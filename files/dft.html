<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-03 Fri 12:55 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Modeling materials using density functional theory</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="John Kitchin" />
<meta  name="description" content="A book on using density functional theory to model materials."
 />
<meta  name="keywords" content="Density functional theory, materials, VASP" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Modeling materials using density functional theory</h1>

<div class="figure">
<p><img src="./images/cover-page.png" alt="cover-page.png" width="200" />
</p>
</div>

<p>
Copyright \copyright 2012--\the\year\ John Kitchin\par
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled "GNU
Free Documentation License".
</p>


<p>
\maketitle
\tableofcontents
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Introduction to this book</h2>
<div class="outline-text-2" id="text-1">
<p>
This book serves two purposes: 1) to provide worked examples of using DFT to model materials properties, and 2) to provide references to more advanced treatments of these topics in the literature. It is not a definitive reference on density functional theory. Along the way to learning how to perform the calculations, you will learn how to analyze the data, make plots, and how to interpret the results. This book is very much "recipe" oriented, with the intention of giving you enough information and knowledge to start your research. In that sense, many of the computations are not publication quality with respect to convergence of calculation parameters.
</p>

<p>
You will read a lot of python code in this book. I believe that computational work should always be scripted. Scripting provides a written record of everything you have done, making it more probable you (or others) could reproduce your results or report the method of its execution exactly at a later time.
</p>

<p>
This book makes heavy use of many computational tools including:
</p>

<ul class="org-ul">
<li><a href="http://python.org/">Python</a>
<ul class="org-ul">
<li><a href="http://docs.python.org/modindex.html">Module index</a></li>
</ul></li>
<li><a href="https://wiki.fysik.dtu.dk/ase/">Atomic Simulation Environment (ase)</a></li>
<li><a href="http://numpy.scipy.org/">numpy</a></li>
<li><a href="http://www.scipy.org/">scipy</a></li>
<li><a href="http://matplotlib.sourceforge.net/">matplotlib</a></li>
<li><a href="http://www.gnu.org/software/emacs/">emacs</a>
<ul class="org-ul">
<li><a href="http://orgmode.org/">org-mode</a> This book is written in org-mode, and is best read in
emacs in org-mode. This format provides clickable links, easy
navigation, syntax highlighting, as well as the ability to
interact with the tables and code. The book is also available in
PDF.</li>
</ul></li>
<li><a href="http://github.org/">git</a>
  This book is available at <a href="https://github.com/jkitchin/dft-book">https://github.com/jkitchin/dft-book</a></li>

<li><a href="https://github.com/jkitchin/vasp">vasp</a>
  This is the Python module used extensively here. It is available at <a href="https://github.com/jkitchin/vasp">https://github.com/jkitchin/vasp</a></li>
</ul>


<p>
The DFT code used primarily in this book is <a href="http://cms.mpi.univie.ac.at/vasp/guide/vasp.html">VASP</a>.
</p>
<ul class="org-ul">
<li><a href="http://cms.mpi.univie.ac.at/wiki/index.php/Main_Page">VASP wiki</a></li>
<li><a href="http://cms.mpi.univie.ac.at/wiki/index.php/The_VASP_Manual">VASP Manual</a></li>
</ul>

<p>
Similar code would be used for other calculators, e.g. GPAW, Jacapo, etc&#x2026; you would just have to import the python modules for those codes, and replace the code that defines the calculator.
</p>

<div class="exercise">
<p>
Review all the hyperlinks in this chapter.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><a id="ID-948b9c8b-a583-43d5-aa23-4927aa3633cb"></a><span class="section-number-2">2</span> Introduction to DFT</h2>
<div class="outline-text-2" id="text-2">
<p>
A comprehensive overview of DFT is beyond the scope of this book, as excellent reviews on these subjects are readily found in the literature, and are suggested reading in the following paragraph.  Instead, this chapter is intended to provide a useful starting point for a non-expert to begin learning about and using DFT in the manner used in this book. Much of the information presented here is standard knowledge among experts, but a consequence of this is that it is rarely discussed in current papers in the literature. A secondary goal of this chapter is to provide new users with a path through the extensive literature available and to point out potential difficulties and pitfalls in these calculations.
</p>


<p>
A modern and practical introduction to density functional theory can be found in Sholl and Steckel <a class='org-ref-reference' href="#sholl-2009-densit-funct-theor">sholl-2009-densit-funct-theor</a>. A fairly standard textbook on DFT is the one written by Parr and Yang <a class='org-ref-reference' href="#parr-yang">parr-yang</a>.  The Chemist's Guide to DFT <a class='org-ref-reference' href="#koch2001">koch2001</a> is more readable and contains more practical information for running calculations, but both of these books focus on molecular systems.  The standard texts in solid state physics are by Kittel <a class='org-ref-reference' href="#kittel">kittel</a> and Ashcroft and Mermin <a class='org-ref-reference' href="#ashcroft-mermin">ashcroft-mermin</a>. Both have their fine points, the former being more mathematically rigorous and the latter more readable.  However, neither of these books is particularly easy to relate to chemistry.  For this, one should consult the exceptionally clear writings of Roald Hoffman <a class='org-ref-reference' href="#hoffmann1987">hoffmann1987</a>,<a class='org-ref-reference' href="#RevModPhys.60.601">RevModPhys.60.601</a>, and follow these with the work of N\o rskov and coworkers <a class='org-ref-reference' href="#hammer2000:adv-cat">hammer2000:adv-cat</a>,<a class='org-ref-reference' href="#greeley2002:elect">greeley2002:elect</a>.
</p>

<p>
In this chapter, only the elements of DFT that are relevant to this work will be discussed.  An excellent review on other implementations of DFT can be found in Reference <a class='org-ref-reference' href="#freeman1995:densit">freeman1995:densit</a>, and details on the various algorithms used in DFT codes can be found in Refs.  <a class='org-ref-reference' href="#payne1992:iterat">payne1992:iterat</a>,<a class='org-ref-reference' href="#Kresse199615">Kresse199615</a>.
</p>

<p>
One of the most useful sources of information has been the dissertations of other students, perhaps because the difficulties they faced in learning the material are still fresh in their minds. Thomas Bligaard, a coauthor of Dacapo, wrote a particularly relevant thesis on exchange/correlation functionals <a class='org-ref-reference' href="#bligaard2000:exchan-correl-funct">bligaard2000:exchan-correl-funct</a> and a dissertation illustrating the use of DFT to design new alloys with desirable thermal and mechanical properties <a class='org-ref-reference' href="#bligaard2003:under-mater-proper-basis-densit">bligaard2003:under-mater-proper-basis-densit</a>.  The Ph.D.  thesis of Ari Seitsonen contains several useful appendices on k-point setups, and convergence tests of calculations, in addition to a thorough description of DFT and analysis of calculation output <a class='org-ref-reference' href="#seitsonen2000:phd">seitsonen2000:phd</a>. Finally, another excellent overview of DFT and its applications to bimetallic alloy phase diagrams and surface reactivity is presented in the PhD thesis of Robin Hirschl <a class='org-ref-reference' href="#hirschl2002:binar-trans-metal-alloy-their-surfac">hirschl2002:binar-trans-metal-alloy-their-surfac</a>.
</p>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><a id="ID-065443d5-59d7-4119-b530-7b63af28349b"></a><span class="section-number-3">2.1</span> Background</h3>
<div class="outline-text-3" id="text-2-1">
<p>
In 1926, Erwin Schr&ouml;dinger published the first accounts of his now famous wave equation <a class='org-ref-reference' href="#pauling1963">pauling1963</a>. He later shared the Nobel prize with Paul A. M. Dirac in 1933 for this discovery. Schr&ouml;dinger's wave function seemed extremely promising, as it contains all of the information available about a system. Unfortunately, most practical systems of interest consist of many interacting electrons, and the effort required to find solutions to Schr&ouml;dinger's equation increases exponentially with the number of electrons, limiting this approach to systems with a small number of relevant electrons, \(N \lesssim O(10)\) <a class='org-ref-reference' href="#RevModPhys.71.1253">RevModPhys.71.1253</a>. Even if this rough estimate is off by an order of magnitude, a system with 100 electrons is still very small, for example, two Ru atoms if all the electrons are counted, or perhaps ten Pt atoms if only the valence electrons are counted. Thus, the wave function method, which has been extremely successful in studying the properties of small molecules, is unsuitable for studies of large, extended solids. Interestingly, this difficulty was recognized by Dirac as early as 1929, when he wrote "The underlying physical laws necessary for the mathematical theory of a large part of physics and the whole of chemistry are thus completely known, and the difficulty is only that the application of these laws leads to equations much too complicated to be soluble."  <a class='org-ref-reference' href="#dirac1929:quant-mechan-many-elect-system">dirac1929:quant-mechan-many-elect-system</a>.
</p>

<p>
In 1964, Hohenberg and Kohn showed that the ground state total energy of a system of interacting electrons is a unique functional of the electron density <a class='org-ref-reference' href="#PhysRev.136.B864">PhysRev.136.B864</a>. By definition, a function returns a number when given a number. For example, in \(f(x)=x^2\), \(f(x)\) is the function, and it equals four when \(x=2\). A functional returns a number when given a function. Thus, in \(g(f(x))=\int_0^\pi f(x) dx\), \(g(f(x))\) is the functional, and it is equal to two when \(f(x)=\sin(x)\). Hohenberg and Kohn further identified a variational principle that appeared to reduce the problem of finding the ground state energy of an electron gas in an external potential (i.e., in the presence of ion cores) to that of the minimization of a functional of the three-dimensional density function.  Unfortunately, the definition of the functional involved a set of 3N-dimensional trial wave functions.
</p>

<p>
In 1965, Kohn and Sham made a significant breakthrough when they showed that the problem of many interacting electrons in an external potential can be mapped exactly to a set of noninteracting electrons in an effective external potential <a class='org-ref-reference' href="#PhysRev.140.A1133">PhysRev.140.A1133</a>.  This led to a set of self-consistent, single particle equations known as the Kohn-Sham (KS) equations:
</p>

<p>
with
</p>

<p>
where \(v(\mathbf{r})\) is the external potential and \(v_{xc}(\mathbf{r})\) is the exchange-correlation potential, which depends on the entire density function. Thus, the density needs to be known in order to define the effective potential so that Eq. \eqref{eq:KS} can be solved.  \(\varphi_j(\mathbf{r})\) corresponds to the \(j^{th}\) KS orbital of energy \(\epsilon_j\).
</p>

<p>
The ground state density is given by:
</p>
<p>
To solve Eq. \eqref{eq:KS} then, an initial guess is used for \(\varphi_j(r)\) which is used to generate Eq. \eqref{eq:density}, which is subsequently used in Eq. \eqref{eq:veff}. This equation is then solved for \(\varphi_j(\mathbf{r})\) iteratively until the \(\varphi_j(\mathbf{r})\) that result from the solution are the same as the \(\varphi_j(\mathbf{r})\) that are used to define the equations, that is, the solutions are self-consistent.  Finally, the ground state energy is given by:
</p>

<p>
where \(E_{xc}[n(\mathbf{r})]\) is the exchange-correlation energy functional.  Walter Kohn shared the Nobel prize in Chemistry in 1998 for this work <a class='org-ref-reference' href="#RevModPhys.71.1253">RevModPhys.71.1253</a>. The other half of the prize went to John Pople for his efforts in wave function based quantum mechanical methods <a class='org-ref-reference' href="#RevModPhys.71.1267">RevModPhys.71.1267</a>.  Provided the exchange-correlation energy functional is known, Eq.  (<a href="#eq:dftEnergy">eq:dftEnergy</a>) is exact.  However, the exact form of the exchange-correlation energy functional is not known, thus approximations for this functional must be used.
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.2</span> Exchange correlation functionals</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The two main types of exchange/correlation functionals used in DFT are the local density approximation (LDA) and the generalized gradient approximation (GGA). In the LDA, the exchange-correlation functional is defined for an electron in a uniform electron gas of density \(n\) <a class='org-ref-reference' href="#PhysRev.140.A1133">PhysRev.140.A1133</a>. It is exact for a uniform electron gas, and is anticipated to be a reasonable approximation for slowly varying densities. In molecules and solids, however, the density tends to vary substantially in space. Despite this, the LDA has been very successfully used in many systems. It tends to predict overbonding in both molecular and solid systems <a class='org-ref-reference' href="#fuchs1998:pseud">fuchs1998:pseud</a>, and it tends to make semiconductor systems too metallic (the band gap problem) <a class='org-ref-reference' href="#perdew1982:elect-kohn-sham">perdew1982:elect-kohn-sham</a>.
</p>

<p>
The generalized gradient approximation includes corrections for gradients in the electron density, and is often implemented as a corrective function of the LDA.  The form of this corrective function, or "exchange enhancement" function determines which functional it is, e.g. PBE, RPBE, revPBE, etc. <a class='org-ref-reference' href="#hammer1999:improv-pbe">hammer1999:improv-pbe</a>. In this book the PBE GGA functional is used the most. N\o{}rskov and coworkers have found that the RPBE functional gives superior chemisorption energies for atomic and molecular bonding to surfaces, but that it gives worse bulk properties, such as lattice constants compared to experimental data <a class='org-ref-reference' href="#hammer1999:improv-pbe">hammer1999:improv-pbe</a>.
</p>

<p>
Finally, there are increasingly new types of functionals in the literature. The so-called hybrid functionals, such as B3LYP, are more popular with gaussian basis sets (e.g. in Gaussian), but they are presently inefficient with planewave basis sets. None of these other types of functionals were used in this work. For more details see Chapter 6 in Ref. <a class='org-ref-reference' href="#koch2001">koch2001</a> and Thomas Bligaard's thesis on exchange and correlation functionals <a class='org-ref-reference' href="#bligaard2000:exchan-correl-funct">bligaard2000:exchan-correl-funct</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">2.3</span> Basis sets</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Briefly, VASP utilizes planewaves as the basis set to expand the
Kohn-Sham orbitals.  In a periodic solid, one can use Bloch's theorem
to show that the wave function for an electron can be expressed as the
product of a planewave and a function with the periodicity of the
lattice <a class='org-ref-reference' href="#ashcroft-mermin">ashcroft-mermin</a>:
</p>
\begin{equation}
\psi_{n\mathbf{k}}(\mathbf{r})=\exp({i\mathbf{k}\cdot\mathbf{r}})u_{n\mathbf{k}}(\mathbf{r})
\end{equation}

<p>
where \(\mathbf{r}\) is a position vector, and \(\mathbf{k}\) is a so-called wave vector that will only have certain allowed values defined by the size of the unit cell. Bloch's theorem sets the stage for using planewaves as a basis set, because it suggests a planewave character of the wave function. If the periodic function \(u_{n\mathbf{k}}(\mathbf{r})\) is also expanded in terms of planewaves determined by wave vectors of the reciprocal lattice vectors, \(\mathbf{G}\), then the wave function can be expressed completely in terms of a sum of planewaves <a class='org-ref-reference' href="#payne1992:iterat">payne1992:iterat</a>:
</p>

\begin{equation}
\psi_i(\mathbf{r})=\sum_\mathbf{G} c_{i,\mathbf{k+G}} \exp(i\mathbf{(k+G)\cdot r}).
\end{equation}

<p>
where \(c_{i,\mathbf{k+G}}\) are now coefficients that can be varied to determine the lowest energy solution. This also converts Eq.  \eqref{eq:KS} from an integral equation to a set of algebraic equations that can readily be solved using matrix algebra.
</p>

<p>
In aperiodic systems, such as systems with even one defect, or randomly ordered alloys, there is no periodic unit cell. Instead one must represent the portion of the system of interest in a supercell, which is then subjected to the periodic boundary conditions so that a planewave basis set can be used. It then becomes necessary to ensure the supercell is large enough to avoid interactions between the defects in neighboring supercells. The case of the randomly ordered alloy is virtually hopeless as the energy of different configurations will fluctuate statistically about an average value.  These systems were not considered in this work, and for more detailed discussions the reader is referred to Ref. <a class='org-ref-reference' href="#makov1995:period-bound-condit">makov1995:period-bound-condit</a>.  Once a supercell is chosen, however, Bloch's theorem can be applied to the new artificially periodic system.
</p>

<p>
To get a perfect expansion, one needs an infinite number of planewaves.  Luckily, the coefficients of the planewaves must go to zero for high energy planewaves, otherwise the energy of the wave function would go to infinity. This provides justification for truncating the planewave basis set above a cutoff energy. Careful testing of the effect of the cutoff energy on the total energy can be done to determine a suitable cutoff energy. The cutoff energy required to obtain a particular convergence precision is also element dependent, shown in Table <a href="#tab:pwcut">tab:pwcut</a>. It can also vary with the "softness" of the pseudopotential.  Thus, careful testing should be done to ensure the desired level of convergence of properties in different systems. Table <a href="#tab:pwcut">tab:pwcut</a> refers to convergence of total energies. These energies are rarely considered directly, it is usually differences in energy that are important. These tend to converge with the planewave cutoff energy much more quickly than total energies, due to cancellations of convergence errors.  In this work, 350 eV was found to be suitable for the H adsorption calculations, but a cutoff energy of 450 eV was required for O adsorption calculations.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Planewave cutoff energies (in eV) required for different convergence precisions for two different elements with different pseudopotential setups. <div id="tab:pwcut"></caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Precision</th>
<th scope="col" class="org-right">Low</th>
<th scope="col" class="org-right">High</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Mo</td>
<td class="org-right">168</td>
<td class="org-right">293</td>
</tr>

<tr>
<td class="org-left">O</td>
<td class="org-right">300</td>
<td class="org-right">520</td>
</tr>

<tr>
<td class="org-left">O_sv</td>
<td class="org-right">1066</td>
<td class="org-right">1847</td>
</tr>
</tbody>
</table>

<p>
Bloch's theorem eliminates the need to calculate an infinite number of wave functions, because there are only a finite number of electrons in the unit (super) cell. However, there are still an infinite number of discrete \(\mathbf{k}\) points that must be considered, and the energy of the unit cell is calculated as an integral over these points.  It turns out that wave functions at \(\mathbf{k}\) points that are close together are similar, thus an interpolation scheme can be used with a finite number of \(\mathbf{k}\) points. This also converts the integral used to determine the energy into a sum over the \(\mathbf{k}\) points, which are suitably weighted to account for the finite number of them.  There will be errors in the total energy associated with the finite number of \(\mathbf{k}\), but these can be reduced and tested for convergence by using higher $\mathbf{k}$-point densities. An excellent discussion of this for aperiodic systems can be found in Ref.  <a class='org-ref-reference' href="#makov1995:period-bound-condit">makov1995:period-bound-condit</a>.
</p>

<p>
The most common schemes for generating \(\mathbf{k}\) points are the Chadi-Cohen scheme <a class='org-ref-reference' href="#PhysRevB.8.5747">PhysRevB.8.5747</a>, and the Monkhorst-Pack scheme <a class='org-ref-reference' href="#PhysRevB.13.5188">PhysRevB.13.5188</a>. The use of these \(\mathbf{k}\) point setups amounts to an expansion of the periodic function in reciprocal space, which allows a straight-forward interpolation of the function between the points that is more accurate than with other \(\mathbf{k}\) point generation schemes <a class='org-ref-reference' href="#PhysRevB.13.5188">PhysRevB.13.5188</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">2.4</span> Pseudopotentials</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The core electrons of an atom are computationally expensive with planewave basis sets because they are highly localized. This means that a very large number of planewaves are required to expand their wave functions. Furthermore, the contributions of the core electrons to bonding compared to those of the valence electrons is usually negligible. In fact, the primary role of the core electron wave functions is to ensure proper orthogonality between the valence electrons and core states.  Consequently, it is desirable to replace the atomic potential due to the core electrons with a pseudopotential that has the same effect on the valence electrons <a class='org-ref-reference' href="#PhysRevB.43.1993">PhysRevB.43.1993</a>. There are essentially two kinds of pseudopotentials, norm-conserving soft pseudopotentials <a class='org-ref-reference' href="#PhysRevB.43.1993">PhysRevB.43.1993</a> and Vanderbilt ultrasoft pseudopotentials <a class='org-ref-reference' href="#PhysRevB.41.7892">PhysRevB.41.7892</a>. In either case, the pseudopotential function is generated from an all-electron calculation of an atom in some reference state. In norm-conserving pseudopotentials, the charge enclosed in the pseudopotential region is the same as that enclosed by the same space in an all-electron calculation. In ultrasoft pseudopotentials, this requirement is relaxed and charge augmentation functions are used to make up the difference. As its name implies, this allows a "softer" pseudopotential to be generated, which means fewer planewaves are required to expand it.
</p>

<p>
The pseudopotentials are not unique, and calculated properties depend on them. However, there are standard methods for ensuring the quality and transferability (to different chemical environments) of the pseudopotentials <a class='org-ref-reference' href="#PhysRevB.56.15629">PhysRevB.56.15629</a>.
</p>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> PAW description</b><br  />
nil</div>

<p>
VASP provides a database of PAW potentials <a class='org-ref-reference' href="#PhysRevB.50.17953">PhysRevB.50.17953</a>,<a class='org-ref-reference' href="#PhysRevB.59.1758">PhysRevB.59.1758</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">2.5</span> Fermi Temperature and band occupation numbers</h3>
<div class="outline-text-3" id="text-2-5">
<p>
At absolute zero, the occupancies of the bands of a system are well-defined step functions; all bands up to the Fermi level are occupied, and all bands above the Fermi level are unoccupied.  There is a particular difficulty in the calculation of the electronic structures of metals compared to semiconductors and molecules. In molecules and semiconductors, there is a clear energy gap between the occupied states and unoccupied states. Thus, the occupancies are insensitive to changes in the energy that occur during the self-consistency cycles. In metals, however, the density of states is continuous at the Fermi level, and there are typically a substantial number of states that are close in energy to the Fermi level.  Consequently, small changes in the energy can dramatically change the occupation numbers, resulting in instabilities that make it difficult to converge to the occupation step function. A related problem is that the Brillouin zone integral (which in practice is performed as a sum over a finite number of \(\mathbf{k}\) points) that defines the band energy converges very slowly with the number of \(\mathbf{k}\) points due to the discontinuity in occupancies in a continuous distribution of states for metals <a class='org-ref-reference' href="#gillan1989:calcul">gillan1989:calcul</a>,<a class='org-ref-reference' href="#Kresse199615">Kresse199615</a>.  The difficulty arises because the temperature in most DFT calculations is at absolute zero.  At higher temperatures, the DOS is smeared across the Fermi level, resulting in a continuous occupation function over the distribution of states. A finite-temperature version of DFT was developed <a class='org-ref-reference' href="#PhysRev.137.A1441">PhysRev.137.A1441</a>, which is the foundation on which one solution to this problem is based. In this solution, the step function is replaced by a smoothly varying function such as the Fermi-Dirac function at a small, but non-zero temperature <a class='org-ref-reference' href="#Kresse199615">Kresse199615</a>. The total energy is then extrapolated back to absolute zero.
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">2.6</span> Spin polarization and magnetism</h3>
<div class="outline-text-3" id="text-2-6">
<p>
There are two final points that need to be discussed about these calculations, spin polarization and dipole corrections. Spin polarization is important for systems that contain net spin. For example, iron, cobalt and nickel are magnetic because they have more electrons with spin "up" than spin "down" (or vice versa).  Spin polarization must also be considered in atoms and molecules with unpaired electrons, such as hydrogen and oxygen atoms, oxygen molecules and radicals. For example, there are two spin configurations for an oxygen molecule, the singlet state with no unpaired electrons, and the triplet state with two unpaired electrons. The oxygen triplet state is lower in energy than the oxygen singlet state, and thus it corresponds to the ground state for an oxygen atom. A classically known problem involving spin polarization is the dissociation of a hydrogen molecule. In this case, the molecule starts with no net spin, but it dissociates into two atoms, each of which has an unpaired electron.  See section 5.3.5 in Reference <a class='org-ref-reference' href="#koch2001">koch2001</a> for more details on this.
</p>


<p>
In VASP, spin polarization is not considered by default; it must be turned on, and an initial guess for the magnetic moment of each atom in the unit cell must be provided (typically about one Bohr-magneton per unpaired electron). For Fe, Co, and Ni, the experimental values are 2.22, 1.72, and 0.61 Bohr-magnetons, respectively <a class='org-ref-reference' href="#kittel">kittel</a> and are usually good initial guesses. See Reference <a class='org-ref-reference' href="#PhysRevB.56.15629">PhysRevB.56.15629</a> for a very thorough discussion of the determination of the magnetic properties of these metals with DFT. For a hydrogen atom, an initial guess of 1.0 Bohr-magnetons (corresponding to one unpaired electron) is usually good. An oxygen atom has two unpaired electrons, thus an initial guess of 2.0 Bohr-magnetons should be used.  The spin-polarized solution is sensitive to the initial guess, and typically converges to the closest solution. Thus, a magnetic initial guess usually must be provided to get a magnetic solution.  Finally, unless an adsorbate is on a magnetic metal surface, spin polarization typically does not need to be considered, although the gas-phase reference state calculation may need to be done with spin-polarization.
</p>

<p>
The downside of including spin polarization is that it essentially doubles the calculation time.
</p>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">2.7</span> Recommended reading</h3>
<div class="outline-text-3" id="text-2-7">
<p>
The original papers on DFT are <a class='org-ref-reference' href="#PhysRev.136.B864">PhysRev.136.B864</a>,<a class='org-ref-reference' href="#PhysRev.140.A1133">PhysRev.140.A1133</a>.
</p>

<p>
Kohn's Nobel Lecture <a class='org-ref-reference' href="#RevModPhys.71.1253">RevModPhys.71.1253</a> and Pople's Nobel Lecture <a class='org-ref-reference' href="#RevModPhys.71.1267">RevModPhys.71.1267</a> are good reads.
</p>

<p>
This paper by Hoffman <a class='org-ref-reference' href="#RevModPhys.60.601">RevModPhys.60.601</a> is a nice review of solid state physics from a chemist's point of view.
</p>

<p>
All calculations in this book were performed using VASP <a class='org-ref-reference' href="#Kresse199615">Kresse199615</a>,<a class='org-ref-reference' href="#PhysRevB.54.11169">PhysRevB.54.11169</a>,<a class='org-ref-reference' href="#PhysRevB.49.14251">PhysRevB.49.14251</a>,<a class='org-ref-reference' href="#PhysRevB.47.558">PhysRevB.47.558</a> with the projector augmented wave (PAW) potentials provided in VASP.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-2">
<h2 id="orgheadline69"><a id="ID-0ba173be-1449-4c71-b040-02864f3af5a5"></a><span class="section-number-2">3</span> Molecules</h2>
<div class="outline-text-2" id="text-3">
<p>
In this chapter we consider how to construct models of molecules, how to manipulate them, and how to calculate many properties of molecules. For a nice comparison of VASP and Gaussian see <a class='org-ref-reference' href="#paier:234102">paier:234102</a>.
</p>
</div>
<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">3.1</span> Defining and visualizing molecules</h3>
<div class="outline-text-3" id="text-3-1">
<p>
We start by learning how to define a molecule and visualize it. We will begin with defining molecules from scratch, then reading molecules from data files, and finally using some built-in databases in <code>ase</code>.
</p>
</div>
<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11"><span class="section-number-4">3.1.1</span> From scratch</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
When there is no data file for the molecule you want, or no database to get it from, you have to define your atoms geometry by hand. Here is how that is done for a CO molecule (Figure <a href="#fig:co-origin">fig:co-origin</a>). We must define the type and position of each atom, and the unit cell the atoms are in.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">define an Atoms object</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [1.1, 0., 0.])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'V = {0:1.0f} Angstrom^3'</span>.<span style="color: #006FE0;">format</span>(atoms.get_volume()))

write(<span style="color: #008000;">'images/simple-cubic-cell.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>

<pre class="example">
V = 1000 Angstrom^3
</pre>


<div class="figure">
<p><img src="./images/simple-cubic-cell.png" alt="simple-cubic-cell.png" />
</p>
<p><span class="figure-number">Figure 2:</span> Image of a CO molecule with the C at the origin. \label{fig:co-origin}</p>
</div>

<p>
There are two inconvenient features of the simple cubic cell:
</p>

<ol class="org-ol">
<li>Since the CO molecule is at the corner, its electron density is spread over the 8 corners of the box, which is not convenient for visualization later (see <a href="#orgheadline10">Visualizing electron density</a>).</li>

<li>Due to the geometry of the cube, you need fairly large cubes to make sure the electron density of the molecule does not overlap with that of its images. Electron-electron interactions are repulsive, and the overlap makes the energy increase significantly. Here, the CO molecule has 6 images due to periodic boundary conditions that are 10 &Aring; away. The volume of the unit cell is 1000 &Aring;\(^3\).</li>
</ol>

<p>
The first problem is easily solved by centering the atoms in the unit cell. The second problem can be solved by using a face-centered cubic lattice, which is the lattice with the closest packing. We show the results of the centering in Figure <a href="#fig:co-fcc">fig:co-fcc</a>, where we have guessed values for \(b\) until the CO molecules are on average 10 &Aring; apart. Note the final volume is only about 715 &Aring;\(^3\), which is smaller than the cube. This will result in less computational time to compute properties.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">b</span> = 7.1
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [1.1, 0., 0.])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[b, b, 0.],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [b, 0., b],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0., b, b]])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'V = {0:1.0f} Ang^3'</span>.<span style="color: #006FE0;">format</span>(atoms.get_volume()))

atoms.center()  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">translate atoms to center of unit cell</span>
write(<span style="color: #008000;">'images/fcc-cell.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>

<pre class="example">
V = 716 Ang^3
</pre>


<div class="figure">
<p><img src="./images/fcc-cell.png" alt="fcc-cell.png" />
</p>
<p><span class="figure-number">Figure 3:</span> CO in a face-centered cubic unit cell. \label{fig:co-fcc}</p>
</div>

<p>
At this point you might ask, "How do you know the distance to the neighboring image?" The <code>ag</code> viewer lets you compute this graphically, but we can use code to determine this too. All we have to do is figure out the length of each lattice vector, because these are what separate the atoms in the images. We use the <a href="numpy">numpy</a> module to compute the distance of a vector as the square root of the sum of squared elements.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">b</span> = 7.1
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [1.1, 0., 0.])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[b, b, 0.],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [b, 0., b],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0., b, b]])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get unit cell vectors and their lengths</span>
(a1, a2, a3) = atoms.get_cell()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|a1| = {0:1.2f} Ang'</span>.<span style="color: #006FE0;">format</span>(np.<span style="color: #006FE0;">sum</span>(a1**2)**0.5))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|a2| = {0:1.2f} Ang'</span>.<span style="color: #006FE0;">format</span>(np.linalg.norm(a2)))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|a3| = {0:1.2f} Ang'</span>.<span style="color: #006FE0;">format</span>(np.<span style="color: #006FE0;">sum</span>(a3**2)**0.5))
</pre>
</div>

<pre class="example">
|a1| = 10.04 Ang
|a2| = 10.04 Ang
|a3| = 10.04 Ang
</pre>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12"><span class="section-number-4">3.1.2</span> Reading other data formats into a calculation</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
<a href="ase.io.read">ase.io.read</a> supports many different file formats:
</p>
<pre class="example">
    Known formats:

    =========================  ===========
    format                     short name
    =========================  ===========
    GPAW restart-file          gpw
    Dacapo netCDF output file  dacapo
    Old ASE netCDF trajectory  nc
    Virtual Nano Lab file      vnl
    ASE pickle trajectory      traj
    ASE bundle trajectory      bundle
    GPAW text output           gpaw-text
    CUBE file                  cube
    XCrySDen Structure File    xsf
    Dacapo text output         dacapo-text
    XYZ-file                   xyz
    VASP POSCAR/CONTCAR file   vasp
    VASP OUTCAR file           vasp_out
    SIESTA STRUCT file         struct_out
    ABINIT input file          abinit
    V_Sim ascii file           v_sim
    Protein Data Bank          pdb
    CIF-file                   cif
    FHI-aims geometry file     aims
    FHI-aims output file       aims_out
    VTK XML Image Data         vti
    VTK XML Structured Grid    vts
    VTK XML Unstructured Grid  vtu
    TURBOMOLE coord file       tmol
    TURBOMOLE gradient file    tmol-gradient
    exciting input             exi
    AtomEye configuration      cfg
    WIEN2k structure file      struct
    DftbPlus input file        dftb
    CASTEP geom file           cell
    CASTEP output file         castep
    CASTEP trajectory file     geom
    ETSF format                etsf.nc
    DFTBPlus GEN format        gen
    CMR db/cmr-file            db
    CMR db/cmr-file            cmr
    LAMMPS dump file           lammps
    Gromacs coordinates        gro
    =========================  ===========
</pre>

<p>
You can read XYZ file format to create <a href="ase.Atoms">ase.Atoms</a> objects.  Here is
what an XYZ file format might look like:
</p>

<pre class="example">
#+include: molecules/isobutane.xyz
</pre>

<p>
The first line is the number of atoms in the file. The second line is
often a comment. What follows is one line per atom with the symbol and
Cartesian coordinates in &Aring;. Note that the XYZ format does not have
unit cell information in it, so you will have to figure out a way to
provide it. In this example, we center the atoms in a box with vacuum
on all sides (Figure <a href="#fig:isobutane">fig:isobutane</a>).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> read, write

<span style="color: #BA36A5;">atoms</span> = read(<span style="color: #008000;">'molecules/isobutane.xyz'</span>)
atoms.center(vacuum=5)
write(<span style="color: #008000;">'images/isobutane-xyz.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/isobutane-xyz.png" alt="isobutane-xyz.png" />
</p>
<p><span class="figure-number">Figure 4:</span> An isobutane molecule read in from an XYZ formatted data file. \label{fig:isobutane}</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">3.1.3</span> Predefined molecules</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
<a href="ase">ase</a> defines a number of molecular geometries in the
<a href="ase.data.molecules">ase.data.molecules</a> database.  For example, the database includes
the molecules in the G2/97 database <a class='org-ref-reference' href="#curtiss:1063">curtiss:1063</a>. This database
contains a broad set of atoms and molecules for which good
experimental data exists, making them useful for benchmarking studies.
See <a href="http://www.cse.anl.gov/OldCHMwebsiteContent/compmat/comptherm.htm">this site</a> for the original files.
</p>

<p>
The coordinates for the atoms in the database are <a href="http://en.wikipedia.org/wiki/M%C3%B8ller-Plesset_perturbation_theory">MP2</a>(full)/<a href="http://en.wikipedia.org/wiki/Basis_set_(chemistry)">6-31G(d)</a>
optimized geometries. Here is a list of all the species available in
<a href="ase.data.g2">ase.data.g2</a>. You may be interested in reading about some of the other databases in <a href="ase.data">ase.data</a> too.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> g2
<span style="color: #BA36A5;">keys</span> = g2.data.keys()
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">print in 3 columns</span>
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(keys) / 3):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:25s}{1:25s}{2:25s}'</span>.<span style="color: #006FE0;">format</span>(*<span style="color: #006FE0;">tuple</span>(keys[i * 3: i * 3 + 3])))
</pre>
</div>

<pre class="example">
isobutene                CH3CH2OH                 CH3COOH
COF2                     CH3NO2                   CF3CN
CH3OH                    CCH                      CH3CH2NH2
PH3                      Si2H6                    O3
O2                       BCl3                     CH2_s1A1d
Be                       H2CCl2                   C3H9C
C3H9N                    CH3CH2OCH3               BF3
CH3                      CH4                      S2
C2H6CHOH                 SiH2_s1A1d               H3CNH2
CH3O                     H                        BeH
P                        C3H4_C3v                 C2F4
OH                       methylenecyclopropane    F2O
SiCl4                    HCF3                     HCCl3
C3H7                     CH3CH2O                  AlF3
CH2NHCH2                 SiH2_s3B1d               H2CF2
SiF4                     H2CCO                    PH2
OCS                      HF                       NO2
SH2                      C3H4_C2v                 H2O2
CH3CH2Cl                 isobutane                CH3COF
HCOOH                    CH3ONO                   C5H8
2-butyne                 SH                       NF3
HOCl                     CS2                      P2
C                        CH3S                     O
C4H4S                    S                        C3H7Cl
H2CCHCl                  C2H6                     CH3CHO
C2H4                     HCN                      C2H2
C2Cl4                    bicyclobutane            H2
C6H6                     N2H4                     C4H4NH
H2CCHCN                  H2CCHF                   cyclobutane
HCl                      CH3OCH3                  Li2
Na                       CH3SiH3                  NaCl
CH3CH2SH                 OCHCHO                   SiH4
C2H5                     SiH3                     NH
ClO                      AlCl3                    CCl4
NO                       C2H3                     ClF
HCO                      CH3CONH2                 CH2SCH2
CH3COCH3                 C3H4_D2d                 CH
CO                       CN                       F
CH3COCl                  N                        CH3Cl
Si                       C3H8                     CS
N2                       Cl2                      NCCN
F2                       CO2                      Cl
CH2OCH2                  H2O                      CH3CO
SO                       HCOOCH3                  butadiene
ClF3                     Li                       PF3
B                        CH3SH                    CF4
C3H6_Cs                  C2H6NH                   N2O
LiF                      H2COH                    cyclobutene
LiH                      SiO                      Si2
C2H6SO                   C5H5N                    trans-butane
Na2                      C4H4O                    SO2
NH3                      NH2                      CH2_s3B1d
ClNO                     C3H6_D3h                 Al
CH3SCH3                  H2CO                     CH3CN
</pre>

<p>
<a id="orgtarget1"></a>
Some other databases include the <a href="ase.data.s22">ase.data.s22</a> for weakly interacting dimers and complexes, and <a href="ase.data.extra_molecules">ase.data.extra_molecules</a> which has a few extras like biphenyl and C60.
</p>

<p>
Here is an example of getting the geometry of an acetonitrile molecule and writing an image to a file. Note that the default unit cell is a 1       cubic cell. That is too small to use if your calculator uses periodic boundary conditions. We center the atoms in the unit cell and add vacuum on each side. We will add 6  of vacuum on each side. In the write command we use the option <code>show_unit_cell</code> =2 to draw the unit cell boundaries. See Figure <a href="#fig:ch3cn">fig:ch3cn</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3CN'</span>)

atoms.center(vacuum=6)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'unit cell'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'---------'</span>)
<span style="color: #0000FF;">print</span>(atoms.get_cell())

write(<span style="color: #008000;">'images/ch3cn.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>

<pre class="example">
unit cell
---------
[[ 13.775328   0.         0.      ]
 [  0.        13.537479   0.      ]
 [  0.         0.        15.014576]]
</pre>


<div class="figure">
<p><img src="./images/ch3cn.png" alt="ch3cn.png" />
</p>
<p><span class="figure-number">Figure 5:</span> A CH<sub>3</sub>CN molecule in a box. \label{fig:ch3cn}</p>
</div>


<p>
It is possible to rotate the atoms with <a href="ase.io.write">ase.io.write</a> if you wanted to see pictures from another angle. In the next example we rotate 45 degrees about the $x$-axis, then 45 degrees about the $y$-axis. Note that this only affects the image, not the actual coordinates. See Figure <a href="#fig:ch3cn-rot">fig:ch3cn-rot</a>.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3CN'</span>)

atoms.center(vacuum=6)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'unit cell'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'---------'</span>)
<span style="color: #0000FF;">print</span>(atoms.get_cell())

write(<span style="color: #008000;">'images/ch3cn-rotated.png'</span>, atoms,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> show_unit_cell=2, rotation=<span style="color: #008000;">'45x,45y,0z'</span>)
</pre>
</div>

<pre class="example">
unit cell
---------
[[ 13.775328   0.         0.      ]
 [  0.        13.537479   0.      ]
 [  0.         0.        15.014576]]
</pre>


<div class="figure">
<p><img src="./images/ch3cn-rotated.png" alt="ch3cn-rotated.png" />
</p>
<p><span class="figure-number">Figure 6:</span> The rotated version of CH<sub>3</sub>CN. \label{fig:ch3cn-rot}</p>
</div>

<p>
If you actually want to rotate the coordinates, there is a nice way to do that too, with the <a href="ase.Atoms.rotate">ase.Atoms.rotate</a> method. Actually there are some subtleties in rotation. One rotates the molecule an angle (in radians) around a vector, but you have to choose whether the center of mass should be fixed or not. You also must decide whether or not the unit cell should be rotated. In the next example you can see the coordinates have changed due to the rotations. Note that the write function uses the rotation angle in degrees, while the rotate function uses radians.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> numpy <span style="color: #0000FF;">import</span> pi

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3CN'</span>)
atoms.center(vacuum=6)
<span style="color: #BA36A5;">p1</span> = atoms.get_positions()

atoms.rotate(<span style="color: #008000;">'x'</span>, pi/4, center=<span style="color: #008000;">'COM'</span>, rotate_cell=<span style="color: #D0372D;">False</span>)
atoms.rotate(<span style="color: #008000;">'y'</span>, pi/4, center=<span style="color: #008000;">'COM'</span>, rotate_cell=<span style="color: #D0372D;">False</span>)

write(<span style="color: #008000;">'images/ch3cn-rotated-2.png'</span>, atoms, show_unit_cell=2)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'difference in positions after rotating'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom    difference vector'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'--------------------------------------'</span>)
<span style="color: #BA36A5;">p2</span> = atoms.get_positions()

<span style="color: #BA36A5;">diff</span> = p2 - p1
<span style="color: #0000FF;">for</span> i, d <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(diff):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0} {1}'</span>.<span style="color: #006FE0;">format</span>(i, d))
</pre>
</div>

<pre class="example">
difference in positions after rotating
atom    difference vector
--------------------------------------
0 [-0.65009456  0.91937255  0.65009456]
1 [ 0.08030744 -0.11357187 -0.08030744]
2 [ 0.66947344 -0.94677841 -0.66947344]
3 [-0.32532156  0.88463727  1.35030756]
4 [-1.35405183  1.33495444 -0.04610517]
5 [-0.8340703   1.33495444  1.2092413 ]
</pre>


<div class="figure">
<p><img src="./images/ch3cn-rotated-2.png" alt="ch3cn-rotated-2.png" />
</p>
<p><span class="figure-number">Figure 7:</span> Rotated CH<sub>3</sub>CN molecule</p>
</div>

<p>
Note in this last case the unit cell is oriented differently than the previous example, since we chose not to rotate the unit cell.
</p>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><span class="section-number-4">3.1.4</span> Combining Atoms objects</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
It is frequently useful to combine two <code>Atoms</code> objects, e.g. for computing reaction barriers, or other types of interactions. In <code>ase</code>, we simply add two <code>Atoms</code> objects together. Here is an example of getting an ammonia and oxygen molecule in the same unit cell. See Figure <a href="#fig:combined-atoms">fig:combined-atoms</a>. We set the <code>Atoms</code> about three &Aring; apart using the <a href="ase.Atoms.translate">ase.Atoms.translate</a> function.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms1</span> = molecule(<span style="color: #008000;">'NH3'</span>)

<span style="color: #BA36A5;">atoms2</span> = molecule(<span style="color: #008000;">'O2'</span>)
atoms2.translate([3, 0, 0])

<span style="color: #BA36A5;">bothatoms</span> = atoms1 + atoms2
bothatoms.center(5)

write(<span style="color: #008000;">'images/bothatoms.png'</span>, bothatoms, show_unit_cell=2, rotation=<span style="color: #008000;">'90x'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/bothatoms.png" alt="bothatoms.png" />
</p>
<p><span class="figure-number">Figure 8:</span> Image featuring ammonia and oxygen molecule in one unit cell. \label{fig:combined-atoms}</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">3.2</span> Simple properties</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Simple properties do not require a DFT calculation. They are typically only functions of the atom types and geometries.
</p>
</div>
<div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><span class="section-number-4">3.2.1</span> Getting cartesian positions</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
If you want the \((x,y,z)\) coordinates of the atoms, use the <a href="ase.Atoms.get_positions">ase.Atoms.get_positions</a>. If you are interested in the fractional coordinates, use <a href="ase.Atoms.get_scaled_positions">ase.Atoms.get_scaled_positions</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'C6H6'</span>)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">benzene</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">access properties on each atom</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">' #  sym   p_x     p_y     p_z'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'------------------------------'</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:3d}{1:^4s}{2:-8.2f}{3:-8.2f}{4:-8.2f}'</span>.<span style="color: #006FE0;">format</span>(i,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atom.symbol,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atom.x,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atom.y,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atom.z))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get all properties in arrays</span>
<span style="color: #BA36A5;">sym</span> = atoms.get_chemical_symbols()
<span style="color: #BA36A5;">pos</span> = atoms.get_positions()
<span style="color: #BA36A5;">num</span> = atoms.get_atomic_numbers()

<span style="color: #BA36A5;">atom_indices</span> = <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(atoms))

<span style="color: #0000FF;">print</span>()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  # sym    at#    p_x     p_y     p_z'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'-------------------------------------'</span>)
<span style="color: #0000FF;">for</span> i, s, n, p <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(atom_indices, sym, num, pos):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">px</span>, <span style="color: #BA36A5;">py</span>, <span style="color: #BA36A5;">pz</span> = p
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:3d}{1:&gt;3s}{2:8d}{3:-8.2f}{4:-8.2f}{5:-8.2f}'</span>.<span style="color: #006FE0;">format</span>(i, s, n,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> px, py, pz))
</pre>
</div>

<pre class="example">
 #  sym   p_x     p_y     p_z
------------------------------
  0 C      0.00    1.40    0.00
  1 C      1.21    0.70    0.00
  2 C      1.21   -0.70    0.00
  3 C      0.00   -1.40    0.00
  4 C     -1.21   -0.70    0.00
  5 C     -1.21    0.70    0.00
  6 H      0.00    2.48    0.00
  7 H      2.15    1.24    0.00
  8 H      2.15   -1.24    0.00
  9 H      0.00   -2.48    0.00
 10 H     -2.15   -1.24    0.00
 11 H     -2.15    1.24    0.00
()
  # sym    at#    p_x     p_y     p_z
-------------------------------------
  0  C       6    0.00    1.40    0.00
  1  C       6    1.21    0.70    0.00
  2  C       6    1.21   -0.70    0.00
  3  C       6    0.00   -1.40    0.00
  4  C       6   -1.21   -0.70    0.00
  5  C       6   -1.21    0.70    0.00
  6  H       1    0.00    2.48    0.00
  7  H       1    2.15    1.24    0.00
  8  H       1    2.15   -1.24    0.00
  9  H       1    0.00   -2.48    0.00
 10  H       1   -2.15   -1.24    0.00
 11  H       1   -2.15    1.24    0.00
</pre>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">3.2.2</span> Molecular weight and molecular formula</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
<a href="molecular weight">molecular weight</a>
We can quickly compute the molecular weight of a molecule with this recipe. We use <a href="ase.Atoms.get_masses">ase.Atoms.get_masses</a> to get an array of the atomic masses of each atom in the <code>Atoms</code> object, and then just sum them up.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
<span style="color: #BA36A5;">masses</span> = atoms.get_masses()

<span style="color: #BA36A5;">molecular_weight</span> = masses.<span style="color: #006FE0;">sum</span>()
<span style="color: #BA36A5;">molecular_formula</span> = atoms.get_chemical_formula(mode=<span style="color: #008000;">'reduce'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note use of two lines to keep length of line reasonable</span>
<span style="color: #BA36A5;">s</span> = <span style="color: #008000;">'The molecular weight of {0} is {1:1.2f} gm/mol'</span>
<span style="color: #0000FF;">print</span>(s.<span style="color: #006FE0;">format</span>(molecular_formula, molecular_weight))
</pre>
</div>

<pre class="example">
The molecular weight of C6H6 is 78.11 gm/mol
</pre>

<p>
Note that the argument <code>reduce=True</code> for <a href="ase.Atoms.get_chemical_formula">ase.Atoms.get_chemical_formula</a> collects all the symbols to provide a molecular formula.
</p>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">3.2.3</span> Center of mass</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
<a href="center of mass">center of mass</a>
The center of mass (COM) is defined as:
</p>

<p>
COM = \(\frac{\sum m_i \cdot r_i}{\sum m_i}\)
</p>

<p>
The center of mass is essentially the average position of the atoms, weighted by the mass of each atom. Here is an example of getting the center of mass from an <code>Atoms</code> object using <a href="ase.Atoms.get_center_of_mass">ase.Atoms.get_center_of_mass</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">ammonia</span>
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cartesian coordinates</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'COM1 = {0}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_center_of_mass()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute the center of mass by hand</span>
<span style="color: #BA36A5;">pos</span> = atoms.positions
<span style="color: #BA36A5;">masses</span> = atoms.get_masses()

<span style="color: #BA36A5;">COM</span> = np.array([0., 0., 0.])
<span style="color: #0000FF;">for</span> m, p <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(masses, pos):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COM</span> += m*p
<span style="color: #BA36A5;">COM</span> /= masses.<span style="color: #006FE0;">sum</span>()

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'COM2 = {0}'</span>.<span style="color: #006FE0;">format</span>(COM))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">one-line linear algebra definition of COM</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'COM3 = {0}'</span>.<span style="color: #006FE0;">format</span>(np.dot(masses, pos) / np.<span style="color: #006FE0;">sum</span>(masses)))
</pre>
</div>

<pre class="example">
COM1 = [  0.00000000e+00   5.91843349e-08   4.75457009e-02]
COM2 = [  0.00000000e+00   5.91843349e-08   4.75457009e-02]
COM3 = [  0.00000000e+00   5.91843349e-08   4.75457009e-02]
</pre>

<p>
You can see see that these centers of mass, which are calculated by different methods, are the same.
</p>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-4">
<h4 id="orgheadline19"><span class="section-number-4">3.2.4</span> Moments of inertia</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
<a href="moment of inertia">moment of inertia</a>
The <a href="http://en.wikipedia.org/wiki/Moment_of_inertia">moment of inertia</a> is a measure of resistance to changes in rotation. It is defined by \(I = \sum_{i=1}^N m_i r_i^2\) where \(r_i\) is the distance to an axis of rotation. There are typically three moments of inertia, although some may be zero depending on symmetry, and others may be degenerate. There is a convenient function to get the  moments of inertia: <a href="ase.Atoms.get_moments_of_inertia">ase.Atoms.get_moments_of_inertia</a>. Here are several examples of molecules with different types of symmetry.:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'linear rotors: I = [0 Ia Ia]'</span>)
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CO2'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  CO2 moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'symmetric rotors (Ia = Ib) &lt; Ic'</span>)
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  NH3 moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  C6H6 moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'symmetric rotors Ia &lt; (Ib = Ic)'</span>)
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3Cl'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'CH3Cl moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'spherical rotors Ia = Ib = Ic'</span>)
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH4'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  CH4 moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'unsymmetric rotors Ia != Ib != Ic'</span>)
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'C3H7Cl'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'  C3H7Cl moments of inertia: {}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_moments_of_inertia()))
</pre>
</div>

<pre class="example">
linear rotors: I = [0 Ia Ia]
  CO2 moments of inertia: [  0.          44.45384271  44.45384271]

symmetric rotors (Ia = Ib) &lt; Ic
  NH3 moments of inertia: [ 1.71012426  1.71012548  2.67031768]
  C6H6 moments of inertia: [  88.77914641   88.77916799  177.5583144 ]

symmetric rotors Ia &lt; (Ib = Ic)
CH3Cl moments of inertia: [  3.20372189  37.97009644  37.97009837]

spherical rotors Ia = Ib = Ic
  CH4 moments of inertia: [ 3.19145621  3.19145621  3.19145621]

unsymmetric rotors Ia != Ib != Ic
  C3H7Cl moments of inertia: [  19.41351508  213.18961963  223.16255537]
</pre>

<p>
If you want to know the principle axes of rotation, we simply pass <code>vectors=True</code> to the function, and it returns the moments of inertia and the principle axes.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3Cl'</span>)
<span style="color: #BA36A5;">moments</span>, <span style="color: #BA36A5;">axes</span> = atoms.get_moments_of_inertia(vectors=<span style="color: #D0372D;">True</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Moments = {0}'</span>.<span style="color: #006FE0;">format</span>(moments))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'axes = {0}'</span>.<span style="color: #006FE0;">format</span>(axes))
</pre>
</div>

<pre class="example">
Moments = [  3.20372189  37.97009644  37.97009837]
axes = [[ 0.  0.  1.]
 [ 0.  1.  0.]
 [ 1.  0.  0.]]
</pre>

<p>
This shows the first moment is about the z-axis, the second moment is about the y-axis, and the third moment is about the x-axis.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">3.2.5</span> Computing bond lengths and angles</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
A typical question we might ask is, "What is the structure of a molecule?" In other words, what are the bond lengths, angles between bonds, and similar properties. The Atoms object contains an <a href="ase.Atoms.get_distance">ase.Atoms.get_distance</a> method to make this easy. To calculate the distance between two atoms, you have to specify their indices, remembering that the index starts at 0.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">ammonia</span>
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom symbol'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'==========='</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:2d} {1:3s}'</span> .<span style="color: #006FE0;">format</span>(i, atom.symbol))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">N-H bond length</span>
<span style="color: #BA36A5;">s</span> = <span style="color: #008000;">'The N-H distance is {0:1.3f} angstroms'</span>
<span style="color: #0000FF;">print</span>(s.<span style="color: #006FE0;">format</span>(atoms.get_distance(0, 1)))
</pre>
</div>

<pre class="example">
atom symbol
===========
 0 N
 1 H
 2 H
 3 H
The N-H distance is 1.017 angstroms
</pre>

<p>
Bond angles are a little trickier. If we had vectors describing the directions between two atoms, we could use some simple trigonometry to compute the angle between the vectors: \(\vec{a} \cdot \vec{b} = |\vec{a}||\vec{b}| \cos(\theta)\).  So we can calculate the angle as \(\theta = \arccos\left(\frac{\vec{a} \cdot \vec{b}}{|\vec{a}||\vec{b}|}\right)\), we just have to define our two vectors \(\vec{a}\) and \(\vec{b}\). We compute these vectors as the difference in positions of two atoms. For example, here we compute the angle H-N-H in an ammonia molecule. This is the angle between N-H\(_1\) and N-H\(_2\). In the next example, we utilize functions in <a href="numpy">numpy</a> to perform the calculations, specifically the <a href="numpy.arccos">numpy.arccos</a> function, the <a href="numpy.dot">numpy.dot</a> function, and <a href="numpy.linalg.norm">numpy.linalg.norm</a> functions.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">ammonia</span>
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom symbol'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'==========='</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:2d} {1:3s}'</span>.<span style="color: #006FE0;">format</span>(i, atom.symbol))

<span style="color: #BA36A5;">a</span> = atoms.positions[0] - atoms.positions[1]
<span style="color: #BA36A5;">b</span> = atoms.positions[0] - atoms.positions[2]

<span style="color: #0000FF;">from</span> numpy <span style="color: #0000FF;">import</span> arccos, dot, pi
<span style="color: #0000FF;">from</span> numpy.linalg <span style="color: #0000FF;">import</span> norm

<span style="color: #BA36A5;">theta_rad</span> = arccos(dot(a, b) / (norm(a) * norm(b)))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">in radians</span>

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'theta = {0:1.1f} degrees'</span>.<span style="color: #006FE0;">format</span>(theta_rad * 180./pi))
</pre>
</div>

<pre class="example">
atom symbol
===========
 0 N
 1 H
 2 H
 3 H
theta = 106.3 degrees
</pre>


<div class="figure">
<p><img src="./images/NH3-vectors.png" alt="NH3-vectors.png" />
</p>
<p><span class="figure-number">Figure 9:</span> Schematic of the vectors defining the H-N-H angle.</p>
</div>

<p>
Alternatively you could use <a href="ase.Atoms.get_angle">ase.Atoms.get_angle</a>. Note we want the angle between atoms with indices [1, 0, 2] to get the H-N-H angle.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> numpy <span style="color: #0000FF;">import</span> pi
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">ammonia</span>
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'theta = {0} degrees'</span>.<span style="color: #006FE0;">format</span>(atoms.get_angle([1, 0, 2]) * 180. / pi))
</pre>
</div>

<pre class="example">
theta = 106.334624232 degrees
</pre>
</div>

<div id="outline-container-orgheadline20" class="outline-5">
<h5 id="orgheadline20"><span class="section-number-5">3.2.5.1</span> Dihedral angles</h5>
<div class="outline-text-5" id="text-3-2-5-1">
<p>
There is support in ase for computing <a href="http://en.wikipedia.org/wiki/Dihedral_angle">dihedral angles</a>. Let us illustrate that for ethane. We will compute the dihedral angle between atoms 5, 1, 0, and 4. That is a H-C-C-H dihedral angle, and one can visually see (although not here) that these atoms have a dihedral angle of 60<sup>&circ;</sup> (Figure <a href="#fig:ethane-dihedral">fig:ethane-dihedral</a>).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">calculate an ethane dihedral angle</span>
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'C2H6'</span>)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom symbol'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'==========='</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:2d} {1:3s}'</span>.<span style="color: #006FE0;">format</span>(i, atom.symbol))

<span style="color: #BA36A5;">da</span> = atoms.get_dihedral([5, 1, 0, 4]) * 180. / np.pi
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'dihedral angle = {0:1.2f} degrees'</span>.<span style="color: #006FE0;">format</span>(da))
</pre>
</div>

<pre class="example">
atom symbol
===========
 0 C
 1 C
 2 H
 3 H
 4 H
 5 H
 6 H
 7 H
dihedral angle = 60.00 degrees
</pre>

<p>
<img src="./images/ethane-dihedral.png" alt="ethane-dihedral.png" />
In this section we covered properties that require simple calculations, but not DFT calculations, to compute.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36"><a id="ID-4fff14db-59ee-4e84-bbd2-f4428d1679f9"></a><span class="section-number-3">3.3</span> Simple properties that require single computations</h3>
<div class="outline-text-3" id="text-3-3">
<p>
There are many properties that only require a single DFT calculation to obtain the energy, forces, density of states, electron density and electrostatic potential. This section describes some of these calculations and their analysis.
</p>
</div>
<div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><span class="section-number-4">3.3.1</span> Energy and forces</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
Two of the most important quantities we are interested in are the total
energy and the forces on the atoms. To get these quantities, we have
to define a calculator and attach it to an <a href="ase.Atoms">ase.Atoms</a> object so
that <code>ase</code> knows how to get the data. After defining the calculator a
DFT calculation must be run.
</p>

<p>
Here is an example of getting the energy and forces from a CO
molecule. The forces in this case are very high, indicating that this
geometry is not close to the ground state geometry. Note that the
forces are only along the $x$-axis, which is along the molecular axis. We will see how to minimize this force in <a href="#orgheadline23">Manual determination</a> and <a href="#orgheadline24">Automatic geometry optimization with VASP</a>.
</p>

<div class="note">
<p>
This is your first DFT calculation in the book! See <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISMEAR>ISMEAR</a>, <a href=http://cms.mpi.univie.ac.at/wiki/index.php/SIGMA>SIGMA</a>, <a href=http://cms.mpi.univie.ac.at/wiki/index.php/NBANDS>NBANDS</a>, and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ENCUT>ENCUT</a> to learn more about these VASP keywords.
</p>

</div>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>, [1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(6., 6., 6.))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'pbe'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the exchange-correlation functional</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=6,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of bands</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">planewave cutoff</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=1,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Methfessel-Paxton smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">very small smearing factor for a molecule</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=co)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(co.get_potential_energy()))
<span style="color: #0000FF;">print</span>(co.get_forces())
</pre>
</div>

<pre class="example">
energy = -14.69111507 eV
[[ 5.09138064  0.          0.        ]
 [-5.09138064  0.          0.        ]]
</pre>

<p>
We can see what files were created and used in this calculation by printing the vasp attribute of the calculator.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'molecules/simple-co'</span>).vasp)
</pre>
</div>

<pre class="example">
INCAR
-----
INCAR created by Atomic Simulation Environment
 ENCUT = 350
 LCHARG = .FALSE.
 NBANDS = 6
 ISMEAR = 1
 LWAVE = .FALSE.
 SIGMA = 0.01


POSCAR
------
 C  O
 1.0000000000000000
     6.0000000000000000    0.0000000000000000    0.0000000000000000
     0.0000000000000000    6.0000000000000000    0.0000000000000000
     0.0000000000000000    0.0000000000000000    6.0000000000000000
   1   1
Cartesian
  0.0000000000000000  0.0000000000000000  0.0000000000000000
  1.2000000000000000  0.0000000000000000  0.0000000000000000


KPOINTS
-------
KPOINTS created by Atomic Simulation Environment
0
Monkhorst-Pack
1 1 1
0.0 0.0 0.0


POTCAR
------
cat $VASP_PP_PATH/potpaw_PBE/C/POTCAR $VASP_PP_PATH/potpaw_PBE/O/POTCAR &gt; POTCAR
</pre>
</div>

<div id="outline-container-orgheadline25" class="outline-5">
<h5 id="orgheadline25"><span class="section-number-5">3.3.1.1</span> Running a job in parallel</h5>
<div class="outline-text-5" id="text-3-3-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> vasp.vasprc <span style="color: #0000FF;">import</span> VASPRC

<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'queue.ppn'</span>] = 4

<span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>, [1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(6., 6., 6.))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co-n4'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the exchange-correlation functional</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=6,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of bands</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">planewave cutoff</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=1,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Methfessel-Paxton smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">very small smearing factor for a molecule</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=co)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(co.get_potential_energy()))
<span style="color: #0000FF;">print</span>(co.get_forces())
</pre>
</div>

<pre class="example">
energy = -14.69072754 eV
[[ 5.09089107  0.          0.        ]
 [-5.09089107  0.          0.        ]]
</pre>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-5">
<h5 id="orgheadline26"><span class="section-number-5">3.3.1.2</span> Convergence with unit cell size</h5>
<div class="outline-text-5" id="text-3-3-1-2">
<p>
There are a number of parameters that affect the energy and forces including the calculation parameters and the unit cell. We will first consider the effect of the unit cell on the total energy and forces. The reason that the unit cell affects the total energy is that it can change the distribution of electrons in the molecule.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(precision=3, suppress=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [1.2, 0, 0])])

<span style="color: #BA36A5;">L</span> = [4, 5, 6, 8, 10]

<span style="color: #BA36A5;">energies</span> = []
<span style="color: #BA36A5;">ready</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> L:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.set_cell([a, a, a], scale_atoms=<span style="color: #D0372D;">False</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.center()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-L-{0}'</span>.<span style="color: #006FE0;">format</span>(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

<span style="color: #0000FF;">print</span>(energies)
calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(L, energies, <span style="color: #008000;">'bo-'</span>)
plt.xlabel(<span style="color: #008000;">'Unit cell length ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/co-e-v.png'</span>)
</pre>
</div>

<pre class="example">
[-15.35943747, -14.85641864, -14.68750595, -14.63202061, -14.65342838]
</pre>


<div class="figure">
<p><img src="./images/co-e-v.png" alt="co-e-v.png" />
</p>
<p><span class="figure-number">Figure 10:</span> Total energy of a CO molecule as a function of the unit cell length.</p>
</div>

<p>
Here there are evidently attractive interactions between the CO molecules which lower the total energy for small box sizes. We have to decide what an appropriate volume for our calculation is, and the choice depends on the goal. We may wish to know the total energy of a molecule that is not interacting with any other molecules, e.g. in the ideal gas limit. In that case we need a large unit cell so the electron density from the molecule does not go outside the unit cell where it would overlap with neighboring images.
</p>

<p>
It pays to check for convergence. The cost of running the calculation goes up steeply with increasing cell size. Doubling a lattice vector here leads to a 20-fold increase in computational time! Note that doubling a lattice vector length increases the volume by a factor of 8 for a cube. The cost goes up because the number of planewaves that fit in the cube grows as the cube gets larger.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">L</span> = [4, 5, 6, 8, 10]

<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> L:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-L-{0}'</span>.<span style="color: #006FE0;">format</span>(a))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0} {1} seconds'</span>.<span style="color: #006FE0;">format</span>(a, calc.get_elapsed_time()))
</pre>
</div>

<pre class="example">
4 10.748 seconds
5 11.855 seconds
6 15.613 seconds
8 28.346 seconds
10 45.259 seconds
</pre>


<p>
Let us consider what the pressure in the unit cell is. In the ideal gas limit we have \(PV = nRT\), which gives a pressure of zero at absolute zero. At non-zero temperatures, we have \(P=n/V RT\). Let us consider some examples. In atomic units we use \(k_B\) instead of \(R\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> kB, Pascal
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">atm</span> = 101325 * Pascal

<span style="color: #BA36A5;">L</span> = np.linspace(4, 10)
<span style="color: #BA36A5;">V</span> = L**3

<span style="color: #BA36A5;">n</span> = 1  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">one atom/molecule per unit cell</span>

<span style="color: #0000FF;">for</span> T <span style="color: #0000FF;">in</span> [298, 600, 1000]:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P</span> = n / V * kB * T / atm  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">convert to atmospheres</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(V, P, label=<span style="color: #008000;">'{0}K'</span>.<span style="color: #006FE0;">format</span>(T))

plt.xlabel(<span style="color: #008000;">'Unit cell volume ($\AA^3$)'</span>)
plt.ylabel(<span style="color: #008000;">'Pressure (atm)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/ideal-gas-pressure.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/ideal-gas-pressure.png" alt="ideal-gas-pressure.png" />
</p>
<p><span class="figure-number">Figure 11:</span> Ideal gas pressure dependence on temperature and unit cell volume.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-5">
<h5 id="orgheadline27"><span class="section-number-5">3.3.1.3</span> Convergence of ENCUT</h5>
<div class="outline-text-5" id="text-3-3-1-3">
<p>
The total energy and forces also depend on the computational parameters, notably <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ENCUT>ENCUT</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(precision=3, suppress=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(6, 6, 6))
atoms.center()

<span style="color: #BA36A5;">ENCUTS</span> = [250, 300, 350, 400, 450, 500]

<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'molecules/co-en-{0}'</span>.<span style="color: #006FE0;">format</span>(en),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=en,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> en <span style="color: #0000FF;">in</span> ENCUTS]

<span style="color: #BA36A5;">energies</span> = [calc.potential_energy <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]
<span style="color: #0000FF;">print</span>(energies)
calcs[0].stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(ENCUTS, energies, <span style="color: #008000;">'bo-'</span>)
plt.xlabel(<span style="color: #008000;">'ENCUT (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/co-encut-v.png'</span>)
</pre>
</div>

<pre class="example">
[-14.95250419, -14.71808896, -14.68750595, -14.66725733, -14.65604528, -14.65012078]
</pre>


<div class="figure">
<p><img src="./images/co-encut-v.png" alt="co-encut-v.png" />
</p>
<p><span class="figure-number">Figure 12:</span> Dependence of the total energy of CO molecule on ENCUT.</p>
</div>

<p>
You can see in this figure that it takes a cutoff energy of about 400 eV to achieve a convergence level around 10 meV, and that even at 500 meV the energy is still changing slightly. Keep in mind that we are generally interested in differences in total energy, and the differences tend to converge faster than a single total energy. Also it is important to note that it is usually a single element that determines the rate of convergence. The reason we do not just use very high ENCUT all the time is it is expensive.
</p>

<div class="org-src-container">

<pre class="src src-sh">grep <span style="color: #008000;">"Elapsed time (sec):"</span> molecules/co-en-*/OUTCAR
</pre>
</div>

<pre class="example">
molecules/co-en-250/OUTCAR:                         Elapsed time (sec):       11.634
molecules/co-en-300/OUTCAR:                         Elapsed time (sec):       14.740
molecules/co-en-350/OUTCAR:                         Elapsed time (sec):       13.577
molecules/co-en-400/OUTCAR:                         Elapsed time (sec):       16.310
molecules/co-en-450/OUTCAR:                         Elapsed time (sec):       17.704
molecules/co-en-500/OUTCAR:                         Elapsed time (sec):       11.658
</pre>
</div>
</div>


<div id="outline-container-orgheadline28" class="outline-5">
<h5 id="orgheadline28"><span class="section-number-5">3.3.1.4</span> Cloning</h5>
<div class="outline-text-5" id="text-3-3-1-4">
<p>
You may want to clone a calculation, so you can change some parameter without losing the previous result. The clone function does this, and changes the calculator over to the new directory.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(calc.get_atoms().get_potential_energy()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">This creates the directory and makes it current working directory</span>
calc.clone(<span style="color: #008000;">'molecules/clone-1'</span>)
calc.<span style="color: #006FE0;">set</span>(encut=325)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this will trigger a new calculation</span>

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(calc.get_atoms().get_potential_energy()))
</pre>
</div>

<pre class="example">
energy = -14.69111507 eV
energy = -14.77117554 eV
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">3.3.2</span> Visualizing electron density</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
The electron density is a 3\(d\) quantity: for every \((x,y,z)\) point, there is a charge density. That means we need 4 numbers for each point: \((x,y,z)\) and \(\rho(x,y,z)\). Below we show an example (Figure <a href="#fig:cd1">fig:cd1</a>) of plotting the charge density, and we consider some issues we have to consider when visualizing volumetric data in unit cells with periodic boundary conditions. We will use the results from a previous calculation.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> enthought.mayavi <span style="color: #0000FF;">import</span> mlab
<span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> vdw_radii
<span style="color: #0000FF;">from</span> ase.data.colors <span style="color: #0000FF;">import</span> cpk_colors

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>)
calc.clone(<span style="color: #008000;">'molecules/co-chg'</span>)
calc.<span style="color: #006FE0;">set</span>(lcharg=<span style="color: #D0372D;">True</span>)
calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">cd</span> = calc.get_charge_density()


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make a white figure</span>
mlab.figure(1, bgcolor=(1, 1, 1))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the atoms as spheres</span>
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.points3d(atom.x,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.y,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.z,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">this determines the size of the atom</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_factor=vdw_radii[atom.number] / 5.,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> resolution=20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">a tuple is required for the color</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> color=<span style="color: #006FE0;">tuple</span>(cpk_colors[atom.number]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_mode=<span style="color: #008000;">'none'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">draw the unit cell - there are 8 corners, and 12 connections</span>
<span style="color: #BA36A5;">a1</span>, <span style="color: #BA36A5;">a2</span>, <span style="color: #BA36A5;">a3</span> = atoms.get_cell()
<span style="color: #BA36A5;">origin</span> = [0, 0, 0]
<span style="color: #BA36A5;">cell_matrix</span> = [[origin,  a1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [origin,  a2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [origin,  a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1,      a1 + a2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1,      a1 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2,      a2 + a1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2,      a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a3,      a1 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a3,      a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1 + a2, a1 + a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2 + a3, a1 + a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1 + a3, a1 + a3 + a2]]

<span style="color: #0000FF;">for</span> p1, p2 <span style="color: #0000FF;">in</span> cell_matrix:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.plot3d([p1[0], p2[0]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">x-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [p1[1], p2[1]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">y-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [p1[2], p2[2]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">z-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   tube_radius=0.02)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Now plot the charge density</span>

mlab.contour3d(x, y, z, cd)
mlab.view(azimuth=-90, elevation=90, distance=<span style="color: #008000;">'auto'</span>)

mlab.savefig(<span style="color: #008000;">'images/co-cd.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/co-cd.png" alt="co-cd.png" />
</p>
<p><span class="figure-number">Figure 13:</span> Charge density of a CO molecule that is located at the origin. The electron density that is outside the cell is wrapped around to the other corners. \label{fig:cd1}</p>
</div>

<p>
If we take care to center the CO molecule in the unit cell, we get a nicer looking result.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> enthought.mayavi <span style="color: #0000FF;">import</span> mlab
<span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> vdw_radii
<span style="color: #0000FF;">from</span> ase.data.colors <span style="color: #0000FF;">import</span> cpk_colors
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [2.422, 0.0, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [3.578, 0.0, 0.0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(10,10,10))

atoms.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-centered'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.<span style="color: #006FE0;">set</span>(lcharg=<span style="color: #D0372D;">True</span>,)
calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">cd</span> = calc.get_charge_density()

mlab.figure(bgcolor=(1, 1, 1))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the atoms as spheres</span>
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.points3d(atom.x,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.y,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.z,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_factor=vdw_radii[atom.number]/5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> resolution=20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">a tuple is required for the color</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> color=<span style="color: #006FE0;">tuple</span>(cpk_colors[atom.number]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_mode=<span style="color: #008000;">'none'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">draw the unit cell - there are 8 corners, and 12 connections</span>
<span style="color: #BA36A5;">a1</span>, <span style="color: #BA36A5;">a2</span>, <span style="color: #BA36A5;">a3</span> = atoms.get_cell()
<span style="color: #BA36A5;">origin</span> = [0, 0, 0]
<span style="color: #BA36A5;">cell_matrix</span> = [[origin,  a1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [origin,  a2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [origin,  a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1,      a1 + a2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1,      a1 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2,      a2 + a1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2,      a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a3,      a1 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a3,      a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1 + a2, a1 + a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a2 + a3, a1 + a2 + a3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [a1 + a3, a1 + a3 + a2]]

<span style="color: #0000FF;">for</span> p1, p2 <span style="color: #0000FF;">in</span> cell_matrix:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.plot3d([p1[0], p2[0]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">x-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [p1[1], p2[1]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">y-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [p1[2], p2[2]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">z-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   tube_radius=0.02)


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Now plot the charge density</span>
mlab.contour3d(x, y, z, cd, transparent=<span style="color: #D0372D;">True</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this view was empirically found by iteration</span>
mlab.view(azimuth=-90, elevation=90, distance=<span style="color: #008000;">'auto'</span>)

mlab.savefig(<span style="color: #008000;">'images/co-centered-cd.png'</span>)
mlab.show()
</pre>
</div>


<div class="figure">
<p><img src="./images/co-centered-cd.png" alt="co-centered-cd.png" />
</p>
<p><span class="figure-number">Figure 14:</span> Charge density of a CO molecule centered in the unit cell. Now the electron density is centered in the unit cell. \label{fig:cd2}</p>
</div>

<p>
TODO: how to make this figure <img src="http://www.zid.tuwien.ac.at/fileadmin/files_zid/zidline/images/zl22/vasp--fig1.jpg" alt="vasp--fig1.jpg" />
</p>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">3.3.3</span> Visualizing electron density differences</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
Here, we visualize how charge moves in a benzene ring when you substitute an H atom with an electronegative Cl atom.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/bin/env python</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> *
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;">### </span><span style="color: #8D8D84; font-style: italic;">Setup calculators</span>
<span style="color: #BA36A5;">benzene</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
benzene.set_cell([10, 10, 10])
benzene.center()

<span style="color: #BA36A5;">calc1</span> = Vasp(<span style="color: #008000;">'molecules/benzene'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=18,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=benzene)
calc1.<span style="color: #006FE0;">set</span>(lcharg=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">chlorobenzene</span> =  molecule(<span style="color: #008000;">'C6H6'</span>)
chlorobenzene.set_cell([10, 10, 10])
chlorobenzene.center()
chlorobenzene[11]<span style="color: #BA36A5;">.symbol</span> =<span style="color: #008000;">'Cl'</span>

<span style="color: #BA36A5;">calc2</span> = Vasp(<span style="color: #008000;">'molecules/chlorobenzene'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=22,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=chlorobenzene)
calc2.<span style="color: #006FE0;">set</span>(lcharg=<span style="color: #D0372D;">True</span>)
calc2.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> (calc1.potential_energy, calc2.potential_energy))

<span style="color: #BA36A5;">x1</span>, <span style="color: #BA36A5;">y1</span>, <span style="color: #BA36A5;">z1</span>, <span style="color: #BA36A5;">cd1</span> = calc1.get_charge_density()
<span style="color: #BA36A5;">x2</span>, <span style="color: #BA36A5;">y2</span>, <span style="color: #BA36A5;">z2</span>, <span style="color: #BA36A5;">cd2</span> = calc2.get_charge_density()

<span style="color: #BA36A5;">cdiff</span> = cd2 - cd1

<span style="color: #0000FF;">print</span>(cdiff.<span style="color: #006FE0;">min</span>(), cdiff.<span style="color: #006FE0;">max</span>())
<span style="color: #8D8D84;">##########################################</span>


<span style="color: #8D8D84;">##### </span><span style="color: #8D8D84; font-style: italic;">set up visualization of charge difference</span>
<span style="color: #0000FF;">from</span> enthought.mayavi <span style="color: #0000FF;">import</span> mlab
mlab.contour3d(x1, y1, z1, cdiff,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  contours=[-0.02, 0.02])

mlab.savefig(<span style="color: #008000;">'images/cdiff.png'</span>)
</pre>
</div>

<pre class="example">
(-2.0821159999999987, 2.9688999999999979)
</pre>


<div class="figure">
<p><img src="./images/cdiff.png" alt="cdiff.png" />
</p>
</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/bin/env python</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> *
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> bisect
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">def</span> <span style="color: #006699;">vinterp3d</span>(x, y, z, u, xi, yi, zi):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">"Interpolate the point (xi, yi, zi) from the values at u(x, y, z)"</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">p</span> = np.array([xi, yi, zi])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">1D arrays of coordinates</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">xv</span> = x[:, 0, 0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yv</span> = y[0, :, 0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">zv</span> = z[0, 0, :]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we subtract 1 because bisect tells us where to insert the</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">element to maintain an ordered list, so we want the index to the</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">left of that point</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span> = bisect.bisect_right(xv, xi) - 1
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = bisect.bisect_right(yv, yi) - 1
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = bisect.bisect_right(zv, zi) - 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> i == <span style="color: #006FE0;">len</span>(x) - 1:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span> = <span style="color: #006FE0;">len</span>(x) - 2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">elif</span> i &lt; 0:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span> = 0

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> j == <span style="color: #006FE0;">len</span>(y) - 1:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = <span style="color: #006FE0;">len</span>(y) - 2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">elif</span> j &lt; 0:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = 0

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> k == <span style="color: #006FE0;">len</span>(z) - 1:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = <span style="color: #006FE0;">len</span>(z) - 2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">elif</span> k &lt; 0:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = 0

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">points at edge of cell. We only need P1, P2, P3, and P5</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P1</span> = np.array([x[i, j, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  y[i, j, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  z[i, j, k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P2</span> = np.array([x[i + 1, j, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  y[i + 1, j, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  z[i + 1, j, k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P3</span> = np.array([x[i, j + 1, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  y[i, j + 1, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  z[i, j + 1, k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P5</span> = np.array([x[i, j, k + 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  y[i, j, k + 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  z[i, j, k + 1]])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">values of u at edge of cell</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u1</span> = u[i, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u2</span> = u[i+1, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u3</span> = u[i, j+1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u4</span> = u[i+1, j+1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u5</span> = u[i, j, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u6</span> = u[i+1, j, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u7</span> = u[i, j+1, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u8</span> = u[i+1, j+1, k+1]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cell basis vectors, not the unit cell, but the voxel cell containing the point</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cbasis</span> = np.array([P2 - P1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  P3 - P1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  P5 - P1])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now get interpolated point in terms of the cell basis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">s</span> = np.dot(np.linalg.inv(cbasis.T), np.array([xi, yi, zi]) - P1)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now s = (sa, sb, sc) which are fractional coordinates in the vector space</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">next we do the interpolations</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui1</span> = u1 + s[0] * (u2 - u1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui2</span> = u3 + s[0] * (u4 - u3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui3</span> = u5 + s[0] * (u6 - u5)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui4</span> = u7 + s[0] * (u8 - u7)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui5</span> = ui1 + s[1] * (ui2 - ui1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui6</span> = ui3 + s[1] * (ui4 - ui3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui7</span> = ui5 + s[2] * (ui6 - ui5)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> ui7

<span style="color: #8D8D84;">### </span><span style="color: #8D8D84; font-style: italic;">Setup calculators</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/benzene'</span>)
<span style="color: #BA36A5;">benzene</span> = calc.get_atoms()
<span style="color: #BA36A5;">x1</span>, <span style="color: #BA36A5;">y1</span>, <span style="color: #BA36A5;">z1</span>, <span style="color: #BA36A5;">cd1</span> = calc.get_charge_density()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/chlorobenzene'</span>)
<span style="color: #BA36A5;">x2</span>, <span style="color: #BA36A5;">y2</span>, <span style="color: #BA36A5;">z2</span>, <span style="color: #BA36A5;">cd2</span> = calc.get_charge_density()

<span style="color: #BA36A5;">cdiff</span> = cd2 - cd1

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we need the x-y plane at z=5</span>
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> scipy <span style="color: #0000FF;">import</span> mgrid

<span style="color: #BA36A5;">X</span>, <span style="color: #BA36A5;">Y</span> = mgrid[0: 10: 25j, 0: 10: 25j]

<span style="color: #BA36A5;">cdiff_plane</span> = np.zeros(X.shape)
<span style="color: #BA36A5;">ni</span>, <span style="color: #BA36A5;">nj</span> = X.shape

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(ni):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> j <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nj):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cdiff_plane</span>[i, j] = vinterp3d(x1, y1, z1, cdiff,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> X[i, j], Y[i, j], 5.0)

plt.imshow(cdiff_plane.T,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  vmin=-0.02,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">min charge diff to plot</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  vmax=0.02,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">max charge diff to plot</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cmap=plt.cm.gist_heat,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">colormap</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  extent=(0., 10., 0., 10.))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">axes limits</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot atom positions. It is a little tricky to see why we reverse the x and y coordinates. That is because imshow does that.</span>
<span style="color: #BA36A5;">x</span> = [a.x <span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> benzene]
<span style="color: #BA36A5;">y</span> = [a.y <span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> benzene]
plt.plot(x, y, <span style="color: #008000;">'bo'</span>)

plt.colorbar() <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">add colorbar</span>
plt.savefig(<span style="color: #008000;">'images/cdiff-imshow.png'</span>)
plt.show()
</pre>
</div>


<div class="figure">
<p><img src="./images/cdiff-imshow.png" alt="cdiff-imshow.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">3.3.4</span> Dipole moments</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
<a href="dipole moment">dipole moment</a>
The <a href="http://en.wikipedia.org/wiki/Molecular_dipole_moment#Molecular_dipoles">dipole moment</a> is a vector describing the separation of  electrical (negative) and nuclear (positive) charge. The magnitude of this vector is the dipole moment, which has units of Coulomb-meter, or more commonly Debye. The symmetry of a molecule determines if a molecule has a dipole moment or not. Below we compute the dipole moment of CO. We must integrate the electron density to find the center of electrical charge, and compute a sum over the nuclei to find the center of positive charge.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> vasp.VaspChargeDensity <span style="color: #0000FF;">import</span> VaspChargeDensity
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> Debye
<span style="color: #0000FF;">import</span> os

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-centered'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
calc.stop_if(atoms.get_potential_energy() <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">vcd</span> = VaspChargeDensity(<span style="color: #008000;">'molecules/co-centered/CHG'</span>)

<span style="color: #BA36A5;">cd</span> = np.array(vcd.chg[0])

<span style="color: #BA36A5;">n0</span>, <span style="color: #BA36A5;">n1</span>, <span style="color: #BA36A5;">n2</span> = cd.shape

<span style="color: #BA36A5;">s0</span> = 1.0 / n0
<span style="color: #BA36A5;">s1</span> = 1.0 / n1
<span style="color: #BA36A5;">s2</span> = 1.0 / n2

<span style="color: #BA36A5;">X</span>, <span style="color: #BA36A5;">Y</span>, <span style="color: #BA36A5;">Z</span> = np.mgrid[0.0:1.0:s0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.0:1.0:s1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.0:1.0:s2]

<span style="color: #BA36A5;">C</span> = np.column_stack([X.ravel(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>Y.ravel(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>Z.ravel()])

<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">uc</span> = atoms.get_cell()
<span style="color: #BA36A5;">real</span> = np.dot(C, uc)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now convert arrays back to unitcell shape</span>
<span style="color: #BA36A5;">x</span> = np.reshape(real[:, 0], (n0, n1, n2))
<span style="color: #BA36A5;">y</span> = np.reshape(real[:, 1], (n0, n1, n2))
<span style="color: #BA36A5;">z</span> = np.reshape(real[:, 2], (n0, n1, n2))


<span style="color: #BA36A5;">nelements</span> = n0 * n1 * n2
<span style="color: #BA36A5;">voxel_volume</span> = atoms.get_volume() / nelements
<span style="color: #BA36A5;">total_electron_charge</span> = -cd.<span style="color: #006FE0;">sum</span>() * voxel_volume

<span style="color: #BA36A5;">electron_density_center</span> = np.array([(cd * x).<span style="color: #006FE0;">sum</span>(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (cd * y).<span style="color: #006FE0;">sum</span>(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (cd * z).<span style="color: #006FE0;">sum</span>()])
<span style="color: #BA36A5;">electron_density_center</span> *= voxel_volume
<span style="color: #BA36A5;">electron_density_center</span> /= total_electron_charge

<span style="color: #BA36A5;">electron_dipole_moment</span> = -electron_density_center * total_electron_charge

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now the ion charge center. We only need the Zval listed in the potcar</span>
<span style="color: #0000FF;">from</span> vasp.POTCAR <span style="color: #0000FF;">import</span> get_ZVAL

<span style="color: #BA36A5;">LOP</span> = calc.get_pseudopotentials()
<span style="color: #BA36A5;">ppp</span> = os.environ[<span style="color: #008000;">'VASP_PP_PATH'</span>]

<span style="color: #BA36A5;">zval</span> = {}
<span style="color: #0000FF;">for</span> sym, ppath, <span style="color: #006FE0;">hash</span> <span style="color: #0000FF;">in</span> LOP:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">fullpath</span> = os.path.join(ppp, ppath)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">z</span> = get_ZVAL(fullpath)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">zval</span>[sym] = z
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ion_charge_center</span> = np.array([0.0, 0.0, 0.0])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">total_ion_charge</span> = 0.0

<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">Z</span> = zval[atom.symbol]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">total_ion_charge</span> += Z
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pos</span> = atom.position
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ion_charge_center</span> += Z * pos

<span style="color: #BA36A5;">ion_charge_center</span> /= total_ion_charge
<span style="color: #BA36A5;">ion_dipole_moment</span> = ion_charge_center * total_ion_charge

<span style="color: #BA36A5;">dipole_vector</span> = (ion_dipole_moment + electron_dipole_moment)

<span style="color: #BA36A5;">dipole_moment</span> = ((dipole_vector**2).<span style="color: #006FE0;">sum</span>())**0.5 / Debye
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The dipole vector is {0}'</span>.<span style="color: #006FE0;">format</span>(dipole_vector))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The dipole moment is {0:1.2f} Debye'</span>.<span style="color: #006FE0;">format</span>(dipole_moment))
</pre>
</div>

<pre class="example">
The dipole vector is [ 0.02048406  0.00026357  0.00026357]
The dipole moment is 0.10 Debye
</pre>


<p>
Note that a function using the code above exists in <code>vasp</code> which makes it trivial to compute the dipole moment. Here is an example of its usage.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> Debye

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-centered'</span>)

<span style="color: #BA36A5;">dipole_moment</span> = calc.get_dipole_moment()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The dipole moment is {0:1.2f} Debye'</span>.<span style="color: #006FE0;">format</span>(dipole_moment))
</pre>
</div>

<pre class="example">
The dipole moment is 0.10 Debye
</pre>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">3.3.5</span> The density of states (DOS)</h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
The density of states (DOS) gives you the number of electronic states (i.e., the orbitals) that have a particular energy. We can get this information from the last calculation we just ran without having to run another DFT calculation.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.dft.dos <span style="color: #0000FF;">import</span> DOS
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>)   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we already ran this!</span>
<span style="color: #BA36A5;">dos</span> = DOS(calc)
plt.plot(dos.get_energies(), dos.get_dos())
plt.xlabel(<span style="color: #008000;">'Energy - $E_f$ (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure you save the figure outside the with statement, or provide</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the correct relative or absolute path to where you want it.</span>
plt.savefig(<span style="color: #008000;">'images/co-dos.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/co-dos.png" alt="co-dos.png" />
</p>
<p><span class="figure-number">Figure 17:</span> Density of states for a CO molecule.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">3.3.6</span> Atom-projected density of states on molecules</h4>
<div class="outline-text-4" id="text-3-3-6">
<p>
Let us consider which states in the density of states belong to which atoms in a molecule. This can only be a qualitative consideration because the orbitals on the atoms often hybridize to form molecular orbitals, e.g. in methane the \(s\) and \(p\) orbitals can form what we call \(sp^3\) orbitals. We can compute atom-projected density of states in VASP, which is done by projecting the wave function onto localized atomic orbitals. Here is an example. We will consider the CO molecule. To get atom-projected density of states, we must set <a href=http://cms.mpi.univie.ac.at/wiki/index.php/RWIGS>RWIGS</a> for each atom. This parameter defines the radius of the sphere around the atom which cuts off the projection. The total density of states and projected density of states information comes from the DOSCAR file.
</p>

<p>
Note that unlike the DOS, here we must run another calculation because we did not specify the atom-projected keywords above. Our strategy is to get the atoms from the previous calculation, and use them in a new calculation. You could redo the calculation in the same directory, but you risk losing the results of the first step. That can make it difficult to reproduce a result. We advocate our approach of using multiple directories for the subsequent calculations, because it leaves a clear trail of how the work was done.
</p>

<div class="note">
<p>
The <a href=http://cms.mpi.univie.ac.at/wiki/index.php/RWIGS>RWIGS</a> is not uniquely determined for an element. There are various natural choices, e.g. the ionic radius of an atom, or a value that minimizes overlap of neighboring spheres, but these values can change slightly in different environments.
</p>

<p>
You can also get spin-polarized atom-projected DOS, and magnetization projected DOS. See <a href="http://cms.mpi.univie.ac.at/vasp/vasp/DOSCAR_file.html#doscar">http://cms.mpi.univie.ac.at/vasp/vasp/DOSCAR_file.html#doscar</a> for more details.
</p>

</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.dft.dos <span style="color: #0000FF;">import</span> DOS
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get the geometry from another calculation</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-ados'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   rwigs={<span style="color: #008000;">'C'</span>: 1.0, <span style="color: #008000;">'O'</span>: 1.0},     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">these are the cutoff radii for projected states</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now get results</span>
<span style="color: #BA36A5;">dos</span> = DOS(calc)
plt.plot(dos.get_energies(), dos.get_dos() + 10)

<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">c_s</span> = calc.get_ados(0, <span style="color: #008000;">'s'</span>)
<span style="color: #BA36A5;">_</span>, <span style="color: #BA36A5;">c_p</span> = calc.get_ados(0, <span style="color: #008000;">'p'</span>)
<span style="color: #BA36A5;">_</span>, <span style="color: #BA36A5;">o_s</span> = calc.get_ados(1, <span style="color: #008000;">'s'</span>)
<span style="color: #BA36A5;">_</span>, <span style="color: #BA36A5;">o_p</span> = calc.get_ados(1, <span style="color: #008000;">'p'</span>)

<span style="color: #BA36A5;">_</span>, <span style="color: #BA36A5;">c_d</span> = calc.get_ados(0, <span style="color: #008000;">'d'</span>)
<span style="color: #BA36A5;">_</span>, <span style="color: #BA36A5;">o_d</span> = calc.get_ados(1, <span style="color: #008000;">'d'</span>)

plt.plot(energies, c_s + 6, energies, o_s + 5)
plt.plot(energies, c_p + 4, energies, o_p + 3)
plt.plot(energies, c_d, energies, o_d + 2)
plt.xlabel(<span style="color: #008000;">'Energy - $E_f$ (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.legend([<span style="color: #008000;">'DOS'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'C$_s$'</span>, <span style="color: #008000;">'O$_s$'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'C$_p$'</span>, <span style="color: #008000;">'O$_p$'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'C$_d$'</span>, <span style="color: #008000;">'O$_d$'</span>],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ncol=2, loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/co-ados.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/co-ados.png" alt="co-ados.png" />
</p>
<p><span class="figure-number">Figure 18:</span> Atom-projected DOS for a CO molecule. The total density of states and the \(s\), \(p\) and \(d\) states on the C and O are shown.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">3.3.7</span> Electrostatic potential</h4>
<div class="outline-text-4" id="text-3-3-7">
<p>
This is an example of the so-called &sigma; hole in a <a href="http://pubs.acs.org/cen/science/87/8738sci2.html">halogen bond</a>. The coordinates for the CF<sub>3</sub>Br molecule were found at <a href="http://cccbdb.nist.gov/exp2.asp?casno=75638">http://cccbdb.nist.gov/exp2.asp?casno=75638</a>.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #0000FF;">from</span> enthought.mayavi <span style="color: #0000FF;">import</span> mlab
<span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> vdw_radii
<span style="color: #0000FF;">from</span> ase.data.colors <span style="color: #0000FF;">import</span> cpk_colors

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>,  [ 0.0000,     0.0000,         -0.8088]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Br'</span>, [ 0.0000,     0.0000,          1.1146]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'F'</span>,  [ 0.0000,     1.2455,         -1.2651]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'F'</span>,  [ 1.0787,    -0.6228,         -1.2651]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'F'</span>,  [-1.0787,    -0.6228,         -1.2651])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(10, 10, 10))
atoms.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/CF3Br'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=50,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvtot=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvhar=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.set_nbands(f=2)
calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">lp</span> = calc.get_local_potential()
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">cd</span> = calc.get_charge_density()

mlab.figure(1, bgcolor=(1, 1, 1)) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make a white figure</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the atoms as spheres</span>
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.points3d(atom.x,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.y,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atom.z,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_factor=vdw_radii[atom.number]/5.,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> resolution=20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">a tuple is required for the color</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> color=<span style="color: #006FE0;">tuple</span>(cpk_colors[atom.number]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> scale_mode=<span style="color: #008000;">'none'</span>)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the bonds. We want a line from C-Br, C-F, etc...</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">We create a bond matrix showing which atoms are connected.</span>
<span style="color: #BA36A5;">bond_matrix</span> = [[0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0, 2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0, 3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0, 4]]

<span style="color: #0000FF;">for</span> a1, a2 <span style="color: #0000FF;">in</span> bond_matrix:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   mlab.plot3d(atoms.positions[[a1,a2], 0], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">x-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.positions[[a1,a2], 1], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">y-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.positions[[a1,a2], 2], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">z-positions</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [2, 2],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   tube_radius=0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   colormap=<span style="color: #008000;">'Reds'</span>)

mlab.contour3d(x, y, z, lp)
mlab.savefig(<span style="color: #008000;">'images/halogen-ep.png'</span>)
mlab.show()
</pre>
</div>


<div class="figure">
<p><img src="./images/halogen-ep.png" alt="halogen-ep.png" />
</p>
<p><span class="figure-number">Figure 19:</span> Plot of the electrostatic potential of CF<sub>3</sub>Br. TODO: figure out how to do an isosurface of charge, colormapped by the local potential.</p>
</div>

<p>
See <a href="http://www.uni-due.de/~hp0058/?file=manual03.html&amp;dir=vmdplugins">http://www.uni-due.de/~hp0058/?file=manual03.html&amp;dir=vmdplugins</a> for examples of using <a href="http://www.ks.uiuc.edu/Research/vmd/">VMD</a> for visualization.
</p>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">3.3.8</span> Bader analysis</h4>
<div class="outline-text-4" id="text-3-3-8">
<p>
<a href="bader">bader</a>
</p>

<p>
Note: Thanks to @prtkm for helping improve this section (<a href="https://github.com/jkitchin/dft-book/issues/2">https://github.com/jkitchin/dft-book/issues/2</a>).
Bader analysis is a charge partitioning scheme where charge is divided by surfaces of zero flux that define atomic basins of charge. The most modern way of calculating the Bader charges is using the <code>bader</code> program from Graeme Henkelmen's group <a class='org-ref-reference' href="#Henkelman2006354">Henkelman2006354</a>,<a class='org-ref-reference' href="#doi.10.1021/ct100125x">doi.10.1021/ct100125x</a>. Let us consider a water molecule, centered in a box. The strategy is first to run the calculation, then run the bader program on the results.
</p>

<p>
We have to specify laechg to be true so that the all-electron core charges will be written out to files. Here we setup and run the calculation to get the densities first.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'H2O'</span>)
atoms.center(vacuum=6)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o-bader'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   laechg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span> calc.potential_energy
</pre>
</div>

<pre class="example">
-14.22250648
</pre>

<p>
Now that the calculation is done, get the bader code and scripts from <a href="http://theory.cm.utexas.edu/henkelman/code/bader/">http://theory.cm.utexas.edu/henkelman/code/bader/</a>.
</p>

<p>
We use this code to see the changes in charges on the atoms.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o-bader'</span>)
calc.bader(ref=<span style="color: #D0372D;">True</span>, overwrite=<span style="color: #D0372D;">True</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|{0} | {1} |'</span>.<span style="color: #006FE0;">format</span>(atom.symbol, atom.charge))
</pre>
</div>

<pre class="example">
|O | -1.2326 |
|H | 0.6161 |
|H | 0.6165 |
</pre>



<p>
The results above are comparable to those from gpaw at <a href="https://wiki.fysik.dtu.dk/gpaw/tutorials/bader/bader.html">https://wiki.fysik.dtu.dk/gpaw/tutorials/bader/bader.html</a>.
</p>

<p>
You can see some charge has been "transferred" from H to O.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-3">
<h3 id="orgheadline38"><a id="ID-af5957a7-116e-42f0-b617-0bf2059fd1e5"></a><span class="section-number-3">3.4</span> Geometry optimization</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23"><span class="section-number-4">3.4.1</span> Manual determination of a bond length</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
The equilibrium bond length of a CO molecule is approximately the bond length that minimizes the total energy. We can find that by computing the total energy as a function of bond length, and noting where the minimum is. Here is an example in VASP. There are a few features to point out here. We want to compute 5 bond lengths, and each calculation is independent of all the others. <a href="vasp">vasp</a> is set up to automatically handle jobs for you by submitting them to the queue. It raises a variety of exceptions to let you know what has happened, and you must handle these to control the workflow. We will illustrate this by the following examples.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]
<span style="color: #BA36A5;">energies</span> = []

<span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths:  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">possible bond lengths</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>, [d, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(6, 6, 6))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d),  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=co)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(co.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'d = {0:1.2f} ang'</span>.<span style="color: #006FE0;">format</span>(d))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(energies[-1] <span style="color: #0000FF;">or</span> 0))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'forces = (eV/ang)\n {0}'</span>.<span style="color: #006FE0;">format</span>(co.get_forces()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">blank line</span>

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.abort()
<span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(bond_lengths, energies, <span style="color: #008000;">'bo-'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.xlabel(r<span style="color: #008000;">'Bond length ($\AA$)'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.savefig(<span style="color: #008000;">'images/co-bondlengths.png'</span>)
</pre>
</div>

<pre class="example">
d = 1.05 ang
energy = -14.216 eV
forces = (eV/ang)
 [[-14.93017486   0.           0.        ]
 [ 14.93017486   0.           0.        ]]

d = 1.10 ang
energy = -14.722 eV
forces = (eV/ang)
 [[-5.81988086  0.          0.        ]
 [ 5.81988086  0.          0.        ]]

d = 1.15 ang
energy = -14.841 eV
forces = (eV/ang)
 [[ 0.63231023  0.          0.        ]
 [-0.63231023  0.          0.        ]]

d = 1.20 ang
energy = -14.691 eV
forces = (eV/ang)
 [[ 5.09138064  0.          0.        ]
 [-5.09138064  0.          0.        ]]

d = 1.25 ang
energy = -14.355 eV
forces = (eV/ang)
 [[ 8.14027842  0.          0.        ]
 [-8.14027842  0.          0.        ]]
</pre>


<div class="figure">
<p><img src="./images/co-bondlengths.png" alt="co-bondlengths.png" />
</p>
</div>


<p>
Before continuing, it is worth looking at some other approaches to setup and run these calculations. Here we consider a functional approach that uses list comprehensions pretty extensively.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]

<span style="color: #BA36A5;">ATOMS</span> = [Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>, [d, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(6, 6, 6))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths]

<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d),  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> d, atoms <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(bond_lengths, ATOMS)]

<span style="color: #BA36A5;">energies</span> = [atoms.get_potential_energy() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> ATOMS]

<span style="color: #0000FF;">print</span>(energies)
</pre>
</div>

<pre class="example">
[-14.21584765, -14.72174343, -14.84115208, -14.69111507, -14.35508371]
</pre>

<p>
We can retrieve data similarly.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]
<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d)) <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths]

<span style="color: #BA36A5;">energies</span> = [calc.get_atoms().get_potential_energy() <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]

<span style="color: #0000FF;">print</span>(energies)
</pre>
</div>

<pre class="example">
[-14.21584765, -14.72174343, -14.84115208, -14.69111507, -14.35508371]
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.db <span style="color: #0000FF;">import</span> connect

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]
<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d)) <span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths]

<span style="color: #BA36A5;">con</span> = connect(<span style="color: #008000;">'co-database.db'</span>, append=<span style="color: #D0372D;">False</span>)
<span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> [calc.get_atoms() <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   con.write(atoms)
</pre>
</div>

<p>
Here we just show that there are entries in our database. If you run the code above many times, each time will add new entries.
</p>

<div class="org-src-container">

<pre class="src src-sh">ase-db co-database.db
</pre>
</div>

<pre class="example">
id|age|user    |formula|calculator| energy|  fmax|pbc| volume|charge|  mass| smax|magmom
 1|12s|jkitchin|CO     |vasp      |-14.216|14.930|TTT|216.000| 0.000|28.010|0.060| 0.000
 2|10s|jkitchin|CO     |vasp      |-14.722| 5.820|TTT|216.000| 0.000|28.010|0.017| 0.000
 3| 9s|jkitchin|CO     |vasp      |-14.841| 0.632|TTT|216.000| 0.000|28.010|0.017| 0.000
 4| 9s|jkitchin|CO     |vasp      |-14.691| 5.091|TTT|216.000| 0.000|28.010|0.041| 0.000
 5| 7s|jkitchin|CO     |vasp      |-14.355| 8.140|TTT|216.000| 0.000|28.010|0.060| 0.000
Rows: 5
</pre>

<p>
This database is now readable in Python too. Here we read in all the results. Later we will learn how to select specific entries.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> read

<span style="color: #BA36A5;">ATOMS</span> = read(<span style="color: #008000;">'co-database.db'</span>, <span style="color: #008000;">':'</span>)
<span style="color: #0000FF;">print</span>([a[0].x - a[1].x <span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> ATOMS])
<span style="color: #0000FF;">print</span>([atoms.get_potential_energy() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> ATOMS])
</pre>
</div>

<pre class="example">
[-1.0499999999999998, -1.09999998, -1.15000002, -1.2000000000000002, -1.2499999800000001]
[-14.21584765, -14.72174343, -14.84115208, -14.69111507, -14.35508371]
</pre>

<p>
Now, back to the goal of finding the minimum. To find the minimum we could run more calculations, but a simpler and faster way is to fit a polynomial to the data, and find the analytical minimum. The results are shown in Figure <a href="#fig:co-bondlengths">fig:co-bondlengths</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]
<span style="color: #BA36A5;">energies</span> = []

<span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths:  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">possible bond lengths</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Now we fit an equation - cubic polynomial</span>
<span style="color: #BA36A5;">pp</span> = np.polyfit(bond_lengths, energies, 3)
<span style="color: #BA36A5;">dp</span> = np.polyder(pp)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first derivative - quadratic</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we expect two roots from the quadratic eqn. These are where the</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first derivative is equal to zero.</span>
<span style="color: #BA36A5;">roots</span> = np.roots(dp)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">The minimum is where the second derivative is positive.</span>
<span style="color: #BA36A5;">dpp</span> = np.polyder(dp)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">second derivative - line</span>
<span style="color: #BA36A5;">secd</span> = np.polyval(dpp, roots)

<span style="color: #BA36A5;">minV</span> = roots[secd &gt; 0]
<span style="color: #BA36A5;">minE</span> = np.polyval(pp, minV)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The minimum energy is {0[0]} eV at V = {1[0]} Ang^3'</span>.<span style="color: #006FE0;">format</span>(minE, minV))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the fit</span>
<span style="color: #BA36A5;">x</span> = np.linspace(1.05, 1.25)
<span style="color: #BA36A5;">fit</span> = np.polyval(pp, x)

plt.plot(bond_lengths, energies, <span style="color: #008000;">'bo '</span>)
plt.plot(x, fit, <span style="color: #008000;">'r-'</span>)
plt.plot(minV, minE, <span style="color: #008000;">'m* '</span>)
plt.legend([<span style="color: #008000;">'DFT'</span>, <span style="color: #008000;">'fit'</span>, <span style="color: #008000;">'minimum'</span>], numpoints=1)
plt.xlabel(r<span style="color: #008000;">'Bond length ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/co-bondlengths.png'</span>)
</pre>
</div>

<pre class="example">
The minimum energy is -14.8458440947 eV at V = 1.14437582331 Ang^3
</pre>



<div class="figure">
<p><img src="./images/co-bondlengths.png" alt="co-bondlengths.png" />
</p>
<p><span class="figure-number">Figure 21:</span> Energy vs CO bond length. \label{fig:co-bondlengths}</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><span class="section-number-4">3.4.2</span> Automatic geometry optimization with VASP</h4>
<div class="outline-text-4" id="text-3-4-2">
<p>
It is generally the case that the equilibrium geometry of a system is the one that minimizes the total energy and forces. Since each atom has three degrees of freedom, you can quickly get a high dimensional optimization problem. Luckily, VASP has built-in geometry optimization using the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IBRION>IBRION</a> and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/NSW>NSW</a> tags. Here we compute the bond length for a CO molecule, letting VASP do the geometry optimization for us.
</p>

<p>
Here are the most common choices for IBRION.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">IBRION value</th>
<th scope="col" class="org-left">algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">quasi-Newton    (use if initial guess is good)</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">conjugate gradient</td>
</tr>
</tbody>
</table>


<div class="note">
<p>
VASP applies a criteria for stopping a geometry optimization. When the change in energy between two steps is less than 0.001 eV (or 10*EDIFF), the relaxation is stopped. This criteria is controlled by the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/EDIFFG>EDIFFG</a> tag. If you prefer to stop based on forces, set EDIFFG=-0.05, i.e. to a negative number. The units of force is eV/&Aring;. For most work, a force tolerance of 0.05 eV/&Aring; is usually sufficient.
</p>

</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>,[0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>,[1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   cell=(6, 6, 6))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-cg'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nbands=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> sigma=0.01, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is small for a molecule</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">conjugate gradient optimizer</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=5,      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">do at least 5 steps to relax</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=co)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Forces'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'======='</span>)
<span style="color: #0000FF;">print</span>(co.get_forces())

<span style="color: #BA36A5;">pos</span> = co.get_positions()
<span style="color: #BA36A5;">d</span> = ((pos[0] - pos[1])**2).<span style="color: #006FE0;">sum</span>()**0.5
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Bondlength = {0:1.2f} angstroms'</span>.<span style="color: #006FE0;">format</span>(d))
</pre>
</div>

<pre class="example">
Forces
=======
[[-0.8290116  0.         0.       ]
 [ 0.8290116  0.         0.       ]]
Bondlength = 1.14 angstroms
</pre>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37"><span class="section-number-4">3.4.3</span> Relaxation of a water molecule</h4>
<div class="outline-text-4" id="text-3-4-3">
<p>
It is not more complicated to relax more atoms, it just may take longer because there are more electrons and degrees of freedom. Here we relax a water molecule which has three atoms.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'H'</span>, [0.5960812, -0.7677068, 0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [0.0000000,  0.0000000, 0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'H'</span>, [0.5960812,  0.7677068, 0.0000000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 8, 8))

atoms.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o-relax-centered'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gaussian smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ediff=1e-8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">"forces"</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'======='</span>)
<span style="color: #0000FF;">print</span>(atoms.get_forces())
</pre>
</div>

<pre class="example">
[[ 4.2981572   3.23149312  4.        ]
 [ 3.70172616  4.          4.        ]
 [ 4.2981572   4.76850688  4.        ]]
forces
=======
[[ -3.49600000e-05   5.06300000e-05   0.00000000e+00]
 [  6.99200000e-05   0.00000000e+00   0.00000000e+00]
 [ -3.49600000e-05  -5.06300000e-05   0.00000000e+00]]
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o-relax-centered'</span>)

<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view
view(calc.traj)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-3">
<h3 id="orgheadline42"><a id="ID-a9c1ebd4-65cd-4818-8ee0-923f3b800e22"></a><span class="section-number-3">3.5</span> Vibrational frequencies</h3>
<div class="outline-text-3" id="text-3-5">
<p>
<a href="vibrations">vibrations</a>
</p>
</div>
<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="section-number-4">3.5.1</span> Manual calculation of vibrational frequency</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
The principle idea in calculating vibrational frequencies is that we consider a molecular system as masses connected by springs. If the springs are Hookean, e.g. the force is proportional to the displacement, then we can readily solve the equations of motion and find that the vibrational frequencies are related to the force constants and the masses of the atoms. For example, in a simple molecule like CO where there is only one spring, the frequency is:
</p>

<p>
\(\nu = \frac{1}{2\pi}\sqrt{k/\mu}\) where \(\frac{1}{\mu} = \frac{1}{m_C} + \frac{1}{m_O}\) and \(k\) is the spring constant. We will compute the value of \(k\) from DFT calculations as follows:
</p>

<p>
\(k = \frac{\partial^2E}{\partial x^2}\) at the equilibrium bond length. We actually already have the data to do this from <a href="#orgheadline23">Manual determination</a>. We only need to fit an equation to the energy vs. bond-length data, find the minimum energy bond-length, and then evaluate the second derivative of the fitted function at the minimum. We will use a cubic polynomial for demonstration here. Polynomials are numerically convenient because they are easy to fit, and it is trivial to get the roots and derivatives of the polynomials, as well as to evaluate them at other points using <a href="numpy.polyfit">numpy.polyfit</a>, <a href="numpy.polyder">numpy.polyder</a>, and <a href="numpy.polyval">numpy.polyval</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">bond_lengths</span> = [1.05, 1.1, 1.15, 1.2, 1.25]
<span style="color: #BA36A5;">energies</span> = []

<span style="color: #0000FF;">for</span> d <span style="color: #0000FF;">in</span> bond_lengths:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-{0}'</span>.<span style="color: #006FE0;">format</span>(d))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fit the data</span>
<span style="color: #BA36A5;">pars</span> = np.polyfit(bond_lengths, energies, 3)
<span style="color: #BA36A5;">xfit</span> = np.linspace(1.05, 1.25)
<span style="color: #BA36A5;">efit</span> = np.polyval(pars, xfit)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first derivative</span>
<span style="color: #BA36A5;">dpars</span> = np.polyder(pars)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">find where the minimum is. chose the second one because it is the</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">minimum we need.</span>
<span style="color: #BA36A5;">droots</span> = np.roots(dpars)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">second derivative</span>
<span style="color: #BA36A5;">ddpars</span> = np.polyder(dpars)

<span style="color: #BA36A5;">d_min</span> = droots[np.polyval(ddpars, droots) &gt; 0]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">curvature at minimum = force constant in SI units</span>
<span style="color: #BA36A5;">k</span> = np.polyval(ddpars, d_min) / (J / m**2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">mu, reduced mass</span>
<span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> atomic_masses
<span style="color: #BA36A5;">C_mass</span> = atomic_masses[6] / kg
<span style="color: #BA36A5;">O_mass</span> = atomic_masses[8] / kg

<span style="color: #BA36A5;">mu</span> = 1.0 / (1.0 / C_mass + 1.0 / O_mass)

<span style="color: #BA36A5;">frequency</span> = 1. / (2. * np.pi) * np.sqrt(k / mu)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The CO vibrational frequency is {0} Hz'</span>.<span style="color: #006FE0;">format</span>(*frequency))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The CO vibrational frequency is {0[0]} cm^{{-1}}'</span>.<span style="color: #006FE0;">format</span>(frequency / 3e10))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(bond_lengths, energies, <span style="color: #008000;">'bo '</span>)
plt.plot(xfit, efit, <span style="color: #008000;">'b-'</span>)
plt.xlabel(<span style="color: #008000;">'Bond length ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/co-freq.png'</span>)
</pre>
</div>

<pre class="example">
The CO vibrational frequency is 6.43186126691e+13 Hz
The CO vibrational frequency is 2143.95375564 cm^{-1}
</pre>


<div class="figure">
<p><img src="./images/co-freq.png" alt="co-freq.png" />
</p>
</div>

<p>
This result is in good agreement with <a href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C630080&amp;Units=SI&amp;Type=IR-SPEC&amp;Index=0#IR-SPEC">experiment</a>. The procedure described above is basically how many vibrational calculations are performed. With more atoms, you have to determine a force constant matrix and diagonalize it. For more details, see <a class='org-ref-reference' href="#wilson1955">wilson1955</a>. In practice, we usually allow a packaged code to automate this, which we cover in <a href="#orgheadline39">Automated vibrational calculations</a>.
</p>

<p>
We now consider how much energy is in this vibration. This is commonly called zero-point energy (ZPE) and it is defined as \(E_{ZPE} = \frac{1}{2} h \nu\) for a single mode, and \(h\) is Planck's constant (4.135667516e-15 eV/s).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">c</span> = 3e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">speed of light cm/s</span>
<span style="color: #BA36A5;">h</span> = 4.135667516e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV*s</span>

<span style="color: #BA36A5;">nu</span> = 2143.6076625*c  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">1/s</span>

<span style="color: #BA36A5;">E_zpe</span> = 0.5*h*nu

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'E_ZPE = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(E_zpe))
</pre>
</div>

<pre class="example">
E_ZPE = 0.133 eV
</pre>

<p>
This is a reasonable amount of energy! Zero-point energy increases with increasing vibrational frequency, and tends to be very important for small atoms.
</p>

<p>
A final note is that this analysis is in the "harmonic approximation". The frequency equation is the solution to a harmonic oscillator. If the spring is non-linear, then there are anharmonic effects that may become important, especially at higher temperatures.
</p>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="section-number-4">3.5.2</span> <span class="todo TODO">TODO</span> Automated vibrational calculations</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
VASP has built-in capability for performing vibrational calculations. We access the capability by using a new value for <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IBRION>IBRION</a>. The values of 5 and 6 calculated the Hessian matrix using finite differences. For IBRION=5, all atoms that are not constrained are displaced. For IBRION=6, only symmetry inequivalent displacements are considered, which makes the calculations slightly cheaper. You can specify the number of displacements with <a href=http://cms.mpi.univie.ac.at/wiki/index.php/NFREE>NFREE</a>. The default number of displacements is 2. You can also specify the size of the displacement with <a href=http://cms.mpi.univie.ac.at/wiki/index.php/POTIM>POTIM</a> (the default is 0.015 &Aring;).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">&lt;&lt;water-vib&gt;&gt;</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">adapted from http://cms.mpi.univie.ac.at/wiki/index.php/H2O_vibration</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> ase.units

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'H'</span>, [0.5960812,  -0.7677068,   0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [0.0000000,   0.0000000,   0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'H'</span>, [0.5960812,   0.7677068,   0.0000000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(8, 8, 8))
atoms.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gaussian smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=6,     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">finite differences with symmetry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">central differences (default)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.015,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">default as well</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ediff=1e-8,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">for vibrations you need precise energies</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Set to 1 for vibrational calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Forces'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'======'</span>)
<span style="color: #0000FF;">print</span>(atoms.get_forces())
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)
calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">vibrational energies are in eV</span>
<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">modes</span> = calc.get_vibrational_modes()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energies\n========'</span>)
<span style="color: #0000FF;">for</span> i, e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} eV'</span>.<span style="color: #006FE0;">format</span>(i, e))
</pre>
</div>

<pre class="example">
Forces
======
[[ 0.01810349 -0.03253721 -0.00127275]
 [-0.03620698  0.          0.0025455 ]
 [ 0.01810349  0.03253721 -0.00127275]]

energies
========
00: 0.475855773 eV
01: 0.46176517 eV
02: 0.196182182 eV
03: 0.007041992 eV
04: 0.002445078 eV
05: (0.000292003+0j) eV
06: (0.012756432+0j) eV
07: (0.01305212+0j) eV
08: (0.015976377+0j) eV
</pre>

<p>
Note we get 9 frequencies here. Water has 3 atoms, with three degrees of freedom each, leading to 9 possible combinations of collective motions. Three of those collective motions are translations, i.e. where all atoms move in the same direction (either \(x\), \(y\) or \(z\)) and there is no change in the total energy of the molecule. Another three of those motions are rotations, which also do not change the total energy of the molecule. That leaves 3N-6 = 3 degrees of vibrational freedom where some or all of the bonds are stretched, resulting in a change in the total energy. The modes of water vibration are (with our calculated values in parentheses):
</p>

<ol class="org-ol">
<li>a symmetric stretch at 3657 cm<sup>-1</sup>   (3723)</li>
<li>an asymmetric stretch at 3756 cm<sup>-1</sup> (3836)</li>
<li>and a bending mode at 1595 cm<sup>-1</sup>    (1583)</li>
</ol>

<p>
<a href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;Mask=800#Electronic-Spec">http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;Mask=800#Electronic-Spec</a>
</p>

<p>
The results are not too far off, and more accurate frequencies may be possible using tighter tolerance on <a href=http://cms.mpi.univie.ac.at/wiki/index.php/POTIM>POTIM</a>, or by using <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IBRION>IBRION</a>=7 or 8.
</p>

<p>
Let us briefly discuss how to determine which vectors are vibrations and which are rotations or translations. One way is to visualize the modes. The vibrations are easy to spot. The rotations/translations are not always cleanly separable. This is an issue of accuracy and convergence. We usually do not worry about this because these modes are usually not important.
</p>

<ol class="org-ol">
<li>mode 0 is an asymmetric stretch</li>
<li>mode 1 is a symmetric stretch</li>
<li>mode 2 is a bending mode</li>
<li>mode 3 is a mixed translation/rotation</li>
<li>mode 4 is a rotation</li>
<li>mode 5 is a translation</li>
<li>mode 6 is a rotation</li>
<li>mode 7 is a partial translation</li>
<li>mode 8 is a rotation</li>
</ol>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">&lt;&lt;h2o-vib-vis&gt;&gt;</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_vib'</span>)
<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">modes</span> = calc.get_vibrational_modes(mode=0, massweighted=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>show=<span style="color: #D0372D;">True</span>)
</pre>
</div>
<p>
See <a href="http://www.gaussian.com/g_whitepap/vib.htm">http://www.gaussian.com/g_whitepap/vib.htm</a> for a more quantitative discussion of these modes, identifying them, and a method to project the rotations and translations out of the Hessian matrix.
</p>
</div>

<div id="outline-container-orgheadline41" class="outline-5">
<h5 id="orgheadline41"><span class="section-number-5">3.5.2.1</span> Zero-point energy for multiple modes</h5>
<div class="outline-text-5" id="text-3-5-2-1">
<p>
For a molecule with lots of vibrational modes the zero-point energy is defined as the sum over all the vibrational modes:
</p>

<p>
\(E_{ZPE} = \sum_i \frac{1}{2} h \nu_i\)
</p>

<p>
Here is an example for water. Note we do not sum over the imaginary modes. We should also ignore the rotational and translational modes (some of those are imaginary, but some are just small).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">c</span> = 3e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">speed of light cm/s</span>
<span style="color: #BA36A5;">h</span> = 4.135667516e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV/s</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first, get the frequencies.</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_vib'</span>)
<span style="color: #BA36A5;">freq</span> = calc.get_vibrational_frequencies()

<span style="color: #BA36A5;">ZPE</span> = 0.0
<span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> freq:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> <span style="color: #006FE0;">isinstance</span>(f, <span style="color: #006FE0;">float</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">continue</span>  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">skip complex numbers</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">nu</span> = f * c  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">convert to frequency</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ZPE</span> += 0.5 * h * nu

<span style="color: #0000FF;">print</span>(np.<span style="color: #006FE0;">sum</span>([0.5 * h * f * c <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> freq <span style="color: #0000FF;">if</span> <span style="color: #006FE0;">isinstance</span>(f, <span style="color: #006FE0;">float</span>)]))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The ZPE of water is {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(ZPE))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">one liner</span>
<span style="color: #BA36A5;">ZPE</span> = np.<span style="color: #006FE0;">sum</span>([0.5 * h * f * c <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> freq <span style="color: #0000FF;">if</span> <span style="color: #006FE0;">isinstance</span>(f, <span style="color: #006FE0;">float</span>)])
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'The ZPE of water is {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(ZPE))
</pre>
</div>

<p>
Note the zero-point energy of water is also fairly high (more than 0.5 eV). That is because of the high frequency O-H stretches.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-3">
<h3 id="orgheadline43"><span class="section-number-3">3.6</span> Simulated infrared spectra</h3>
<div class="outline-text-3" id="text-3-6">
<p>
<a href="infrared intensity">infrared intensity</a>
At <a href="http://homepage.univie.ac.at/david.karhanek/downloads.html#Entry02">http://homepage.univie.ac.at/david.karhanek/downloads.html#Entry02</a> there is a recipe for computing the Infrared vibrational spectroscopy intensities in VASP. We are going to do that for water here. First, we will relax a water molecule.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'H'</span>, [0.5960812,  -0.7677068,   0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [0.0000000,   0.0000000,   0.0000000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'H'</span>, [0.5960812,   0.7677068,   0.0000000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 8, 8))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_relax'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gaussian smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ediff=1e-8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Forces'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'==========================='</span>)
<span style="color: #0000FF;">print</span>(atoms.get_forces())
</pre>
</div>

<pre class="example">
Forces
===========================
[[ -3.80700000e-05   5.32200000e-05   0.00000000e+00]
 [  7.61400000e-05   0.00000000e+00   0.00000000e+00]
 [ -3.80700000e-05  -5.32200000e-05   0.00000000e+00]]
</pre>

<p>
Next, we instruct VASP to compute the vibrational modes using <a href="http://cmt.dur.ac.uk/sjc/thesis_prt/node39.html">density functional perturbation theory</a> with IBRION=7. Note, this is different than in <a href="#orgheadline42">3.5</a> where finite differences were used.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">read in relaxed geometry</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_relax'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now define a new calculator</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_vib_dfpt'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gaussian smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=7,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">switches on the DFPT vibrational analysis (with</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">no symmetry constraints)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.015,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lepsilon=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">enables to calculate and to print the BEC</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">tensors</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lreal=<span style="color: #D0372D;">False</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nwrite=3,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">affects OUTCAR verbosity: explicitly forces</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">SQRT(mass)-divided eigenvectors to be printed</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
-14.22662275
</pre>

<p>
To analyze the results, this <a href="http://homepage.univie.ac.at/david.karhanek/downloads.html#Entry02">shell script</a> was provided to extract the results.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/bin/</span><span style="color: #0000FF;">bash</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">A utility for calculating the vibrational intensities from VASP output (OUTCAR)</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">(C) David Karhanek, 2011-03-25, ICIQ Tarragona, Spain (www.iciq.es)</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">extract Born effective charges tensors</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..reading OUTCAR"</span>
<span style="color: #BA36A5;">BORN_NROWS</span>=<span style="color: #FF1493;">`grep NIONS OUTCAR | awk '{print $12*4+1}'`</span>
<span style="color: #0000FF;">if</span> [ <span style="color: #FF1493;">`grep 'BORN' OUTCAR | wc -l`</span> = 0 ] ; <span style="color: #0000FF;">then</span> <span style="color: #008000;">\</span>
   <span style="color: #006FE0;">printf</span> <span style="color: #008000;">" .. FAILED! Born effective charges missing! Bye! \n\n"</span> ; <span style="color: #0000FF;">exit</span> 1 ; <span style="color: #0000FF;">fi</span>
grep <span style="color: #008000;">"in e, cummulative"</span> -A $<span style="color: #BA36A5;">BORN_NROWS</span> OUTCAR &gt; born.txt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">extract Eigenvectors and eigenvalues</span>
<span style="color: #0000FF;">if</span> [ <span style="color: #FF1493;">`grep 'SQRT(mass)' OUTCAR | wc -l`</span> != 1 ] ; <span style="color: #0000FF;">then</span> <span style="color: #008000;">\</span>
   <span style="color: #006FE0;">printf</span> <span style="color: #008000;">" .. FAILED! Restart VASP with NWRITE=3! Bye! \n\n"</span> ; <span style="color: #0000FF;">exit</span> 1 ; <span style="color: #0000FF;">fi</span>
<span style="color: #BA36A5;">EIG_NVIBS</span>=<span style="color: #FF1493;">`grep -A 2000 'SQRT(mass)' OUTCAR | grep 'cm-1' | wc -l`</span>
<span style="color: #BA36A5;">EIG_NIONS</span>=<span style="color: #FF1493;">`grep NIONS OUTCAR | awk '{print $12}'`</span>
<span style="color: #BA36A5;">EIG_NROWS</span>=<span style="color: #FF1493;">`echo "($EIG_NIONS+3)*$EIG_NVIBS+3" | bc`</span>
grep -A $(($<span style="color: #BA36A5;">EIG_NROWS</span>+2)) <span style="color: #008000;">'SQRT(mass)'</span> OUTCAR | tail -n $(($<span style="color: #BA36A5;">EIG_NROWS</span>+1)) | sed <span style="color: #008000;">'s/f\/i/fi /g'</span> &gt; eigenvectors.txt
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">set up a new directory, split files - prepare for parsing</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..splitting files"</span>
mkdir intensities ; mv born.txt eigenvectors.txt intensities/
<span style="color: #006FE0;">cd</span> intensities/
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">NBORN_NROWS</span>=BORN_NROWS-1
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">NEIG_NROWS</span>=EIG_NROWS-3
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">NBORN_STEP</span>=4
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">NEIG_STEP</span>=EIG_NIONS+3
tail -n $<span style="color: #BA36A5;">NBORN_NROWS</span> born.txt &gt; temp.born.txt
tail -n $<span style="color: #BA36A5;">NEIG_NROWS</span> eigenvectors.txt &gt; temp.eige.txt
mkdir inputs ; mv born.txt eigenvectors.txt inputs/
split -a 3 -d -l $<span style="color: #BA36A5;">NEIG_STEP</span> temp.eige.txt temp.ei.
split -a 3 -d -l $<span style="color: #BA36A5;">NBORN_STEP</span> temp.born.txt temp.bo.
mkdir temps01 ; mv temp.born.txt temp.eige.txt temps01/
<span style="color: #0000FF;">for</span> nu<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NVIBS`</span> ; <span style="color: #0000FF;">do</span>
 <span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">nud</span>=nu-1 ; <span style="color: #BA36A5;">ei</span>=<span style="color: #FF1493;">`printf "%03u" $nu`</span> ; <span style="color: #BA36A5;">eid</span>=<span style="color: #FF1493;">`printf "%03u" $nud`</span> ; mv temp.ei.$<span style="color: #BA36A5;">eid</span> eigens.vib.$<span style="color: #BA36A5;">ei</span>
<span style="color: #0000FF;">done</span>
<span style="color: #0000FF;">for</span> s<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NIONS`</span> ; <span style="color: #0000FF;">do</span>
 <span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">sd</span>=s-1 ; <span style="color: #BA36A5;">bo</span>=<span style="color: #FF1493;">`printf "%03u" $s`</span> ; <span style="color: #BA36A5;">bod</span>=<span style="color: #FF1493;">`printf "%03u" $sd`</span> ; mv temp.bo.$<span style="color: #BA36A5;">bod</span> borncs.$<span style="color: #BA36A5;">bo</span>
<span style="color: #0000FF;">done</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parse deviation vectors (eig)</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..parsing eigenvectors"</span>
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">sad</span>=$<span style="color: #BA36A5;">EIG_NIONS</span>+1
<span style="color: #0000FF;">for</span> nu<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NVIBS`</span> ; <span style="color: #0000FF;">do</span>
 <span style="color: #BA36A5;">nuu</span>=<span style="color: #FF1493;">`printf "%03u" $nu`</span>
 tail -n $<span style="color: #BA36A5;">sad</span> eigens.vib.$<span style="color: #BA36A5;">nuu</span> | head -n $<span style="color: #BA36A5;">EIG_NIONS</span> | awk <span style="color: #008000;">'{print $4,$5,$6}'</span> &gt; e.vib.$<span style="color: #BA36A5;">nuu</span>.allions
 split -a 3 -d -l 1 e.vib.$<span style="color: #BA36A5;">nuu</span>.allions temp.e.vib.$<span style="color: #BA36A5;">nuu</span>.ion.
 <span style="color: #0000FF;">for</span> s<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NIONS`</span> ; <span style="color: #0000FF;">do</span>
  <span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">sd</span>=s-1; <span style="color: #BA36A5;">bo</span>=<span style="color: #FF1493;">`printf "%03u" $s`</span>; <span style="color: #BA36A5;">bod</span>=<span style="color: #FF1493;">`printf "%03u" $sd`</span>; mv temp.e.vib.$<span style="color: #BA36A5;">nuu</span>.ion.$<span style="color: #BA36A5;">bod</span> e.vib.$<span style="color: #BA36A5;">nuu</span>.ion.$<span style="color: #BA36A5;">bo</span>
 <span style="color: #0000FF;">done</span>
<span style="color: #0000FF;">done</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parse born effective charge matrices (born)</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..parsing eff.charges"</span>
<span style="color: #0000FF;">for</span> s<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NIONS`</span> ; <span style="color: #0000FF;">do</span>
 <span style="color: #BA36A5;">ss</span>=<span style="color: #FF1493;">`printf "%03u" $s`</span>
 awk <span style="color: #008000;">'{print $2,$3,$4}'</span> borncs.$<span style="color: #BA36A5;">ss</span> | tail -3 &gt; bornch.$<span style="color: #BA36A5;">ss</span>
<span style="color: #0000FF;">done</span>
mkdir temps02 ; mv eigens.* borncs.* temps02/
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parse matrices, multiply them and collect squares (giving intensities)</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..multiplying matrices, summing "</span>
<span style="color: #0000FF;">for</span> nu<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NVIBS`</span> ; <span style="color: #0000FF;">do</span>
 <span style="color: #BA36A5;">nuu</span>=<span style="color: #FF1493;">`printf "%03u" $nu`</span>
 <span style="color: #BA36A5;">int</span>=0.0
 <span style="color: #0000FF;">for</span> alpha<span style="color: #0000FF;"> in</span> 1 2 3 ;  <span style="color: #0000FF;">do</span>            <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">summing over alpha coordinates</span>
  <span style="color: #BA36A5;">sumpol</span>=0.0
  <span style="color: #0000FF;">for</span> s<span style="color: #0000FF;"> in</span> <span style="color: #FF1493;">`seq 1 $EIG_NIONS`</span> ; <span style="color: #0000FF;">do</span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">summing over atoms</span>
   <span style="color: #BA36A5;">ss</span>=<span style="color: #FF1493;">`printf "%03u" $s`</span>
   awk -v <span style="color: #BA36A5;">a</span>=<span style="color: #008000;">"$alpha"</span> <span style="color: #008000;">'(NR==a){print}'</span> bornch.$<span style="color: #BA36A5;">ss</span> &gt; z.ion.$<span style="color: #BA36A5;">ss</span>.alpha.$<span style="color: #BA36A5;">alpha</span>
   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">summing over beta coordinates and multiplying Z(s,alpha)*e(s) done by the following awk script</span>
   paste z.ion.$<span style="color: #BA36A5;">ss</span>.alpha.$<span style="color: #BA36A5;">alpha</span>  e.vib.$<span style="color: #BA36A5;">nuu</span>.ion.$<span style="color: #BA36A5;">ss</span> | <span style="color: #008000;">\</span>
   awk <span style="color: #008000;">'{pol=$1*$4+$2*$5+$3*$6; print $0,"  ",pol}'</span> &gt; matr-vib-${<span style="color: #BA36A5;">nuu</span>}-alpha-${<span style="color: #BA36A5;">alpha</span>}-ion-${<span style="color: #BA36A5;">ss</span>}
  <span style="color: #0000FF;">done</span>
  <span style="color: #BA36A5;">sumpol</span>=<span style="color: #FF1493;">`cat matr-vib-${nuu}-alpha-${alpha}-ion-* | awk '{sum+=$7} END {print sum}'`</span>
  <span style="color: #BA36A5;">int</span>=<span style="color: #FF1493;">`echo "$int+($sumpol)^2" | sed 's/[eE]/*10^/g' |  bc -l`</span>
 <span style="color: #0000FF;">done</span>
 <span style="color: #BA36A5;">freq</span>=<span style="color: #FF1493;">`awk '(NR==1){print $8}' temps02/eigens.vib.$nuu`</span>
 <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"$nuu $freq $int"</span>&gt;&gt; exact.res.txt
 <span style="color: #006FE0;">printf</span> <span style="color: #008000;">"."</span>
<span style="color: #0000FF;">done</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">format results, normalize intensities</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..normalizing intensities"</span>
<span style="color: #BA36A5;">max</span>=<span style="color: #FF1493;">`awk '(NR==1){max=$3} $3&gt;=max {max=$3} END {print max}' exact.res.txt`</span>
awk -v <span style="color: #BA36A5;">max</span>=<span style="color: #008000;">"$max"</span> <span style="color: #008000;">'{printf "%03u %6.1f %5.3f\n",$1,$2,$3/max}'</span> exact.res.txt &gt; results.txt
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n"</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">clean up, display results</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..finalizing:\n"</span>
mkdir temps03; mv bornch.* e.vib.*.allions temps03/
mkdir temps04; mv z.ion* e.vib.*.ion.* temps04/
mkdir temps05; mv matr-* temps05/
mkdir results; mv *res*txt results/
<span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">NMATRIX</span>=$<span style="color: #BA36A5;">EIG_NVIBS</span>**2
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"%5u atoms found\n%5u vibrations found\n%5u matrices evaluated"</span> <span style="color: #008000;">\</span>
       $<span style="color: #BA36A5;">EIG_NIONS</span> $<span style="color: #BA36A5;">EIG_NVIBS</span> $<span style="color: #BA36A5;">NMATRIX</span> &gt; results/statistics.txt
  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fast switch to clean up all temporary files</span>
  rm -r temps*
cat results/results.txt
</pre>
</div>

<p>
Note that the results above include the rotational and translational modes (modes 4-9). The following <a href="http://homepage.univie.ac.at/david.karhanek/downloads.html#Entry02">shell script</a> removes those, and recalculates the intensities. Note that it appears to just remove the last 6 modes and req compute the intensities. It is not obvious that will always be the right way to do it as the order of the eigenvectors is not guaranteed.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/bin/</span><span style="color: #0000FF;">bash</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reformat intensities, just normal modes: 3N -&gt; (3N-6)</span>
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">"..reformatting and normalizing intensities"</span>
<span style="color: #006FE0;">cd</span> intensities/results/
<span style="color: #BA36A5;">nlns</span>=<span style="color: #FF1493;">`wc -l exact.res.txt | awk '{print $1}' `</span>; <span style="color: #006FE0;">let</span> <span style="color: #BA36A5;">bodylns</span>=nlns-6
head -n $<span style="color: #BA36A5;">bodylns</span> exact.res.txt &gt; temp.reform.res.txt
<span style="color: #BA36A5;">max</span>=<span style="color: #FF1493;">`awk '(NR==1){max=$3} $3&gt;=max {max=$3} END {print max}' temp.reform.res.txt`</span>
awk -v <span style="color: #BA36A5;">max</span>=<span style="color: #008000;">"$max"</span> <span style="color: #008000;">'{print $1,$2,$3/max}'</span> temp.reform.res.txt &gt; exact.reform.res.txt
awk -v <span style="color: #BA36A5;">max</span>=<span style="color: #008000;">"$max"</span> <span style="color: #008000;">'{printf "%03u %6.1f %5.3f\n",$1,$2,$3/max}'</span> temp.reform.res.txt &gt; reform.res.txt
<span style="color: #006FE0;">printf</span> <span style="color: #008000;">" ..done\n..normal modes:\n"</span>
rm temp.reform.res.txt
cat reform.res.txt
<span style="color: #006FE0;">cd</span> ../..
</pre>
</div>

<pre class="example">
..reformatting and normalizing intensities ..done
..normal modes:
</pre>

<p>
The interpretation of these results is that the mode at 3713 cm<sup>-1</sup> would be nearly invisible in the IR spectrum. Earlier we interpreted that as the symmetric stretch. In this mode, there is only a small change in the molecule dipole moment, so there is a small IR intensity.
</p>

<p>
See also <a class='org-ref-reference' href="#giannozzi:8537">giannozzi:8537</a>. For HREELS simulations see <a class='org-ref-reference' href="#0953-8984-22-26-265006">0953-8984-22-26-265006</a>.
</p>

<p>
The shell script above has been translated to a convenient python function in <a href="vasp">vasp</a>.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/h2o_vib_dfpt'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'mode  Relative intensity'</span>)
<span style="color: #0000FF;">for</span> i, intensity <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(calc.get_infrared_intensities()):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}     {1:1.3f}'</span>.<span style="color: #006FE0;">format</span>(i, intensity))
</pre>
</div>

<pre class="example">
mode  Relative intensity
00     0.227
01     0.006
02     0.312
03     1.000
04     0.002
05     0.000
06     0.006
07     0.000
08     0.350
</pre>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="orgheadline44"><span class="section-number-3">3.7</span> Thermochemical properties of molecules</h3>
<div class="outline-text-3" id="text-3-7">
<p>
<a href="thermochemistry">thermochemistry</a>
<a href="ase.thermochemistry">ase.thermochemistry</a> can be used to estimate thermodynamic properties of gases in the ideal gas limit. The module needs as input the geometry, the total energy, the vibrational energies, and some information about the molecular symmetry. We first consider an N<sub>2</sub> molecule.
</p>

<p>
The symmetry numbers are determined by the molecular point group <a class='org-ref-reference' href="#springerlink-10.1007/s00214-007-0328-0">springerlink-10.1007/s00214-007-0328-0</a>. Here is a table of the most common ones.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> Symmetry numbers for common point groups</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">point group</th>
<th scope="col" class="org-right">\(\sigma\)</th>
<th scope="col" class="org-left">examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">C<sub>1</sub></td>
<td class="org-right">1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">C<sub>s</sub></td>
<td class="org-right">1</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">C<sub>2</sub></td>
<td class="org-right">2</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">C<sub>2v</sub></td>
<td class="org-right">2</td>
<td class="org-left">H<sub>2</sub>O</td>
</tr>

<tr>
<td class="org-left">C<sub>3v</sub></td>
<td class="org-right">3</td>
<td class="org-left">NH<sub>3</sub></td>
</tr>

<tr>
<td class="org-left">\(C_{\infty v}\)</td>
<td class="org-right">1</td>
<td class="org-left">CO</td>
</tr>

<tr>
<td class="org-left">D<sub>2h</sub></td>
<td class="org-right">4</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">D<sub>3h</sub></td>
<td class="org-right">6</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">D<sub>5h</sub></td>
<td class="org-right">10</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">\(D_{\infty h}\)</td>
<td class="org-right">2</td>
<td class="org-left">CO<sub>2</sub>, H<sub>2</sub></td>
</tr>

<tr>
<td class="org-left">D<sub>3d</sub></td>
<td class="org-right">6</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">T<sub>d</sub></td>
<td class="org-right">12</td>
<td class="org-left">CH<sub>4</sub></td>
</tr>

<tr>
<td class="org-left">O<sub>h</sub></td>
<td class="org-right">24</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.thermochemistry <span style="color: #0000FF;">import</span> IdealGasThermo
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'N2'</span>)
atoms.set_cell((10,10,10), scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first we relax a molecule</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/n2-relax'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">electronicenergy</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">next, we get vibrational modes</span>
<span style="color: #BA36A5;">calc2</span> = Vasp(<span style="color: #008000;">'molecules/n2-vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.15,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms)

calc2.wait()

<span style="color: #BA36A5;">vib_freq</span> = calc2.get_vibrational_frequencies() <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">in cm^1</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">convert wavenumbers to energy</span>
<span style="color: #BA36A5;">h</span> = 4.1356675e-15 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV*s</span>
<span style="color: #BA36A5;">c</span> = 3.0e10 <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">cm/s</span>
<span style="color: #BA36A5;">vib_energies</span> = [h*c*nu <span style="color: #0000FF;">for</span> nu <span style="color: #0000FF;">in</span> vib_freq]
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'vibrational energies\n===================='</span>)
<span style="color: #0000FF;">for</span> i,e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vib_energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} eV'</span>.<span style="color: #006FE0;">format</span>(i,e))


<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;"># now we can get some properties. Note we only need one vibrational</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">energy since there is only one mode. This example does not work if</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you give all the energies because one energy is zero.</span>
<span style="color: #BA36A5;">thermo</span> = IdealGasThermo(vib_energies=vib_energies[0:0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potentialenergy=electronicenergy, atoms=atoms,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   geometry=<span style="color: #008000;">'linear'</span>, symmetrynumber=2, spin=0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">temperature in K, pressure in Pa, G in eV</span>
<span style="color: #BA36A5;">G</span> = thermo.get_gibbs_energy(temperature=298.15, pressure=101325.)
</pre>
</div>

<pre class="example">
vibrational energies
====================
00: 0.281619180732 eV
01: 0.0302718194691 eV
02: 0.0302718194691 eV
03: 6.20350125e-10 eV
04: 4.962801e-10 eV
05: 0.0 eV
Enthalpy components at T = 298.15 K:
===============================
E_pot                -16.484 eV
E_ZPE                  0.000 eV
Cv_trans (0-&gt;T)        0.039 eV
Cv_rot (0-&gt;T)          0.026 eV
Cv_vib (0-&gt;T)          0.000 eV
(C_v -&gt; C_p)           0.026 eV
-------------------------------
H                    -16.394 eV
===============================

Entropy components at T = 298.15 K and P = 101325.0 Pa:
=================================================
                           S               T*S
S_trans (1 atm)    0.0015579 eV/K        0.464 eV
S_rot              0.0007868 eV/K        0.235 eV
S_elec             0.0000000 eV/K        0.000 eV
S_vib              0.0000000 eV/K        0.000 eV
S (1 atm -&gt; P)    -0.0000000 eV/K       -0.000 eV
-------------------------------------------------
S                  0.0023447 eV/K        0.699 eV
=================================================

Free energy components at T = 298.15 K and P = 101325.0 Pa:
=======================
    H        -16.394 eV
 -T*S         -0.699 eV
-----------------------
    G        -17.093 eV
=======================
</pre>



<p>
Let us compare this to what is in the <a href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7727379&amp;Units=SI&amp;Mask=1#Thermo-Gas">Nist webbook</a> via the Shomate equations.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">A</span> = 28.98641
<span style="color: #BA36A5;">B</span> = 1.853978
<span style="color: #BA36A5;">C</span> = -9.647459
<span style="color: #BA36A5;">D</span> = 16.63537
<span style="color: #BA36A5;">E</span> = 0.000117
<span style="color: #BA36A5;">F</span> = -8.671914
<span style="color: #BA36A5;">G</span> = 226.4168
<span style="color: #BA36A5;">H</span> = 0.0

<span style="color: #BA36A5;">T</span> = 298.15
<span style="color: #BA36A5;">t</span> = T/1000.

<span style="color: #BA36A5;">S</span> = A*np.log(t) + B*t + C*t**2/2 + D*t**3/3 - E/(2*t**2) + G
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'-T*S = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(-T*S/1000/96.4853))
</pre>
</div>

<pre class="example">
-T*S = -0.592 eV
</pre>

<p>
This is reasonable agreement for the entropy. You will get different results if you use different exchange correlation functionals.
</p>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-3">
<h3 id="orgheadline64"><a id="ID-5aa65ee8-f47e-4f65-b52a-de9920505350"></a><span class="section-number-3">3.8</span> Molecular reaction energies</h3>
<div class="outline-text-3" id="text-3-8">
</div>
<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="section-number-4">3.8.1</span> O<sub>2</sub> dissociation</h4>
<div class="outline-text-4" id="text-3-8-1">
<p>
The first reaction we consider is a simple dissociation of oxygen molecule into two oxygen atoms: O<sub>2</sub> &rarr; 2O. The dissociation energy is pretty straightforward to define: it is the energy of the products minus the energy of the reactant. \(D = 2*E_O - E_{O_2}\). It would appear that we simply calculate the energy of an oxygen atom, and the energy of an oxygen molecule and evaluate the formula. Let us do that.
</p>
</div>

<div id="outline-container-orgheadline45" class="outline-5">
<h5 id="orgheadline45"><span class="section-number-5">3.8.1.1</span> Simple estimate of O<sub>2</sub> dissociation energy</h5>
<div class="outline-text-5" id="text-3-8-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O  D = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(2 * E_O - E_O2))
</pre>
</div>

<pre class="example">
O2 -&gt; 2O  D = 8.619 eV
</pre>

<p>
The answer we have obtained is way too high! Experimentally the dissociation energy is about 5.2 eV (need reference), which is <b>very</b> different than what we calculated! Let us consider some factors that contribute to this error.
</p>

<p>
We implicitly neglected spin-polarization in the example above. That could be a problem, since the O<sub>2</sub> molecule can be in one of two spin states, a singlet or a triplet, and these should have different energies. Furthermore, the oxygen atom can be a singlet or a triplet, and these would have different energies. To account for spin polarization, we have to tell VASP to use spin-polarization, and give initial guesses for the magnetic moments of the atoms. Let us try again with spin polarization.
</p>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-5">
<h5 id="orgheadline47"><span class="section-number-5">3.8.1.2</span> Estimating O<sub>2</sub> dissociation energy with spin polarization in triplet ground states</h5>
<div class="outline-text-5" id="text-3-8-1-2">
<p>
To tell VASP to use spin-polarization we use <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISPIN>ISPIN</a>=2, and we set initial guesses for magnetic moments on the atoms with the magmom keyword. In a triplet state there are two electrons with spins of the same sign.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()


<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O = {0} Bohr'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5,    5, 5], magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure we relax the geometry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">verify magnetic moment</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O2 = {0} Bohr'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O  D = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(2 * E_O - E_O2))
</pre>
</div>

<pre class="example">
Magnetic moment on O = 2.0000072 Bohr magnetons
Magnetic moment on O2 = 2.0000084 Bohr magnetons
O2 -&gt; 2O  D = 6.746 eV
</pre>

<p>
This is much closer to accepted literature values for the DFT-GGA O\(_2\) dissociation energy. It is still more than 1 eV above an experimental value, but most of that error is due to the GGA exchange correlation functional. Some additional parameters that might need to be checked for convergence are the SIGMA value (it is probably too high for a molecule), as well as the cutoff energy. Oxygen is a "hard" atom that requires a high cutoff energy to achieve high levels of convergence.
</p>
</div>


<div id="outline-container-orgheadline46" class="outline-6">
<h6 id="orgheadline46"><span class="section-number-6">3.8.1.2.1</span> Looking at the two spin densities</h6>
<div class="outline-text-6" id="text-3-8-1-2-1">
<p>
In a spin-polarized calculation there are actually two electron densities: one for spin-up and one for spin-down. We will look at the differences in these two through the density of states.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.dft.dos <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet'</span>)

<span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #BA36A5;">d_up</span> = dos.get_dos(spin=0)
<span style="color: #BA36A5;">d_down</span> = dos.get_dos(spin=1)
<span style="color: #BA36A5;">e</span> = dos.get_energies()

<span style="color: #BA36A5;">ind</span> = e &lt;= 0.0
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">integrate up to 0eV</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'number of up states = {0}'</span>.<span style="color: #006FE0;">format</span>(np.trapz(d_up[ind], e[ind])))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'number of down states = {0}'</span>.<span style="color: #006FE0;">format</span>(np.trapz(d_down[ind], e[ind])))

<span style="color: #0000FF;">import</span> pylab <span style="color: #0000FF;">as</span> plt
plt.plot(e, d_up,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>e, -d_down)
plt.xlabel(<span style="color: #008000;">'energy [eV]'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.legend([<span style="color: #008000;">'up'</span>, <span style="color: #008000;">'down'</span>])
plt.savefig(<span style="color: #008000;">'images/O2-sp-dos.png'</span>)
</pre>
</div>

<pre class="example">
number of up states = 6.11729553486
number of down states = 5.00000794208
</pre>


<div class="figure">
<p><img src="./images/O2-sp-dos.png" alt="O2-sp-dos.png" />
</p>
<p><span class="figure-number">Figure 23:</span> Spin-polarized DOS for the O<sub>2</sub> molecule. \label{fig:o2-sp-dos}</p>
</div>

<p>
You can see in Figure <a href="#fig:o2-sp-dos">fig:o2-sp-dos</a> that there are two different densities of states for the two spins. One has 7 electrons in it (the blue lines), and the other has 5 electrons in it (the green line). The difference of two electrons leads to the magnetic moment of 2 which we calculated earlier. Remember that only peaks in the DOS below the Fermi level are occupied. It is customary to set the Fermi level to 0 eV in DOS plots. The peaks roughly correspond to electrons. For example, the blue peak between -25 and -30 eV corresponds to one electron, in a 1s orbital, where as the blue peak between -5 and -10 eV corresponds to three electrons.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48"><span class="section-number-5">3.8.1.3</span> Convergence study of the O<sub>2</sub> dissociation energy</h5>
<div class="outline-text-5" id="text-3-8-1-3">
<p>
<a href="convergence!ENCUT">convergence!ENCUT</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #BA36A5;">encuts</span> = [250, 300, 350, 400, 450, 500, 550]

<span style="color: #BA36A5;">D</span> = []
<span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> encuts:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet-{0}'</span>.<span style="color: #006FE0;">format</span>(encut),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=encut,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5,    5, 5], magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-{0}'</span>.<span style="color: #006FE0;">format</span>(encut),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=encut,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this turns relaxation on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d</span> = 2*E_O - E_O2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   D.append(d)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O encut = {0}  D = {1:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(encut, d))

<span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> D <span style="color: #0000FF;">or</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> D: calc.abort()

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(encuts, D)
plt.xlabel(<span style="color: #008000;">'ENCUT (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'O$_2$ dissociation energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/O2-dissociation-convergence.png'</span>)
</pre>
</div>

<pre class="example">
O2 -&gt; 2O encut = 250  D = 6.774 eV
O2 -&gt; 2O encut = 300  D = 6.804 eV
O2 -&gt; 2O encut = 350  D = 6.785 eV
O2 -&gt; 2O encut = 400  D = 6.746 eV
O2 -&gt; 2O encut = 450  D = 6.727 eV
O2 -&gt; 2O encut = 500  D = 6.725 eV
O2 -&gt; 2O encut = 550  D = 6.727 eV
</pre>


<div class="figure">
<p><img src="./images/O2-dissociation-convergence.png" alt="O2-dissociation-convergence.png" />
</p>
<p><span class="figure-number">Figure 24:</span> Convergence study of the O<sub>2</sub> dissociation energy as a function of ENCUT. \label{fig:o2-encut}</p>
</div>

<p>
Based on these results (Figure <a href="#fig:o2-encut">fig:o2-encut</a>), you could argue the dissociation energy is converged to about 2 meV at a planewave cutoff of 450 eV, and within 50 meV at 350 eV cutoff. You have to decide what an appropriate level of convergence is. Note that increasing the planewave cutoff significantly increases the computational time, so you are balancing level of convergence with computational speed. It would appear that planewave cutoff is not the cause for the discrepancy between our calculations and literature values.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">encuts</span> = [250, 300, 350, 400, 450, 500, 550]
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'encut (eV)            Total CPU time'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'--------------------------------------------------------'</span>)

<span style="color: #0000FF;">for</span> encut <span style="color: #0000FF;">in</span> encuts:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">OUTCAR</span> = <span style="color: #008000;">'molecules/O2-sp-triplet-{0}/OUTCAR'</span>.<span style="color: #006FE0;">format</span>(encut)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f</span> = <span style="color: #006FE0;">open</span>(OUTCAR, <span style="color: #008000;">'r'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> line <span style="color: #0000FF;">in</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #008000;">'Total CPU time used (sec)'</span> <span style="color: #0000FF;">in</span> line:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0} eV: {1}'</span>.<span style="color: #006FE0;">format</span>(encut, line))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   f.close()
</pre>
</div>

<pre class="example">
encut (eV)            Total CPU time
--------------------------------------------------------
250 eV:                   Total CPU time used (sec):     1551.338

300 eV:                   Total CPU time used (sec):     2085.191

350 eV:                   Total CPU time used (sec):     2795.841

400 eV:                   Total CPU time used (sec):     2985.064

450 eV:                   Total CPU time used (sec):     5155.562

500 eV:                   Total CPU time used (sec):     4990.818

550 eV:                   Total CPU time used (sec):     5262.052
</pre>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49"><span class="section-number-5">3.8.1.4</span> Illustration of the effect of SIGMA</h5>
<div class="outline-text-5" id="text-3-8-1-4">
<p>
The methodology for extrapolation of the total energy to absolute zero is
only valid for a continuous density of states at the Fermi level
<a class='org-ref-reference' href="#Kresse199615">Kresse199615</a>. Consequently, it should not be used for
semiconductors, molecules or atoms. In VASP, this means a very small
Fermi temperature (SIGMA) should be used.  The O<sub>2</sub> dissociation energy
as a function of SIGMA is shown in Figure
<a href="#fig:sigma-o2-diss">fig:sigma-o2-diss</a>. A variation of nearly 0.2 eV is seen from the
default Fermi temperature of \(k_bT=0.2\) eV and the value of
\(k_bT=0.0001\) eV. However, virtually no change was observed for a
hydrogen atom or molecule or for an oxygen molecule as a function of
the Fermi temperature. It is recommended that the total energy be
calculated at several values of the Fermi temperature to make sure the
total energy is converged with respect to the Fermi temperature.
</p>

<p>
We were not careful in selecting a good value for <a href=http://cms.mpi.univie.ac.at/wiki/index.php/SIGMA>SIGMA</a> in the calculations above. The default value of SIGMA is 0.2, which may be fine for metals, but it is not correct for molecules. SIGMA is the broadening factor used to smear the electronic density of states at the Fermi level. For a metal with a continuous density of states this is appropriate, but for molecules with discrete energy states it does not make sense. We are somewhat forced to use the machinery designed for metals on molecules. The solution is to use a very small SIGMA. Ideally you would use SIGMA=0, but that is not practical for convergence reasons, so we try to find what is small enough. Let us examine the effect of SIGMA on the dissociation energy here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">sigmas</span> = [0.2, 0.1, 0.05, 0.02, 0.01, 0.001]

<span style="color: #BA36A5;">D</span> = []
<span style="color: #0000FF;">for</span> sigma <span style="color: #0000FF;">in</span> sigmas:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>,[5, 5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet-sigma-{0}'</span>.<span style="color: #006FE0;">format</span>(sigma),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=sigma,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>,[5,    5, 5],magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>,[6.22, 5, 5],magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-sigma-{0}'</span>.<span style="color: #006FE0;">format</span>(sigma),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=sigma,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure we relax the geometry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d</span> = 2 * E_O - E_O2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   D.append(d)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O sigma = {0}  D = {1:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(sigma, d))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(sigmas, D, <span style="color: #008000;">'bo-'</span>)
plt.xlabel(<span style="color: #008000;">'SIGMA (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'O$_2$ dissociation energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/O2-dissociation-sigma-convergence.png'</span>)
</pre>
</div>

<pre class="example">
O2 -&gt; 2O sigma = 0.2  D = 6.669 eV
O2 -&gt; 2O sigma = 0.1  D = 6.746 eV
O2 -&gt; 2O sigma = 0.05  D = 6.784 eV
O2 -&gt; 2O sigma = 0.02  D = 6.807 eV
O2 -&gt; 2O sigma = 0.01  D = 6.815 eV
O2 -&gt; 2O sigma = 0.001  D = 6.822 eV
</pre>


<div class="figure">
<p><img src="./images/O2-dissociation-sigma-convergence.png" alt="O2-dissociation-sigma-convergence.png" />
</p>
<p><span class="figure-number">Figure 25:</span> Effect of SIGMA on the oxygen dissociation energy. \label{fig:sigma-o2-diss}</p>
</div>

<p>
Clearly SIGMA has an effect, but it does not move the dissociation energy closer to the literature values!
</p>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50"><span class="section-number-5">3.8.1.5</span> Estimating singlet oxygen dissociation energy</h5>
<div class="outline-text-5" id="text-3-8-1-5">
<p>
Finally, let us consider the case where each species is in the singlet state.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5], magmom=0)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-singlet'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O = {0} Bohr'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5], magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5], magmom=-1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-singlet'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure we relax the geometry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">verify magnetic moment</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 molecule magnetic moment = '</span>, atoms.get_magnetic_moment())

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O  D = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(2 * E_O - E_O2))
</pre>
</div>

<pre class="example">
Magnetic moment on O = 0.0001638 Bohr magnetons
/home-research/jkitchin/dft-book-new-vasp/molecules/O2-sp-singlet Queued: 1391919.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/molecules/O2-sp-singlet Queued: 1391919.gilgamesh.cheme.cmu.edu
('O2 molecule magnetic moment = ', 0.0)
</pre>

<p>
Interestingly, VASP still found a triplet spin state on the oxygen atom, even though we guessed an initial magnetic moment of 0. This highlights a difficulty in computing magnetic moments: you provide an initial guess and a solution is found. The magnetic moment of a singlet state is zero, so the  molecule is correct. Also interesting is that the dissociation energy is almost equal to the experimental value. This is probably a coincidence, and may reflect the fact that the singlet oxygen state is less stable than the triplet state. Let us directly compare their total energies:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-singlet'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'singlet: {0} eV'</span>.<span style="color: #006FE0;">format</span>(calc.potential_energy))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'triplet: {0} eV'</span>.<span style="color: #006FE0;">format</span>(calc.potential_energy))
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book-new-vasp/molecules/O2-sp-singlet Queued: 1391900.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/molecules/O2-sp-singlet Queued: 1391900.gilgamesh.cheme.cmu.edu
singlet: None eV
triplet: -9.84832377 eV
</pre>

<p>
You can see here the triplet state has an energy that is 1 eV more stable than the singlet state.
</p>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-5">
<h5 id="orgheadline51"><span class="section-number-5">3.8.1.6</span> Estimating triplet oxygen dissociation energy with low symmetry</h5>
<div class="outline-text-5" id="text-3-8-1-6">
<p>
It has been suggested that breaking spherical symmetry of the atom can result in lower energy of the atom. The symmetry is broken by putting the atom off-center in a box. We will examine the total energy of an oxygen atom in a few geometries. First, let us consider variations of a square box.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">square box origin</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [0, 0, 0], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">pars</span> = <span style="color: #006FE0;">dict</span>(xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-square-box-origin'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms, **pars)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Square box (origin): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">square box center</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5, 5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-square-box-center'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms, **pars)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Square box (center): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">square box random</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [2.13, 7.32, 1.11], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-square-box-random'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms, **pars)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Square box (random): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))
</pre>
</div>

<pre class="example">
Square box (origin): E = -1.51654778 eV
Square box (center): E = -1.51654804 eV
Square box (random): E = -1.5152871 eV
</pre>

<p>
There is no significant difference in these energies. The origin and center calculations are identical in energy. The meV variation in the random calculation is negligible. Now, let us consider some non-square boxes.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">calculate O atom energy in orthorhombic boxes</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">orthorhombic box origin</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [0, 0, 0], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-orthorhombic-box-origin'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Orthorhombic box (origin): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">orthorhombic box center</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [4, 4.5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-orthorhombic-box-center'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Orthorhombic box (center): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">orthorhombic box random</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [2.13, 7.32, 1.11], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-orthorhombic-box-random'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Orthorhombic box (random): E = {0} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy()))
</pre>
</div>

<pre class="example">
Orthorhombic box (origin): E = -1.89375092 eV
Orthorhombic box (center): E = -1.89375153 eV
Orthorhombic box (random): E = -1.87999536 eV
</pre>

<p>
This is a surprisingly large difference in energy! Nearly 0.4 eV. This is precisely the amount of energy we were in disagreement with the literature values. Surprisingly, the "random" position is higher in energy, similar to the cubic boxes. Finally, we put this all together. We use a non-symmetric box for the O-atom.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5.1, 4.2, 6.1], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet-lowsym'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O = {0} Bohr  magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5,    5, 5], magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure we relax the geometry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">verify magnetic moment</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O2 = {0} Bohr magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))


<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'E_O: '</span>, E_O)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O  D = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(2 * E_O - E_O2))
</pre>
</div>

<pre class="example">
Magnetic moment on O = 2.0000073 Bohr  magnetons
Magnetic moment on O2 = 2.0000084 Bohr magnetons
('E_O: ', -1.89307116)
O2 -&gt; 2O  D = 6.062 eV
</pre>

<p>
This actually agrees within 30-50 meV of reported literature values, although still nearly an eV greater than the experimental dissociation energy. Note that with a different "random" position, we get the lower energy for the O atom. All the disagreement we had been seeing was apparently in the O atom energy. So, if you do not need the dissociation energy in your analysis, you will not see the error. Also note that this error is specific to there being a spherical atom in a symmetric cell. This is not a problem for most molecules, which are generally non-spherical.
</p>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-5">
<h5 id="orgheadline52"><span class="section-number-5">3.8.1.7</span> Verifying the magnetic moments on each atom</h5>
<div class="outline-text-5" id="text-3-8-1-7">
<p>
It is one thing to see the total magnetic moment of a singlet state, and another to ask what are the magnetic moments on each atom. In VASP you must use <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LORBIT>LORBIT</a> = 11 to get the magnetic moments of the atoms written out.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-singlet'</span>)
calc.clone(<span style="color: #008000;">'molecules/O2-sp-singlet-magmoms'</span>)


calc.<span style="color: #006FE0;">set</span>(lorbit=11)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">magmoms</span> = atoms.get_magnetic_moments()

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'singlet ground state'</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom {0}: magmom = {1}'</span>.<span style="color: #006FE0;">format</span>(i, magmoms[i]))
<span style="color: #0000FF;">print</span>(atoms.get_magnetic_moment())

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet'</span>)
calc.clone(<span style="color: #008000;">'molecules/O2-sp-triplet-magmoms'</span>)

calc.<span style="color: #006FE0;">set</span>(lorbit=11)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">magmoms</span> = atoms.get_magnetic_moments()
<span style="color: #0000FF;">print</span>()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'triplet ground state'</span>)
<span style="color: #0000FF;">for</span> i, atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom {0}: magmom = {1}'</span>.<span style="color: #006FE0;">format</span>(i, magmoms[i]))
<span style="color: #0000FF;">print</span>(atoms.get_magnetic_moment())
</pre>
</div>

<pre class="example">
singlet ground state
atom 0: magmom = 0.0
atom 1: magmom = 0.0
0.0
()
triplet ground state
atom 0: magmom = 0.815
atom 1: magmom = 0.815
2.0000083
</pre>

<p>
Note the atomic magnetic moments do not add up to the total magnetic moment. The atomic magnetic moments are not really true observable properties. The moments are determined by a projection method that probably involves a spherical orbital, so the moments may be over or underestimated.
</p>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-5">
<h5 id="orgheadline53"><span class="section-number-5">3.8.1.8</span> Using a different potential</h5>
<div class="outline-text-5" id="text-3-8-1-8">
<p>
It is possible we need a higher quality potential to get the 6.02 eV value quoted by many in the literature. Here we try the O_sv potential, which treats the 1s electrons as valence electrons. Note however, the ENMIN in the POTCAR is very high!
</p>

<div class="org-src-container">

<pre class="src src-sh">grep ENMIN $<span style="color: #BA36A5;">VASP_PP_PATH</span>/potpaw_PBE/O_sv/POTCAR
</pre>
</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [4, 4.5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet-lowsym-s'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   setups=[[<span style="color: #008000;">'O'</span>, <span style="color: #008000;">'_s'</span>]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">print</span>(E_O)
</pre>
</div>

<pre class="example">
-1.57217591
</pre>

<p>
In the following calculation, we let VASP select an appropriate ENCUT value.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [4, 4.5, 5], magmom=2)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(8, 9, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O-sp-triplet-lowsym-s'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   setups=[[<span style="color: #008000;">'O'</span>, <span style="color: #008000;">'_s'</span>]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O = {0} Bohr'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now relaxed O2 dimer</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>, [5,    5, 5], magmom=1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.22, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(10, 10, 10))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-s'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn spin-polarization on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure we relax the geometry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   setups=[[<span style="color: #008000;">'O'</span>, <span style="color: #008000;">'_s'</span>]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">E_O2</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">verify magnetic moment</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Magnetic moment on O2 = {0} Bohr'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' magnetons'</span>.<span style="color: #006FE0;">format</span>(atoms.get_magnetic_moment()))

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> (E_O, E_O2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'O2 -&gt; 2O  D = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(2*E_O - E_O2))
</pre>
</div>

<pre class="example">
Magnetic moment on O = 1.9999982 Bohr magnetons
Magnetic moment on O2 = 2.0000102 Bohr magnetons
O2 -&gt; 2O  D = 6.120 eV
</pre>


<p>
This result is close to other reported values. It is possibly not converged, since we let VASP choose the ENCUT value, and that value is the ENMIN value in the POTCAR. Nevertheless, the point is that a harder potential does not fix the problem of overbinding in the O<sub>2</sub> molecule. That is a fundamental flaw in the GGA exchange-correlation functional.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-4">
<h4 id="orgheadline57"><span class="section-number-4">3.8.2</span> Water gas shift example</h4>
<div class="outline-text-4" id="text-3-8-2">
<p>
We consider calculating the reaction energy of the water-gas shift reaction in this example.
</p>

<p>
CO + H<sub>2</sub>O \(\leftrightharpoons\) CO<sub>2</sub> + H<sub>2</sub>
</p>

<p>
We define the reaction energy as the difference in energy between the products and reactants.
</p>

<p>
\(\Delta E = E_{CO_2} + E_{H_2} - E_{CO} - E_{H_2O}\)
</p>

<p>
For now, we compute this energy simply as the difference in DFT energies. In the next section we will add zero-point energies and compute the energy difference as a function of temperature. For now, we simply need to compute the total energy of each molecule in its equilibrium geometry.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first we define our molecules. These will automatically be at the coordinates from the G2 database.</span>

<span style="color: #BA36A5;">CO</span> = molecule(<span style="color: #008000;">'CO'</span>)
CO.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #BA36A5;">H2O</span> = molecule(<span style="color: #008000;">'H2O'</span>)
H2O.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #BA36A5;">CO2</span> = molecule(<span style="color: #008000;">'CO2'</span>)
CO2.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #BA36A5;">H2</span> = molecule(<span style="color: #008000;">'H2'</span>)
H2.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now the calculators to get the energies</span>
<span style="color: #BA36A5;">c1</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=CO)

<span style="color: #BA36A5;">eCO</span> = CO.get_potential_energy()

<span style="color: #BA36A5;">c2</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=CO2)

<span style="color: #BA36A5;">eCO2</span> = CO2.get_potential_energy()

<span style="color: #BA36A5;">c3</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=H2)

<span style="color: #BA36A5;">eH2</span> = H2.get_potential_energy()

<span style="color: #BA36A5;">c4</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=H2O)

<span style="color: #BA36A5;">eH2O</span> = H2O.get_potential_energy()

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> (eCO2, eH2, eCO, eH2O):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
<span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dE</span> = eCO2 + eH2 - eCO - eH2O
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Delta E = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(dE))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Delta E = {0:1.3f} kcal/mol'</span>.<span style="color: #006FE0;">format</span>(dE * 23.06035))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Delta E = {0:1.3f} kJ/mol'</span>.<span style="color: #006FE0;">format</span>(dE * 96.485))
</pre>
</div>

<pre class="example">
Delta E = -0.723 eV
Delta E = -16.672 kcal/mol
Delta E = -69.758 kJ/mol
</pre>

<p>
We <a href="http://matlab.cheme.cmu.edu/2011/12/12/water-gas-shift-equilibria-via-the-nist-webbook/#7">estimated</a> the enthalpy of this reaction at standard conditions to be -41 kJ/mol using data from the NIST webbook, which is a fair bit lower than we calculated here. In the next section we will examine whether additional corrections are needed, such as zero-point and temperature corrections.
</p>

<p>
It is a good idea to verify your calculations and structures are what you expected. Let us print them here. Inspection of these results shows the geometries were all relaxed, i.e., the forces on each atom are less than 0.05 eV/&Aring;.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'**** Calculation summaries'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'***** CO'</span>)
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'#+begin_example'</span>)
<span style="color: #0000FF;">print</span>(calc)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'#+end_example'</span>)
</pre>
</div>
</div>
<div id="outline-container-orgheadline56" class="outline-5">
<h5 id="orgheadline56"><span class="section-number-5">3.8.2.1</span> Calculation summaries</h5>
<div class="outline-text-5" id="text-3-8-2-1">
</div><div id="outline-container-orgheadline55" class="outline-6">
<h6 id="orgheadline55"><span class="section-number-6">3.8.2.1.1</span> CO</h6>
<div class="outline-text-6" id="text-3-8-2-1-1">
<pre class="example">
Vasp calculation in /home-research/jkitchin/dft-book-new-vasp/molecules/wgs/H2O

INCAR created by Atomic Simulation Environment
 ENCUT = 350
 LCHARG = .FALSE.
 IBRION = 2
 ISMEAR = 0
 LWAVE = .TRUE.
 SIGMA = 0.1
 NSW = 10

 O  H
 1.0000000000000000
     8.0000000000000000    0.0000000000000000    0.0000000000000000
     0.0000000000000000    8.0000000000000000    0.0000000000000000
     0.0000000000000000    0.0000000000000000    8.0000000000000000
   1   2
Cartesian
  0.0000000000000000  0.0000000000000000  0.1192620000000000
  0.0000000000000000  0.7632390000000000 -0.4770470000000000
  0.0000000000000000 -0.7632390000000000 -0.4770470000000000
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-4">
<h4 id="orgheadline63"><span class="section-number-4">3.8.3</span> Temperature dependent water gas shift equilibrium constant</h4>
<div class="outline-text-4" id="text-3-8-3">
<p>
To correct the reaction energy for temperature effects, we must compute the vibrational frequencies of each species, and estimate the temperature dependent contributions to vibrational energy and entropy. We will break these calculations into several pieces. First we do each vibrational calculation. After those are done, we can get the data and construct the thermochemistry objects we need to estimate the reaction energy as a function of temperature (at constant pressure).
</p>
</div>

<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58"><span class="section-number-5">3.8.3.1</span> CO vibrations</h5>
<div class="outline-text-5" id="text-3-8-3-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get relaxed geometry</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO'</span>)
<span style="color: #BA36A5;">CO</span> = calc.get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now do the vibrations</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO-vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=CO)
calc.wait()
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #0000FF;">for</span> i, f <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vib_freq):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} cm^(-1)'</span>.<span style="color: #006FE0;">format</span>(i, f))
</pre>
</div>

<pre class="example">
00: 2064.699153 cm^(-1)
01: 170.409559 cm^(-1)
02: 170.409559 cm^(-1)
03: (1.171397+0j) cm^(-1)
04: (6.354831+0j) cm^(-1)
05: (6.354831+0j) cm^(-1)
</pre>

<p>
CO has only one vibrational mode (3N-5 = 6 - 5 = 1). The other 5 modes are 3 translations and 2 rotations.
</p>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-5">
<h5 id="orgheadline59"><span class="section-number-5">3.8.3.2</span> CO<sub>2</sub> vibrations</h5>
<div class="outline-text-5" id="text-3-8-3-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get relaxed geometry</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO2'</span>)
<span style="color: #BA36A5;">CO2</span> = calc.get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now do the vibrations</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO2-vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=CO2)
calc.wait()
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #0000FF;">for</span> i, f <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vib_freq):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} cm^(-1)'</span>.<span style="color: #006FE0;">format</span>(i, f))
</pre>
</div>

<pre class="example">
00: 2339.140984 cm^(-1)
01: 1309.517832 cm^(-1)
02: 639.625419 cm^(-1)
03: 639.625419 cm^(-1)
04: (0.442216+0j) cm^(-1)
05: (1.801034+0j) cm^(-1)
06: (1.801034+0j) cm^(-1)
07: (35.286745+0j) cm^(-1)
08: (35.286745+0j) cm^(-1)
</pre>

<p>
CO\(_2\) is a linear molecule with 3N-5 = 4 vibrational modes. They are the first four frequencies in the output above.
</p>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-5">
<h5 id="orgheadline60"><span class="section-number-5">3.8.3.3</span> H<sub>2</sub> vibrations</h5>
<div class="outline-text-5" id="text-3-8-3-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get relaxed geometry</span>
<span style="color: #BA36A5;">H2</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2'</span>).get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now do the vibrations</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2-vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=H2)
calc.wait()
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #0000FF;">for</span> i, f <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vib_freq):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} cm^(-1)'</span>.<span style="color: #006FE0;">format</span>(i, f))
</pre>
</div>

<pre class="example">
00: 4484.933386 cm^(-1)
01: 0.0 cm^(-1)
02: 0.0 cm^(-1)
03: (1.5e-05+0j) cm^(-1)
04: (586.624928+0j) cm^(-1)
05: (586.624928+0j) cm^(-1)
</pre>

<p>
There is only one frequency of importance (the one at 4281 cm\(^{-1}\)) for the linear H<sub>2</sub> molecule.
</p>
</div>
</div>

<div id="outline-container-orgheadline61" class="outline-5">
<h5 id="orgheadline61"><span class="section-number-5">3.8.3.4</span> H<sub>2</sub>O vibrations</h5>
<div class="outline-text-5" id="text-3-8-3-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get relaxed geometry</span>
<span style="color: #BA36A5;">H2O</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O'</span>).get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now do the vibrations</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O-vib'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nfree=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   potim=0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=H2O)
calc.wait()
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #0000FF;">for</span> i, f <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vib_freq):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:02d}: {1} cm^(-1)'</span>.<span style="color: #006FE0;">format</span>(i, f))
</pre>
</div>

<pre class="example">
00: 3846.373652 cm^(-1)
01: 3734.935388 cm^(-1)
02: 1573.422217 cm^(-1)
03: 16.562103 cm^(-1)
04: 8.00982 cm^(-1)
05: (0.375952+0j) cm^(-1)
06: (225.466583+0j) cm^(-1)
07: (271.664033+0j) cm^(-1)
08: (286.859818+0j) cm^(-1)
</pre>

<p>
Water has 3N-6 = 3 vibrational modes.
</p>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-5">
<h5 id="orgheadline62"><span class="section-number-5">3.8.3.5</span> Thermochemistry</h5>
<div class="outline-text-5" id="text-3-8-3-5">
<p>
Now we are ready. We have the electronic energies and vibrational frequencies of each species in the reaction.
<a href="ase.thermochemistry.IdealGasThermo">ase.thermochemistry.IdealGasThermo</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.thermochemistry <span style="color: #0000FF;">import</span> IdealGasThermo
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first we get the electronic energies</span>
<span style="color: #BA36A5;">c1</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO'</span>)
<span style="color: #BA36A5;">E_CO</span> = c1.potential_energy
<span style="color: #BA36A5;">CO</span> = c1.get_atoms()

<span style="color: #BA36A5;">c2</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO2'</span>)
<span style="color: #BA36A5;">E_CO2</span> = c2.potential_energy
<span style="color: #BA36A5;">CO2</span> = c2.get_atoms()

<span style="color: #BA36A5;">c3</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2'</span>)
<span style="color: #BA36A5;">E_H2</span> = c3.potential_energy
<span style="color: #BA36A5;">H2</span> = c3.get_atoms()

<span style="color: #BA36A5;">c4</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O'</span>)
<span style="color: #BA36A5;">E_H2O</span> = c4.potential_energy
<span style="color: #BA36A5;">H2O</span> = c4.get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we get the vibrational energies</span>
<span style="color: #BA36A5;">h</span> = 4.1356675e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV * s</span>
<span style="color: #BA36A5;">c</span> = 3.0e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cm / s</span>

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO-vib'</span>)
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #BA36A5;">CO_vib_energies</span> = [h * c * nu <span style="color: #0000FF;">for</span> nu <span style="color: #0000FF;">in</span> vib_freq]

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/CO2-vib'</span>)
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #BA36A5;">CO2_vib_energies</span> = [h * c * nu <span style="color: #0000FF;">for</span> nu <span style="color: #0000FF;">in</span> vib_freq]

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2-vib'</span>)
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #BA36A5;">H2_vib_energies</span> = [h * c * nu <span style="color: #0000FF;">for</span> nu <span style="color: #0000FF;">in</span> vib_freq]

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/wgs/H2O-vib'</span>)
<span style="color: #BA36A5;">vib_freq</span> = calc.get_vibrational_frequencies()
<span style="color: #BA36A5;">H2O_vib_energies</span> = [h * c * nu <span style="color: #0000FF;">for</span> nu <span style="color: #0000FF;">in</span> vib_freq]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we make a thermo object for each molecule</span>
<span style="color: #BA36A5;">CO_t</span> = IdealGasThermo(vib_energies=CO_vib_energies[0:0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> potentialenergy=E_CO, atoms=CO,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> geometry=<span style="color: #008000;">'linear'</span>, symmetrynumber=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> spin=0)

<span style="color: #BA36A5;">CO2_t</span> = IdealGasThermo(vib_energies=CO2_vib_energies[0:4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> potentialenergy=E_CO2, atoms=CO2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> geometry=<span style="color: #008000;">'linear'</span>, symmetrynumber=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> spin=0)

<span style="color: #BA36A5;">H2_t</span> = IdealGasThermo(vib_energies=H2_vib_energies[0:0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> potentialenergy=E_H2, atoms=H2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> geometry=<span style="color: #008000;">'linear'</span>, symmetrynumber=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> spin=0)

<span style="color: #BA36A5;">H2O_t</span> = IdealGasThermo(vib_energies=H2O_vib_energies[0:3],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> potentialenergy=E_H2O, atoms=H2O,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> geometry=<span style="color: #008000;">'nonlinear'</span>, symmetrynumber=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> spin=0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we can compute G_rxn for a range of temperatures from 298 to 1000 K</span>
<span style="color: #BA36A5;">Trange</span> = np.linspace(298, 1000, 20)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">K</span>
<span style="color: #BA36A5;">P</span> = 101325. <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Pa</span>
<span style="color: #BA36A5;">Grxn</span> = np.array([(CO2_t.get_gibbs_energy(temperature=T, pressure=P)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> + H2_t.get_gibbs_energy(temperature=T, pressure=P)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - H2O_t.get_gibbs_energy(temperature=T, pressure=P)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - CO_t.get_gibbs_energy(temperature=T, pressure=P)) * 96.485
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> T <span style="color: #0000FF;">in</span> Trange])

<span style="color: #BA36A5;">Hrxn</span> = np.array([(CO2_t.get_enthalpy(temperature=T)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> + H2_t.get_enthalpy(temperature=T)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - H2O_t.get_enthalpy(temperature=T)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - CO_t.get_enthalpy(temperature=T)) * 96.485
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> T <span style="color: #0000FF;">in</span> Trange])

plt.plot(Trange, Grxn, <span style="color: #008000;">'bo-'</span>, label=<span style="color: #008000;">'$\Delta G_{rxn}$'</span>)
plt.plot(Trange, Hrxn, <span style="color: #008000;">'ro:'</span>, label=<span style="color: #008000;">'$\Delta H_{rxn}$'</span>)
plt.xlabel(<span style="color: #008000;">'Temperature (K)'</span>)
plt.ylabel(r<span style="color: #008000;">'$\Delta G_{rxn}$ (kJ/mol)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/wgs-dG-T.png'</span>)

plt.figure()
<span style="color: #BA36A5;">R</span> = 8.314e-3  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">gas constant in kJ/mol/K</span>

<span style="color: #BA36A5;">Keq</span> = np.exp(-Grxn/R/Trange)
plt.plot(Trange, Keq)
plt.ylim([0, 100])
plt.xlabel(<span style="color: #008000;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #008000;">'$K_{eq}$'</span>)
plt.savefig(<span style="color: #008000;">'images/wgs-Keq.png'</span>)
</pre>
</div>



<p>
<img src="./images/wgs-dG-T.png" alt="wgs-dG-T.png" />
You can see a few things here. One is that at near 298K, the Gibbs free energy is about -75 kJ/mol. This is too negative compared to the experimental standard free energy, which we estimated to be about -29 kJ/mol from the <a href="http://matlab.cheme.cmu.edu/2011/12/12/water-gas-shift-equilibria-via-the-nist-webbook/#7">NIST webbook. </a>There could be several reasons for this disagreement, but the most likely one is errors in the exchange-correlation functional. The error in energy has a significant effect on the calculated equilibrium constant, significantly overestimating it.
</p>


<div class="figure">
<p><img src="./images/wgs-Keq.png" alt="wgs-Keq.png" />
</p>
<p><span class="figure-number">Figure 26:</span> Temperature dependence of the equilibrium constant.</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-3">
<h3 id="orgheadline68"><a id="ID-79BC5433-AE0D-4392-B5B0-A11FFF2D3B13"></a><span class="section-number-3">3.9</span> Molecular reaction barriers</h3>
<div class="outline-text-3" id="text-3-9">
<p>
We will consider a simple example of the barrier for NH<sub>3</sub> inversion. We have to create an NH<sub>3</sub> molecule in the initial and inverted state (these have exactly the same energy), and then interpolate a band of images. Then, we use the NEB method <a class='org-ref-reference' href="#sheppard:134106">sheppard:134106</a> to compute the barrier to inversion. The NEB class of methods are pretty standard, but other algorithms for finding barriers (saddle-points) exist that may be relevant <a class='org-ref-reference' href="#olsen:9776">olsen:9776</a>.
</p>
</div>

<div id="outline-container-orgheadline65" class="outline-4">
<h4 id="orgheadline65"><span class="section-number-4">3.9.1</span> Get initial and final states</h4>
<div class="outline-text-4" id="text-3-9-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute initial and final states</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'NH3'</span>)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol == <span style="color: #008000;">'N'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #BA36A5;">Npos</span> = atoms.positions[0]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">move N to origin</span>
atoms.translate(-Npos)
atoms.set_cell((10, 10, 10), scale_atoms=<span style="color: #D0372D;">False</span>)

<span style="color: #BA36A5;">atoms2</span> = atoms.copy()
<span style="color: #BA36A5;">pos2</span> = atoms2.positions

<span style="color: #0000FF;">for</span> i,atom <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(atoms2):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'H'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reflect through z</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pos2</span>[i] *= np.array([1, 1, -1])
<span style="color: #BA36A5;">atoms2.positions</span> = pos2

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now move N to center of box</span>
atoms.translate([5, 5, 5])
atoms2.translate([5, 5, 5])

<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'molecules/nh3-initial'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>Vasp(<span style="color: #008000;">'molecules/nh3-final'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms2)]

<span style="color: #0000FF;">print</span> [c.potential_energy <span style="color: #0000FF;">for</span> c <span style="color: #0000FF;">in</span> calcs]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-4">
<h4 id="orgheadline66"><span class="section-number-4">3.9.2</span> Run band calculation</h4>
<div class="outline-text-4" id="text-3-9-2">
<p>
Now we do the band calculation. <a href="nudged elastic band">nudged elastic band</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Run NH3 NEB calculations</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.neb <span style="color: #0000FF;">import</span> NEB
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> read

<span style="color: #BA36A5;">atoms</span> = Vasp(<span style="color: #008000;">'molecules/nh3-initial'</span>).get_atoms()
<span style="color: #BA36A5;">atoms2</span> = Vasp(<span style="color: #008000;">'molecules/nh3-final'</span>).get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">5 images including endpoints</span>
<span style="color: #BA36A5;">images</span> = [atoms]   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">initial state</span>
<span style="color: #BA36A5;">images</span> += [atoms.copy() <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(3)]
<span style="color: #BA36A5;">images</span> += [atoms2]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">final state</span>

<span style="color: #BA36A5;">neb</span> = NEB(images)
neb.interpolate()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/nh3-neb'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1, encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=90,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   spring=-5.0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=images)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">calc.write_db(atoms, 'molecules/nh3-neb/00/DB.db')</span>
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">calc.write_db(atoms2, 'molecules/nh3-neb/04/DB.db')</span>
<span style="color: #BA36A5;">images</span>, <span style="color: #BA36A5;">energies</span> = calc.get_neb()
calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">print</span> images
<span style="color: #0000FF;">print</span> energies
<span style="color: #BA36A5;">p</span> = calc.plot_neb(show=<span style="color: #D0372D;">False</span>)
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.savefig(<span style="color: #008000;">'images/nh3-neb.png'</span>)
</pre>
</div>

<pre class="example">
[Atoms(symbols='NH3', positions=..., magmoms=..., cell=[10.0, 10.0, 10.0], pbc=[True, True, True], constraint=FixAtoms(indices=[0]), calculator=Vasp(...)), Atoms(symbols='NH3', positions=..., magmoms=..., cell=[10.0, 10.0, 10.0], pbc=[True, True, True], constraint=FixAtoms(indices=[0])), Atoms(symbols='NH3', positions=..., magmoms=..., cell=[10.0, 10.0, 10.0], pbc=[True, True, True], constraint=FixAtoms(indices=[0])), Atoms(symbols='NH3', positions=..., magmoms=..., cell=[10.0, 10.0, 10.0], pbc=[True, True, True], constraint=FixAtoms(indices=[0])), Atoms(symbols='NH3', positions=..., magmoms=..., cell=[10.0, 10.0, 10.0], pbc=[True, True, True], constraint=FixAtoms(indices=[0]), calculator=Vasp(...))]
[  0.00000000e+00   1.26688520e-01   2.25038820e-01   1.26688620e-01
   9.99999727e-09]
Optimization terminated successfully.
         Current function value: -0.225039
         Iterations: 15
         Function evaluations: 30
</pre>



<p>
The calculator view function shows you the band.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/nh3-neb'</span>)
calc.view()
</pre>
</div>


<div class="figure">
<p><img src="./images/nh3-neb.png" alt="nh3-neb.png" />
</p>
<p><span class="figure-number">Figure 27:</span> Nudged elastic band results for ammonia flipping.</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67"><span class="section-number-4">3.9.3</span> Make a movie of the animation</h4>
<div class="outline-text-4" id="text-3-9-3">
<p>
<a href="animation">animation</a>
It is helpful sometimes to animate the Nudged elastic band path. Here is a script to do that. I have not figured out how to embed the movie in this document
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make neb movie</span>
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Fasp(<span style="color: #008000;">'molecules/nh3-neb'</span>) <span style="color: #0000FF;">as</span> calc:
<span style="color: #BA36A5;">images</span>, <span style="color: #BA36A5;">energies</span> = calc.get_neb()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this rotates the atoms 90 degrees about the y-axis</span>
[atoms.rotate(<span style="color: #008000;">'y'</span>, np.pi/2.) <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> images]

<span style="color: #0000FF;">for</span> i,atoms <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(images):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   write(<span style="color: #008000;">'images/00{0}-nh3.png'</span>.<span style="color: #006FE0;">format</span>(i), atoms, show_unit_cell=2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">animated gif</span>
os.system(<span style="color: #008000;">'convert -delay 50 -loop 0 images/00*-nh3.png images/nh3-neb.gif'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Shockwave flash</span>
os.system(<span style="color: #008000;">'png2swf -o images/nh3-neb.swf images/00*-nh3.png '</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/nh3-neb.gif" alt="nh3-neb.gif" />
</p>
<p><span class="figure-number">Figure 28:</span> In principle this is an animated gif</p>
</div>

<p>
<a href="./images/nh3-neb.swf">./images/nh3-neb.swf</a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline111" class="outline-2">
<h2 id="orgheadline111"><a id="ID-5bdc53ba-774c-4c7a-acd1-1cddf7d15a95"></a><span class="section-number-2">4</span> Bulk systems</h2>
<div class="outline-text-2" id="text-4">
<p>
See <a href="http://arxiv.org/pdf/1204.2733.pdf">http://arxiv.org/pdf/1204.2733.pdf</a> for a very informative comparison of DFT codes for computing different bulk properties.
</p>
</div>

<div id="outline-container-orgheadline73" class="outline-3">
<h3 id="orgheadline73"><span class="section-number-3">4.1</span> Defining and visualizing bulk systems</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-orgheadline71" class="outline-4">
<h4 id="orgheadline71"><span class="section-number-4">4.1.1</span> Built-in functions in ase</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
As with molecules, <a href="ase">ase</a> provides several helper functions to create bulk structures. We highlight a few of them here. Particularly common ones are:
</p>

<ul class="org-ul">
<li><a href="ase.lattice.cubic.FaceCenteredCubic">ase.lattice.cubic.FaceCenteredCubic</a></li>
<li><a href="ase.lattice.cubic.BodyCenteredCubic">ase.lattice.cubic.BodyCenteredCubic</a></li>
<li><a href="ase.lattice.hexagonal.Graphite">ase.lattice.hexagonal.Graphite</a></li>
<li><a href="ase.lattice.compounds.NaCl">ase.lattice.compounds.NaCl</a></li>
</ul>

<p>
For others, see <a href="https://wiki.fysik.dtu.dk/ase/ase/lattice.html">https://wiki.fysik.dtu.dk/ase/ase/lattice.html</a>
</p>

<p>
We start with a simple example, fcc Ag. By default, <a href="ase">ase</a> knows Ag is an fcc metal, and knows the experimental lattice constant. We have to specify the directions (vectors along each axis) to get something other than the default output. Here, the default fcc cell contains four atoms.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(<span style="color: #008000;">'Ag'</span>)

write(<span style="color: #008000;">'images/Ag-fcc.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(atoms)
</pre>
</div>

<pre class="example">
Lattice(symbols='Ag4', positions=..., cell=[4.09, 4.09, 4.09], pbc=[True, True, True])
</pre>

<div class="note">
<p>
A <a href="ase.lattice.bravais.Lattice">ase.lattice.bravais.Lattice</a> object is returned! This is practically the same as as an <a href="ase.atoms.Atoms">ase.atoms.Atoms</a> object.
</p>

</div>


<div class="figure">
<p><img src="./images/Ag-fcc.png" alt="Ag-fcc.png" />
</p>
<p><span class="figure-number">Figure 29:</span> A simple fcc Ag bulk structure in the primitive unit cell.</p>
</div>

<p>
Here we specify the primitive unit cell, which only has one atom in it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(<span style="color: #008000;">'Ag'</span>, directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [1, 1, 0]])

write(<span style="color: #008000;">'images/Ag-fcc-primitive.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span> atoms
</pre>
</div>

<pre class="example">
Lattice(symbols='Ag', positions=..., cell=[[2.892066735052979, 0.0, 0.0], [1.4460333675264898, 2.5046032619957996, 0.0], [1.4460333675264896, 0.8348677539985997, 2.3613626009855695]], pbc=[True, True, True])
</pre>


<div class="figure">
<p><img src="./images/Ag-fcc-primitive.png" alt="Ag-fcc-primitive.png" />
</p>
<p><span class="figure-number">Figure 30:</span> A simple fcc Ag bulk structure in the primitive unit cell.</p>
</div>

<pre class="example">
Lattice(symbols='Ag', positions=..., cell=[[2.892066735052979, 0.0, 0.0], [1.4460333675264898, 2.5046032619957996, 0.0], [1.4460333675264896, 0.8348677539985997, 2.3613626009855695]], pbc=[True, True, True])
</pre>

<p>
We can use these modules to build alloy unit cells. The basic strategy is to create the base unit cell in one element and then selectively change some atoms to different chemical symbols. Here we examine an Ag<sub>3</sub>Pd alloy structure.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[1, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 1, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 0, 1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Ag'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> latticeconstant=4.0)

write(<span style="color: #008000;">'images/Ag-bulk.png'</span>, atoms, show_unit_cell=2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">to make an alloy, we can replace one atom with another kind</span>
atoms[0]<span style="color: #BA36A5;">.symbol</span> = <span style="color: #008000;">'Pd'</span>
write(<span style="color: #008000;">'images/AgPd-bulk.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ag-bulk.png" alt="Ag-bulk.png" />
</p>
<p><span class="figure-number">Figure 31:</span> A simple fcc Ag bulk structure in the traditional unit cell.</p>
</div>


<div class="figure">
<p><img src="./images/AgPd-bulk.png" alt="AgPd-bulk.png" />
</p>
<p><span class="figure-number">Figure 32:</span> A simple Ag<sub>3</sub>Pd bulk structure.</p>
</div>

<p>
To create a graphite structure we use the following code. Note that we have to specify the lattice constants (taken from <a href="http://www.phy.ohiou.edu/~asmith/NewATOMS/HOPG.pdf">http://www.phy.ohiou.edu/~asmith/NewATOMS/HOPG.pdf</a>) because <a href="ase">ase</a> has C in the diamond structure by default. We show two views, because the top view does not show the spacing between the layers.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.hexagonal <span style="color: #0000FF;">import</span> Graphite
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = Graphite(<span style="color: #008000;">'C'</span>, latticeconstant={<span style="color: #008000;">'a'</span>: 2.4612,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'c'</span>: 6.7079})
write(<span style="color: #008000;">'images/graphite.png'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms.repeat((2, 2, 1)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> rotation=<span style="color: #008000;">'115x'</span>, show_unit_cell=2)

write(<span style="color: #008000;">'images/graphite-top.png'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms.repeat((2, 2, 1)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/graphite-top.png" alt="graphite-top.png" />
</p>
<p><span class="figure-number">Figure 33:</span> A top view of graphite.</p>
</div>



<div class="figure">
<p><img src="./images/graphite.png" alt="graphite.png" />
</p>
<p><span class="figure-number">Figure 34:</span> A side view of graphite.</p>
</div>

<p>
To get a compound, we use the following code. We have to specify the basis atoms to the function generating the compound, and the lattice constant. For NaCl we use the lattice constant at (<a href="http://en.wikipedia.org/wiki/Sodium_chloride">http://en.wikipedia.org/wiki/Sodium_chloride</a>).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.compounds <span style="color: #0000FF;">import</span> NaCl
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = NaCl([<span style="color: #008000;">'Na'</span>, <span style="color: #008000;">'Cl'</span>], latticeconstant=5.65)
write(<span style="color: #008000;">'images/NaCl.png'</span>, atoms, show_unit_cell=2, rotation=<span style="color: #008000;">'45x,45y,45z'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/NaCl.png" alt="NaCl.png" />
</p>
<p><span class="figure-number">Figure 35:</span> A view of a NaCl crystal structure.</p>
</div>
</div>


<div id="outline-container-orgheadline70" class="outline-5">
<h5 id="orgheadline70"><span class="section-number-5">4.1.1.1</span> <a href="ase.spacegroup">ase.spacegroup</a></h5>
<div class="outline-text-5" id="text-4-1-1-1">
<p>
A final alternative to setting up bulk structures is <a href="ase.spacegroup">ase.spacegroup</a>. This is a concise way to setup structures if you know the following properties of the crystal structure:
</p>

<ol class="org-ol">
<li>Chemical symbols</li>
<li>Coordinates of the non-equivalent sites in the unit cell</li>
<li>the spacegroup</li>
<li>the cell parameters (a, b, c, alpha, beta, gamma)</li>
</ol>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.spacegroup <span style="color: #0000FF;">import</span> crystal
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">FCC aluminum</span>
<span style="color: #BA36A5;">a</span> = 4.05
<span style="color: #BA36A5;">al</span> = crystal(<span style="color: #008000;">'Al'</span>, [(0, 0, 0)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>spacegroup=225,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cellpar=[a, a, a, 90, 90, 90])
<span style="color: #0000FF;">print</span>(al)
</pre>
</div>

<pre class="example">
Atoms(symbols='Al4', positions=..., cell=[[4.05, 0.0, 0.0], [2.4799097682733903e-16, 4.05, 0.0], [2.4799097682733903e-16, 2.4799097682733903e-16, 4.05]], pbc=[True, True, True])
</pre>

<p>
Here is rutile TiO<sub>2</sub>.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.spacegroup <span style="color: #0000FF;">import</span> crystal

<span style="color: #BA36A5;">a</span> = 4.6
<span style="color: #BA36A5;">c</span> = 2.95
<span style="color: #BA36A5;">rutile</span> = crystal([<span style="color: #008000;">'Ti'</span>, <span style="color: #008000;">'O'</span>], basis=[(0, 0, 0), (0.3, 0.3, 0.0)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>spacegroup=136, cellpar=[a, a, c, 90, 90, 90])
<span style="color: #0000FF;">print</span> rutile
</pre>
</div>

<p>
<code>Atoms(symbols</code>'Ti2O4', positions=&#x2026;, cell=[[4.6, 0.0, 0.0], [2.816687638038912e-16, 4.6, 0.0], [1.806354028742346e-16, 1.806354028742346e-16, 2.95]], pbc=[True, True, True])
<code>=Atoms(symbols</code>'Ti2O4', positions=&#x2026;, cell=[[4.6, 0.0, 0.0], [2.816687638038912e-16, 4.6, 0.0], [1.806354028742346e-16, 1.806354028742346e-16, 2.95]], pbc=[True, True, True])
=sho
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72"><span class="section-number-4">4.1.2</span> Using <a href="http://materialsproject.org/">http://materialsproject.org/</a></h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
The <a href="http://www.materialsproject.org/">Materials Project</a> offers web access to a pretty large number of materials (over 21,000 at the time of this writing), including structure and other computed properties. You must sign up for an account at the website, and then you can access the information. You can search for materials with lots of different criteria including formula, unit cell formula, by elements, by structure, etc&#x2026; The website allows you to download the VASP files used to create the calculations. They also develop the <a href="https://github.com/materialsproject/pymatgen/">pymatgen</a> project (which requires python 2.7+).
</p>

<p>
For example, I downloaded this cif file for a RuO\(_2\) structure (Material ID 825).
</p>

<p>
#\#CIF1.1
##########################################################################
</p>

<p>
##########################################################################
</p>

<p>
data_RuO2
_symmetry_space_group_name_H-M          'P 1'
_cell_length_a                          3.13970109
_cell_length_b                          4.5436378
_cell_length_c                          4.5436378
_cell_angle_alpha                       90.0
_cell_angle_beta                        90.0
_cell_angle_gamma                       90.0
_chemical_name_systematic               'Generated by pymatgen'
_symmetry_Int_Tables_number             1
_chemical_formula_structural            RuO2
_chemical_formula_sum                   'Ru2 O4'
_cell_volume                            64.8180127062
<span class="underline">cell_formula_units_Z                   2
loop</span>
  _symmetry_equiv_pos_site_id
  _symmetry_equiv_pos_as_xyz
   1  'x, y, z'
</p>

<p>
loop_
  _atom_site_type_symbol
  _atom_site_label
  _atom_site_symmetry_multiplicity
  _atom_site_fract_x
  _atom_site_fract_y
  _atom_site_fract_z
  _atom_site_attached_hydrogens
  _atom_site_B_iso_or_equiv
  _atom_site_occupancy
   O  O1  1  0.000000  0.694330  0.694330  0  .  1
   O  O2  1  0.500000  0.805670  0.194330  0  .  1
   O  O3  1  0.000000  0.305670  0.305670  0  .  1
   O  O4  1  0.500000  0.194330  0.805670  0  .  1
   Ru  Ru5  1  0.500000  0.500000  0.500000  0  .  1
   Ru  Ru6  1  0.000000  0.000000  0.000000  0  .  1
#+end_src
</p>

<p>
We can read this file in with <a href="ase.io.read">ase.io.read</a>. That function automatically recognizes the file type by the extension.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> read, write

<span style="color: #BA36A5;">atoms</span> = read(<span style="color: #008000;">'bulk/Ru2O4_1.cif'</span>)

write(<span style="color: #008000;">'images/Ru2O4.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ru2O4.png" alt="Ru2O4.png" />
</p>
<p><span class="figure-number">Figure 36:</span> An RuO<sub>2</sub> unit cell prepared from a cif file.</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline78" class="outline-3">
<h3 id="orgheadline78"><span class="section-number-3">4.2</span> Computational parameters that are important for bulk structures</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><span class="section-number-4">4.2.1</span> k-point convergence</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
In the section on molecules, we learned that the total energy is a function of the planewave cutoff energy (ENCUT) used. In bulk systems that is true also. There is also another calculation parameter you must consider, the k-point grid. The k-point grid is a computational tool used to approximate integrals of some property, e.g. the electron density, over the entire unit cell. The integration is performed in reciprocal space (i.e. in the Brillouin zone) for convenience and efficiency, and the k-point grid is where the property is sampled for the integration. The higher the number of sampled points, the more accurately the integrals are approximated.
</p>

<p>
We will typically use a Monkhorst-Pack <a class='org-ref-reference' href="#PhysRevB.13.5188">PhysRevB.13.5188</a> $k$-point grid, which is essentially a uniformly spaced grid in the Brillouin zone. Another less commonly used scheme is the Chadi-Cohen k-point grid <a class='org-ref-reference' href="#PhysRevB.8.5747">PhysRevB.8.5747</a>. The Monkhorst-Pack grids are specified as \(n1 \times n2 \times n3\) grids, and the total number of k-points is \(n1 \cdot n2 \cdot n3\). The computational cost is linear in the total number of k-points, so  a calculation on a \(4 \times 4 \times 4\) grid will be roughly 8 times more expensive than on a \(2 \times 2 \times 2\) grid. Hence, one seeks again to balance convergence with computational tractability. Below we consider the k-point convergence of fcc Ag.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(<span style="color: #008000;">'Ag'</span>)

<span style="color: #BA36A5;">KPTS</span> = [2, 3, 4, 5, 6, 8, 10]

<span style="color: #BA36A5;">TE</span> = []

<span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> KPTS:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Ag-kpts-{0}'</span>.<span style="color: #006FE0;">format</span>(k),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[k, k, k],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">specifies the Monkhorst-Pack grid</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   TE.append(atoms.get_potential_energy())

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> TE:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.abort()

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">consider the change in energy from lowest energy state</span>
<span style="color: #BA36A5;">TE</span> = np.array(TE)
<span style="color: #BA36A5;">TE</span> -= TE.<span style="color: #006FE0;">min</span>()

plt.plot(KPTS, TE)
plt.xlabel(<span style="color: #008000;">'number of k-points in each dimension'</span>)
plt.ylabel(<span style="color: #008000;">'Total Energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/Ag-kpt-convergence.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ag-kpt-convergence.png" alt="Ag-kpt-convergence.png" />
</p>
<p><span class="figure-number">Figure 37:</span> k-point convergence of the total energy of fcc Ag.</p>
</div>

<p>
Based on this figure, we need at least a \(6 \times 6 \times 6\) k-point grid to achieve a convergence level of at least 50 meV. Note: the k-point convergence is not always monotonic like it is in this example, and sometimes very dense grids (e.g. up to \(20 \times 20 \times 20\)) are needed for highly converged properties such as the density of states in smaller unit cells. Oscillations in the total energy are typical, and it can be difficult to get high levels of convergence. The best practices are to use the same k-point sampling grid in energy differences where possible, and dense (high numbers of k-points) otherwise. It is important to check for convergence in these cases.
</p>

<p>
As unit cells get larger, the number of k-points required becomes smaller. For example, if a \(1 \times 1 \times 1\) fcc unit cell shows converged energies in a \(12 \times 12 \times 12\) k-point grid, then a \(2 \times 2 \times 2\) fcc unit cell would show the same level of convergence with a \(6 \times 6 \times 6\) k-point grid. In other words, doubling the unit cell vectors results in a halving of the number of k-points.
</p>

<p>
Sometimes you may see k-points described as k-points per reciprocal atom. For example, a \(12 \times 12 \times 12\) k-point grid for a primitive fcc unit cell would be 1728 k-points per reciprocal atom. A \(2 \times 2 \times 2\) fcc unit cell has eight atoms in it, or 0.125 reciprocal atoms, so a \(6 \times 6 \times 6\) k-point grid has 216 k-points in it, or 216/0.125 = 1728 k-points per reciprocal atom, the same as we discussed before.
</p>

<p>
In the k-point convergence example above, we used a \(6 \times 6 \times 6\) k-point grid on a unit cell with four atoms in it, leading to 864 k-points per reciprocal atom. If we had instead used the primitive unit cell, we would need either a \(9 \times 9 \times 9\) or \(10 \times 10 \times 10\) k-point grid to get a similar level of accuracy. In this case, there is no exact matching of k-point grids due to the difference in shape of the cells.
</p>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-4">
<h4 id="orgheadline75"><span class="section-number-4">4.2.2</span> <span class="todo TODO">TODO</span> Effect of <a href=http://cms.mpi.univie.ac.at/wiki/index.php/SIGMA>SIGMA</a></h4>
<div class="outline-text-4" id="text-4-2-2">
<p>
<a href="ISMEAR">ISMEAR</a>
<a href="SIGMA">SIGMA</a>
</p>

<p>
In the self-consistent cycle  of a DFT calculation, the total energy is minimized with respect to occupation of the Kohn-Sham orbitals. At absolute zero, a band is either occupied or empty. This discrete occupation results in discontinuous changes in energy with changes in occupation, which makes it difficult to converge. One solution is to artificially broaden the band occupancies, as if they were occupied at a higher temperature where partial occupation is possible. This results in a continuous dependence of energy on the partial occupancy, and dramatically increases the rate of convergence. <a href=http://cms.mpi.univie.ac.at/wiki/index.php/SIGMA>SIGMA</a> and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISMEAR>ISMEAR</a> affect how the partial occupancies of the bands are determined.
</p>

<p>
Some rules to keep in mind:
</p>
<ol class="org-ol">
<li>The smearing methods were designed for metals. For molecules, semiconductors and insulators you should use a very small SIGMA (e.g. 0.01).</li>
<li>Standard values for metallic systems is SIGMA=0.1, but the best SIGMA may be <a href="http://cms.mpi.univie.ac.at/vasp/guide/node159.html">material specific</a>.</li>
</ol>

<p>
The consequence of this finite temperature is that additional bands
must be included in the calculation to allow for the partially
occupied states above the Fermi level; the number of extra bands depends on
the temperature used.  An example of the maximum occupancies of the
bands for an Cu bulk as a function of SIGMA is
shown in Figure <a href="#fig:sigma-occ">fig:sigma-occ</a>. Obviously, as SIGMA
approaches 0, the occupancy approaches a step function.  It is preferable
that the occupancy of several of the highest bands be zero (or at
least of order \(1\times 10^{-8}\)) to ensure enough variational freedom was
available in the calculation.  Consequently, it is suggested that fifteen to
twenty extra bands be used for a SIGMA of 0.20. In any case,
it should be determined that enough bands were used by examination of
the occupancies.  It is undesirable to have too many extra bands, as
this will add computational time.
</p>


<p>
Below we show the effect of SIGMA on the band occupancies.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">a</span> = 3.61
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, (0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]])).repeat((2, 2, 2))

<span style="color: #BA36A5;">SIGMA</span> = [0.001, 0.05, 0.1, 0.2, 0.5]

<span style="color: #0000FF;">for</span> sigma <span style="color: #0000FF;">in</span> SIGMA:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-sigma-{0}'</span>.<span style="color: #006FE0;">format</span>(sigma),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=-1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=sigma,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=9 * 8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">nbands</span> = calc.parameters.nbands
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">nkpts</span> = <span style="color: #006FE0;">len</span>(calc.get_ibz_k_points())

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">occ</span> = np.zeros((nkpts, nbands))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nkpts):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">occ</span>[i, :] = calc.get_occupation_numbers(kpt=i)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">max_occ</span> = np.<span style="color: #006FE0;">max</span>(occ, axis=0) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">axis 0 is columns</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(<span style="color: #006FE0;">range</span>(nbands), max_occ, label=<span style="color: #008000;">'$\sigma = {0}$'</span>.<span style="color: #006FE0;">format</span>(sigma))

plt.xlabel(<span style="color: #008000;">'band number'</span>)
plt.ylabel(<span style="color: #008000;">'maximum occupancy (electrons)'</span>)
plt.ylim([-0.1, 2.1])
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/occ-sigma.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/occ-sigma.png" alt="occ-sigma.png" />
</p>
<p><span class="figure-number">Figure 38:</span> Effects of SIGMA on the occupancies of the Cu system. <div id="fig:sigma-occ"></p>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-4">
<h4 id="orgheadline77"><span class="section-number-4">4.2.3</span> The number of bands</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
In the last figure, it is evident that due to the smearing of the electronic states you need to have extra bands to accommodate the electrons above the Fermi level, and the higher the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/SIGMA>SIGMA</a> value is, the more bands you need. You need enough bands so that the highest energy bands are unoccupied, and VASP will give you a warning that looks like this:
</p>

<pre class="example">
 -----------------------------------------------------------------------------
|                                                                             |
|  ADVICE TO THIS USER RUNNING 'VASP/VAMP'   (HEAR YOUR MASTER'S VOICE ...):  |
|                                                                             |
|      Your highest band is occupied at some k-points! Unless you are         |
|      performing a calculation for an insulator or semiconductor, without    |
|      unoccupied bands, you have included TOO FEW BANDS!! Please increase    |
|      the parameter NBANDS in file 'INCAR' to ensure that the highest band   |
|      is unoccupied at all k-points. It is always recommended to             |
|      include a few unoccupied bands to accelerate the convergence of        |
|      molecular dynamics runs (even for insulators or semiconductors).       |
|      Because the presence of unoccupied bands improves wavefunction         |
|      prediction, and helps to suppress 'band-crossings.'                    |
|      Following all k-points will be listed (with the Fermi weights of       |
|      the highest band given in paranthesis) ... :                           |
|                                                                             |
|                          6       (-0.01472)                                 |
|                          8       (-0.01413)                                 |
|                         13       (-0.01733)                                 |
|                         14       (-0.01838)                                 |
|                                                                             |
|      The total occupancy of band no.    49 is  -0.00932 electrons ...       |
|                                                                             |
 -----------------------------------------------------------------------------
</pre>

<p>
We tell VASP the number of bands to use with the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/NBANDS>NBANDS</a> keyword. VASP will set the NBANDS automatically if you do not provide a value, but this is in general bad practice (even though it is often done in this book!). There are a few general guidelines for setting NBANDS. First we recognize that a band can only have two electrons in it (one spin up, and one spin down) in an calculation without spin-polarization, or one electron per band for a spin-polarized calculation (note that spin-polarization doubles the number of bands).  There absolutely must be enough bands to accommodate all the electrons, so the minimum number of bands is int(ceil(nelectrons/2)).
</p>

<p>
Here is an example of what this equation does.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #0000FF;">print</span> <span style="color: #006FE0;">int</span>(np.ceil(50 / 2.))
<span style="color: #0000FF;">print</span> <span style="color: #006FE0;">int</span>(np.ceil(51 / 2.))
</pre>
</div>

<pre class="example">
25
26
</pre>

<p>
However, due to the smearing, the minimum number of bands is almost never enough, and we always add more bands. The default behavior in VASP is:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">non-spin polarized</td>
<td class="org-left">NELECT/2 + NIONS/2</td>
</tr>

<tr>
<td class="org-left">spin-polarized</td>
<td class="org-left">0.6*NELECT + NMAGIONS</td>
</tr>
</tbody>
</table>

<p>
These do not always work, especially for small molecular systems where NIONS/2 may be only 1, or transition metals where it may be necessary to add up to 2*NIONS extra bands.
</p>

<p>
To figure out how many bands you need, it is necessary to know how many electrons are in your calculation. The <a href="Vasp.get_valence_electrons">Vasp.get_valence_electrons</a> provides this for you. Alternatively, you can look in the <a href="#orgheadline76">Appendix</a> for a table listing the number of valence electrons for each POTCAR file. Armed with this information you can set NBANDS the way you want.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [0.000, 0.000, 0.000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell= [[1.818, 0.000, 1.818],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[1.818, 1.818, 0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0.000, 1.818, 1.818]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[13, 13, 13],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=9,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=4,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(calc.get_valence_electrons())
<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
11.0
-3.73436945
</pre>

<p>
For this calculation we need at least 6 bands (11/2=5.5 which is rounded up to 6) and we need to include some extra bands. The default rule would only add half a band, which is not enough. We add three additional bands. This system is so small it does not substantially increase the computational cost.
</p>

<p>
If you are too trifling to do that much work, you can use the <a href="Vasp.set_nbands">Vasp.set_nbands</a> to automatically set the number of bands. This function takes an argument <code>N</code> to set the number of bands to N, <b>or</b> an argument <code>f</code> to set the NBANDS according to the formula \(nbands = int(nelectrons/2 + len(atoms)*f)\). The default value of <code>f</code> is 1.5. If you want the default VASP behavior, set f=0.5. For transition metals, it may be required that f=2. This function does not consider whether the calculation is spin-polarized or not. Here is an example of using <a href="Vasp.set_nbands">Vasp.set_nbands</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, [0.000, 0.000, 0.000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[1.818, 0.000, 1.818],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [1.818, 1.818, 0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.000, 1.818, 1.818]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[13, 13, 13],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=4,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.set_nbands(f=7)
calc.write_input()  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you have to write out the input for it to take effect</span>
<span style="color: #0000FF;">print</span> calc
</pre>
</div>

<pre class="example">
*************** VASP CALCULATION SUMMARY ***************
Vasp calculation directory:
---------------------------
  [[/home-research/jkitchin/dft-book/bulk/alloy/cu]]

Unit cell:
----------
       x       y       z             |v|
  v0   1.818   0.000   1.818       2.571 Ang
  v1   1.818   1.818   0.000       2.571 Ang
  v2   0.000   1.818   1.818       2.571 Ang
  alpha, beta, gamma (deg):  60.0  60.0  60.0
  Total volume:                   12.017 Ang^3
  Stress:    xx     yy     zz     yz     xz     xy
            nan    nan    nan    nan    nan    nan GPa

  ID  tag     sym    x         y         z        rmsF (eV/A)
  0   0       Cu     0.000     0.000     0.000        nan
  Potential energy: nan eV

INPUT Parameters:
-----------------
  pp        : PBE
  isif      : 4
  xc        : pbe
  kpts      : [13, 13, 13]
  encut     : 350
  lcharg    : False
  ibrion    : 2
  nbands    : 13
  ismear    : 1
  lwave     : True
  sigma     : 0.1
  nsw       : 10

Pseudopotentials used:
----------------------
  Cu: potpaw_PBE/Cu/POTCAR (git-hash: 13fa889d46be8b12a676c1063c5e4faede17e89b)
</pre>

<p>
Note the defaults that were set.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, [0.000, 0.000, 0.000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[1.818, 0.000, 1.818],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [1.818, 1.818, 0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.000, 1.818, 1.818]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu-setnbands'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[13, 13, 13],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> isif=4,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms)
calc.set_nbands(f=3)
calc.write_input()
<span style="color: #0000FF;">print</span> calc
</pre>
</div>

<pre class="example">
*************** VASP CALCULATION SUMMARY ***************
Vasp calculation directory:
---------------------------
  [[/home-research/jkitchin/dft-book/bulk/alloy/cu-setnbands]]

Unit cell:
----------
       x       y       z             |v|
  v0   1.818   0.000   1.818       2.571 Ang
  v1   1.818   1.818   0.000       2.571 Ang
  v2   0.000   1.818   1.818       2.571 Ang
  alpha, beta, gamma (deg):  60.0  60.0  60.0
  Total volume:                   12.017 Ang^3
  Stress:    xx     yy     zz     yz     xz     xy
            nan    nan    nan    nan    nan    nan GPa

  ID  tag     sym    x         y         z        rmsF (eV/A)
  0   0       Cu     0.000     0.000     0.000        nan
  Potential energy: nan eV

INPUT Parameters:
-----------------
  pp        : PBE
  isif      : 4
  xc        : pbe
  kpts      : [13, 13, 13]
  encut     : 350
  lcharg    : False
  ibrion    : 2
  nbands    : 9
  ismear    : 1
  lwave     : True
  sigma     : 0.1
  nsw       : 10

Pseudopotentials used:
----------------------
  Cu: potpaw_PBE/Cu/POTCAR (git-hash: 13fa889d46be8b12a676c1063c5e4faede17e89b)
</pre>

<p>
You are, of course, free to use any formula you want to set the number of bands. Some formulas I have used in the past include:
</p>

<ol class="org-ol">
<li>NBANDS = 0.65*NELECT + 10</li>
<li>NBANDS = 0.5*NELECT + 15</li>
<li>etc&#x2026;</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline84" class="outline-3">
<h3 id="orgheadline84"><a id="ID-82305f4d-66ec-4971-9504-fd44ff75bb6e"></a><span class="section-number-3">4.3</span> Determining bulk structures</h3>
<div class="outline-text-3" id="text-4-3">
<p>
What we typically mean by determining bulk structures includes the following:
</p>

<ul class="org-ul">
<li>What is the most stable crystal structure for a material?</li>
<li>What is the lattice constant of fcc Cu?</li>
<li>What are the lattice parameters and internal atom parameters for TiO<sub>2</sub>?</li>
</ul>

<p>
All of these questions can often be addressed by finding the volume, shape and atomic positions that minimize the total energy of a bulk system. This is true at 0K. At higher temperatures, one must consider minimizing the free energy, rather than the internal energy.
</p>
</div>

<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80"><span class="section-number-4">4.3.1</span> fcc/bcc crystal structures</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
The fcc and bcc structures are simple. They only have one degree of freedom: the lattice constant. In this section we show how to calculate the equilibrium volume of each structure, and determine which one is more stable. We start with the fcc crystal structure of Cu. We will manually define the crystal structure based on the definitions in Kittel <a class='org-ref-reference' href="#kittel">kittel</a> (Chapter 1).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fcc</span>
<span style="color: #BA36A5;">LC</span> = [3.5, 3.55, 3.6, 3.65, 3.7, 3.75]
<span style="color: #BA36A5;">fcc_energies</span> = []
<span style="color: #BA36A5;">ready</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, (0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]]))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-{0}'</span>.<span style="color: #006FE0;">format</span>(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   fcc_energies.append(e)

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> fcc_energies)

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(LC, fcc_energies)
plt.xlabel(<span style="color: #008000;">'Lattice constant ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/Cu-fcc.png'</span>)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'#+tblname: cu-fcc-energies'</span>
<span style="color: #0000FF;">print</span> r<span style="color: #008000;">'| lattice constant ($\AA$) | Total Energy (eV) |'</span>
<span style="color: #0000FF;">for</span> lc, e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(LC, fcc_energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'| {0} | {1} |'</span>.<span style="color: #006FE0;">format</span>(lc, e)
</pre>
</div>

<table id="orgtable1" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">lattice constant (\(\AA\))</td>
<td class="org-right">Total Energy (eV)</td>
</tr>

<tr>
<td class="org-right">3.5</td>
<td class="org-right">-3.66182568</td>
</tr>

<tr>
<td class="org-right">3.55</td>
<td class="org-right">-3.70817569</td>
</tr>

<tr>
<td class="org-right">3.6</td>
<td class="org-right">-3.73109713</td>
</tr>

<tr>
<td class="org-right">3.65</td>
<td class="org-right">-3.73432446</td>
</tr>

<tr>
<td class="org-right">3.7</td>
<td class="org-right">-3.72094163</td>
</tr>

<tr>
<td class="org-right">3.75</td>
<td class="org-right">-3.69342783</td>
</tr>
</tbody>
</table>


<div class="exercise">
<p>
Use the data in the table above to plot the total energy as a function of the lattice constant. Fit a cubic polynomial to the data, and find the volume that minimizes the total energy.
</p>

</div>


<div class="figure">
<p><img src="./images/Cu-fcc.png" alt="Cu-fcc.png" />
</p>
<p><span class="figure-number">Figure 39:</span> Total energy vs. fcc lattice contant for Cu. It appears the minimum is near 3.65 &Aring;.</p>
</div>

<p>
If you want to know the lattice constant that gives the lowest energy, you would fit an <a href="#orgheadline79">equation of state</a> to the data. Here is an example using <a href="ase.utils.eos">ase.utils.eos</a>.  See also the appendix <a href="#orgheadline79">equations of state</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.utils.eos <span style="color: #0000FF;">import</span> EquationOfState
<span style="color: #BA36A5;">LC</span> = [3.5, 3.55, 3.6, 3.65, 3.7, 3.75]
<span style="color: #BA36A5;">energies</span> = []
<span style="color: #BA36A5;">volumes</span> = []
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-{0}'</span>.<span style="color: #006FE0;">format</span>(a))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #BA36A5;">eos</span> = EquationOfState(volumes, energies)
<span style="color: #BA36A5;">v0</span>, <span style="color: #BA36A5;">e0</span>, <span style="color: #BA36A5;">B</span> = eos.fit()

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'''</span>
<span style="color: #008000;">v0 = {0} A^3</span>
<span style="color: #008000;">E0 = {1} eV</span>
<span style="color: #008000;">B  = {2} eV/A^3'''</span>.<span style="color: #006FE0;">format</span>(v0, e0, B)

eos.plot(<span style="color: #008000;">'images/Cu-fcc-eos.png'</span>)
</pre>
</div>


<pre class="example">
v0 = 11.9941760954 A^3
E0 = -3.73528237713 eV
B  = 0.862553823078 eV/A^3
</pre>

<p>
<code>3.63585568663</code> <code>3.63585568663</code> <code>3.63585568663</code>
</p>


<div class="figure">
<p><img src="./images/Cu-fcc-eos.png" alt="Cu-fcc-eos.png" />
</p>
<p><span class="figure-number">Figure 40:</span> Total energy vs. volume for fcc Cu with  fitted cubic polynomial equation of state.</p>
</div>


<p>
Before we jump into the bcc calculations, let us consider what range of lattice constants we should choose. The fcc lattice is close-packed, and the volume of the primitive cell is \(V = 1/4 a^3\) or about 11.8 &Aring;<sup>3</sup>/atom. The volume of the equilibrium bcc primitive cell will probably be similar to that. The question is: what bcc lattice constant gives that volume? The simplest way to answer this is to compute the answer. We will make a bcc crystal at the fcc lattice constant, and then compute the scaling factor needed to make it the right volume.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">a</span> = 3.61 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">lattice constant</span>

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, [0,0,0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a*np.array([[ 1.0,  1.0, -1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[-1.0,  1.0,  1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[ 1.0, -1.0,  1.0]]))

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'BCC lattice constant = {0:1.3f} Ang'</span>.<span style="color: #006FE0;">format</span>(a * (11.8 / atoms.get_volume())**(1./3.))
</pre>
</div>

<pre class="example">
BCC lattice constant = 2.868 Ang
</pre>

<p>
Now we run the equation of state calculations.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">LC</span> = [2.75, 2.8, 2.85, 2.9, 2.95, 3.0]

<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, [0, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[ 1.0,  1.0, -1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [-1.0,  1.0,  1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [ 1.0, -1.0,  1.0]]))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-bcc-{0}'</span>.<span style="color: #006FE0;">format</span>(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
-3.59937543
-3.67930795
-3.71927399
-3.72637899
-3.70697046
-3.66645678
</pre>

<p>
Finally, we will compare the two crystal structures.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">bcc energies and volumes</span>
<span style="color: #BA36A5;">bcc_LC</span> = [2.75, 2.8, 2.85, 2.9, 2.95, 3.0]
<span style="color: #BA36A5;">bcc_volumes</span> = []
<span style="color: #BA36A5;">bcc_energies</span> = []
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> bcc_LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-bcc-{0}'</span>.<span style="color: #006FE0;">format</span>(a))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   bcc_volumes.append(atoms.get_volume())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   bcc_energies.append(atoms.get_potential_energy())

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fcc energies and volumes</span>
<span style="color: #BA36A5;">fcc_LC</span> = [3.5, 3.55, 3.6, 3.65, 3.7, 3.75]
<span style="color: #BA36A5;">fcc_volumes</span> = []
<span style="color: #BA36A5;">fcc_energies</span> =[]
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> fcc_LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-{0}'</span>.<span style="color: #006FE0;">format</span>(a))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   fcc_volumes.append(atoms.get_volume())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   fcc_energies.append(atoms.get_potential_energy())

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(fcc_volumes, fcc_energies, label=<span style="color: #008000;">'fcc'</span>)
plt.plot(bcc_volumes, bcc_energies, label=<span style="color: #008000;">'bcc'</span>)

plt.xlabel(<span style="color: #008000;">'Atomic volume ($\AA^3$/atom)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.legend()
plt.savefig(<span style="color: #008000;">'images/Cu-bcc-fcc.png'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">print table of data</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'#+tblname: bcc-data'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'#+caption: Total energy vs. lattice constant for BCC Cu.'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'| Lattice constant (\AA$^3$) | Total energy (eV) |'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'|-'</span>
<span style="color: #0000FF;">for</span> lc, e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(bcc_LC, bcc_energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'| {0} | {1} |'</span>.<span style="color: #006FE0;">format</span>(lc, e)
</pre>
</div>

<p>
/home-research/jkitchin/dft-book/bulk/Cu-bcc-2.75 Queued: 1392110.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Cu-bcc-2.8 Queued: 1392111.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Cu-bcc-2.85 Queued: 1392112.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Cu-bcc-2.9 Queued: 1392113.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Cu-bcc-2.95 Queued: 1392114.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Cu-bcc-3.0 Queued: 1392115.gilgamesh.cheme.cmu.edu
</p>
<table id="orgtable2" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> Total energy vs. lattice constant for BCC Cu.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Lattice constant (&Aring;\(^3\))</th>
<th scope="col" class="org-left">Total energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2.75</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.8</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.85</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.9</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.95</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">3.0</td>
<td class="org-left">None</td>
</tr>
</tbody>
</table>
<p>
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-2.75 Queued: 1391788.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-2.8 Queued: 1391789.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-2.85 Queued: 1391790.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-2.9 Queued: 1391791.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-2.95 Queued: 1391792.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book-new-vasp/bulk/Cu-bcc-3.0 Queued: 1391793.gilgamesh.cheme.cmu.edu
</p>
<table id="orgtable3" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> Total energy vs. lattice constant for BCC Cu.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Lattice constant (&Aring;\(^3\))</th>
<th scope="col" class="org-left">Total energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2.75</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.8</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.85</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.9</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">2.95</td>
<td class="org-left">None</td>
</tr>

<tr>
<td class="org-right">3.0</td>
<td class="org-left">None</td>
</tr>
</tbody>
</table>
<table id="orgtable4" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> Total energy vs. lattice constant for BCC Cu.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Lattice constant (&Aring;\(^3\))</th>
<th scope="col" class="org-right">Total energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2.75</td>
<td class="org-right">-3.59937543</td>
</tr>

<tr>
<td class="org-right">2.8</td>
<td class="org-right">-3.67930795</td>
</tr>

<tr>
<td class="org-right">2.85</td>
<td class="org-right">-3.71927399</td>
</tr>

<tr>
<td class="org-right">2.9</td>
<td class="org-right">-3.72637899</td>
</tr>

<tr>
<td class="org-right">2.95</td>
<td class="org-right">-3.70697046</td>
</tr>

<tr>
<td class="org-right">3.0</td>
<td class="org-right">-3.66645679</td>
</tr>
</tbody>
</table>


<div class="exercise">
<p>
Use the data for FCC and BCC Cu to plot the total energy as a function of the lattice constant.
</p>

</div>


<div class="figure">
<p><img src="./images/Cu-bcc-fcc.png" alt="Cu-bcc-fcc.png" />
</p>
<p><span class="figure-number">Figure 41:</span> Comparison of energies between fcc and bcc Cu. The fcc structure is lower in energy.</p>
</div>

<p>
Note we plot the energy vs. atomic volume. That is because the lattice constants of the two crystal structures are very different. It also shows that the atomic volumes in the two structures are similar.
</p>

<p>
What can we say here? The fcc structure has a lower energy than the bcc structure, so we can conclude the fcc structure is more favorable. In fact, the fcc structure is the experimentally found structure for Cu. Some caution is in order; if you run these calculations at a \(4 \times 4 \times 4\) $k$-point grid, the bcc structure is more stable because the results are not converged!
</p>

<div class="exercise">
<p>
Compute the energy vs. volume for fcc and bcc Cu for different $k$-point grids. Determine when each result has converged, and which structure is more stable.
</p>

</div>

<p>
What can we say about the relative stability of fcc to hcp? Nothing, until we calculate the hcp equation of state.
</p>
</div>
</div>


<div id="outline-container-orgheadline81" class="outline-4">
<h4 id="orgheadline81"><span class="section-number-4">4.3.2</span> Optimizing the hcp lattice constant</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
The hcp lattice is more complicated than the fcc/bcc lattices because there are two lattice parameters: \(a\) and \(c\) or equivalently: \(a\) and \(c/a\). We will start by making a grid of values and find the set of parameters that minimizes the energy. See Figure <a href="#fig:ru-e-ca">fig:ru-e-ca</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.hexagonal <span style="color: #0000FF;">import</span> HexagonalClosedPacked
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">atoms</span> = HexagonalClosedPacked(symbol=<span style="color: #008000;">'Ru'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> latticeconstant={<span style="color: #008000;">'a'</span>: 2.7,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'c/a'</span>: 1.584})

<span style="color: #BA36A5;">a_list</span> = [2.5, 2.6, 2.7, 2.8, 2.9]
<span style="color: #BA36A5;">covera_list</span> = [1.4, 1.5, 1.6, 1.7, 1.8]

<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> a_list:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">energies</span> = []
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> covera <span style="color: #0000FF;">in</span> covera_list:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = HexagonalClosedPacked(symbol=<span style="color: #008000;">'Ru'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> latticeconstant={<span style="color: #008000;">'a'</span>: a,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'c/a'</span>: covera})

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">wd</span> = <span style="color: #008000;">'bulk/Ru/{0:1.2f}-{1:1.2f}'</span>.<span style="color: #006FE0;">format</span>(a, covera)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(wd,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the c-axis is longer than the a-axis, so we use</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fewer kpoints.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(covera_list, energies, label=r<span style="color: #008000;">'a={0} $\AA$'</span>.<span style="color: #006FE0;">format</span>(a))

plt.xlabel(<span style="color: #008000;">'$c/a$'</span>)
plt.ylabel(<span style="color: #008000;">'Energy (eV)'</span>)
plt.legend()
plt.savefig(<span style="color: #008000;">'images/Ru-covera-scan.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ru-covera-scan.png" alt="Ru-covera-scan.png" />
</p>
<p><span class="figure-number">Figure 42:</span> Total energy vs. \(c/a\) for different values of \(a\). \label{fig:ru-e-ca}</p>
</div>

<p>
It looks like there is a minimum in the a=2.7  &Aring;  curve, at a \(c/a\) ratio of about 1.6. We can look at the same data in a contour plot which shows more clearly there is minimum in all directions near that point (Figure <a href="#fig:ru-contourf">fig:ru-contourf</a>).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">x</span> = [2.5, 2.6, 2.7, 2.8, 2.9]
<span style="color: #BA36A5;">y</span> = [1.4, 1.5, 1.6, 1.7, 1.8]

<span style="color: #BA36A5;">X</span>,<span style="color: #BA36A5;">Y</span> = np.meshgrid(x, y)
<span style="color: #BA36A5;">Z</span> = np.zeros(X.shape)

<span style="color: #0000FF;">for</span> i,a <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(x):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> j,covera <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(y):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">wd</span> = <span style="color: #008000;">'bulk/Ru/{0:1.2f}-{1:1.2f}'</span>.<span style="color: #006FE0;">format</span>(a, covera)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(wd)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Z[i][j] = calc.potential_energy

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> Z)

<span style="color: #BA36A5;">cf</span> = plt.contourf(X, Y, Z, 20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cmap=plt.cm.jet)

<span style="color: #BA36A5;">cbar</span> = plt.colorbar(cf)
cbar.ax.set_ylabel(<span style="color: #008000;">'Energy (eV)'</span>)

plt.xlabel(<span style="color: #008000;">'$a$ ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'$c/a$'</span>)

plt.legend()
plt.savefig(<span style="color: #008000;">'images/ru-contourf.png'</span>)
plt.show()
</pre>
</div>
<pre class="example">
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.40 Queued: 1392116.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.40 Queued: 1392116.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.50 Queued: 1392117.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.50 Queued: 1392117.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.60 Queued: 1392118.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.60 Queued: 1392118.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.70 Queued: 1392119.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.70 Queued: 1392119.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.80 Queued: 1392120.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.50-1.80 Queued: 1392120.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.40 Queued: 1392121.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.40 Queued: 1392121.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.50 Queued: 1392122.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.50 Queued: 1392122.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.60 Queued: 1392123.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.60 Queued: 1392123.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.70 Queued: 1392124.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.70 Queued: 1392124.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.80 Queued: 1392125.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.60-1.80 Queued: 1392125.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.40 Queued: 1392126.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.40 Queued: 1392126.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.50 Queued: 1392127.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.50 Queued: 1392127.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.60 Queued: 1392128.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.60 Queued: 1392128.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.70 Queued: 1392129.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.70 Queued: 1392129.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.80 Queued: 1392130.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.70-1.80 Queued: 1392130.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.40 Queued: 1392131.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.40 Queued: 1392131.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.50 Queued: 1392132.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.50 Queued: 1392132.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.60 Queued: 1392133.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.60 Queued: 1392133.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.70 Queued: 1392134.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.70 Queued: 1392134.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.80 Queued: 1392135.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.80-1.80 Queued: 1392135.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.40 Queued: 1392136.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.40 Queued: 1392136.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.50 Queued: 1392137.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.50 Queued: 1392137.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.60 Queued: 1392138.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.60 Queued: 1392138.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.70 Queued: 1392139.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.70 Queued: 1392139.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.80 Queued: 1392140.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/Ru/2.90-1.80 Queued: 1392140.gilgamesh.cheme.cmu.edu
</pre>


<div class="figure">
<p><img src="./images/ru-contourf.png" alt="ru-contourf.png" />
</p>
<p><span class="figure-number">Figure 43:</span> Contour plot of the total energy of hcp Ru for different values of \(a\) and \(c/a\). \label{fig:ru-contourf}</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline82" class="outline-4">
<h4 id="orgheadline82"><span class="section-number-4">4.3.3</span> Complex structures with internal degrees of freedom</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
A unit cell has six degrees of freedom: the lengths of each unit cell vector, and the angle between each vector. There may additionally be internal degrees of freedom for the atoms. It is impractical to try the approach used for the hcp Ru on anything complicated. Instead, we rely again on algorithms to optimize the unit cell shape, volume and internal degrees of freedom. It is usually not efficient to make a wild guess of the geometry and then turn VASP loose on to optimize it. Instead, the following algorithm works pretty well.
</p>

<ol class="org-ol">
<li>Find the volume (at constant shape, with relaxed ions) that minimizes the total energy (<a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISIF>ISIF</a>=2). The goal here is to just get an idea of where the right volume is.</li>
<li>Using the results from step 1 as a starting point, perform a set of calculations at constant volume around the minimum from step 1, but the shape and internal atom positions are allowed to change (<a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISIF>ISIF</a>=4).</li>
<li>Finally, do a final calculation near the minimum energy allowing the volume to also change. (<a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISIF>ISIF</a>=3).</li>
</ol>

<p>
This multistep process is pretty reasonable to get a converged structure pretty quickly. It is not foolproof, however, and if you have materials such as graphite it may not work well. The problem with graphite is that it is a layered compound that is held together by weak van der waal type forces which are not modeled well by typical GGA functionals. Thus the change in energy due to a volume change is larger in the plane of the graphite sheet than in the direction normal to the sheet. With a typical GGA, the sheets may just move apart until they do not interact any more.
</p>

<p>
We will illustrate the process on a well-behaved system (rutile TiO<sub>2</sub>) which has two lattice parameters and one internal degree of freedom. There are a few subtle points to mention in doing these calculations. The VASP <a href="http://cms.mpi.univie.ac.at/vasp/guide/node161.html">manual</a> recommends that you set <a href=http://cms.mpi.univie.ac.at/wiki/index.php/PREC>PREC</a> to 'high', and that ENCUT be set to 1.3*max(ENMAX) of the pseudopotentials. This is necessary to avoid problems caused by small basis sets when the volume changes, and Pulay stress. It is important to ensure that the energies are reasonably converged with respect to k-point grids. Hence, it can be a significant amount of work to do this right! Let us start with determining the ENCUT value that is appropriate for TiO<sub>2</sub>.
</p>

<div class="org-src-container">

<pre class="src src-sh">grep ENMAX $<span style="color: #BA36A5;">VASP_PP_PATH</span>/potpaw_PBE/Ti/POTCAR
grep ENMAX $<span style="color: #BA36A5;">VASP_PP_PATH</span>/potpaw_PBE/O/POTCAR
</pre>
</div>

<pre class="example">
ENMAX  =  178.330; ENMIN  =  133.747 eV
ENMAX  =  400.000; ENMIN  =  300.000 eV
</pre>

<p>
According to the manual, we should use ENCUT = 1.3*400 = 520 eV for good results.
</p>

<p>
Now we consider the k-point convergence. The lattice vectors of the rutile TiO<sub>2</sub> structure are not all the same length, which means it is not essential that we use the same number of k-points in each direction. For simplicity, however, we do that here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">step 1 frozen atoms and shape at different volumes</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #008000;">'''</span>
<span style="color: #008000;">create a TiO2 structure from the lattice vectors at</span>
<span style="color: #008000;">http://cst-www.nrl.navy.mil/lattice/struk/c4.html</span>
<span style="color: #008000;">This site does not exist anymore.</span>
<span style="color: #008000;">'''</span>
<span style="color: #BA36A5;">a</span> = 4.59  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">experimental degrees of freedom.</span>
<span style="color: #BA36A5;">c</span> = 2.96
<span style="color: #BA36A5;">u</span> = 0.3  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">internal degree of freedom!</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">primitive vectors</span>
<span style="color: #BA36A5;">a1</span> = a * np.array([1.0, 0.0, 0.0])
<span style="color: #BA36A5;">a2</span> = a * np.array([0.0, 1.0, 0.0])
<span style="color: #BA36A5;">a3</span> = c * np.array([0.0, 0.0, 1.0])

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Ti'</span>, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Ti'</span>, 0.5 * a1 + 0.5 * a2 + 0.5 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, u * a1 + u * a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, -u * a1 - u * a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, (0.5 + u) * a1 + (0.5 - u) * a2 + 0.5 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, (0.5 - u) * a1 + (0.5 + u) * a2 + 0.5 * a3)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[a1, a2, a3])

<span style="color: #BA36A5;">KPOINTS</span> = [2, 3, 4, 5, 6, 7, 8]
<span style="color: #BA36A5;">energies</span> = []

<span style="color: #BA36A5;">ready</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> KPOINTS:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/kpts-{0}'</span>.<span style="color: #006FE0;">format</span>(k),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=520,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[k, k, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.05,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

plt.plot(KPOINTS, energies)
plt.xlabel(<span style="color: #008000;">'number of k-points in each vector'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/tio2-kpt-convergence.png'</span>)
</pre>
</div>



<div class="figure">
<p><img src="./images/tio2-kpt-convergence.png" alt="tio2-kpt-convergence.png" />
</p>
<p><span class="figure-number">Figure 44:</span> k-point convergence of rutile TiO<sub>2</sub>.</p>
</div>

<p>
A k-point grid of \(5 \times 5 \times 5\) appears suitable for reasonably converged results. Now we proceed with step 1: Compute the total energy of the unit cell allowing internal degrees of freedom to relax, but keeping a constant cell shape.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">step 1 frozen atoms and shape at different volumes</span>
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #008000;">'''</span>
<span style="color: #008000;">create a TiO2 structure from the lattice vectors at</span>
<span style="color: #008000;">http://cst-www.nrl.navy.mil/lattice/struk/c4.html</span>
<span style="color: #008000;">'''</span>
<span style="color: #BA36A5;">a</span> = 4.59  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">experimental degrees of freedom.</span>
<span style="color: #BA36A5;">c</span> = 2.96
<span style="color: #BA36A5;">u</span> = 0.3  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">internal degree of freedom!</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">primitive vectors</span>
<span style="color: #BA36A5;">a1</span> = a * np.array([1.0, 0.0, 0.0])
<span style="color: #BA36A5;">a2</span> = a * np.array([0.0, 1.0, 0.0])
<span style="color: #BA36A5;">a3</span> = c * np.array([0.0, 0.0, 1.0])

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Ti'</span>, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Ti'</span>, 0.5 * a1 + 0.5 * a2 + 0.5 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, u * a1 + u * a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, -u * a1 - u * a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, (0.5 + u) * a1 + (0.5 - u) * a2 + 0.5 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, (0.5 - u) * a1 + (0.5 + u) * a2 + 0.5 * a3)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[a1, a2, a3])

<span style="color: #BA36A5;">v0</span> = atoms.get_volume()
<span style="color: #BA36A5;">cell0</span> = atoms.get_cell()

<span style="color: #BA36A5;">factors</span> = [0.9, 0.95, 1.0, 1.05, 1.1] <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">to change volume by</span>

<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">volumes</span> = [], []

<span style="color: #BA36A5;">ready</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v1</span> = f * v0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cell_factor</span> = (v1 / v0)**(1. / 3.)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.set_cell(cell0 * cell_factor, scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step1-{0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(f),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=520,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[5, 5, 5],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=2, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">relax internal degrees of freedom</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=50,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.05,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

plt.plot(volumes, energies)
plt.xlabel(<span style="color: #008000;">'Vol. ($\AA^3)$'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/tio2-step1.png'</span>)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'#+tblname: tio2-vol-ene'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'#+caption: Total energy of TiO_{2} vs. volume.'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'| Volume ($\AA^3$) | Energy (eV) |'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'|-'</span>
<span style="color: #0000FF;">for</span> v, e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(volumes, energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'| {0} | {1} |'</span>.<span style="color: #006FE0;">format</span>(v, e)
</pre>
</div>

<table id="orgtable5" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> Total energy of TiO<sub>2</sub> vs. volume.</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Volume (\(\AA^3\))</th>
<th scope="col" class="org-right">Energy (eV)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">56.1254185488</td>
<td class="org-right">-51.81932158</td>
</tr>

<tr>
<td class="org-right">59.2434971663</td>
<td class="org-right">-52.46118036</td>
</tr>

<tr>
<td class="org-right">62.361576</td>
<td class="org-right">-52.76017908</td>
</tr>

<tr>
<td class="org-right">65.4796549456</td>
<td class="org-right">-52.80043775</td>
</tr>

<tr>
<td class="org-right">68.5977335623</td>
<td class="org-right">-52.64628895</td>
</tr>
</tbody>
</table>



<div class="figure">
<p><img src="./images/tio2-step1.png" alt="tio2-step1.png" />
</p>
<p><span class="figure-number">Figure 45:</span> Total energy vs. volume for rutile TiO<sub>2</sub> in step 1 of the optimization.</p>
</div>

<p>
Now, we know the minimum energy volume is near 64 &Aring;^3. You could at this point fit an equation of state to find that minimum. However, we now want to use these initial starting points for a second round of optimization where we allow the unit cell shape to change, at constant volume: ISIF=4.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step1-0.90'</span>)
calc.clone(<span style="color: #008000;">'bulk/tio2/step2-0.90'</span>)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">calc.set(isif=4)</span>
<span style="color: #0000FF;">print</span> calc.<span style="color: #006FE0;">set</span>(isif=4)
<span style="color: #0000FF;">print</span> calc.calculation_required()
</pre>
</div>

<pre class="example">
clone:  Atoms(symbols='Ti2O4', positions=..., magmoms=..., cell=[4.41041021, 4.41041021, 2.88537073], pbc=[True, True, True], calculator=SinglePointCalculator(...))
{}
False
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">factors</span> = [0.9, 0.95, 1.0, 1.05, 1.1]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">to change volume by</span>

<span style="color: #BA36A5;">energies1</span>, <span style="color: #BA36A5;">volumes1</span> = [], []  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">from step 1</span>
<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">volumes</span> = [], []  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">for step 2</span>
<span style="color: #BA36A5;">ready</span> = <span style="color: #D0372D;">True</span>
<span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step1-{0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies1.append(atoms.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes1.append(atoms.get_volume())

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.clone(<span style="color: #008000;">'bulk/tio2/step2-{0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.<span style="color: #006FE0;">set</span>(isif=4)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">You have to get the atoms again.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())

<span style="color: #0000FF;">print</span>(energies, volumes)
calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(volumes1, energies1, volumes, energies)
plt.xlabel(<span style="color: #008000;">'Vol. ($\AA^3)$'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.legend([<span style="color: #008000;">'step 1'</span>, <span style="color: #008000;">'step 2'</span>], loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/tio2-step2.png'</span>)
</pre>
</div>


<pre class="example">
([-51.82715553, -52.46235848, -52.76127768, -52.80903199, -52.67597935], [56.125418401558292, 59.243497055444799, 62.36157600817976, 65.47965475812434, 68.597733708605929])
</pre>


<div class="figure">
<p><img src="./images/tio2-step2.png" alt="tio2-step2.png" />
</p>
<p><span class="figure-number">Figure 46:</span> Total energy vs. volume for step 2 of the unit cell optimization.</p>
</div>

<p>
The take away message here is that the total energy slightly decreases when we allow the unit cell shape to change, especially for the larger unit cell deformation. This has little effect on the minimum volume, but would have an effect on the bulk modulus, which is related to the curvature of the equation of state. At this point, you could fit an equation of state to the step 2 data, and estimate the volume at the minimum volume, and recalculate the total energy at that volume.
</p>

<p>
An alternative is a final calculation with ISIF=3, which optimizes the unit cell volume, shape and internal coordinates.  It looks like the calculation at bulk/tio2/step2-1.05 is close to the minimum, so we will use that as a starting point for the final calculation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step2-1.05'</span>)
calc.clone(<span style="color: #008000;">'bulk/tio2/step3'</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step3'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3)
calc.wait()
<span style="color: #0000FF;">print</span> calc

<span style="color: #0000FF;">from</span> pyspglib <span style="color: #0000FF;">import</span> spglib
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'\nThe spacegroup is {0}'</span>.<span style="color: #006FE0;">format</span>(spglib.get_spacegroup(calc.atoms))
</pre>
</div>

<pre class="example">
*************** VASP CALCULATION SUMMARY ***************
Vasp calculation directory:
---------------------------
  [[/home-research/jkitchin/dft-book/bulk/tio2/step3]]

Unit cell:
----------
       x       y       z             |v|
  v0   4.661   0.000   0.000       4.661 Ang
  v1   0.000   4.661   0.000       4.661 Ang
  v2   0.000   0.000   2.970       2.970 Ang
  alpha, beta, gamma (deg):  90.0  90.0  90.0
  Total volume:                   64.535 Ang^3
  Stress:    xx     yy     zz     yz     xz     xy
         -0.002 -0.002 -0.000 -0.000 -0.000 -0.000 GPa

  ID  tag     sym    x         y         z        rmsF (eV/A)
  0   0       Ti     0.000     0.000     0.000       0.00
  1   0       Ti     2.331     2.331     1.485       0.00
  2   0       O      1.420     1.420     0.000       0.00
  3   0       O      3.241     3.241     0.000       0.00
  4   0       O      3.751     0.910     1.485       0.00
  5   0       O      0.910     3.751     1.485       0.00
  Potential energy: -52.8176 eV

INPUT Parameters:
-----------------
  pp        : PBE
  isif      : 3
  xc        : pbe
  kpts      : [5, 5, 5]
  encut     : 520
  lcharg    : False
  ibrion    : 1
  ismear    : 1
  lwave     : False
  sigma     : 0.05
  nsw       : 50

Pseudopotentials used:
----------------------
  Ti: potpaw_PBE/Ti/POTCAR (git-hash: 39cac2d7c620efc80c69344da61b5c43bc16e9b8)
  O: potpaw_PBE/O/POTCAR (git-hash: 592f34096943a6f30db8749d13efca516d75ec55)

The spacegroup is P4_2/mnm (136)
</pre>


<p>
This is the final result. You can see that the forces on all the atoms are less than 0.01 eV/&Aring;, and the stress is also very small. The final volume is close to where we expect it to be based on steps 1 and 2. The space group is still correct. The lattice vectors are close in length to the experimentally known values, and the angles between the vectors has not changed much. Looks good!
</p>

<p>
As a final note, the VASP <a href="http://cms.mpi.univie.ac.at/vasp/guide/node164.html">manual</a> recommends you do not use the final energy directly from the calculation, but rather run a final calculation with <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ISMEAR>ISMEAR</a> set to -5. Here we examine the effect.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step3'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'default ismear: '</span>, atoms.get_potential_energy()

calc.clone(<span style="color: #008000;">'bulk/tio2/step4'</span>)
calc.<span style="color: #006FE0;">set</span>(ismear=-5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=0)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'ismear=-5:      '</span>, atoms.get_potential_energy()
</pre>
</div>

<pre class="example">
default ismear:  -52.81760338
ismear=-5:       -52.8004532
</pre>

<p>
The difference here is on the order of a meV. That does not seem significant here. I suspect the recommended practice stems from early days when much smaller ENCUT values were used and changes in the number of basis functions were more significant.
</p>
</div>
</div>

<div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83"><span class="section-number-4">4.3.4</span> Effect of XC on bulk properties</h4>
<div class="outline-text-4" id="text-4-3-4">
<p>
The exchange correlation functional can significantly affect computed bulk properties. Here, we examine the effect on the bulk lattice constant of Pd (exp. 3.881). An excellent review of this can be found in <a class='org-ref-reference' href="#mattsson-084714">mattsson-084714</a>. We examine several functionals. The <code>xc</code> keyword in <code>Vasp</code> is used to select the POTCARs.  Let us consider the LDA functional first.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.utils.eos <span style="color: #0000FF;">import</span> EquationOfState
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">LC</span> = [3.75, 3.80, 3.85, 3.90, 3.95, 4.0, 4.05, 4.1]

<span style="color: #BA36A5;">volumes</span>, <span style="color: #BA36A5;">energies</span> = [], []
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>, (0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]]))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Pd-LDA-{0}'</span>.<span style="color: #006FE0;">format</span>(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'LDA'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(e)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #BA36A5;">eos</span> = EquationOfState(volumes, energies)
<span style="color: #BA36A5;">v0</span>, <span style="color: #BA36A5;">e0</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'LDA lattice constant is {0:1.3f} Ang^3'</span>.<span style="color: #006FE0;">format</span>((4*v0)**(1./3.)))
</pre>
</div>

<pre class="example">
LDA lattice constant is 3.841 Ang^3
</pre>

<p>
For a GGA calculation, it is possible to specify which functional you want via the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/GGA>GGA</a> tag. This tag was designed to use the LDA POTCAR files, but with a GGA functional. We will consider four different functionals here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.utils.eos <span style="color: #0000FF;">import</span> EquationOfState
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">LC</span> = [3.75, 3.80, 3.85, 3.90, 3.95, 4.0, 4.05, 4.1]

<span style="color: #BA36A5;">GGA</span> = {<span style="color: #008000;">'AM'</span>: <span style="color: #008000;">'AM05'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'PE'</span>: <span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'PS'</span>: <span style="color: #008000;">'PBEsol'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'RP'</span>: <span style="color: #008000;">'RPBE'</span>}

<span style="color: #0000FF;">for</span> key <span style="color: #0000FF;">in</span> GGA:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">volumes</span>, <span style="color: #BA36A5;">energies</span> = [], []
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>, (0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]]))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Pd-GGA-{1}-{0}'</span>.<span style="color: #006FE0;">format</span>(a, key),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'LDA'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   gga=key,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(e)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">not</span> <span style="color: #0000FF;">in</span> energies:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">eos</span> = EquationOfState(volumes, energies)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v0</span>, <span style="color: #BA36A5;">e0</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'{1:6s} lattice constant is {0:1.3f} Ang^3'</span>.<span style="color: #006FE0;">format</span>((4*v0)**(1./3.),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>GGA[key])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> energies, LC
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'{0} is not ready'</span>.<span style="color: #006FE0;">format</span>(GGA[key])
</pre>
</div>

<pre class="example">
PBEsol lattice constant is 3.841 Ang^3
AM05   lattice constant is 3.841 Ang^3
RPBE   lattice constant is 3.841 Ang^3
PBE    lattice constant is 3.939 Ang^3
</pre>

<p>
These results compare very favorably to those in <a class='org-ref-reference' href="#mattsson-084714">mattsson-084714</a>. It is typical that LDA functionals underestimate the lattice constants, and that GGAs tend to overestimate the lattice constants. PBEsol and AM05 were designed specifically for solids, and for Pd, these functionals do an exceptional job of reproducing the lattice constants. RPBE is particularly bad at the lattice constant, but it has been reported to be a superior functional for reactivity <a class='org-ref-reference' href="#hammer1999:improv-pbe">hammer1999:improv-pbe</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline85" class="outline-3">
<h3 id="orgheadline85"><span class="section-number-3">4.4</span> <span class="todo TODO">TODO</span> Using built-in ase optimization with vasp</h3>
<div class="outline-text-3" id="text-4-4">
<p>
ASE has some nice optimization tools built into it. We can use them in vasp too. This example is adapted from this test: <a href="https://trac.fysik.dtu.dk/projects/ase/browser/trunk/ase/test/vasp/vasp_Al_volrelax.py">https://trac.fysik.dtu.dk/projects/ase/browser/trunk/ase/test/vasp/vasp_Al_volrelax.py</a>
</p>

<p>
First the VASP way.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice <span style="color: #0000FF;">import</span> bulk

<span style="color: #BA36A5;">Al</span> = bulk(<span style="color: #008000;">'Al'</span>, <span style="color: #008000;">'fcc'</span>, a=4.5, cubic=<span style="color: #D0372D;">True</span>)
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Al-lda-vasp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'LDA'</span>, isif=7, nsw=5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1, ediffg=-1e-3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lwave=<span style="color: #D0372D;">False</span>, lcharg=<span style="color: #D0372D;">False</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=Al)
<span style="color: #0000FF;">print</span>(calc.potential_energy)
<span style="color: #0000FF;">print</span>(calc)
</pre>
</div>

<pre class="example">
-10.07430725

Vasp calculation in /home-research/jkitchin/dft-book/bulk/Al-lda-vasp

INCAR created by Atomic Simulation Environment
 ISIF = 7
 LCHARG = .FALSE.
 IBRION = 1
 EDIFFG = -0.001
 ISMEAR = 1
 LWAVE = .TRUE.
 SIGMA = 0.1
 NSW = 5

Al
 1.0000000000000000
     4.5000000000000000    0.0000000000000000    0.0000000000000000
     0.0000000000000000    4.5000000000000000    0.0000000000000000
     0.0000000000000000    0.0000000000000000    4.5000000000000000
   4
Cartesian
  0.0000000000000000  0.0000000000000000  0.0000000000000000
  0.0000000000000000  2.2500000000000000  2.2500000000000000
  2.2500000000000000  0.0000000000000000  2.2500000000000000
  2.2500000000000000  2.2500000000000000  0.0000000000000000
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">+BEGIN_SRC python</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Al-lda-vasp'</span>)
calc.view()
<span style="color: #0000FF;">print</span> [atoms.get_volume() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> calc.traj]
<span style="color: #0000FF;">print</span> [atoms.get_potential_energy() <span style="color: #0000FF;">for</span> atoms <span style="color: #0000FF;">in</span> calc.traj]
</pre>
</div>

<pre class="example">
[91.124999999999986, 78.034123525818302, 72.328582812881763, 73.422437849114189, 73.368474506164134]
[-9.58448747, -10.02992063, -10.07180132, -10.07429962, -10.07430725]
</pre>

<p>
Now, the ASE way.
TODO
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice <span style="color: #0000FF;">import</span> bulk
<span style="color: #0000FF;">from</span> ase.optimize <span style="color: #0000FF;">import</span> BFGS <span style="color: #0000FF;">as</span> QuasiNewton

<span style="color: #BA36A5;">Al</span> = bulk(<span style="color: #008000;">'Al'</span>, <span style="color: #008000;">'fcc'</span>, a=4.5, cubic=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Al-lda-ase'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'LDA'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=Al)

<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> StrainFilter
<span style="color: #BA36A5;">sf</span> = StrainFilter(Al)
<span style="color: #BA36A5;">qn</span> = QuasiNewton(sf, logfile=<span style="color: #008000;">'relaxation.log'</span>)
qn.run(fmax=0.1, steps=5)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Stress:\n'</span>, calc.stress)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Al post ASE volume relaxation\n'</span>, calc.get_atoms().get_cell())
<span style="color: #0000FF;">print</span>(calc)
</pre>
</div>

<p>
Now for a detailed comparison:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">atoms</span> = Vasp(<span style="color: #008000;">'bulk/Al-lda-vasp'</span>).get_atoms()

<span style="color: #BA36A5;">atoms2</span> = Vasp(<span style="color: #008000;">'bulk/Al-lda-ase'</span>).get_atoms()

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">cellA</span> = atoms.get_cell()
<span style="color: #BA36A5;">cellB</span> = atoms2.get_cell()

<span style="color: #0000FF;">print</span>((np.<span style="color: #006FE0;">abs</span>(cellA - cellB) &lt; 0.01).<span style="color: #006FE0;">all</span>())
</pre>
</div>

<pre class="example">
False
</pre>

<p>
This could be handy if you want to use any of the optimizers in <a href="ase.optimize">ase.optimize</a> in conjunction with <a href="ase.constraints">ase.constraints</a>, which are more advanced than what is in VASP.
</p>
</div>
</div>

<div id="outline-container-orgheadline86" class="outline-3">
<h3 id="orgheadline86"><span class="section-number-3">4.5</span> Cohesive energy</h3>
<div class="outline-text-3" id="text-4-5">
<p>
<a href="cohesive energy">cohesive energy</a>
The cohesive energy is defined as the energy to separate neutral atoms in their ground electronic state from the solid at 0K at 1 atm. We will compute this for rhodium. Rh is normally an fcc metal, so we will use that structure and let VASP find the equilibrium volume for us.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">bulk system</span>
<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Rh'</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/bulk-rh'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">bulk_energy</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atomic system</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Rh'</span>,[5, 5, 5])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(7, 8, 9))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/atomic-rh'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[1, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">atomic_energy</span> = atoms.get_potential_energy()

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> (bulk_energy, atomic_energy))

<span style="color: #BA36A5;">cohesive_energy</span> = atomic_energy - bulk_energy
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'The cohesive energy is {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(cohesive_energy)
</pre>
</div>

<pre class="example">
The cohesive energy is 6.184 eV
</pre>

<p>
According to Kittel <a class='org-ref-reference' href="#kittel">kittel</a>, the cohesive energy of Rh is 5.75 eV. There are a few reasons we may have discrepancy here:
</p>

<ol class="org-ol">
<li>The k-point grid used in the bulk state is not very dense. However, you can see below that the total energy is pretty converged by a \(6 \times 6 \times 6\) $k$-point grid.</li>
<li>We did not check for convergence with the planewave cutoff.</li>
<li>We neglected spin on the atomic state. Rh in the atomic state has this electronic structure:   [Kr] 4d8 5s1 and is a doublet.</li>
</ol>

<p>
First we consider the k-point convergence.
<a href="convergence!KPOINTS">convergence!KPOINTS</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/atomic-rh'</span>)
<span style="color: #BA36A5;">atomic_energy</span> = calc.potential_energy

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/bulk-rh'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">kpts</span> = [3, 4, 6, 9, 12, 15, 18]

<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'bulk/bulk-rh-kpts-{0}'</span>.<span style="color: #006FE0;">format</span>(k),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[k, k, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> kpts]

<span style="color: #BA36A5;">energies</span> = [calc.potential_energy <span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs]

calcs[0].stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">for</span> k, e <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(kpts, energies):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'({0:2d}, {0:2d}, {0:2d}):'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #008000;">' cohesive energy = {1} eV'</span>.<span style="color: #006FE0;">format</span>(k,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>e - atomic_energy))
</pre>
</div>

<pre class="example">
( 3,  3,  3): cohesive energy = -4.76129426 eV
( 4,  4,  4): cohesive energy = -6.17915613 eV
( 6,  6,  6): cohesive energy = -6.20654198 eV
( 9,  9,  9): cohesive energy = -6.20118094 eV
(12, 12, 12): cohesive energy = -6.20897225 eV
(15, 15, 15): cohesive energy = -6.2091123 eV
(18, 18, 18): cohesive energy = -6.21007962 eV
</pre>

<p>
Using only 1 k-point for the bulk energy is a terrible approximation! It takes at least a 6 &times; 6 &times; 6 grid to get the total energy converged to less than 10 meV. Note we do not need to check the k-point convergence of the atomic state because it is surrounded by vacuum on all sides, and so there should not be any dispersion in the bands.
</p>

<p>
We will examine the magnetic state next.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">bulk system</span>
<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>symbol=<span style="color: #008000;">'Rh'</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/bulk-rh'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">bulk_energy</span> = atoms.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atomic system</span>
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Rh'</span>,[5, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=(7, 8, 9))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/atomic-rh-sp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[1, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">atomic_energy</span> = atoms.get_potential_energy()

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [atomic_energy, bulk_energy])

<span style="color: #BA36A5;">cohesive_energy</span> = atomic_energy - bulk_energy
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'The cohesive energy is {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(cohesive_energy)
</pre>
</div>

<pre class="example">
The cohesive energy is 6.127 eV
</pre>

<p>
Again, the value in Kittel <a class='org-ref-reference' href="#kittel">kittel</a> is 5.75 eV which is very close to this value. Finally, it is also possible there is a lower energy non-spherical atom energy; we did not check that at all (see <a href="#orgheadline51">Estimating triplet oxygen dissociation energy with low symmetry</a>).
</p>
</div>
</div>

<div id="outline-container-orgheadline89" class="outline-3">
<h3 id="orgheadline89"><span class="section-number-3">4.6</span> Elastic properties</h3>
<div class="outline-text-3" id="text-4-6">
<p>
See this reference <a class='org-ref-reference' href="#PhysRevB.65.104104">PhysRevB.65.104104</a>.
</p>

<p>
We seek the elastic constant tensor that relates stress (&sigma;) and strain (&epsilon;) via \(\sigma = c \epsilon \). The stress and strain are six component vectors, so \(c\) will be a 6 &times; 6 symmetric matrix.
</p>
</div>

<div id="outline-container-orgheadline87" class="outline-4">
<h4 id="orgheadline87"><span class="section-number-4">4.6.1</span> Fe elastic properties</h4>
<div class="outline-text-4" id="text-4-6-1">
<p>
As with molecular vibrations, we need a groundstate geometry. Let us get one for BCC Fe.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> BodyCenteredCubic

<span style="color: #BA36A5;">atoms</span> = BodyCenteredCubic(symbol=<span style="color: #008000;">'Fe'</span>)
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atom.magmom</span> = 3.0

<span style="color: #0000FF;">from</span> vasp.vasprc <span style="color: #0000FF;">import</span> VASPRC
<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'mode'</span>] = <span style="color: #D0372D;">None</span>

<span style="color: #0000FF;">import</span> logging
<span style="color: #BA36A5;">log</span> = logging.getLogger(<span style="color: #008000;">'Vasp'</span>)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">log.setLevel(logging.DEBUG)</span>

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Fe-bulk'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=30,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
<span style="color: #0000FF;">print</span>(atoms.get_stress())
</pre>
</div>

<pre class="example">
-15.53472773
[ 0.00031141  0.00031141  0.00031141 -0.         -0.         -0.        ]
</pre>


<p>
Ok, now with a relaxed geometry at hand, we proceed with the elastic constants. This is accomplished with IBRION=6 and ISIF &gt; 3 in VASP. See this reference (from the VASP <a href="http://cms.mpi.univie.ac.at/vasp/vasp/IBRION_5_IBRION_6.html">page</a>) Y. Le Page and P. Saxe, Phys. Rev. B 65, 104104 (2002) <a href="http://dx.doi.org/10.1103/PhysRevB.65.104104">doi:10.1103/PhysRevB.65.104104</a> for more details.
</p>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Fe-bulk'</span>)
calc.clone(<span style="color: #008000;">'bulk/Fe-elastic'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=6,    <span style="color: #8D8D84;">#</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=3,      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">gets elastic constants</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.05,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">displacements</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2)

<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
-15.52764065
</pre>

<p>
Now, the results are written out to the OUTCAR file. Actually, three sets of moduli are written out 1) the elastic tensor for rigid ions, 2) the contribution from allowing the atoms to relax, and 3) the total elastic modulus, all in kBar.
</p>

<pre class="example">
  SYMMETRIZED ELASTIC MODULI (kBar)
 Direction    XX          YY          ZZ          XY          YZ          ZX
 --------------------------------------------------------------------------------
 XX        2803.5081   1622.6085   1622.6085      0.0000      0.0000      0.0000
 YY        1622.6085   2803.5081   1622.6085      0.0000      0.0000      0.0000
 ZZ        1622.6085   1622.6085   2803.5081      0.0000      0.0000      0.0000
 XY           0.0000      0.0000      0.0000    866.8792      0.0000      0.0000
 YZ           0.0000      0.0000      0.0000      0.0000    866.8792      0.0000
 ZX           0.0000      0.0000      0.0000      0.0000      0.0000    866.8792
 --------------------------------------------------------------------------------
</pre>

<p>
and
</p>

<pre class="example">
 ELASTIC MODULI CONTR FROM IONIC RELAXATION (kBar)
 Direction    XX          YY          ZZ          XY          YZ          ZX
 --------------------------------------------------------------------------------
 XX           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 YY           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 ZZ           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 XY           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 YZ           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 ZX           0.0000      0.0000      0.0000      0.0000      0.0000      0.0000
 --------------------------------------------------------------------------------


 TOTAL ELASTIC MODULI (kBar)
 Direction    XX          YY          ZZ          XY          YZ          ZX
 --------------------------------------------------------------------------------
 XX        2803.5081   1622.6085   1622.6085      0.0000      0.0000      0.0000
 YY        1622.6085   2803.5081   1622.6085      0.0000      0.0000      0.0000
 ZZ        1622.6085   1622.6085   2803.5081      0.0000      0.0000      0.0000
 XY           0.0000      0.0000      0.0000    866.8792      0.0000      0.0000
 YZ           0.0000      0.0000      0.0000      0.0000    866.8792      0.0000
 ZX           0.0000      0.0000      0.0000      0.0000      0.0000    866.8792
 --------------------------------------------------------------------------------
</pre>

<p>
Let us write a small code here to extract the Total elastic moduli from the OUTCAR file. First we get the line where the total elastic moduli start, then take the six lines that start three lines after that. Finally we parse out the matrix elements and cast them as floats.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">EM</span> = []

<span style="color: #0000FF;">with</span> <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'bulk/Fe-elastic/OUTCAR'</span>) <span style="color: #0000FF;">as</span> f:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">lines</span> = f.readlines()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> i, line <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(lines):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> line.startswith(<span style="color: #008000;">' TOTAL ELASTIC MODULI (kBar)'</span>):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = i + 3
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">data</span> = lines[j:j+6]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">break</span>

<span style="color: #0000FF;">for</span> line <span style="color: #0000FF;">in</span> data:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">EM</span> += [[<span style="color: #006FE0;">float</span>(x) <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> line.split()[1:]]]

<span style="color: #0000FF;">print</span> np.array(EM)
</pre>
</div>

<pre class="example">
[[ 1125.1405  3546.8135  3546.8135     0.         0.         0.    ]
 [ 3546.8135  1125.1405  3546.8135     0.         0.         0.    ]
 [ 3546.8135  3546.8135  1125.1405     0.         0.         0.    ]
 [    0.         0.         0.      1740.2372     0.         0.    ]
 [    0.         0.         0.         0.      1740.2372     0.    ]
 [    0.         0.         0.         0.         0.      1740.2372]]
</pre>


<p>
Fe is in a BCC crystal structure, which is high in symmetry. Consequently, many of the elements in the matrix are equal to zero.
</p>

<p>
see <a href="http://www.nist.gov/data/PDFfiles/jpcrd34.pdf">http://www.nist.gov/data/PDFfiles/jpcrd34.pdf</a> for a lot of detail about Fe-Ni alloys and general theory about elastic constants. In the next section, we show how the code above is integrated into <a href="Vasp">Vasp</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-4">
<h4 id="orgheadline88"><span class="section-number-4">4.6.2</span> <span class="todo TODO">TODO</span> Al elastic properties</h4>
<div class="outline-text-4" id="text-4-6-2">
<p>
First, the relaxed geometry.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(symbol=<span style="color: #008000;">'Al'</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Al-bulk'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   prec=<span style="color: #008000;">'High'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=30,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
-14.97511793
</pre>

<p>
Ok, now with a relaxed geometry at hand, we proceed with the elastic constants. This is accomplished with IBRION=6 and ISIF  3 in VASP.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Al-bulk'</span>)
calc.clone(<span style="color: #008000;">'bulk/Al-elastic'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=6,    <span style="color: #8D8D84;">#</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=3,      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">gets elastic constants</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.015,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">displacements</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2)

calc.wait(abort=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">EM</span> = calc.get_elastic_moduli()

<span style="color: #0000FF;">print</span>(EM)

<span style="color: #BA36A5;">c11</span> = EM[0, 0]
<span style="color: #BA36A5;">c12</span> = EM[0, 1]
<span style="color: #BA36A5;">B</span> = (c11 + 2 * c12) / 3.0
<span style="color: #0000FF;">print</span>(B)
</pre>
</div>

<pre class="example">
[[ 110.17099   59.54652   59.54652    0.         0.         0.     ]
 [  59.54652  110.17099   59.54652    0.         0.         0.     ]
 [  59.54652   59.54652  110.17099    0.         0.         0.     ]
 [   0.         0.         0.        11.52331    0.         0.     ]
 [   0.         0.         0.         0.        11.52331    0.     ]
 [   0.         0.         0.         0.         0.        11.52331]]
76.4213433333
</pre>


<p>
This example shows the basic mechanics of getting the elastic constants. The C<sub>44</sub> constant above is too low, and probably we need to check these constants for convergence with respect to kpoints, planewave cutoff, and maybe the value of POTIM.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline90" class="outline-3">
<h3 id="orgheadline90"><span class="section-number-3">4.7</span> Bulk thermodynamics</h3>
<div class="outline-text-3" id="text-4-7">
<p>
We can predict temperature dependent thermodynamic properties of bulk materials without too much effort. As with the thermochemical properties of ideal gases, we must use some simple models that we parameterize by DFT. Here we follow the example in Reference <a class='org-ref-reference' href="#Shang20101040">Shang20101040</a> for computing the thermal coefficient of expansion, heat capacity, enthalpy and entropy for Ni as a function of temperature.
</p>

<p>
We start by computing the equation of state for fcc Ni.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fcc</span>
<span style="color: #BA36A5;">LC</span> = [3.5, 3.55, 3.6, 3.65, 3.7, 3.75]
<span style="color: #BA36A5;">volumes</span>, <span style="color: #BA36A5;">energies</span> = [], []
<span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> LC:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Ni'</span>, (0, 0, 0), magmom=2.5)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]]))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Ni-{0}'</span>.<span style="color: #006FE0;">format</span>(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(calc.potential_energy)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   volumes.append(atoms.get_volume())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(LC, energies)
plt.xlabel(<span style="color: #008000;">'Lattice constant ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/Ni-fcc.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ni-fcc.png" alt="Ni-fcc.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-3">
<h3 id="orgheadline91"><span class="section-number-3">4.8</span> Effect of pressure on phase stability</h3>
<div class="outline-text-3" id="text-4-8">
<p>
So far we have only considered relative stability at a pressure of 0 Pa. We now consider the relative stability of two phases under pressure. We will consider TiO\(_2\) in the rutile and anatase phases.
</p>

<p>
The pressure is defined by: \(P = -\left(\frac{\partial E}{\partial V}\right)_T\). So if we have an equation of state \(E(V)\) we can calculate the pressure at any volume, or alternatively, given a pressure, compute the volume. Pressure can affect the energy of two phases differently, so that one may become stable under pressure. The condition where a phase transition occurs is when the pressure in the two phases is the same, which occurs at a common tangent.
</p>

<p>
To show this, we need \(E_{rutile}(V)\) and \(E_{anatase}(V)\).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">run the rutile calculations</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">B</span> = <span style="color: #008000;">'Ti'</span>; <span style="color: #BA36A5;">X</span> = <span style="color: #008000;">'O'</span>; <span style="color: #BA36A5;">a</span> = 4.59; <span style="color: #BA36A5;">c</span> = 2.958; <span style="color: #BA36A5;">u</span> = 0.305;
<span style="color: #008000;">'''</span>
<span style="color: #008000;">create a rutile structure from the lattice vectors at</span>
<span style="color: #008000;">http://cst-www.nrl.navy.mil/lattice/struk/c4.html</span>

<span style="color: #008000;">spacegroup: 136 P4_2/mnm</span>
<span style="color: #008000;">'''</span>
<span style="color: #BA36A5;">a1</span> = a * np.array([1.0, 0.0, 0.0])
<span style="color: #BA36A5;">a2</span> = a * np.array([0.0, 1.0, 0.0])
<span style="color: #BA36A5;">a3</span> = c * np.array([0.0, 0.0, 1.0])

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(B, [0., 0., 0.]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(B, 0.5*a1 + 0.5*a2 + 0.5*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X,  u*a1 + u*a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, -u*a1 - u*a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, (0.5+u)*a1 + (0.5-u)*a2 + 0.5*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, (0.5-u)*a1 + (0.5+u)*a2 + 0.5*a3)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[a1, a2, a3])

<span style="color: #BA36A5;">nTiO2</span> = <span style="color: #006FE0;">len</span>(atoms) / 3.
<span style="color: #BA36A5;">v0</span> = atoms.get_volume()
<span style="color: #BA36A5;">cell0</span> = atoms.get_cell()

<span style="color: #BA36A5;">volumes</span> = [28., 30., 32., 34., 36.]  <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">vol of one TiO2</span>

<span style="color: #0000FF;">for</span> v <span style="color: #0000FF;">in</span> volumes:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.set_cell(cell0 * ((nTiO2 * v / v0)**(1. / 3.)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/TiO2/rutile/rutile-{0}'</span>.<span style="color: #006FE0;">format</span>(v),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.001,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.update()
</pre>
</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">run the anatase calculations</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://cst-www.nrl.navy.mil/lattice/struk/c5.html</span>

<span style="color: #BA36A5;">B</span> = <span style="color: #008000;">'Ti'</span>; <span style="color: #BA36A5;">X</span> = <span style="color: #008000;">'O'</span>; <span style="color: #BA36A5;">a</span> = 3.7842; <span style="color: #BA36A5;">c</span> = 2*4.7573; <span style="color: #BA36A5;">z</span> = 0.0831;

<span style="color: #BA36A5;">a1</span> = a * np.array([1.0, 0.0, 0.0])
<span style="color: #BA36A5;">a2</span> = a * np.array([0.0, 1.0, 0.0])
<span style="color: #BA36A5;">a3</span> = np.array([0.5 * a, 0.5 * a, 0.5 * c])

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(B, -0.125 * a1 + 0.625 * a2 + 0.25 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(B,  0.125 * a1 + 0.375 * a2 + 0.75 * a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, -z*a1 + (0.25-z)*a2 + 2.*z*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, -(0.25+z)*a1 + (0.5-z)*a2 + (0.5+2*z)*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, z*a1 - (0.25 - z)*a2 + (1-2*z)*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(X, (0.25 + z)*a1 + (0.5 + z)*a2 + (0.5-2*z)*a3)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=[a1,a2,a3])

<span style="color: #BA36A5;">nTiO2</span> = <span style="color: #006FE0;">len</span>(atoms) / 3.
<span style="color: #BA36A5;">v0</span> = atoms.get_volume()
<span style="color: #BA36A5;">cell0</span> = atoms.get_cell()

<span style="color: #BA36A5;">volumes</span> = [30., 33., 35., 37., 39.]  <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">vol of one TiO2</span>

<span style="color: #0000FF;">for</span> v <span style="color: #0000FF;">in</span> volumes:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.set_cell(cell0 * ((nTiO2*v/v0)**(1./3.)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/TiO2/anatase/anatase-{0}'</span>.<span style="color: #006FE0;">format</span>(v),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.001,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=20,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.update()
</pre>
</div>

<p>
Now we will fit cubic polynomials to the data.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fit cubic polynomials to E(V) for rutile and anatase</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(precision=2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">anatase equation of state</span>
<span style="color: #BA36A5;">volumes</span> = [30., 33., 35., 37., 39.]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">vol of one TiO2 formula unit</span>
<span style="color: #BA36A5;">a_volumes</span>, <span style="color: #BA36A5;">a_energies</span> = [], []
<span style="color: #0000FF;">for</span> v <span style="color: #0000FF;">in</span> volumes:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/TiO2/anatase/anatase-{0}'</span>.<span style="color: #006FE0;">format</span>(v))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">nTiO2</span> = <span style="color: #006FE0;">len</span>(atoms) / 3.0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   a_volumes.append(atoms.get_volume() / nTiO2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   a_energies.append(atoms.get_potential_energy() / nTiO2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">rutile equation of state</span>
<span style="color: #BA36A5;">volumes</span> = [28., 30., 32., 34., 36.]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">vol of one TiO2</span>
<span style="color: #BA36A5;">r_volumes</span>, <span style="color: #BA36A5;">r_energies</span> = [], []
<span style="color: #0000FF;">for</span> v <span style="color: #0000FF;">in</span> volumes:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/TiO2/rutile/rutile-{0}'</span>.<span style="color: #006FE0;">format</span>(v))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">nTiO2</span> = <span style="color: #006FE0;">len</span>(atoms) / 3.0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   r_volumes.append(atoms.get_volume() / nTiO2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   r_energies.append(atoms.get_potential_energy() / nTiO2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cubic polynomial fit to equation of state E(V) = pars*[V^3 V^2 V^1 V^0]</span>
<span style="color: #BA36A5;">apars</span> = np.polyfit(a_volumes, a_energies, 3)
<span style="color: #BA36A5;">rpars</span> = np.polyfit(r_volumes, r_energies, 3)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'E_anatase(V) = {0:1.2f}*V^3 + {1:1.2f}*V^2 + {2:1.2f}*V + {3:1.2f}'</span>.<span style="color: #006FE0;">format</span>(*apars)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'E_rutile(V) =  {0:1.2f}*V^3 + {1:1.2f}*V^2 + {2:1.2f}*V + {3:1.2f}'</span>.<span style="color: #006FE0;">format</span>(*rpars)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'anatase epars: {0!r}'</span>.<span style="color: #006FE0;">format</span>(apars)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'rutile epars: {0!r}'</span>.<span style="color: #006FE0;">format</span>(rpars)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get pressure parameters P(V) = -dE/dV</span>
<span style="color: #BA36A5;">dapars</span> = -np.polyder(apars)
<span style="color: #BA36A5;">drpars</span> = -np.polyder(rpars)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'anatase ppars: {0!r}'</span>.<span style="color: #006FE0;">format</span>(dapars)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'rutile ppars: {0!r}'</span>.<span style="color: #006FE0;">format</span>(drpars)

<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'P_anatase(V) = {0:1.2f}*V^2 + {1:1.2f}*V + {2:1.2f}'</span>.<span style="color: #006FE0;">format</span>(*dapars)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'P_rutile(V) =  {0:1.2f}*V^2 + {1:1.2f}*V + {2:1.2f}'</span>.<span style="color: #006FE0;">format</span>(*drpars)

<span style="color: #BA36A5;">vfit</span> = np.linspace(28, 40)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the equations of state</span>
plt.plot(a_volumes, a_energies,<span style="color: #008000;">'bo '</span>, label=<span style="color: #008000;">'Anatase'</span>)
plt.plot(vfit, np.polyval(apars, vfit), <span style="color: #008000;">'b-'</span>)

plt.plot(r_volumes, r_energies,<span style="color: #008000;">'gs '</span>, label=<span style="color: #008000;">'Rutile'</span>)
plt.plot(vfit, np.polyval(rpars, vfit), <span style="color: #008000;">'g-'</span>)

plt.xlabel(<span style="color: #008000;">'Volume ($\AA^3$/f.u.)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV/f.u.)'</span>)
plt.legend()
plt.xlim([25, 40])
plt.ylim([-27, -26])
plt.savefig(<span style="color: #008000;">'imag</span>
</pre>
</div>


<div class="figure">
<p><img src="./images/rutile-anatase-eos.png" alt="rutile-anatase-eos.png" />
</p>
<p><span class="figure-number">Figure 48:</span> Equations of state (E(V)) for anatase and rutile TiO\(_2\).</p>
</div>

<p>
To find the conditions where a phase transition occurs, we have to find the common tangent line between the rutile and anatase phases. In other words we have to solve these two equations:
</p>

<p>
\((E_{anatase}(V1) - E_{rutile}(V2))/(V1-V2) = P_{anatase}(V1)\)
</p>

<p>
\((E_{anatase}(V1) - E_{rutile}(V2))/(V1-V2) = P_{rutile}(V2)\)
</p>

<p>
This is a nonlinear algebra problem. We use the <a href="scipy.optimize.fsolve">scipy.optimize.fsolve</a> to solve this problem.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> GPa
<span style="color: #0000FF;">from</span> numpy <span style="color: #0000FF;">import</span> array, linspace, polyval

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">copied from polynomial fit above</span>
<span style="color: #BA36A5;">anatase_epars</span> = array([-1.06049246e-03,   1.30279404e-01,  -5.23520055e+00,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>4.25202869e+01])
<span style="color: #BA36A5;">rutile_epars</span> = array([-1.24680208e-03,   1.42966536e-01,  -5.33239733e+00,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>3.85903670e+01])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">polynomial fits for pressures</span>
<span style="color: #BA36A5;">anatase_ppars</span> = array([3.18147737e-03,  -2.60558808e-01,   5.23520055e+00])
<span style="color: #BA36A5;">rutile_ppars</span> = array([3.74040625e-03,  -2.85933071e-01,   5.33239733e+00])


<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(V):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V1</span> = V[0] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">rutile volume</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V2</span> = V[1] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">anatase volume</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_rutile</span> = polyval(rutile_epars, V1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E_anatase</span> = polyval(anatase_epars, V2)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P_rutile</span> =  polyval(rutile_ppars, V1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P_anatase</span> = polyval(anatase_ppars, V2)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> [(E_anatase - E_rutile) / (V1 - V2) - P_anatase,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (E_anatase - E_rutile) / (V1 - V2) - P_rutile]

<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fsolve
<span style="color: #BA36A5;">x0</span> = fsolve(func, [28, 34])
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'The solutions are at V = {0}'</span>.<span style="color: #006FE0;">format</span>(x0)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Anatase pressure: {0} GPa'</span>.<span style="color: #006FE0;">format</span>(polyval(anatase_ppars, x0[1]) / GPa)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Rutile  pressure: {0} GPa'</span>.<span style="color: #006FE0;">format</span>(polyval(rutile_ppars, x0[0]) / GPa)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">illustrate the common tangent</span>
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">vfit</span> = linspace(28, 40)
plt.plot(vfit, polyval(anatase_epars,vfit), label=<span style="color: #008000;">'anatase'</span>)
plt.plot(vfit, polyval(rutile_epars,vfit), label=<span style="color: #008000;">'rutile'</span>)
plt.plot(x0, [polyval(rutile_epars,x0[0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> polyval(anatase_epars,x0[1])], <span style="color: #008000;">'ko-'</span>, label=<span style="color: #008000;">'common tangent'</span>)
plt.legend()
plt.xlabel(<span style="color: #008000;">'Volume ($\AA^3$/f.u.)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV/f.u.)'</span>)
plt.savefig(<span style="color: #008000;">'images/eos-common-tangent.png'</span>)
</pre>
</div>

<pre class="example">
The solutions are at V = [ 31.67490656  34.60893508]
Anatase pressure: 4.5249494236 GPa
Rutile  pressure: 4.52494942374 GPa
</pre>

<p>
At a pressure of 4.5 GPa, we expect that anatase will start converting into rutile. Along this common tangent, a mixture of the two phases will be more stable than either pure phase.
</p>


<div class="figure">
<p><img src="./images/eos-common-tangent.png" alt="eos-common-tangent.png" />
</p>
<p><span class="figure-number">Figure 49:</span> Illustration of the common tangent that shows the pressure where anatase and rutile coexist before anatase converts to rutile. \label{fig:tio2-cotangent}</p>
</div>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> add literature discussion</b><br  />
<p>
there is some controversy about the most stable phase. add discussion here.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline99" class="outline-3">
<h3 id="orgheadline99"><a id="ID-15961dbc-5a10-42b6-8a3c-ca1d73b390f9"></a><span class="section-number-3">4.9</span> Bulk reaction energies</h3>
<div class="outline-text-3" id="text-4-9">
</div>
<div id="outline-container-orgheadline93" class="outline-4">
<h4 id="orgheadline93"><span class="section-number-4">4.9.1</span> Alloy formation energies</h4>
<div class="outline-text-4" id="text-4-9-1">
<p>
In this section we will consider how to calculate the formation energy of an fcc Cu-Pd alloy and how to use that information to discuss relative stabilities. The kinds of questions we can easily answer are:
</p>

<ol class="org-ol">
<li>Is the formation of an alloy at a particular composition and structure energetically favorable?</li>
<li>Given two alloy structures at the same composition, which one is more stable?</li>
<li>Given a set of alloy structures at different compositions, which ones are stable with respect to phase separation?</li>
</ol>

<p>
Each of these questions is answered by calculating the formation energy of the alloy from the parent metals. Thus, we will need the total energies of fcc Cu and fcc Pd. To get started. We get those first. Rather than compute a full equation of state for these, we will rely on the built in unit cell optimization algorithm in VASP (ISIF=3).
</p>
</div>

<div id="outline-container-orgheadline92" class="outline-5">
<h5 id="orgheadline92"><span class="section-number-5">4.9.1.1</span> Basic alloy formation energy</h5>
<div class="outline-text-5" id="text-4-9-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get bulk Cu and Pd energies. &lt;&lt;pure-metal-components&gt;&gt;</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Vasp.log.setLevel(10)</span>
Vasp.vasprc(mode=<span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      0.000,      0.000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=  [[ 1.818,  0.000,  1.818],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [ 1.818,  1.818,  0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [ 0.000,  1.818,  1.818]])

<span style="color: #BA36A5;">cuc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[13, 13, 13],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nbands=9,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms)

<span style="color: #BA36A5;">cu</span> = cuc.potential_energy

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>,  [0.000,      0.000,      0.000])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[ 1.978,  0.000,  1.978],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [ 1.978,  1.978,  0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.000,  1.978,  1.978]])

<span style="color: #BA36A5;">pd</span> = Vasp(<span style="color: #008000;">'bulk/alloy/pd'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[13, 13, 13],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nbands=9,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms).potential_energy

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Cu energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(cu)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Pd energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(pd)
</pre>
</div>

<pre class="example">
{'vasp.executable.serial': '/home-research/zhongnanxu/opt/vasp-5.3.5/bin/vasp-vtst-beef-serial', 'queue.options': '-joe', 'queue.command': 'qsub', 'handle_exceptions': True, 'validate': True, 'queue.nodes': '1', 'multiprocessing.cores_per_process': 'None', 'restart_unconverged': True, 'vasp.executable.parallel': '/home-research/zhongnanxu/opt/vasp-5.3.5/bin/vasp-vtst-beef-parallel', 'vdw_kernel.bindat': '/opt/kitchingroup/vasp-5.3.5/vdw_kernel.bindat', 'queue.ppn': '1', 'user.email': 'jkitchin@andrew.cmu.edu', 'mode': None, 'queue.jobname': 'None', 'queue.mem': '2GB', 'queue.walltime': '23:00:00', 'user.name': 'jkitchin'}
</pre>


<p>
Note that the Pd energy is more negative than the Cu energy. This does not mean anything significant. We cannot say Pd is more stable than Cu; it is not like Cu could transmutate into Pd!
</p>

<p>
Next, we will consider a question like which of two structures with composition of CuPd is more stable. These coordinates for these structures came from research of the author. The approach is pretty general, you must identify the coordinates and unit cell of the candidate structure, and then run a calculation to find the optimized geometry and unit cell. This may take some work, as previously described in the multistep process for optimizing a bulk system. Here the geometry is pretty close to optimized, so we can use the VASP optimization routines. We consider two structures with composition CuPd.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      0.000,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-1.652,     0.000,      2.039])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=  [[0.000, -2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0.000,  2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [-3.303,  0.000,  0.000]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[12, 12, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=17,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">cupd1</span> = atoms.get_potential_energy()

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [-0.049,     0.049,      0.049]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [-11.170,   11.170,     11.170]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-7.415,     7.415,      7.415]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-3.804 ,    3.804,      3.804])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=[[-5.629,  3.701,  5.629 ],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [-3.701,  5.629,  5.629 ],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [-5.629,  5.629,  3.701 ]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=34,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">cupd2</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'cupd-1 = {0} eV'</span>.<span style="color: #006FE0;">format</span>(cupd1)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'cupd-2 = {0} eV'</span>.<span style="color: #006FE0;">format</span>(cupd2)
</pre>
</div>

<pre class="example">
cupd-1 = -9.17794311 eV
cupd-2 = -18.07698067 eV
</pre>


<p>
Looking at these energies, you could be tempted to say cupd-2 is more stable than cupd-1 because its energy is much lower. This is wrong, however, because cupd-2 has twice as many atoms as cupd-1. We should compare the normalized total energies, that is the energy normalized per CuPd formula unit, or as an alternative  the number of atoms in the unit cell. It does not matter which, as long as we normalize consistently. It is conventional in alloy calculation to normalize by the number of atoms in the unit cell.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-1'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e1</span> = atoms.get_potential_energy()/<span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-2'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e2</span> = atoms.get_potential_energy()/<span style="color: #006FE0;">len</span>(atoms)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'cupd-1: {0} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e1)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'cupd-2: {0} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e2)
</pre>
</div>

<p>
After normalizing by number of atoms, we can see that cupd-1 is a more stable structure. However, we are looking at total energies, and we might ask: is cupd-1 more stable than an unreacted mixture of the parent compounds, fcc Cu and Pd? In other words, is the following reaction exothermic:
</p>

<p>
Cu + Pd \(\rightarrow\) CuPd for the two configurations we examined? Below, we show some pretty general code that computes these formation energies, and normalizes them by the number of atoms in the unit cell.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">bulk energy 1</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">cu</span> = atoms.get_potential_energy()/<span style="color: #006FE0;">len</span>(atoms)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">bulk energy 2</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/pd'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">pd</span> = atoms.get_potential_energy()/<span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-1'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e1</span> = atoms.get_potential_energy()
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">subtract bulk energies off of each atom in cell</span>
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'Cu'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> -= cu
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e1</span> -= pd

<span style="color: #BA36A5;">e1</span> /= <span style="color: #006FE0;">len</span>(atoms)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">normalize by number of atoms in cell</span>

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cupd-2'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e2</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'Cu'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> -= cu
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e2</span> -= pd
<span style="color: #BA36A5;">e2</span> /= <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Delta Hf cupd-1 = {0:1.2f} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e1)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Delta Hf cupd-2 = {0:1.2f} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e2)
</pre>
</div>

<p>
The answer is yes. Both structures are energetically more favorable than an equal composition mixture of the parent metals. The heat of formation for both structures is exothermic, but the cupd-1 structure is more stable than the cupd-2 structure. This is shown conceptually in Figure <a href="#fig:alloy1">fig:alloy1</a>.
</p>


<div class="figure">
<p><img src="./images/alloy-stability.png" alt="alloy-stability.png" />
</p>
<p><span class="figure-number">Figure 50:</span> Conceptual picture of two alloys with exothermic formation energies. The dashed line represents a composition weighted average energy of the parent metals. E4 and E3 are energies associated with two different alloy structures at the same composition. Both structures are more stable than a mixture of pure metals with the same composition, but E3 is more stable than E4. <div id="fig:alloy1"></p>
</div>

<p>
We will now examine another structure at another composition and its stability.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parent metals</span>

<span style="color: #BA36A5;">atoms</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>).get_atoms()
<span style="color: #BA36A5;">cu</span> = atoms.get_potential_energy() / <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">atoms</span> = Vasp(<span style="color: #008000;">'bulk/alloy/pd'</span>).get_atoms()
<span style="color: #BA36A5;">pd</span> = atoms.get_potential_energy() / <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [-3.672,     3.672,      3.672]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,     0.000,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [-10.821,   10.821,     10.821]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-7.246,     7.246,      7.246])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=[[-5.464,  3.565,  5.464],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[-3.565,  5.464,  5.464],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[-5.464,  5.464,  3.565]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu3pd-1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=34,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">e3</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'Cu'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e3</span> -= cu
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e3</span> -= pd
<span style="color: #BA36A5;">e3</span> /= <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Delta Hf cu3pd-1 = {0:1.2f} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e3)
</pre>
</div>

<p>
The formation energy is slightly exothermic, which means the structure is more stable than a mixture of the parent metals. However, let us consider whether the structure is stable with respect to phase separation into pure Cu and the cupd-1 structure. We define the following quantities:
</p>

<p>
\(H_{f,Cu}\) = 0.0 eV/atom,    \(x_0\) = 0,
\(H_{f,cupd-1}\) = -0.12 eV/atom,   \(x_3\) = 0.5.
</p>

<p>
The composition weighted average at \(x_{Pd}=0.25\) is:
</p>

<p>
\(H_f = H_{f,Cu} + \frac{x0-x}{x0-x3}(H_{f,cupd-1} - H_{f,Cu})\)
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">x0</span> = 0.0; <span style="color: #BA36A5;">x3</span> = 0.5; <span style="color: #BA36A5;">x</span> = 0.25;
<span style="color: #BA36A5;">Hf1</span> = 0.0; <span style="color: #BA36A5;">Hf3</span> = -0.12;

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Composition weighted average  = {0} eV'</span>.<span style="color: #006FE0;">format</span>(Hf1 +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> (x0 - x)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> / (x0 - x3)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> * (Hf3 - Hf1))
</pre>
</div>

<pre class="example">
Composition weighted average  = -0.06 eV
</pre>

<p>
We find the weighted composition formation energy of pure Cu and cupd-1 is more favorable than the formation energy of cu3pd-1. Therefore, we could expect that structure to phase separate into a mixture of pure Cu and cupd-1. Schematically what we are seeing is shown in Figure \ref:fig:alloy-phase-separation.
</p>


<div class="figure">
<p><img src="./images/alloy-phase-stability.png" alt="alloy-phase-stability.png" />
</p>
<p><span class="figure-number">Figure 51:</span> Illustration of of an alloy structure with an exothermic formation energy that is not stable with respect to phase separation. The solid line shows the composition weighted average energy of a mixture of Cu and cupd-2. Since the energy of cu3pd-1 is above the solid line, it is less favorable than a mixture of Cu and cupd-2 with the same composition. \label{fig:alloy-phase-separation}</p>
</div>

<p>
Finally, let us consider one more structure with the Cu<sub>3</sub>Pd stoichiometry.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">parent metals</span>
<span style="color: #BA36A5;">cu</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>).potential_energy / <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">pd</span> = Vasp(<span style="color: #008000;">'bulk/alloy/pd'</span>).potential_energy / <span style="color: #006FE0;">len</span>(atoms)

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [-1.867,     1.867,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      0.000,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      1.867,      1.867]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-1.867,     0.000,      1.86])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=[[-3.735,  0.000,  0.000],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0.000,  0.000,  3.735],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0.000,  3.735,  0.000]])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu3pd-2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=34,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">e4</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'Cu'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e4</span> -= cu
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e4</span> -= pd
<span style="color: #BA36A5;">e4</span> /= <span style="color: #006FE0;">len</span>(atoms)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Delta Hf cu3pd-2 = {0:1.2f} eV/atom'</span>.<span style="color: #006FE0;">format</span>(e4))
</pre>
</div>

<p>
This looks promising: the formation energy is much more favorable than cu3pd-1, and it is below the composition weighted formation energy of -0.06 eV/atom. Consequently, we conclude that this structure will not phase separate into a mixture of Cu and CuPd. We cannot say, however, if there is a more stable phase not yet considered, or if it might phase separate into two other phases. We also note here that we have ignored a few other contributions to alloy stability. We have only considered the electronic energy contributions to the formation energy. At temperatures above absolute zero there are additional contributions including configurational and vibrational entropy, which may stabilize some structures more than others. Finally, our analysis is limited to comparisons of the structures computed on the fcc lattice. In fact, it is known that the CuPd alloy forms a bcc structure. We did not calculate that structure, so we can not say if it is more or less stable than the obvious fcc structure we found.
</p>


<div class="figure">
<p><img src="./images/alloy-phase-stability-2.png" alt="alloy-phase-stability-2.png" />
</p>
<p><span class="figure-number">Figure 52:</span> Illustration that cu3pd-2 is more stable than cu3pd-1 and that is it is more stable than a composition weighted mixture of Cu and cupd-1. The dotted line shows the energy of a composition weighted average energy of a mixture of Cu and cupd-1. Since cu3pd-2 is below the dotted line, it is more stable than the phase-separated mixture. \label{fig:alloy-phase-separation-2}</p>
</div>

<p>
The construction of alloy phase diagrams is difficult. You are always faced with the possibility that there is a phase that you have not calculated that is more stable than the ones you did calculate. One approach is to use a tool that automates the discovery of relevant structures such as the Alloy Theoretic Automated Toolkit (<a href="http://www.its.caltech.edu/~avdw/atat/">ATAT</a>) <a class='org-ref-reference' href="#vandeWalle2002539">vandeWalle2002539</a>,<a class='org-ref-reference' href="#vandeWalle2009266">vandeWalle2009266</a> which uses a cluster expansion methodology.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline98" class="outline-4">
<h4 id="orgheadline98"><span class="section-number-4">4.9.2</span> Metal oxide oxidation energies</h4>
<div class="outline-text-4" id="text-4-9-2">
<p>
We will consider here the reaction 2 Cu<sub>2</sub>O + O<sub>2</sub> \(\rightleftharpoons\) 4 CuO. The reaction energy is:
</p>

<p>
\(\Delta E = 4E_{CuO} - 2E_{Cu_2O} - E_{O_2}\). We need to compute the energy of each species.
</p>
</div>

<div id="outline-container-orgheadline94" class="outline-5">
<h5 id="orgheadline94"><span class="section-number-5">4.9.2.1</span> Cu<sub>2</sub>O calculation</h5>
<div class="outline-text-5" id="text-4-9-2-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">run Cu2O calculation</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://phycomp.technion.ac.il/~ira/types.html#Cu2O</span>
<span style="color: #BA36A5;">a</span> = 4.27

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>, [0.5, 0.5, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>, [0.5, 0.0, 0.5]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>, [0.0, 0.5, 0.5]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [0.25, 0.25, 0.25]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [0.75, 0.75, 0.75])])

atoms.set_cell((a, a, a), scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu2O'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=30,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span> atoms.get_potential_energy()
<span style="color: #0000FF;">print</span> atoms.get_stress()
</pre>
</div>

<pre class="example">
-27.27469393
[ 0.00271993  0.00271993  0.00271993 -0.         -0.         -0.        ]
</pre>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-5">
<h5 id="orgheadline95"><span class="section-number-5">4.9.2.2</span> CuO calculation</h5>
<div class="outline-text-5" id="text-4-9-2-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">run CuO calculation</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">CuO</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://cst-www.nrl.navy.mil/lattice/struk/b26.html</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://www.springermaterials.com/docs/info/10681727_51.html</span>
<span style="color: #BA36A5;">a</span> = 4.6837
<span style="color: #BA36A5;">b</span> = 3.4226
<span style="color: #BA36A5;">c</span> = 5.1288
<span style="color: #BA36A5;">beta</span> = 99.54/180*np.pi
<span style="color: #BA36A5;">y</span> = 0.5819

<span style="color: #BA36A5;">a1</span> = np.array([0.5*a, -0.5*b, 0.0])
<span style="color: #BA36A5;">a2</span> = np.array([0.5*a, 0.5*b, 0.0])
<span style="color: #BA36A5;">a3</span> = np.array([c*np.cos(beta), 0.0, c*np.sin(beta)])

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>, 0.5*a2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>, 0.5*a1 + 0.5*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, -y*a1 + y*a2 + 0.25*a3),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>,  y*a1 - y*a2 - 0.25*a3)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(a1, a2, a3))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuO'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=400,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=30,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
</pre>
</div>

<pre class="example">
-19.62493655
</pre>
</div>
</div>

<div id="outline-container-orgheadline97" class="outline-5">
<h5 id="orgheadline97"><span class="section-number-5">4.9.2.3</span> <span class="todo TODO">TODO</span> Reaction energy calculation</h5>
<div class="outline-text-5" id="text-4-9-2-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">don't forget to normalize your total energy to a formula unit. Cu2O</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">has 3 atoms, so the number of formula units in an atoms is</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">len(atoms)/3.</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu2O'</span>)
<span style="color: #BA36A5;">atoms1</span> = calc.get_atoms()
<span style="color: #BA36A5;">cu2o_energy</span> = atoms1.get_potential_energy()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuO'</span>)
<span style="color: #BA36A5;">atoms2</span> = calc.get_atoms()
<span style="color: #BA36A5;">cuo_energy</span> = atoms2.get_potential_energy()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure to use the same cutoff energy for the O2 molecule!</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-400'</span>)
<span style="color: #BA36A5;">atoms3</span> = calc.get_atoms()
<span style="color: #BA36A5;">o2_energy</span> = atoms3.get_potential_energy()

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [cu2o_energy, cuo_energy, o2_energy])

<span style="color: #BA36A5;">cu2o_energy</span> /= (<span style="color: #006FE0;">len</span>(atoms1) / 3)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note integer math</span>
<span style="color: #BA36A5;">cuo_energy</span> /= (<span style="color: #006FE0;">len</span>(atoms2) / 2)
<span style="color: #BA36A5;">rxn_energy</span> = 4.0 * cuo_energy - o2_energy - 2.0 * cu2o_energy
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Reaction energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(rxn_energy)
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book/bulk/Cu2O Queued: 1392189.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/bulk/CuO Queued: 1392190.gilgamesh.cheme.cmu.edu
</pre>

<p>
This is the reaction energy for 2 Cu<sub>2</sub>O \(\rightarrow\) 4 CuO. In <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a>, the experimental reaction is estimated to be  about -3.14 eV.
</p>

<p>
There are a few reasons why our number does not agree with the experimental reaction energy. One reason is related to errors in the O<sub>2</sub> dissociation energy, and another reason is related to localization of electrons in the Cu 3\(d\) orbitals <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a>. The first error of incorrect O<sub>2</sub> dissociation error is a systematic error that can be corrected empirically <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a>. Fixing the second error requires the application of DFT+U (see <a href="#orgheadline96">DFT+U</a>).
</p>

<p>
The heat of reaction is reported to be 1000 J/g product at <a href="http://onlinelibrary.wiley.com/doi/10.1002/er.4440130107/pdf">http://onlinelibrary.wiley.com/doi/10.1002/er.4440130107/pdf</a> for the reaction 2CuO \(\rightleftharpoons\) Cu<sub>2</sub>O + 1/2 O<sub>2</sub>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms
<span style="color: #BA36A5;">atoms</span> = Atoms(<span style="color: #008000;">'Cu2O'</span>)
<span style="color: #BA36A5;">MW</span> = atoms.get_masses().<span style="color: #006FE0;">sum</span>()

<span style="color: #BA36A5;">H</span> = 1.  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">kJ/g</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'rxn energy = {0:1.1f} eV'</span>.<span style="color: #006FE0;">format</span>(-2 * H * MW / 96.4)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">convert to eV</span>
</pre>
</div>

<pre class="example">
rxn energy = -3.0 eV
</pre>

<p>
This is pretty close to the value in <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a> and might need a temperature correction to get agreement at 298K.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline100" class="outline-3">
<h3 id="orgheadline100"><a id="ID-cdf40b4f-f686-48b4-a458-c885f62b8bbf"></a><span class="section-number-3">4.10</span> Bulk density of states</h3>
<div class="outline-text-3" id="text-4-10">
<p>
The density of states refers to the number of electronic states in a particular energy range.
</p>

<p>
The solution to Eq. \eqref{eq:KS} yields a set of Kohn-Sham (K-S) orbitals and an
associated set of eigenvalues that correspond to the energies of these
orbitals, neither of which have any known directly observable meaning
<a class='org-ref-reference' href="#RevModPhys.71.1253">RevModPhys.71.1253</a>.  The sum of the squared K-S orbitals,
however, is equal to the electron density (Eq. \eqref{eq:density}),
and the sum of the eigenvalues is a significant part of the total
energy (Eq.  \eqref{eq:dftEnergy}). Thus, it seems reasonable to
suppose these quantities have other significant relationships to
physical observables. Perdew et al. showed that the highest occupied
eigenvalue is equal to the ionization energy of a system within an
exact density functional theory <a class='org-ref-reference' href="#perdew1982:elect-kohn-sham">perdew1982:elect-kohn-sham</a>, but
their interpretation has been vigorously debated in the literature
<a class='org-ref-reference' href="#kleinman1997:signif-kohn-sham">kleinman1997:signif-kohn-sham</a>,<a class='org-ref-reference' href="#perdew1997">perdew1997</a>,<a class='org-ref-reference' href="#kleinman1997:reply-commen-kohn-sham">kleinman1997:reply-commen-kohn-sham</a>,
and is only true for the exact exchange/correlation functional, not
the approximate ones used in practice <a class='org-ref-reference' href="#koch2001">koch2001</a>.
Stowasser and Hoffmann discussed an approach to using the K-S orbitals
in more traditional molecular orbital interpretations, but the results
were primarily qualitative <a class='org-ref-reference' href="#stowasser1999:what-kohn-sham">stowasser1999:what-kohn-sham</a>. More
recently, a DFT analog of Koopmans' theorem has been developed that
formally identifies the eigenvalues with vertical ionization
potentials, which can be measured with photoelectron spectroscopy
<a class='org-ref-reference' href="#gritsenko2002">gritsenko2002</a>.
</p>

<p>
Despite the arguments against ascribing physical meaning to the K-S
orbitals and eigenvalues, it has become fairly standard, especially
for solids, to use them to calculate the density of states (DOS)
<a class='org-ref-reference' href="#jones1989">jones1989</a> [Sec.  VI.  B].  This has been found to yield
reasonable results for the valence bands in metals, but poor results
for tightly bound orbitals and band gaps
<a class='org-ref-reference' href="#perdew1982:elect-kohn-sham">perdew1982:elect-kohn-sham</a>. A highly technical discussion of
this issue can be found in Ref. <a class='org-ref-reference' href="#perdew1981:self">perdew1981:self</a>.  The
density of states can be calculated by a sum over the k-points
<a class='org-ref-reference' href="#seitsonen2000:phd">seitsonen2000:phd</a>:
</p>

\begin{equation}\label{eq:dos}
\Rho(\epsilon)=\sum_\mathbf{\mathrm{k}} \omega_\mathbf{\mathrm{k}} \sum_i \beta(\epsilon -\epsilon_{i\mathbf{\mathrm{k}}})
\end{equation}

<p>
where \(\omega_\mathbf{\mathrm{k}}\) is the weight associated with the
k-point, and \(\beta\) is a broadening function, typically a gaussian
function, to account for the finite number of k-points used in the
calculations. The amount of broadening is arbitrary, and should tend
to zero as the number of k-points approaches infinity.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">npoints</span> = 200
<span style="color: #BA36A5;">width</span> = 0.5

<span style="color: #0000FF;">def</span> <span style="color: #006699;">gaussian</span>(energies, eik):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span> = ((energies - eik) / width)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> np.exp(-x**2) / np.sqrt(np.pi) / width

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-dos'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">kpt weights</span>
<span style="color: #BA36A5;">wk</span> = calc.get_k_point_weights()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">for each k-point there are a series of eigenvalues</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">here we get all the eigenvalues for each k-point</span>
<span style="color: #BA36A5;">e_kn</span> = []
<span style="color: #0000FF;">for</span> i, k <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(wk):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   e_kn.append(calc.get_eigenvalues(kpt=i))

<span style="color: #BA36A5;">e_kn</span> = np.array(e_kn) - calc.get_fermi_level()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">these are the energies we want to evaluate the dos at</span>
<span style="color: #BA36A5;">energies</span> = np.linspace(e_kn.<span style="color: #006FE0;">min</span>(), e_kn.<span style="color: #006FE0;">max</span>(), npoints)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is where we build up the dos</span>
<span style="color: #BA36A5;">dos</span> = np.zeros(npoints)

<span style="color: #0000FF;">for</span> j <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(npoints):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(wk)): <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">loop over all kpoints</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(e_kn[k])): <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">loop over eigenvalues in each k</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span>[j] += wk[k] * gaussian(energies[j], e_kn[k][i])

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(energies, dos)
plt.savefig(<span style="color: #008000;">'images/manual-dos.png'</span>)
plt.show()
</pre>
</div>


<div class="figure">
<p><img src="./images/manual-dos.png" alt="manual-dos.png" />
</p>
<p><span class="figure-number">Figure 53:</span> Density of states.</p>
</div>


<p>
Here is a more convenient way to compute the DOS using <a href="ase.dft">ase.dft</a>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.dft <span style="color: #0000FF;">import</span> DOS

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-dos'</span>)
<span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #BA36A5;">d</span> = dos.get_dos()
<span style="color: #BA36A5;">e</span> = dos.get_energies()

<span style="color: #0000FF;">import</span> pylab <span style="color: #0000FF;">as</span> plt
plt.plot(e, d)
plt.xlabel(<span style="color: #008000;">'energy (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.savefig(<span style="color: #008000;">'images/pd-dos.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/pd-dos.png" alt="pd-dos.png" />
</p>
<p><span class="figure-number">Figure 54:</span> Total DOS for bulk Pd.</p>
</div>

<p>
This DOS looks roughly like you would expect. The peak between -5 to 0 eV is the Pd d-band.
</p>

<p>
The VASP manual <a href="http://cms.mpi.univie.ac.at/vasp/guide/node124.html#SECTION000933000000000000000">recommends</a> a final run be made with ISMEAR=-5, which uses the tetrahedron method with Bl\"ochl corrections.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.dft <span style="color: #0000FF;">import</span> DOS
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-dos'</span>)
calc.clone(<span style="color: #008000;">'bulk/pd-dos-ismear-5'</span>)


<span style="color: #BA36A5;">bulk</span> = calc.get_atoms()
calc.<span style="color: #006FE0;">set</span>(ismear=-5)

bulk.get_potential_energy()
<span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #BA36A5;">d</span> = dos.get_dos()
<span style="color: #BA36A5;">e</span> = dos.get_energies()

<span style="color: #0000FF;">import</span> pylab <span style="color: #0000FF;">as</span> plt
plt.plot(e, d)
plt.xlabel(<span style="color: #008000;">'energy [eV]'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.savefig(<span style="color: #008000;">'images/pd-dos-ismear-5.png'</span>)
</pre>
</div>

<p>
This not notably different to me.
</p>


<div class="figure">
<p><img src="./images/pd-dos-ismear-5.png" alt="pd-dos-ismear-5.png" />
</p>
<p><span class="figure-number">Figure 55:</span> Total DOS for Pd computed with ISMEAR=-5</p>
</div>

<p>
We can test for convergence of the DOS. The k-points are most important.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
Vasp.vasprc(mode=<span style="color: #D0372D;">None</span>)
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">Vasp.log.setLevel(10)</span>

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> ase.dft <span style="color: #0000FF;">import</span> DOS
<span style="color: #0000FF;">import</span> pylab <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">a</span> = 3.9  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">approximate lattice constant</span>
<span style="color: #BA36A5;">b</span> = a / 2.
<span style="color: #BA36A5;">bulk</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>, (0.0, 0.0, 0.0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cell=[(0, b, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, 0, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, b, 0)])

<span style="color: #BA36A5;">kpts</span> = [8, 10, 12, 14, 16, 18, 20]

<span style="color: #BA36A5;">calcs</span> = [Vasp(<span style="color: #008000;">'bulk/pd-dos-k{0}-ismear-5'</span>.<span style="color: #006FE0;">format</span>(k),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[k, k, k],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=bulk) <span style="color: #0000FF;">for</span> k <span style="color: #0000FF;">in</span> kpts]

Vasp.wait(abort=<span style="color: #D0372D;">True</span>)

<span style="color: #0000FF;">for</span> calc <span style="color: #0000FF;">in</span> calcs:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this runs the calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d</span> = dos.get_dos() + k / 4.0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = dos.get_energies()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(e, d, label=<span style="color: #008000;">'k={0}'</span>.<span style="color: #006FE0;">format</span>(k))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">pass</span>
plt.xlabel(<span style="color: #008000;">'energy (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.legend()
plt.savefig(<span style="color: #008000;">'images/pd-dos-k-convergence-ismear-5.png'</span>)
plt.show()
</pre>
</div>

<pre class="example">
got here
&lt;ase.dft.dos.DOS instance at 0xec2d710&gt;
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.dft <span style="color: #0000FF;">import</span> DOS
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">This seems very slow...</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-dos-k20-ismear-5'</span>)
<span style="color: #0000FF;">print</span> DOS(calc, width=0.2)
</pre>
</div>

<pre class="example">
&lt;ase.dft.dos.DOS instance at 0x168a1ea8&gt;
</pre>


<div class="figure">
<p><img src="./images/pd-dos-k-convergence-ismear-5.png" alt="pd-dos-k-convergence-ismear-5.png" />
</p>
<p><span class="figure-number">Figure 56:</span> Convergence of the total DOS with k-points</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline102" class="outline-3">
<h3 id="orgheadline102"><span class="section-number-3">4.11</span> Atom projected density of states</h3>
<div class="outline-text-3" id="text-4-11">
<p>
One major disadvantage of a planewave basis set is that it is difficult to relate the completely delocalized planewaves to localized phenomena such as bonding. Much insight into bonding has been gained by atomic/molecular orbital theory, which has carried over to the solid-state arena <a class='org-ref-reference' href="#RevModPhys.60.601">RevModPhys.60.601</a>. Consequently, several schemes have been developed to project the one-electron Kohn-Sham wave functions onto atomic wave functions <a class='org-ref-reference' href="#sanchez-portal1995:projec">sanchez-portal1995:projec</a>,<a class='org-ref-reference' href="#segall1996:popul">segall1996:popul</a>,<a class='org-ref-reference' href="#segall1996:popul-mp">segall1996:popul-mp</a>.  In VASP, the one electron wave functions can be projected onto spherical harmonic orbitals. The radial component of the atomic orbitals extends to infinity. In a solid, this means that the projection on one atom may overlap with the projection on a neighboring atom, resulting in double counting of electrons.  Consequently, a cutoff radius was introduced, beyond which no contributions are included.  It is not obvious what the best cutoff radius is. If the radius is too small, it might not capture all of the electrons associated with the atom. However, if it is too large, it may include electrons from neighboring atoms.  One might want to use different cutoff radii for different atoms, which have different sizes.  Furthermore, the ideal cutoff radius for an atom may change in different environments, thus it would require an iterative procedure to determine it.  This difficulty arises because the orbital-band occupations are not observable, thus how the electrons are divided up between atoms is arbitrary and, as will be seen later, is sensitive to the cutoff radius (and in other DFT implementations, the basis set).  However, Mulliken orbital populations have been used successfully for many years to examine the qualitative differences between similar systems, and that is precisely what these quantities are used for here.  Thus, a discussion of the analysis and results is warranted.
</p>

<p>
The s and p states in a metal are typically delocalized in space and more like free-electrons, whereas the d-orbitals are fairly localized in space and have been treated successfully with tight-binding theories such as extended H\"u ckel theory <a class='org-ref-reference' href="#RevModPhys.60.601">RevModPhys.60.601</a>, and linear muffin tin orbital theory <a class='org-ref-reference' href="#ruban1997:surfac">ruban1997:surfac</a>.  Consequently, the remaining discussion will be focused on the properties of the projected d-states.
</p>

<p>
In this example, we consider how to get the atom-projected density of states (ADOS). We are interested in properties of the $d$-band on Pd, such as the $d$-band center and $d$-band width. You must set the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/RWIGS>RWIGS</a> tag to get ADOS, and these are the Wigner-Seitz radii for each atom.  By integrating the projected d-band up to the Fermi level, the d-band filling can be determined.  It is not obvious what the electron count in the d-band should be for an atom in a metal.  For a gas-phase, neutral metal atom in the ground state, however, the d-orbital electron count is well defined, so it will be used as an initial reference point for comparison <a class='org-ref-reference' href="#kittel">kittel</a>.
</p>

<p>
A powerful method for characterizing distributions is to examine various moments of the distribution (see Chapter 4 in Ref.  <a class='org-ref-reference' href="#cottrell1988">cottrell1988</a> and Chapter 6 in Refs. <a class='org-ref-reference' href="#ducastelle1991">ducastelle1991</a> and <a class='org-ref-reference' href="#pettifor1992:elect-theor-alloy-desig">pettifor1992:elect-theor-alloy-desig</a>). The \(n^{th}\) order moment, \(\mu_n\), of a distribution of states \(\rho(\epsilon)\) with respect to a reference \(\epsilon_o\) is defined by
</p>
\begin{equation}
\mu_n = \frac{\int_{-\infty}^\infty \epsilon^n \rho(\epsilon-\epsilon_o)d\epsilon}
{\int_{-\infty}^\infty \rho(\epsilon-\epsilon_o)d\epsilon}
\end{equation}
<p>
In this work, the reference energy is always the Fermi level.  The zeroth moment is just the total number of states, in this case it will be normalized to unity. The first moment is the average energy of distribution, analogous to the center of mass for a mass density distribution. The second moment is the mean squared width of the distribution. The third moment is a measure of skewness and the fourth moment is related to kurtosis, but these moments are rarely used, and only the first and second moments are considered in this work.
</p>

<p>
It is important to note that these projected density of states are not physical observables. They are the wavefunctions projected onto atomic orbitals. For some situations this makes sense, e.g. the \(d\) orbitals are fairly localized and reasonably approximated by atomic orbitals. The \(s\) valence orbitals in a metal, in contrast, are almost totally delocalized. Depending on the cutoff radius (RWIGS) you choose, you can see very different ADOS.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">a</span> = 3.9  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">approximate lattice constant</span>
<span style="color: #BA36A5;">b</span> = a / 2.
<span style="color: #BA36A5;">bulk</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>, (0.0, 0.0, 0.0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cell=[(0, b, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, 0, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, b, 0)])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-ados'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lreal=<span style="color: #D0372D;">False</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   rwigs={<span style="color: #008000;">'Pd'</span>: 1.5},  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">wigner-seitz radii for ados</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 8],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=bulk)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this runs the calculation</span>
calc.wait(abort=<span style="color: #D0372D;">True</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now get results</span>
<span style="color: #BA36A5;">energies</span>, <span style="color: #BA36A5;">ados</span> = calc.get_ados(0, <span style="color: #008000;">'d'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we will select energies in the range of -10, 5</span>
<span style="color: #BA36A5;">ind</span> = (energies &lt; 5) &amp; (energies &gt; -10)

<span style="color: #BA36A5;">energies</span> = energies[ind]
<span style="color: #BA36A5;">dos</span> = ados[ind]

<span style="color: #BA36A5;">Nstates</span> = np.trapz(dos, energies)
<span style="color: #BA36A5;">occupied</span> = energies &lt;= 0.0
<span style="color: #BA36A5;">N_occupied_states</span> = np.trapz(dos[occupied], energies[occupied])
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">first moment</span>
<span style="color: #BA36A5;">ed</span> = np.trapz(energies * dos, energies) / Nstates

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">second moment</span>
<span style="color: #BA36A5;">wd2</span> = np.trapz(energies**2 * dos, energies) / Nstates

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Total # states = {0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(Nstates)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'number of occupied states = {0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(N_occupied_states)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'d-band center = {0:1.2f} eV'</span>.<span style="color: #006FE0;">format</span>(ed)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'d-band width  = {0:1.2f} eV'</span>.<span style="color: #006FE0;">format</span>(np.sqrt(wd2))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the d-band</span>
plt.plot(energies, dos, label=<span style="color: #008000;">'$d$-orbitals'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the occupied states in shaded gray</span>
plt.fill_between(x=energies[occupied],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>y1=dos[occupied],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>y2=np.zeros(dos[occupied].shape),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>color=<span style="color: #008000;">'gray'</span>, alpha=0.25)

plt.xlabel(<span style="color: #008000;">'$E - E_f$ (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'DOS (arbitrary units)'</span>)

plt.savefig(<span style="color: #008000;">'images/pd-ados.png'</span>)
</pre>
</div>

<pre class="example">
Total # states = 9.29
number of occupied states = 7.95
d-band center = -1.98 eV
d-band width  = 2.71 eV
</pre>



<div class="figure">
<p><img src="./images/pd-ados.png" alt="pd-ados.png" />
</p>
<p><span class="figure-number">Figure 57:</span> Atom projected $d$-band for bulk Pd. The shaded area corresponds to the occupied states below the Fermi level.</p>
</div>
</div>

<div id="outline-container-orgheadline101" class="outline-4">
<h4 id="orgheadline101"><span class="section-number-4">4.11.1</span> Effect of RWIGS on ADOS</h4>
<div class="outline-text-4" id="text-4-11-1">
<p>
Here we examine the effect of changing RWIGS on the number of counted electrons, and properties of the d-band moments.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">a</span> = 3.9  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">approximate lattice constant</span>
<span style="color: #BA36A5;">b</span> = a / 2.
<span style="color: #BA36A5;">bulk</span> = Atoms([Atom(<span style="color: #008000;">'Pd'</span>, (0.0, 0.0, 0.0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cell=[(0, b, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, 0, b),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  (b, b, 0)])

<span style="color: #BA36A5;">RWIGS</span> = [1.0, 1.1, 1.25, 1.5, 2.0, 2.5, 3.0, 4.0, 5.0 ]

<span style="color: #BA36A5;">ED</span>, <span style="color: #BA36A5;">WD</span>, <span style="color: #BA36A5;">N</span> = [], [], []

<span style="color: #0000FF;">for</span> rwigs <span style="color: #0000FF;">in</span> RWIGS:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/pd-ados'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.clone(<span style="color: #008000;">'bulk/pd-ados-rwigs-{0}'</span>.<span style="color: #006FE0;">format</span>(rwigs))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.<span style="color: #006FE0;">set</span>(rwigs={<span style="color: #008000;">'Pd'</span>: rwigs})
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">continue</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now get results</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ados</span> = VaspDos(efermi=calc.get_fermi_level())

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">energies</span> = ados.energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span> = ados.site_dos(0, <span style="color: #008000;">'d'</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we will select energies in the range of -10, 5</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ind</span> = (energies &lt; 5) &amp; (energies &gt; -10)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">energies</span> = energies[ind]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span> = dos[ind]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">Nstates</span> = np.trapz(dos, energies)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">occupied</span> = energies &lt;= 0.0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">N_occupied_states</span> = np.trapz(dos[occupied], energies[occupied])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ed</span> = np.trapz(energies * dos, energies) / np.trapz(dos, energies)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">wd2</span> = np.trapz(energies**2 * dos, energies) / np.trapz(dos, energies)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   N.append(N_occupied_states)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ED.append(ed)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   WD.append(wd2**0.5)

plt.plot(RWIGS, N, <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'N. occupied states'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.xlabel(<span style="color: #008000;">'RWIGS ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'# occupied states'</span>)
plt.savefig(<span style="color: #008000;">'images/ados-rwigs-occupation.png'</span>)


<span style="color: #BA36A5;">fig</span>, <span style="color: #BA36A5;">ax1</span> = plt.subplots()
ax1.plot(RWIGS, ED, <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'d-band center (eV)'</span>)
ax1.set_xlabel(<span style="color: #008000;">'RWIGS ($\AA$)'</span>)
ax1.set_ylabel(<span style="color: #008000;">'d-band center (eV)'</span>, color=<span style="color: #008000;">'b'</span>)
<span style="color: #0000FF;">for</span> tl <span style="color: #0000FF;">in</span> ax1.get_yticklabels():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   tl.set_color(<span style="color: #008000;">'b'</span>)

<span style="color: #BA36A5;">ax2</span> = ax1.twinx()
ax2.plot(RWIGS, WD, <span style="color: #008000;">'gs'</span>, label=<span style="color: #008000;">'d-band width (eV)'</span>)
ax2.set_ylabel(<span style="color: #008000;">'d-band width (eV)'</span>, color=<span style="color: #008000;">'g'</span>)
<span style="color: #0000FF;">for</span> tl <span style="color: #0000FF;">in</span> ax2.get_yticklabels():
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   tl.set_color(<span style="color: #008000;">'g'</span>)

plt.savefig(<span style="color: #008000;">'images/ados-rwigs-moments.png'</span>)
plt.show()
</pre>
</div>


<div class="figure">
<p><img src="./images/ados-rwigs-occupation.png" alt="ados-rwigs-occupation.png" />
</p>
<p><span class="figure-number">Figure 58:</span> Effect of the RWIGS on the number of occupied \(d\)-states.</p>
</div>

<p>
You can see the number of occupied states increases approximately linearly here with RWIGS. This is due to overcounting of neighboring electrons.
</p>

<p>
<img src="./images/ados-rwigs-moments.png" alt="ados-rwigs-moments.png" />q
</p>

<p>
The d-band center and width also change.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline104" class="outline-3">
<h3 id="orgheadline104"><span class="section-number-3">4.12</span> Band structures</h3>
<div class="outline-text-3" id="text-4-12">
<p>
<a href="band structure">band structure</a>
To compute a band structure we do two things. First, we compute the self-consistent band structure. Then we compute the band structure at the desired $k$-points. We will use Si as an example (adapted from <a href="http://bbs.sciencenet.cn/bbs/upload/20083418325986.pdf">http://bbs.sciencenet.cn/bbs/upload/20083418325986.pdf</a>).
</p>

<p>
First, we get the self-consistent electron density in a calculation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view

<span style="color: #BA36A5;">a</span> = 5.38936
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Si'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Si'</span>, [0.25, 0.25, 0.25])])

atoms.set_cell([[a / 2., a / 2., 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.0,  a / 2., a / 2.],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [a / 2., 0.0, a / 2.]], scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Si-selfconsistent'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   prec=<span style="color: #008000;">'Medium'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lwave=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.run()
</pre>
</div>

<p>
Now, we run a new calculation along the k-point path desired. The standard VASP way of doing this is to modify the INCAR and KPOINTS file and rerun VASP. We will not do that. Doing that results in some lost information if you overwrite the old files. We will copy the old directory to a new directory, using code to ensure this only happens one time.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">wd</span> = <span style="color: #008000;">'bulk/Si-bandstructure'</span>

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Si-selfconsistent'</span>)
calc.clone(wd)

<span style="color: #BA36A5;">kpts</span> = [[0.5, 0.5, 0.0],   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">L</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0, 0, 0],         <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Gamma</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.5, 0.5, 0.5]]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">X</span>

calc.<span style="color: #006FE0;">set</span>(kpts=kpts,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>reciprocal=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts_nintersections=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>icharg=11)

<span style="color: #0000FF;">print</span> calc.run()
</pre>
</div>

<pre class="example">
-3.62224484
</pre>


<p>
We will learn how to manually parse the EIGENVAL file here to generate the band structure. The structure of the EIGENVAL file looks like this:
</p>

<div class="org-src-container">

<pre class="src src-sh">head -n 20 bulk/Si-bandstructure/EIGENVAL
</pre>
</div>

<pre class="example">
    2    2    1    1
  0.1956688E+02  0.3810853E-09  0.3810853E-09  0.3810853E-09  0.5000000E-15
  1.000000000000000E-004
  CAR
 unknown system
      8     20      8

  0.5000000E+00  0.5000000E+00  0.0000000E+00  0.5000000E-01
    1       -1.826747
    2       -1.826743
    3        3.153321
    4        3.153347
    5        6.743989
    6        6.744017
    7       16.392596
    8       16.393943

  0.4444444E+00  0.4444444E+00  0.0000000E+00  0.5000000E-01
    1       -2.669487
    2       -0.918463
</pre>

<p>
We can ignore the first five lines.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">f</span> = <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'bulk/Si-bandstructure/EIGENVAL'</span>, <span style="color: #008000;">'r'</span>)

<span style="color: #BA36A5;">line1</span> = f.readline()
<span style="color: #BA36A5;">line2</span> = f.readline()
<span style="color: #BA36A5;">line3</span> = f.readline()
<span style="color: #BA36A5;">line4</span> = f.readline()
<span style="color: #BA36A5;">comment</span> = f.readline()
<span style="color: #BA36A5;">unknown</span>, <span style="color: #BA36A5;">nkpoints</span>, <span style="color: #BA36A5;">nbands</span> = [<span style="color: #006FE0;">int</span>(x) <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> f.readline().split()]

<span style="color: #BA36A5;">blankline</span> = f.readline()

<span style="color: #BA36A5;">band_energies</span> = [[] <span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nbands)]

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nkpoints):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">weight</span> = [<span style="color: #006FE0;">float</span>(x) <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> f.readline().split()]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> j <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nbands):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">fields</span> = f.readline().split()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">id</span>, <span style="color: #BA36A5;">energy</span> = <span style="color: #006FE0;">int</span>(fields[0]), <span style="color: #006FE0;">float</span>(fields[1])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   band_energies[<span style="color: #006FE0;">id</span> - 1].append(energy)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">blankline</span> = f.readline()
f.close()

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nbands):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   plt.plot(<span style="color: #006FE0;">range</span>(nkpoints), band_energies[i])

<span style="color: #BA36A5;">ax</span> = plt.gca()
ax.set_xticks([]) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">no tick marks</span>
plt.xlabel(<span style="color: #008000;">'k-vector'</span>)
plt.ylabel(<span style="color: #008000;">'Energy (eV)'</span>)
ax.set_xticks([0, 10, 19])
ax.set_xticklabels([<span style="color: #008000;">'$L$'</span>, <span style="color: #008000;">'$\Gamma$'</span>, <span style="color: #008000;">'$X$'</span>])
plt.savefig(<span style="color: #008000;">'images/Si-bandstructure.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Si-bandstructure.png" alt="Si-bandstructure.png" />
</p>
<p><span class="figure-number">Figure 59:</span> Calculated band-structure for Si.</p>
</div>


<p>
Next we will examine the connection between band structures and density of states. In this example, we will compute the band structure of TiO<sub>2</sub> using a function built into <a href="vasp">vasp</a> to do the analysis described above.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/tio2/step3'</span>)
<span style="color: #0000FF;">print</span> calc.get_fermi_level()
calc.abort()
<span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">bands</span>, <span style="color: #BA36A5;">p</span> = calc.get_bandstructure(kpts_path=[(<span style="color: #008000;">'$\Gamma$'</span>, [0.0, 0.0, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'X'</span>, [0.5, 0.5, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'X'</span>, [0.5, 0.5, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'M'</span>, [0.0, 0.5, 0.5]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'M'</span>, [0.0, 0.5, 0.5]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$\Gamma$'</span>, [0.0, 0.0, 0.0])])

p.savefig(<span style="color: #008000;">'images/tio2-bandstructure-dos.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/tio2-bandstructure-dos.png" alt="tio2-bandstructure-dos.png" />
</p>
<p><span class="figure-number">Figure 60:</span> Band structure and total density of states for TiO<sub>2</sub>.</p>
</div>
</div>

<div id="outline-container-orgheadline103" class="outline-4">
<h4 id="orgheadline103"><span class="section-number-4">4.12.1</span> create example showing band dispersion with change in lattice constant</h4>
<div class="outline-text-4" id="text-4-12-1">
<p>
In this section, we examine the effect of the lattice constant on the band structure. Since the lattice constant affects the overlap of neighboring atoms, we expect that smaller lattice constants will show more dispersion, i.e. broader bands. Larger lattice constants, in contrast, should show narrower bands. We examine this in silicon.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">calcs</span> = []
<span style="color: #0000FF;">for</span> i, a <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>([4.7, 5.38936, 6.0]):

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Si'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Si'</span>, [0.25, 0.25, 0.25])])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms.set_cell([[a/2., a/2., 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [0.0,  a/2., a/2.],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   [a/2., 0.0, a/2.]], scale_atoms=<span style="color: #D0372D;">True</span>)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Si-bs-{0}'</span>.<span style="color: #006FE0;">format</span>(i),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lwave=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(calc.run())
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calcs</span> += [calc]


Vasp.wait(abort=<span style="color: #D0372D;">True</span>)

<span style="color: #0000FF;">for</span> i, calc <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(calcs):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">bands</span>, <span style="color: #BA36A5;">p</span>  = calc.get_bandstructure(kpts_path=[(<span style="color: #008000;">'L'</span>, [0.5,0.5,0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>(<span style="color: #008000;">'$\Gamma$'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>(<span style="color: #008000;">'$\Gamma$'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>(<span style="color: #008000;">'X'</span>, [0.5, 0.5, 0.5])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts_nintersections=10)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> p <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">png</span> = <span style="color: #008000;">'images/Si-bs-{0}.png'</span>.<span style="color: #006FE0;">format</span>(i)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   p.savefig(png)
</pre>
</div>

<pre class="example">
-7.55662509
-10.80024435
-10.13735105
</pre>



<div class="figure">
<p><img src="./images/Si-bs-0.png" alt="Si-bs-0.png" />
</p>
<p><span class="figure-number">Figure 61:</span> Si band structure for a=4.7</p>
</div>


<div class="figure">
<p><img src="./images/Si-bs-1.png" alt="Si-bs-1.png" />
</p>
<p><span class="figure-number">Figure 62:</span> Si band structure for a=5.38936</p>
</div>


<div class="figure">
<p><img src="./images/Si-bs-2.png" alt="Si-bs-2.png" />
</p>
<p><span class="figure-number">Figure 63:</span> Si band structure for a=6.0</p>
</div>

<p>
You can see the band structure for a=6.0 is notably sharper than the band structure for a=4.0.
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline108" class="outline-3">
<h3 id="orgheadline108"><a id="ID-9aba409a-1d3b-4bbb-96df-6cd58a787991"></a><span class="section-number-3">4.13</span> Magnetism</h3>
<div class="outline-text-3" id="text-4-13">
</div>
<div id="outline-container-orgheadline105" class="outline-4">
<h4 id="orgheadline105"><span class="section-number-4">4.13.1</span> Determining if a magnetic solution is energetically favorable</h4>
<div class="outline-text-4" id="text-4-13-1">
<p>
We can force a total magnetic moment onto a unit cell and compute the total energy as function of the total magnetic moment. If there is a minimum in the energy, then we know there is a lower energy magnetic solution than a non-magnetic solution. We use <a href=http://cms.mpi.univie.ac.at/wiki/index.php/NUPDOWN>NUPDOWN</a> to enforce the magnetic moment in the cell. Note that NUPDOWN can only be an integer. You cannot set it to be an arbitrary float.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> BodyCenteredCubic

<span style="color: #BA36A5;">atoms</span> = BodyCenteredCubic(directions=[[1, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 1, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 0, 1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Fe'</span>)


<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Fe-bcc-fixedmagmom-{0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(0.0),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nupdown=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
</pre>
</div>

<pre class="example">
-15.34226703
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> BodyCenteredCubic

<span style="color: #BA36A5;">atoms</span> = BodyCenteredCubic(directions=[[1, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 1, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 0, 1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Fe'</span>)

<span style="color: #BA36A5;">NUPDOWNS</span> = [0.0, 2.0, 4.0, 5.0, 6.0, 8.0]
<span style="color: #BA36A5;">energies</span> = []
<span style="color: #0000FF;">for</span> B <span style="color: #0000FF;">in</span> NUPDOWNS:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Fe-bcc-fixedmagmom-{0:1.2f}'</span>.<span style="color: #006FE0;">format</span>(B),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nupdown=B,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(atoms.get_potential_energy())

<span style="color: #0000FF;">if</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.abort()

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(NUPDOWNS, energies)
plt.xlabel(<span style="color: #008000;">'Total Magnetic Moment'</span>)
plt.ylabel(<span style="color: #008000;">'Energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/Fe-fixedmagmom.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Fe-fixedmagmom.png" alt="Fe-fixedmagmom.png" />
</p>
<p><span class="figure-number">Figure 64:</span> Total energy vs. total magnetic moment for bcc Fe.</p>
</div>

<p>
You can see here there is a minimum in energy at a total magnetic moment somewhere between 4 and 5. There are two Fe atoms in the unit cell, which means the magnetic moment on each atom must be about 2.5 Bohr-magnetons. This is a good guess for a real calculation. Note that VASP <a href="http://cms.mpi.univie.ac.at/vasp/guide/node100.html#SECTION00099000000000000000">recommends</a> you overestimate the magnetic moment guesses if you are looking for ferromagnetic solutions.
</p>

<p>
To run a spin-polarized calculation with initial guesses on each atom, we must set the magnetic moment on the atoms. Here we set it through the <code>magmom</code> attribute on the atom. In the example after this, we set it in the <code>Atoms</code> object.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> BodyCenteredCubic

<span style="color: #BA36A5;">atoms</span> = BodyCenteredCubic(directions=[[1, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 1, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0, 0, 1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Fe'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">set magnetic moments on each atom</span>
<span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atom.magmom</span> = 2.5

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Fe-bcc-sp-1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lorbit=11, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you need this for individual magnetic moments</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #BA36A5;">B</span> = atoms.get_magnetic_moment()
<span style="color: #BA36A5;">magmoms</span> = atoms.get_magnetic_moments()

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Total magnetic moment is {0:1.2f} Bohr-magnetons'</span>.<span style="color: #006FE0;">format</span>(B)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Individual moments are {0} Bohr-magnetons'</span>.<span style="color: #006FE0;">format</span>(magmoms)
</pre>
</div>

<pre class="example">
Total magnetic moment is -0.01 Bohr-magnetons
Individual moments are [-0.013 -0.013] Bohr-magnetons
</pre>
</div>
</div>

<div id="outline-container-orgheadline106" class="outline-4">
<h4 id="orgheadline106"><span class="section-number-4">4.13.2</span> Antiferromagnetic spin states</h4>
<div class="outline-text-4" id="text-4-13-2">
<p>
In an antiferromagnetic material, there are equal numbers of spin up and down electrons that align in a regular pattern, but pointing in opposite directions so that there is no net magnetism. It is possible to model this by setting the magnetic moments on each <a href="ase.Atom">ase.Atom</a> object. <a href=http://cms.mpi.univie.ac.at/wiki/index.php/lreal>lreal</a>
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Fe'</span>, [0.00,  0.00,  0.00], magmom=5),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Fe'</span>, [4.3,   4.3,   4.3],  magmom=-5),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [2.15,  2.15,  2.15], magmom=0),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'O'</span>, [6.45,  6.45,  6.45], magmom=0)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=[[4.3,    2.15,    2.15],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[2.15,    4.3,     2.15],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[2.15,    2.15,    4.3]])

<span style="color: #BA36A5;">ca</span> = Vasp(<span style="color: #008000;">'bulk/afm-feo'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> prec=<span style="color: #008000;">'Normal'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nupdown=0, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this forces a non-magnetic solution</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> lorbit=11, <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">to get individual moments</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> lreal=<span style="color: #D0372D;">False</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Magnetic moments = '</span>, atoms.get_magnetic_moments()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Total magnetic moment = '</span>, atoms.get_magnetic_moment()
</pre>
</div>

<pre class="example">
Magnetic moments =  [-0.061 -0.061  0.063  0.063]
Total magnetic moment =  -5e-06
</pre>

<p>
You can see that even though the total magnetic moment is 0, there is a spin on both Fe atoms, and they are pointing in opposite directions. Hence, the sum of spins is zero, and this arrangement is called anti-ferromagnetic.
</p>
</div>
</div>

<div id="outline-container-orgheadline107" class="outline-4">
<h4 id="orgheadline107"><span class="section-number-4">4.13.3</span> <span class="todo TODO">TODO</span> NiO-FeO formation energies with magnetism</h4>
</div>
</div>
<div id="outline-container-orgheadline109" class="outline-3">
<h3 id="orgheadline109"><span class="section-number-3">4.14</span> <span class="todo TODO">TODO</span> phonons</h3>
<div class="outline-text-3" id="text-4-14">
<p>
<a class='org-ref-reference' href="#RevModPhys.73.515">RevModPhys.73.515</a>
</p>

<p>
phonopy
</p>
</div>
</div>
<div id="outline-container-orgheadline110" class="outline-3">
<h3 id="orgheadline110"><span class="section-number-3">4.15</span> <span class="todo TODO">TODO</span> solid state NEB</h3>
<div class="outline-text-3" id="text-4-15">
<p>
<a class='org-ref-reference' href="#Caspersen10052005">Caspersen10052005</a> Carter paper
<a class='org-ref-reference' href="#sheppard:074103">sheppard:074103</a> recent Henkelman paper
</p>

<p>
<a href="http://scitation.aip.org/content/aip/journal/jcp/137/10/10.1063/1.4752249">http://scitation.aip.org/content/aip/journal/jcp/137/10/10.1063/1.4752249</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline161" class="outline-2">
<h2 id="orgheadline161"><a id="ID-af4a3f54-6572-49ac-b938-e62401bc35b9"></a><span class="section-number-2">5</span> Surfaces</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgheadline114" class="outline-3">
<h3 id="orgheadline114"><span class="section-number-3">5.1</span> Surface structures</h3>
<div class="outline-text-3" id="text-5-1">
<p>
As with molecules and bulk systems <a href="ase">ase</a> provides several convenience functions for making surfaces.
</p>
</div>
<div id="outline-container-orgheadline112" class="outline-4">
<h4 id="orgheadline112"><span class="section-number-4">5.1.1</span> Simple surfaces</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
ase provides many <a href="https://wiki.fysik.dtu.dk/ase/ase/surface.html#module-ase.lattice.surface">utility functions</a> to setup surfaces. Here is a simple example of an fcc111 Al surface. There are built in functions for fcc111, bcc110, bcc111, hcp001 and diamond111.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(2, 2, 3), vacuum=10.0)
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt;= 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> slab])
slab.set_constraint(constraint)

view(slab)
write(<span style="color: #008000;">'images/Al-slab.png'</span>, slab, rotation=<span style="color: #008000;">'90x'</span>, show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/Al-slab.png" alt="Al-slab.png" />
</p>
<p><span class="figure-number">Figure 65:</span> An Al(111) slab with three layers and 20 &Aring; of vacuum.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline113" class="outline-4">
<h4 id="orgheadline113"><span class="section-number-4">5.1.2</span> Vicinal surfaces</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
The vast majority of surface calculations are performed on flat surfaces. This is partially because these surfaces tend to have the lowest surface energies, and thus are likely to be experimentally observed. The flat surfaces, also known as low Miller index surfaces, also have small unit cells, which tends to make them computationally affordable. There are, however, many reasons to model the properties of surfaces that are not flat. You may be interested in the reactivity of a step edge, for example, or you may use the lower cooridnation of steps as a proxy for nanoparticle reactivity.  Many stepped surfaces are not that difficult to make now. The main idea in generating them is described <a href="https://wiki.fysik.dtu.dk/ase/_downloads/general_surface.pdf">here</a>. <a href="ase">ase</a> provides a general function for making vicinal surfaces. Here is an example of a (211) surface.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> surface
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Au(211) with 9 layers</span>
<span style="color: #BA36A5;">s1</span> = surface(<span style="color: #008000;">'Au'</span>, (2, 1, 1), 9)
s1.center(vacuum=10, axis=2)

write(<span style="color: #008000;">'images/Au-211.png'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> s1.repeat((3, 3, 1)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> rotation=<span style="color: #008000;">'-30z,90x'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">change the orientation for viewing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/Au-211.png" alt="Au-211.png" />
</p>
<p><span class="figure-number">Figure 66:</span> An Au(211) surface constructed with <code>ase</code>.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline115" class="outline-3">
<h3 id="orgheadline115"><span class="section-number-3">5.2</span> Surface calculation parameters</h3>
<div class="outline-text-3" id="text-5-2">
<p>
There is one important parameter that is different for surfaces than for bulk calculations, the k-point grid. Assuming you have followed the convention that the z-axis is normal to the surface, the k-point grids for slab calculations always have the form of \(M \times N \times 1\). To illustrate why, consider this example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(1, 1, 4), vacuum=10.0)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-bandstructure'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you need the charge density</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lwave=<span style="color: #D0372D;">True</span>,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">and wavecar for the restart</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=slab)

<span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">bands</span>, <span style="color: #BA36A5;">p</span> = calc.get_bandstructure(kpts_path=[(r<span style="color: #008000;">'$\Gamma$'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$K1$'</span>, [0.5, 0.0, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$K1$'</span>, [0.5, 0.0, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$K2$'</span>, [0.5, 0.5, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$K2$'</span>, [0.5, 0.5, 0.0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (r<span style="color: #008000;">'$\Gamma$'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (r<span style="color: #008000;">'$\Gamma$'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (<span style="color: #008000;">'$K3$'</span>, [0.0, 0.0, 1.0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts_nintersections=10)

p.savefig(<span style="color: #008000;">'images/Al-slab-bandstructure.png'</span>)
</pre>
</div>

<pre class="example">
done
</pre>



<div class="figure">
<p><img src="./images/Al-slab-bandstructure.png" alt="Al-slab-bandstructure.png" />
</p>
<p><span class="figure-number">Figure 67:</span> Band structure of an Al slab in the plane (path from Gamma to K1 to K2 to Gamma) and normal to the surface (Gamma to K3). Note the bands are flat in the direction normal to the surface, hence only one k-point is needed in this direction.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline116" class="outline-3">
<h3 id="orgheadline116"><a id="ID-10d1486b-97d1-48a4-83dd-d71097668d18"></a><span class="section-number-3">5.3</span> Surface relaxation</h3>
<div class="outline-text-3" id="text-5-3">
<p>
When a surface is created, the bulk symmetry is broken and consequently there will be forces on the surface atoms. We will examine some consequences of this with a simple Al slab. First, we show there are forces on the slab atoms.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(1, 1, 4), vacuum=10.0)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-unrelaxed'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(atoms.get_forces())
</pre>
</div>

<pre class="example">
[[ 0.          0.         -0.01505445]
 [ 0.          0.          0.18818605]
 [ 0.          0.         -0.18818605]
 [ 0.          0.          0.01505445]]
</pre>

<p>
Some points to note. The forces on the atoms have symmetry to them. That is because the slab is centered. Had the slab had an odd number of atoms, it is likely the center atom would have no forces on it. Next we consider the spacing between each layer in the slab. We do this for comparison later.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-unrelaxed'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Total energy: {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy())

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(1, <span style="color: #006FE0;">len</span>(atoms)):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'{0}  deltaz = {1:1.3f} angstroms'</span>.<span style="color: #006FE0;">format</span>(i, atoms[i].z - atoms[i-1].z)
</pre>
</div>

<pre class="example">
Total energy: -14.179 eV
1  deltaz = 2.338 angstroms
2  deltaz = 2.338 angstroms
3  deltaz = 2.338 angstroms
</pre>

<p>
To reduce the forces, we can let VASP relax the geometry. We have to make some decisions about how to relax the slab. One choice would be to relax all the atoms in the slab. If we do that, then there will be no atoms with bulk like spacing unless we increase the slab thickness pretty dramatically. It is pretty common to freeze some atoms at the bulk coordinates, and let the others relax. We will freeze the bottom two layers (defined by tags 3 and 4) and let the first two layers relax. To do that we add constraints to the slab.
</p>

<p>
Note: the <a href="https://wiki.fysik.dtu.dk/ase/ase/constraints.html">ase constraints</a> are only partially used by <code>Vasp</code>. The <a href="ase.constraints.FixAtoms">ase.constraints.FixAtoms</a> constraint gets written to the POSCAR file, and is then used internally in VASP. The only other constraint that VASP can use internally is <a href="ase.constraints.FixScaled">ase.constraints.FixScaled</a>. The other constraints are not written to the POSCAR and are not used by VASP.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(2, 2, 4), vacuum=10.0)
<span style="color: #0000FF;">print</span>([atom.z <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
<span style="color: #0000FF;">print</span> [atom.z &lt;= 13 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms]
</pre>
</div>

<pre class="example">
[9.9999999999999982, 9.9999999999999982, 9.9999999999999982, 9.9999999999999982, 12.338268590217982, 12.338268590217982, 12.338268590217982, 12.338268590217982, 14.676537180435968, 14.676537180435968, 14.676537180435968, 14.676537180435968, 17.01480577065395, 17.01480577065395, 17.01480577065395, 17.01480577065395]
[True, True, True, True, True, True, True, True, False, False, False, False, False, False, False, False]
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(1, 1, 4), vacuum=10.0)

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt;= 3 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-relaxed'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span> calc.potential_energy
<span style="color: #0000FF;">print</span> calc
</pre>
</div>

<pre class="example">
-14.18341424

*************** VASP CALCULATION SUMMARY ***************
Vasp calculation directory:
---------------------------
  [[/home-research/jkitchin/dft-book/surfaces/Al-slab-relaxed]]

Unit cell:
----------
       x       y       z             |v|
  v0   2.864   0.000   0.000       2.864 Ang
  v1   1.432   2.480   0.000       2.864 Ang
  v2   0.000   0.000  27.015      27.015 Ang
  alpha, beta, gamma (deg):  90.0  90.0  60.0
  Total volume:                  191.872 Ang^3
  Stress:    xx     yy     zz     yz     xz     xy
          0.006  0.006  0.001 -0.000 -0.000 -0.000 GPa

  ID  tag     sym    x         y         z        rmsF (eV/A)
  0   0       Al     0.000*    0.000*   10.000*      0.00
  1   0       Al     1.432*    0.827*   12.338*      0.00
  2   0       Al     2.864     1.653    14.646       0.03
  3   0       Al     0.000     0.000    17.003       0.04
  Potential energy: -14.1834 eV

INPUT Parameters:
-----------------
  pp        : PBE
  isif      : 2
  xc        : pbe
  kpts      : [6, 6, 1]
  encut     : 350
  lcharg    : False
  ibrion    : 2
  ismear    : 1
  lwave     : True
  sigma     : 0.1
  nsw       : 10

Pseudopotentials used:
----------------------
  Al: potpaw_PBE/Al/POTCAR (git-hash: ad7c649117f1490637e05717e30ab9a0dd8774f6)
</pre>

<p>
You can see that atoms 2 and 3 (the ones we relaxed, because the have tags of 1 and 2, which are less than 3) now have very low forces on them and it appears that atoms 0 and 1 have no forces on them. That is because the FixAtoms constraint works by setting the forces on those atoms to zero. We can see in the next example that the z-positions of the relaxed atoms have indeed relaxed and changed, while the position of the frozen atoms did not change.
</p>

<p>
Note there are two versions of the forces. The true forces, and the forces when constraints are applied.
<a href="ase.atoms.Atoms.get_forces">ase.atoms.Atoms.get_forces</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-relaxed'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Constraints = True: '</span>, atoms.get_forces(apply_constraint=<span style="color: #D0372D;">True</span>))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Constraints = False: '</span>, atoms.get_forces(apply_constraint=<span style="color: #D0372D;">False</span>))
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book-new-vasp/surfaces/Al-slab-relaxed Queued: 1391621.gilgamesh.cheme.cmu.edu
('Constraints = True: ', array([[0.0, 0.0, 0.0],
       [0.0, 0.0, 0.0],
       [None, None, None],
       [None, None, None]], dtype=object))
/home-research/jkitchin/dft-book-new-vasp/surfaces/Al-slab-relaxed Queued: 1391621.gilgamesh.cheme.cmu.edu
('Constraints = False: ', array([[None, None, None],
       [None, None, None],
       [None, None, None],
       [None, None, None]], dtype=object))
</pre>


<pre class="example">
Constraints = True:  [[ 0.     0.     0.   ]
 [ 0.     0.     0.   ]
 [ 0.     0.    -0.049]
 [ 0.     0.    -0.019]]
Constraints = False:  [[ 0.     0.    -0.002]
 [ 0.     0.     0.069]
 [ 0.     0.    -0.049]
 [ 0.     0.    -0.019]]
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-relaxed'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Total energy: {0:1.3f}'</span>.<span style="color: #006FE0;">format</span>(atoms.get_potential_energy())

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(1, <span style="color: #006FE0;">len</span>(atoms)):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'d_({0},{1}) = {2:1.3f} angstroms'</span>.<span style="color: #006FE0;">format</span>(i, i-1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms[i].z - atoms[i-1].z)
</pre>
</div>

<p>
Depending on the layer there is either slight contraction or expansion. These quantities are small, and careful convergence studies should be performed. Note the total energy change from unrelaxed to relaxed is not that large in this case (e.g., it is about 5 meV). This is usually the case for metals, where the relaxation effects are relatively small. In oxides and semiconductors, the effects can be large, and when there are adsorbates, the effects can be large also.
</p>
</div>
</div>

<div id="outline-container-orgheadline132" class="outline-3">
<h3 id="orgheadline132"><span class="section-number-3">5.4</span> Surface reconstruction</h3>
<div class="outline-text-3" id="text-5-4">
<p>
<a href="reconstruction">reconstruction</a>
</p>

<p>
We previously considered how relaxation can lower the surface energy. For some surfaces, a more extreme effect can reduce the surface energy: reconstruction. In a simple surface relaxation, the basic structure of a surface is preserved. However, sometimes there is a different surface structure that may have a lower surface energy. Some famous reconstructions include: Si-\(\sqrt{7}\times\sqrt{7}\), Pt(100) hex reconstruction <a class='org-ref-reference' href="#PhysRevB.56.10518">PhysRevB.56.10518</a>,<a class='org-ref-reference' href="#PhysRevB.82.161418">PhysRevB.82.161418</a>, and the Au(111) herringbone reconstruction.
</p>

<p>
We will consider the (110) missing row reconstruction <a class='org-ref-reference' href="#PhysRevB.83.075415">PhysRevB.83.075415</a>. For some metals, especially Pt and Au, it is energetically favorable to form the so-called missing row reconstruction where every other row in the surface is "missing". It is favorable because it lowers the surface energy. Let us consider how we might calculate and predict that. It is straightforward to compute the energy of a (110) slab, and of a (110) slab with one row missing. However, these slabs contain different numbers of atoms, so we cannot directly compare the total energies to determine which energy is lower.
</p>

<p>
We have to consider where the missing row atoms have gone, so we can account for their energy. We will consider that they have gone into the bulk, and so we to consider the energy associated with the following transformation:
</p>

<p>
slab<sub>110</sub> \(\rightarrow\) slab<sub>missing row</sub> + bulk
</p>

<p>
Thus, if this change in energy: \(E_{bulk} + E_{slab_{missing row}} - E_{slab_{110}} \) is negative, then the formation of the missing row is expected to be favorable.
</p>
</div>

<div id="outline-container-orgheadline121" class="outline-4">
<h4 id="orgheadline121"><span class="section-number-4">5.4.1</span> Au(110) missing row reconstruction</h4>
<div class="outline-text-4" id="text-5-4-1">
<p>
We first consider the Au(110) case, where the reconstruction is known to be favorable.
</p>
</div>
<div id="outline-container-orgheadline117" class="outline-5">
<h5 id="orgheadline117"><span class="section-number-5">5.4.1.1</span> Clean Au(110) slab</h5>
<div class="outline-text-5" id="text-5-4-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Au'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)
view(atoms)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Au'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

write(<span style="color: #008000;">'images/Au-110.png'</span>, atoms.repeat((2, 2, 1)), rotation=<span style="color: #008000;">'-90x'</span>, show_unit_cell=2)

<span style="color: #0000FF;">print</span> Vasp(<span style="color: #008000;">'surfaces/Au-110'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy
</pre>
</div>

<pre class="example">
-35.92440066
</pre>


<div class="figure">
<p><img src="./images/Au-110.png" alt="Au-110.png" />
</p>
<p><span class="figure-number">Figure 68:</span> The unreconstructed Au(110) surface viewed from the side.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline118" class="outline-5">
<h5 id="orgheadline118"><span class="section-number-5">5.4.1.2</span> Missing row in Au(110)</h5>
<div class="outline-text-5" id="text-5-4-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Au'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #0000FF;">del</span> atoms[11]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">delete surface row</span>

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

write(<span style="color: #008000;">'images/Au-110-missing-row.png'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms.repeat((2, 2, 1)),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> rotation=<span style="color: #008000;">'-90x'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> show_unit_cell=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Au-110-missing-row'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms)

calc.update()
</pre>
</div>


<div class="figure">
<p><img src="./images/Au-110-missing-row.png" alt="Au-110-missing-row.png" />
</p>
<p><span class="figure-number">Figure 69:</span> Au(110) with the missing row reconstruction.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline119" class="outline-5">
<h5 id="orgheadline119"><span class="section-number-5">5.4.1.3</span> Bulk Au</h5>
<div class="outline-text-5" id="text-5-4-1-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>symbol=<span style="color: #008000;">'Au'</span>)

<span style="color: #0000FF;">print</span> Vasp(<span style="color: #008000;">'bulk/Au-fcc'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy
</pre>
</div>

<pre class="example">
-3.19446244
</pre>
</div>
</div>

<div id="outline-container-orgheadline120" class="outline-5">
<h5 id="orgheadline120"><span class="section-number-5">5.4.1.4</span> Analysis of energies</h5>
<div class="outline-text-5" id="text-5-4-1-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'dE = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(Vasp(<span style="color: #008000;">'surfaces/Au-110-missing-row'</span>).potential_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   + Vasp(<span style="color: #008000;">'bulk/Au-fcc'</span>).potential_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   - Vasp(<span style="color: #008000;">'surfaces/Au-110'</span>).potential_energy)
</pre>
</div>

<pre class="example">
natoms slab        = 12
natoms missing row = 11
natoms bulk        = 1
dE = -0.070 eV
</pre>

<p>
The missing row formation energy is slightly negative. The magnitude of the formation energy is pretty small, but just slightly bigger than the typical convergence errors observed, so we should cautiously conclude that the reconstruction if favorable for Au(110). We made a lot of shortcuts in computing this quantity, including using the experimental lattice constant of Au, not checking for convergence in k-points or planewave cutoff, and not checking for convergence with respect to slab thickness or number of relaxed layers.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline126" class="outline-4">
<h4 id="orgheadline126"><span class="section-number-4">5.4.2</span> Ag(110) missing row reconstruction</h4>
<div class="outline-text-4" id="text-5-4-2">
</div><div id="outline-container-orgheadline122" class="outline-5">
<h5 id="orgheadline122"><span class="section-number-5">5.4.2.1</span> Clean Ag(110) slab</h5>
<div class="outline-text-5" id="text-5-4-2-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Ag'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Ag-110'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline123" class="outline-5">
<h5 id="orgheadline123"><span class="section-number-5">5.4.2.2</span> Missing row in Ag(110)</h5>
<div class="outline-text-5" id="text-5-4-2-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Ag'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #0000FF;">del</span> atoms[11]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">delete surface row</span>

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

Vasp(<span style="color: #008000;">'surfaces/Ag-110-missing-row'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms).update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline124" class="outline-5">
<h5 id="orgheadline124"><span class="section-number-5">5.4.2.3</span> Bulk Ag</h5>
<div class="outline-text-5" id="text-5-4-2-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Ag'</span>)

Vasp(<span style="color: #008000;">'bulk/Ag-fcc'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms).update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline125" class="outline-5">
<h5 id="orgheadline125"><span class="section-number-5">5.4.2.4</span> Analysis of energies</h5>
<div class="outline-text-5" id="text-5-4-2-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">eslab</span> = Vasp(<span style="color: #008000;">'surfaces/Ag-110'</span>).potential_energy

<span style="color: #BA36A5;">emissingrow</span> = Vasp(<span style="color: #008000;">'surfaces/Ag-110-missing-row'</span>).potential_energy

<span style="color: #BA36A5;">ebulk</span> = Vasp(<span style="color: #008000;">'bulk/Ag-fcc'</span>).potential_energy

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'dE = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(emissingrow + ebulk - eslab)
</pre>
</div>

<pre class="example">
dE = -0.010 eV
</pre>

<p>
For Ag(110), the missing row formation energy is practically thermoneutral, i.e. not that favorable. This energy is so close to 0eV, that we cannot confidently say whether the reconstruction is favorable or not. Experimentally, the reconstruction is not seen on very clean Ag(110) although it is reported that some adsorbates may induce the reconstruction <a class='org-ref-reference' href="#PhysRevLett.59.2307">PhysRevLett.59.2307</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline131" class="outline-4">
<h4 id="orgheadline131"><span class="section-number-4">5.4.3</span> Cu(110) missing row reconstruction</h4>
<div class="outline-text-4" id="text-5-4-3">
</div><div id="outline-container-orgheadline127" class="outline-5">
<h5 id="orgheadline127"><span class="section-number-5">5.4.3.1</span> Clean Cu(110) slab</h5>
<div class="outline-text-5" id="text-5-4-3-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Cu'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

Vasp(<span style="color: #008000;">'surfaces/Cu-110'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms).update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline128" class="outline-5">
<h5 id="orgheadline128"><span class="section-number-5">5.4.3.2</span> Missing row in Cu(110)</h5>
<div class="outline-text-5" id="text-5-4-3-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc110
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc110(<span style="color: #008000;">'Cu'</span>, size=(2, 1, 6), vacuum=10.0)
<span style="color: #0000FF;">del</span> atoms[11]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">delete surface row</span>

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.tag &gt; 2 <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

Vasp(<span style="color: #008000;">'surfaces/Cu-110-missing-row'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms).update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline129" class="outline-5">
<h5 id="orgheadline129"><span class="section-number-5">5.4.3.3</span> Bulk Cu</h5>
<div class="outline-text-5" id="text-5-4-3-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>symbol=<span style="color: #008000;">'Cu'</span>)

Vasp(<span style="color: #008000;">'bulk/Cu-fcc'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>kpts=[12, 12, 12],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms=atoms).update()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline130" class="outline-5">
<h5 id="orgheadline130"><span class="section-number-5">5.4.3.4</span> Analysis</h5>
<div class="outline-text-5" id="text-5-4-3-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">eslab</span> = Vasp(<span style="color: #008000;">'surfaces/Cu-110'</span>).potential_energy

<span style="color: #BA36A5;">emissingrow</span> = Vasp(<span style="color: #008000;">'surfaces/Cu-110-missing-row'</span>).potential_energy

<span style="color: #BA36A5;">ebulk</span> = Vasp(<span style="color: #008000;">'bulk/Cu-fcc'</span>).potential_energy

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'natoms slab        = {0}'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">len</span>(slab))
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'natoms missing row = {0}'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">len</span>(missingrow))
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'natoms bulk        = {0}'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">len</span>(bulk))

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'dE = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(emissingrow + ebulk - eslab)
</pre>
</div>

<p>
It is questionable whether we should consider this evidence of a missing row reconstruction because the number is small. That does not mean the reconstruction will not happen, but it could mean it is very easy to lift.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline134" class="outline-3">
<h3 id="orgheadline134"><span class="section-number-3">5.5</span> Surface energy</h3>
<div class="outline-text-3" id="text-5-5">
<p>
The easiest way to calculate surface energies is from this equation:
</p>

<p>
\(\sigma = \frac{1}{2}(E_{slab} - \frac{N_{slab}}{N_{bulk}} E_{bulk})\)
</p>

<p>
where \(E_{slab}\) is the total energy of a symmetric slab (i.e. one with inversion symmetry, and where both sides of the slab have been relaxed), \(E_{bulk}\) is the total energy of a bulk unit cell, \(N_{slab}\) is the number of atoms in the slab, and \(N_{bulk}\) is the number of atoms in the bulk unit cell. One should be sure that the bulk energy is fully converged with respect to $k$-points, and that the slab energy is also converged with respect to $k$-points. The energies should be compared at the same cutoff energies. The idea is then to increase the thickness of the slab until the surface energy \(\sigma\) converges.
</p>



<div class="figure">
<p><img src="./images/surface-construction.png" alt="surface-construction.png" />
</p>
<p><span class="figure-number">Figure 70:</span> Schematic figure illustrating the calculation of a surface energy.</p>
</div>

<p>
Unfortunately, this approach does not always work. The bulk system is treated subtly different than the slab system, particularly in the $z$-direction where the vacuum is (where typically only one $k$-point is used in slabs). Consequently, the $k$-point sampling is not equivalent in the two systems, and one can in general expect some errors due to this, with the best case being cancellation of the errors due to total $k$-point convergence. In the worst case, one can get a linear divergence in the surface energy with slab thickness <a class='org-ref-reference' href="#PhysRevB.49.16798">PhysRevB.49.16798</a>.
</p>

<p>
A variation of this method that usually results in better $k$-point error cancellation is to calculate the bulk unit cell energy using the slab unit cell with no vacuum space, with the same $k$-point mesh in the \(x\) and \(y\) directions, but with increased $k$-points in the $z$-direction. Thus, the bulk system and slab system have the same Brillouin zone in at least two dimensions. This maximizes the cancellation of $k$-point errors, but still does not guarantee convergence of the surface energy, as discussed in <a class='org-ref-reference' href="#PhysRevB.49.16798">PhysRevB.49.16798</a>,<a class='org-ref-reference' href="#0953-8984-10-4-017">0953-8984-10-4-017</a>.
</p>

<p>
For quick estimates of the surface energy, one of the methods described above is likely sufficient. The advantage of these methods is the small number of calculations required to obtain the estimate, one needs only a bulk calculation (which must be done anyhow to get the bulk lattice constant to create the slab), and a slab calculation that is sufficiently thick to get the estimate. Additional calculations are only required to test the convergence of the surface energy.
</p>

<p>
An alternative method for calculating surface energies that does not involve an explicit bulk calculation follows Ref. <a class='org-ref-reference' href="#0953-8984-10-4-017">0953-8984-10-4-017</a>. The method follows from equation (ref{eq:se}) where for a N-atom slab, in the limit of N &rarr; &infin;,
</p>

<p>
\(E_{slab} \approx 2\sigma + \frac{N_{slab}}{N_{bulk}} E_{bulk}\)
</p>

<p>
Then, we can estimate E<sub>bulk</sub> by plotting the total energy of the slab as a function of the slab thickness.
</p>

<p>
\(\sigma = \lim_{N \rightarrow \infty} \frac{1}{2}(E_{slab}^N - N \Delta E_N)\)
</p>

<p>
where \(\Delta E_N = E_{slab}^N - E_{slab}^{N-1}\).
</p>

<p>
We will examine this approach here. We will use unrelaxed slabs for computational efficiency.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">Nlayers</span> = [3, 4, 5, 6, 7, 8, 9, 10, 11]
<span style="color: #BA36A5;">energies</span> = []
<span style="color: #BA36A5;">sigmas</span> = []

<span style="color: #0000FF;">for</span> n <span style="color: #0000FF;">in</span> Nlayers:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Cu'</span>, size=(1, 1, n), vacuum=10.0)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   slab.center()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-layers/{0}'</span>.<span style="color: #006FE0;">format</span>(n),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[8, 8, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=slab)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.set_nbands(f=2)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the default nbands in VASP is too low for Cu</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   energies.append(slab.get_potential_energy())

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> energies)

<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(Nlayers) - 1):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">N</span> = Nlayers[i]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">DeltaE_N</span> = energies[i + 1] - energies[i]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">sigma</span> = 0.5 * (-N * energies[i + 1] + (N + 1) * energies[i])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigmas.append(sigma)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'nlayers = {1:2d} sigma = {0:1.3f} eV/atom'</span>.<span style="color: #006FE0;">format</span>(sigma, N)

plt.plot(Nlayers[0:-1], sigmas, <span style="color: #008000;">'bo-'</span>)
plt.xlabel(<span style="color: #008000;">'Number of layers'</span>)
plt.ylabel(<span style="color: #008000;">'Surface energy (eV/atom)'</span>)
plt.savefig(<span style="color: #008000;">'images/Cu-unrelaxed-surface-energy.png'</span>)
</pre>
</div>

<pre class="example">
nlayers =  3 sigma = 0.561 eV/atom
nlayers =  4 sigma = 0.398 eV/atom
nlayers =  5 sigma = 0.594 eV/atom
nlayers =  6 sigma = 0.308 eV/atom
nlayers =  7 sigma = 0.590 eV/atom
nlayers =  8 sigma = 0.332 eV/atom
nlayers =  9 sigma = 0.591 eV/atom
nlayers = 10 sigma = 0.392 eV/atom
</pre>


<div class="figure">
<p><img src="./images/Cu-unrelaxed-surface-energy.png" alt="Cu-unrelaxed-surface-energy.png" />
</p>
<p><span class="figure-number">Figure 71:</span> Surface energy of a Cu(111) slab as a function of thickness.</p>
</div>

<p>
One reason for the oscillations may be quantum size effects <a class='org-ref-reference' href="#Fiolhais2003209">Fiolhais2003209</a>. In <a class='org-ref-reference' href="#PhysRevB.75.115131">PhysRevB.75.115131</a> the surface energy of Cu(111) is reported as 0.48 eV/atom, or 1.36 J/m\(^2\). Here is an example showing a conversion between these two units. We use ase to compute the area of the unit cell from the norm of the cross-product of the vectors defining the surface unit cell.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> J, m
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Cu'</span>, size=(1, 1, 3), vacuum=10.0)
<span style="color: #BA36A5;">cell</span> = slab.get_cell()

<span style="color: #BA36A5;">area</span> = np.linalg.norm(np.cross(cell[0], cell[1]))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">area per atom</span>

<span style="color: #BA36A5;">sigma</span> = 0.48  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV/atom</span>

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'sigma = {0} J/m^2'</span>.<span style="color: #006FE0;">format</span>(sigma / area / (J / m**2))
</pre>
</div>

<pre class="example">
sigma = 1.36281400415 J/m^2
</pre>
</div>

<div id="outline-container-orgheadline133" class="outline-4">
<h4 id="orgheadline133"><span class="section-number-4">5.5.1</span> Advanced topics in surface energy</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
The surface energies can be used to estimate the shapes of nanoparticles using a Wulff construction. See <a class='org-ref-reference' href="#doi.10.1021/jp200950a">doi.10.1021/jp200950a</a> for an example of computing Mo<sub>2</sub>C surface energies and particle shapes, and <a class='org-ref-reference' href="#Inoglu2009188">Inoglu2009188</a> for an example of the influence of adsorbates on surface energies and particle shapes of Cu.
</p>

<p>
For a classic paper on trends in surface energies see <a class='org-ref-reference' href="#Vitos1998186">Vitos1998186</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline135" class="outline-3">
<h3 id="orgheadline135"><a id="ID-6fb2a790-5fc8-47f7-b379-bf6eb65bd3f5"></a><span class="section-number-3">5.6</span> Work function</h3>
<div class="outline-text-3" id="text-5-6">
<p>
<a href="work function">work function</a>
To get the work function, we need to have the local potential. This is not written by default in VASP, and we have to tell it to do that with the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LVTOT>LVTOT</a> and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LVHAR>LVHAR</a> keywords.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-relaxed'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-slab-locpot'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvtot=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out local potential</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvhar=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out only electrostatic potential, not xc pot</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
calc.wait()
<span style="color: #BA36A5;">ef</span> = calc.get_fermi_level()
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">lp</span> = calc.get_local_potential()

<span style="color: #BA36A5;">nx</span>, <span style="color: #BA36A5;">ny</span>, <span style="color: #BA36A5;">nz</span> = lp.shape

<span style="color: #BA36A5;">axy</span> = np.array([np.average(lp[:, :, z]) <span style="color: #0000FF;">for</span> z <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nz)])
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">setup the x-axis in realspace</span>
<span style="color: #BA36A5;">uc</span> = atoms.get_cell()
<span style="color: #BA36A5;">xaxis</span> = np.linspace(0, uc[2][2], nz)

plt.plot(xaxis, axy)
plt.plot([<span style="color: #006FE0;">min</span>(xaxis), <span style="color: #006FE0;">max</span>(xaxis)], [ef, ef], <span style="color: #008000;">'k:'</span>)
plt.xlabel(<span style="color: #008000;">'Position along z-axis'</span>)
plt.ylabel(<span style="color: #008000;">'x-y averaged electrostatic potential'</span>)
plt.savefig(<span style="color: #008000;">'images/Al-wf.png'</span>)

<span style="color: #BA36A5;">ind</span> = (xaxis &gt; 0) &amp; (xaxis &lt; 5)
<span style="color: #BA36A5;">wf</span> = np.average(axy[ind]) - ef
<span style="color: #0000FF;">print</span> <span style="color: #008000;">' The workfunction is {0:1.2f} eV'</span>.<span style="color: #006FE0;">format</span>(wf)
</pre>
</div>

<pre class="example">
The workfunction is 4.17 eV
</pre>

<p>
The workfunction of Al is listed as 4.08 at <a href="http://hyperphysics.phy-astr.gsu.edu/hbase/tables/photoelec.html">http://hyperphysics.phy-astr.gsu.edu/hbase/tables/photoelec.html</a>.
</p>


<div class="figure">
<p><img src="./images/Al-wf.png" alt="Al-wf.png" />
</p>
<p><span class="figure-number">Figure 72:</span> \(xy\) averaged local electrostatic potential of an Al(111) slab.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline139" class="outline-3">
<h3 id="orgheadline139"><span class="section-number-3">5.7</span> Dipole correction</h3>
<div class="outline-text-3" id="text-5-7">
<p>
<a href="dipole correction">dipole correction</a>
</p>

<p>
A subtle problem can arise when an adsorbate is placed on one side of
a slab with periodic boundary conditions, which is currently the
common practice.  The problem is that this gives the slab a dipole
moment. The array of dipole moments created by the periodic boundary
conditions generates an electric field that can distort the electron
density of the slab and change the energy. The existence of this field
in the vacuum also makes the zero-potential in the vacuum ill-defined,
thus the work function is not well-defined. One solution to this
problem is to use slabs with adsorbates on both sides, but then very
thick (eight to ten layers) slabs must be used to ensure the
adsorbates do not interact through the slab. An alternative solution,
the dipole correction scheme, was developed by Neugebauer and
Scheffler <a class='org-ref-reference' href="#PhysRevB.46.16067">PhysRevB.46.16067</a> and later corrected by Bengtsson
<a class='org-ref-reference' href="#PhysRevB.59.12301">PhysRevB.59.12301</a>. In this technique, an external field is
imposed in the vacuum region that exactly cancels the artificial field
caused by the slab dipole moment. The advantage of this approach is
that thinner slabs with adsorbates on only one side can be used.
</p>

<p>
There are also literature reports that the correction is small
<a class='org-ref-reference' href="#morikawa2001:c2h2-si">morikawa2001:c2h2-si</a>.  Nevertheless, in the literature the use
of this correction is fairly standard, and it is typical to at least
consider the correction.
</p>

<p>
Here we will just illustrate the effect.
</p>
</div>

<div id="outline-container-orgheadline136" class="outline-4">
<h4 id="orgheadline136"><span class="section-number-4">5.7.1</span> Slab with no dipole correction</h4>
<div class="outline-text-4" id="text-5-7-1">
<p>
We simply run the calculation here, and compare the results later.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute local potential of slab with no dipole</span>
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(2, 2, 2), vacuum=10.0)
add_adsorbate(slab, <span style="color: #008000;">'Na'</span>, height=1.2, position=<span style="color: #008000;">'fcc'</span>)

slab.center()
write(<span style="color: #008000;">'images/Na-Al-slab.png'</span>, slab, rotation=<span style="color: #008000;">'-90x'</span>, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Al-Na-nodip'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=340,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[2, 2, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  lvtot=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out local potential</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  lvhar=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out only electrostatic potential, not xc pot</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=slab).potential_energy)
</pre>
</div>

<pre class="example">
-22.55264459
</pre>


<div class="figure">
<p><img src="./images/Na-Al-slab.png" alt="Na-Al-slab.png" />
</p>
<p><span class="figure-number">Figure 73:</span> Example slab with a Na atom on it for illustrating the effects of dipole corrections.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline137" class="outline-4">
<h4 id="orgheadline137"><span class="section-number-4">5.7.2</span> <span class="todo TODO">TODO</span> Slab with a dipole correction</h4>
<div class="outline-text-4" id="text-5-7-2">
<p>
Note this takes a considerably longer time to run than without a dipole correction! In VASP there are several levels of dipole correction to apply. You can use the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IDIPOL>IDIPOL</a> tag to turn it on, and specify which direction to apply it in (1=\(x\), 2=\(y\), 3=\(z\), 4=\((x,y,z)\)). This simply corrects the total energy and forces. It does not change the contents of LOCPOT. For that, you have to also set the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LDIPOL>LDIPOL</a> and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/DIPOL>DIPOL</a> tags. It is not efficient to set all three at the same time for some reason. The VASP manual recommends you first set IDIPOL to get a converged electronic structure, and then set LDIPOL to True, and set the center of electron density in DIPOL. That makes these calculations a multistep process, because we must run a calculation, analyze the charge density to get the center of charge, and then run a second calculation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute local potential with dipole calculation on</span>
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Al'</span>, size=(2, 2, 2), vacuum=10.0)
add_adsorbate(slab, <span style="color: #008000;">'Na'</span>, height=1.2, position=<span style="color: #008000;">'fcc'</span>)

slab.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-Na-dip'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=340,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[2, 2, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lcharg=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   idipol=3,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">only along z-axis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvtot=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out local potential</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lvhar=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">write out only electrostatic potential, not xc pot</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=slab)

calc.stop_if(calc.potential_energy <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">cd</span> = calc.get_charge_density()
<span style="color: #BA36A5;">n0</span>, <span style="color: #BA36A5;">n1</span>, <span style="color: #BA36A5;">n2</span> = cd.shape
<span style="color: #BA36A5;">nelements</span> = n0 * n1 * n2
<span style="color: #BA36A5;">voxel_volume</span> = slab.get_volume() / nelements
<span style="color: #BA36A5;">total_electron_charge</span> = cd.<span style="color: #006FE0;">sum</span>() * voxel_volume

<span style="color: #BA36A5;">electron_density_center</span> = np.array([(cd * x).<span style="color: #006FE0;">sum</span>(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (cd * y).<span style="color: #006FE0;">sum</span>(),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   (cd * z).<span style="color: #006FE0;">sum</span>()])
<span style="color: #BA36A5;">electron_density_center</span> *= voxel_volume
<span style="color: #BA36A5;">electron_density_center</span> /= total_electron_charge

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'electron-density center = {0}'</span>.<span style="color: #006FE0;">format</span>(electron_density_center)
<span style="color: #BA36A5;">uc</span> = slab.get_cell()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get scaled electron charge density center</span>
<span style="color: #BA36A5;">sedc</span> = np.dot(np.linalg.inv(uc.T), electron_density_center.T).T

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we only write 4 decimal places out to the INCAR file, so we round here.</span>
<span style="color: #BA36A5;">sedc</span> = np.<span style="color: #006FE0;">round</span>(sedc, 4)

calc.clone(<span style="color: #008000;">'surfaces/Al-Na-dip-step2'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now run step 2 with dipole set at scaled electron charge density center</span>
calc.<span style="color: #006FE0;">set</span>(ldipol=<span style="color: #D0372D;">True</span>, dipol=sedc)
<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline138" class="outline-4">
<h4 id="orgheadline138"><span class="section-number-4">5.7.3</span> Comparing no dipole correction with a dipole correction</h4>
<div class="outline-text-4" id="text-5-7-3">
<p>
To see the difference in what the dipole correction does, we now plot the potentials from each calculation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-Na-nodip'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">lp</span> = calc.get_local_potential()
<span style="color: #BA36A5;">nx</span>, <span style="color: #BA36A5;">ny</span>, <span style="color: #BA36A5;">nz</span> = lp.shape

<span style="color: #BA36A5;">axy_1</span> = [np.average(lp[:, :, z]) <span style="color: #0000FF;">for</span> z <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nz)]
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">setup the x-axis in realspace</span>
<span style="color: #BA36A5;">uc</span> = atoms.get_cell()
<span style="color: #BA36A5;">xaxis_1</span> = np.linspace(0, uc[2][2], nz)

<span style="color: #BA36A5;">e1</span> = atoms.get_potential_energy()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Al-Na-dip-step2'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">lp</span> = calc.get_local_potential()
<span style="color: #BA36A5;">nx</span>, <span style="color: #BA36A5;">ny</span>, <span style="color: #BA36A5;">nz</span> = lp.shape

<span style="color: #BA36A5;">axy_2</span> = [np.average(lp[:, :, z]) <span style="color: #0000FF;">for</span> z <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(nz)]
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">setup the x-axis in realspace</span>
<span style="color: #BA36A5;">uc</span> = atoms.get_cell()
<span style="color: #BA36A5;">xaxis_2</span> = np.linspace(0, uc[2][2], nz)

<span style="color: #BA36A5;">ef2</span> = calc.get_fermi_level()
<span style="color: #BA36A5;">e2</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'The difference in energy is {0} eV.'</span>.<span style="color: #006FE0;">format</span>(e2-e1)

plt.plot(xaxis_1, axy_1, label=<span style="color: #008000;">'no dipole correction'</span>)
plt.plot(xaxis_2, axy_2, label=<span style="color: #008000;">'dipole correction'</span>)
plt.plot([<span style="color: #006FE0;">min</span>(xaxis_2), <span style="color: #006FE0;">max</span>(xaxis_2)], [ef2, ef2], <span style="color: #008000;">'k:'</span>, label=<span style="color: #008000;">'Fermi level'</span>)
plt.xlabel(<span style="color: #008000;">'z ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'xy-averaged electrostatic potential'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/dip-vs-nodip-esp.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/dip-vs-nodip-esp.png" alt="dip-vs-nodip-esp.png" />
</p>
<p><span class="figure-number">Figure 74:</span> Comparison of the electrostatic potentials with a dipole correction and without it.</p>
</div>

<p>
The key points to notice in this figure are:
</p>
<ol class="org-ol">
<li>The two deep dips are where the atoms are.</li>
<li>Without a dipole correction, the electrostatic potential never flattens out. there is near constant slope in the vacuum region, which means there is an electric field there.</li>
<li>With a dipole correction the potential is flat in the vacuum region, except for the step jump near 23 &Aring;.</li>
<li>The difference between the Fermi level and the flat vacuum potential is the work function.</li>
<li>The difference in energy with and without the dipole correction here is small.</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgheadline154" class="outline-3">
<h3 id="orgheadline154"><span class="section-number-3">5.8</span> Adsorption energies</h3>
<div class="outline-text-3" id="text-5-8">
<p>
<a href="adsorption energy">adsorption energy</a>
</p>
</div>
<div id="outline-container-orgheadline148" class="outline-4">
<h4 id="orgheadline148"><span class="section-number-4">5.8.1</span> Simple estimate of the adsorption energy</h4>
<div class="outline-text-4" id="text-5-8-1">
<p>
Calculating an adsorption energy amounts to computing the energy of the following kind of reaction:
</p>

<p>
slab + gas-phase molecule \(\rightarrow\) slab_adsorbate + products
</p>


<div class="figure">
<p><img src="./images/adsorbate-energy.png" alt="adsorbate-energy.png" />
</p>
<p><span class="figure-number">Figure 75:</span> Schematic of an adsorption process.</p>
</div>

<p>
There are many variations of this idea. The slab may already have some adsorbates on it, the slab may reconstruct on adsorption, the gas-phase molecule may or may not dissociate, and the products may or may not stick to the surface. We have to decide where to put the adsorbates, i.e. what site to put them on, and some sites will be more stable than others. We will consider the dissociative adsorption of O\(_2\) on three sites of a Pt(111) slab. We will assume the oxygen molecule has split in half, and that the atoms have moved far apart. We will model the oxygen coverage at 0.25 ML, which means we need to use a \(2 \times 2\) surface unit cell. For computational speed, we will freeze the slab, but allow the adsorbate to relax.
</p>

<p>
\( \Delta H_{ads} (eV/O) = E_{slab+O} - E_{slab} - 0.5*E_{O_2} \)
</p>
</div>
<div id="outline-container-orgheadline144" class="outline-5">
<h5 id="orgheadline144"><span class="section-number-5">5.8.1.1</span> Calculations</h5>
<div class="outline-text-5" id="text-5-8-1-1">
</div><div id="outline-container-orgheadline140" class="outline-6">
<h6 id="orgheadline140"><span class="section-number-6">5.8.1.1.1</span> clean slab calculation</h6>
<div class="outline-text-6" id="text-5-8-1-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(2, 2, 3), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[<span style="color: #D0372D;">True</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
write(<span style="color: #008000;">'images/Pt-fcc-ori.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-68.23616204
</pre>


<div class="figure">
<p><img src="./images/Pt-fcc-ori.png" alt="Pt-fcc-ori.png" />
</p>
<p><span class="figure-number">Figure 76:</span> Pt(111) fcc surface</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline141" class="outline-6">
<h6 id="orgheadline141"><span class="section-number-6">5.8.1.1.2</span> fcc site</h6>
<div class="outline-text-6" id="text-5-8-1-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(2, 2, 3), vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note this function only works when atoms are created by the surface module.</span>
add_adsorbate(atoms, <span style="color: #008000;">'O'</span>, height=1.2, position=<span style="color: #008000;">'fcc'</span>)

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
write(<span style="color: #008000;">'images/Pt-fcc-site.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=25,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-74.23018764
</pre>


<div class="figure">
<p><img src="./images/Pt-fcc-site.png" alt="Pt-fcc-site.png" />
</p>
<p><span class="figure-number">Figure 77:</span> FCC site.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline142" class="outline-6">
<h6 id="orgheadline142"><span class="section-number-6">5.8.1.1.3</span> O atom on the bridge site</h6>
<div class="outline-text-6" id="text-5-8-1-1-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(2, 2, 3), vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note this function only works when atoms are created by the surface module.</span>
add_adsorbate(atoms, <span style="color: #008000;">'O'</span>, height=1.2, position=<span style="color: #008000;">'bridge'</span>)

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=25,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-74.23023073
</pre>


<div class="figure">
<p><img src="./images/Pt-o-brige-ori.png" alt="Pt-o-brige-ori.png" />
</p>
<p><span class="figure-number">Figure 78:</span> Initial geometry of the bridge site. It is definitely on the bridge.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline143" class="outline-6">
<h6 id="orgheadline143"><span class="section-number-6">5.8.1.1.4</span> hcp site</h6>
<div class="outline-text-6" id="text-5-8-1-1-4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(2, 2, 3), vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note this function only works when atoms are created by the surface module.</span>
add_adsorbate(atoms, <span style="color: #008000;">'O'</span>, height=1.2, position=<span style="color: #008000;">'hcp'</span>)

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
write(<span style="color: #008000;">'images/Pt-hcp-o-site.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-hcp'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=25,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-73.76942127
</pre>


<div class="figure">
<p><img src="./images/Pt-hcp-o-site.png" alt="Pt-hcp-o-site.png" />
</p>
<p><span class="figure-number">Figure 79:</span> HCP site.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline146" class="outline-5">
<h5 id="orgheadline146"><span class="section-number-5">5.8.1.2</span> Analysis of adsorption energies</h5>
<div class="outline-text-5" id="text-5-8-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_slab</span> = atoms.get_potential_energy()
write(<span style="color: #008000;">'images/pt-slab.png'</span>, atoms,show_unit_cell=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_slab_o_fcc</span> = atoms.get_potential_energy()
write(<span style="color: #008000;">'images/pt-slab-fcc-o.png'</span>, atoms,show_unit_cell=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-hcp'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_slab_o_hcp</span> = atoms.get_potential_energy()
write(<span style="color: #008000;">'images/pt-slab-hcp-o.png'</span>, atoms,show_unit_cell=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_slab_o_bridge</span> = atoms.get_potential_energy()
write(<span style="color: #008000;">'images/pt-slab-bridge-o.png'</span>, atoms,show_unit_cell=2)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-350'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_O2</span> = atoms.get_potential_energy()

<span style="color: #BA36A5;">Hads_fcc</span> = e_slab_o_fcc - e_slab - 0.5 * e_O2
<span style="color: #BA36A5;">Hads_hcp</span> = e_slab_o_hcp - e_slab - 0.5 * e_O2
<span style="color: #BA36A5;">Hads_bridge</span> = e_slab_o_bridge - e_slab - 0.5 * e_O2

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Hads (fcc)    = {0} eV/O'</span>.<span style="color: #006FE0;">format</span>(Hads_fcc)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Hads (hcp)    = {0} eV/O'</span>.<span style="color: #006FE0;">format</span>(Hads_hcp)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Hads (bridge) = {0} eV/O'</span>.<span style="color: #006FE0;">format</span>(Hads_bridge)
</pre>
</div>

<p>
You can see the hcp site is not as energetically favorable as the fcc site. Interestingly, the bridge site seems to be as favorable as the fcc site. This is not correct, and to see why, we have to look at the final geometries of each calculation. First the fcc (Figure <a href="#fig:fcc">fig:fcc</a> and hcp (Figure <a href="#fig:hcp">fig:hcp</a> sites, which look like we expect.
</p>


<div class="figure">
<p><img src="./images/pt-slab-fcc-o.png" alt="pt-slab-fcc-o.png" />
</p>
<p><span class="figure-number">Figure 80:</span> Final geometry of the fcc site. \label{fig:fcc}</p>
</div>



<div class="figure">
<p><img src="./images/pt-slab-hcp-o.png" alt="pt-slab-hcp-o.png" />
</p>
<p><span class="figure-number">Figure 81:</span> Final geometry of the hcp site. \label{fig:hcp}</p>
</div>

<p>
The bridge site (Figure <a href="#fig:bridge">fig:bridge</a>, however, is clearly not at a bridge site!
</p>


<div class="figure">
<p><img src="./images/pt-slab-bridge-o.png" alt="pt-slab-bridge-o.png" />
</p>
<p><span class="figure-number">Figure 82:</span> Final geometry of the bridge site. You can see that the oxygen atom ended up in the fcc site. \label{fig:bridge}</p>
</div>

<p>
Let us see what the original geometry and final geometry for the bridge site were. The POSCAR contains the initial geometry (as long as you haven't copied CONTCAR to POSCAR), and the CONTCAR contains the final geometry.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> read, write

<span style="color: #BA36A5;">atoms</span> = read(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge/POSCAR'</span>)
write(<span style="color: #008000;">'images/Pt-o-brige-ori.png'</span>, atoms, show_unit_cell=2)

<span style="color: #BA36A5;">atoms</span> = read(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge/CONTCAR'</span>)
write(<span style="color: #008000;">'images/Pt-o-brige-final.png'</span>, atoms, show_unit_cell=2)
</pre>
</div>


<div class="figure">
<p><img src="./images/Pt-o-brige-ori.png" alt="Pt-o-brige-ori.png" />
</p>
<p><span class="figure-number">Figure 83:</span> Initial geometry of the bridge site. It is definitely on the bridge.</p>
</div>


<div class="figure">
<p><img src="./images/Pt-o-brige-final.png" alt="Pt-o-brige-final.png" />
</p>
<p><span class="figure-number">Figure 84:</span> Final geometry of the bridge site. It has fallen into the fcc site.</p>
</div>

<p>
You can see the problem. We should not call the adsorption energy from this calculation a bridge site adsorption energy because the O atom is actually in an fcc site! This kind of result can happen with relaxation, and you should always check that the result you get makes sense. Next, we consider how to get a bridge site adsorption energy by using constraints.
</p>

<p>
Some final notes:
</p>
<ol class="org-ol">
<li>We did not let the slabs relax in these examples, and allowing them to relax is likely to have a big effect on the adsorption energies. You have to decide how many layers to relax, and check for convergence with respect to the number of layers.</li>
<li>The slabs were pretty thin. It is typical these days to see slabs that are 4-5 or more layers thick.</li>
<li>We did not consider how well converged the calculations were with respect to $k$-points or <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ENCUT>ENCUT</a>.</li>
<li>We did not consider the effect of the error in O\(_2\) dissociation energy on the adsorption energies.</li>
<li>We did not consider coverage effects (see <a href="#orgheadline145">Coverage dependence</a>).</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline147" class="outline-5">
<h5 id="orgheadline147"><span class="section-number-5">5.8.1.3</span> Adsorption on bridge site with constraints</h5>
<div class="outline-text-5" id="text-5-8-1-3">
<p>
To prevent the oxygen atom from sliding down into the fcc site, we have to constrain it so that it only moves in the $z$-direction. This is an artificial constraint; the bridge site is only metastable. But there are lots of reasons you might want to do this anyway. One is the bridge site is a transition state for diffusion between the fcc and hcp sites. Another is to understand the role of coordination in the adsorption energies. We use a <a href="ase.constraints.FixScaled">ase.constraints.FixScaled</a> constraint in ase to constrain the O atom so it can only move in the $z$-direction (actually so it can only move in the direction of the third unit cell vector, which only has a $z$-component).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms, FixScaled
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(2, 2, 3), vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note this function only works when atoms are created by the surface module.</span>
add_adsorbate(atoms, <span style="color: #008000;">'O'</span>, height=1.2, position=<span style="color: #008000;">'bridge'</span>)
<span style="color: #BA36A5;">constraint1</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fix in xy-direction, free in z. actually, freeze movement in surface</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">unit cell, and free along 3rd lattice vector</span>
<span style="color: #BA36A5;">constraint2</span> = FixScaled(atoms.get_cell(), 12, [<span style="color: #D0372D;">True</span>, <span style="color: #D0372D;">True</span>, <span style="color: #D0372D;">False</span>])

atoms.set_constraint([constraint1, constraint2])
write(<span style="color: #008000;">'images/Pt-O-bridge-constrained-initial.png'</span>, atoms, show_unit_cell=2)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Initial O position: {0}'</span>.<span style="color: #006FE0;">format</span>(atoms.positions[-1])

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge-xy-constrained'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=25,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #BA36A5;">e_bridge</span> = atoms.get_potential_energy()

write(<span style="color: #008000;">'images/Pt-O-bridge-constrained-final.png'</span>, atoms, show_unit_cell=2)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Final O position  : {0}'</span>.<span style="color: #006FE0;">format</span>(atoms.positions[-1])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now compute Hads</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_slab</span> = atoms.get_potential_energy()


<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-350'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">e_O2</span> = atoms.get_potential_energy()

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [e_bridge, e_slab, e_O2])

<span style="color: #BA36A5;">Hads_bridge</span> = e_bridge - e_slab - 0.5*e_O2

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Hads (bridge) = {0:1.3f} eV/O'</span>.<span style="color: #006FE0;">format</span>(Hads_bridge)
</pre>
</div>

<pre class="example">
Initial O position: [  1.38592929   0.          15.72642611]
Final O position  : [  1.38592929   0.          15.9685262 ]
Hads (bridge) = -0.512 eV/O
</pre>

<p>
You can see that only the \(z\)-position of the O atom changed. Also, the adsorption energy of O on the bridge site is <b>much</b> less favorable than on the fcc or hcp sites.
</p>


<div class="figure">
<p><img src="./images/Pt-O-bridge-constrained-initial.png" alt="Pt-O-bridge-constrained-initial.png" />
</p>
<p><span class="figure-number">Figure 85:</span> Initial state of the O atom on the bridge site.</p>
</div>


<div class="figure">
<p><img src="./images/Pt-O-bridge-constrained-final.png" alt="Pt-O-bridge-constrained-final.png" />
</p>
<p><span class="figure-number">Figure 86:</span> Final state of the constrained O atom, still on the bridge site.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline145" class="outline-4">
<h4 id="orgheadline145"><span class="section-number-4">5.8.2</span> Coverage dependence</h4>
<div class="outline-text-4" id="text-5-8-2">
<p>
The adsorbates on the surface can interact with each other which results in coverage dependent adsorption energies <a class='org-ref-reference' href="#PhysRevB.82.045414">PhysRevB.82.045414</a>. Coverage dependence is not difficult to model; we simply compute adsorption energies in different size unit cells, and/or with different adsorbate configurations. Here we consider dissociative oxygen adsorption at 1ML on Pt(111) in an fcc site, which is one oxygen atom in a \(1 \times 1\) unit cell.
</p>

<p>
For additional reading, see these references from our work:
</p>
<ul class="org-ul">
<li>Correlations of coverage dependence of oxygen adsorption on different metals <a class='org-ref-reference' href="#miller:104709">miller:104709</a>,<a class='org-ref-reference' href="#Miller2009794">Miller2009794</a></li>
<li>Coverage effects of atomic adsorbates on Pd(111) <a class='org-ref-reference' href="#PhysRevB.79.205412">PhysRevB.79.205412</a></li>
<li>Simple model for estimating coverage dependence <a class='org-ref-reference' href="#PhysRevB.82.045414">PhysRevB.82.045414</a></li>
<li>Coverage effects on alloys <a class='org-ref-reference' href="#PhysRevB.77.075437">PhysRevB.77.075437</a></li>
</ul>
</div>

<div id="outline-container-orgheadline149" class="outline-5">
<h5 id="orgheadline149"><span class="section-number-5">5.8.2.1</span> clean slab calculation</h5>
<div class="outline-text-5" id="text-5-8-2-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(1, 1, 3), vacuum=10.0)
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[<span style="color: #D0372D;">True</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

write(<span style="color: #008000;">'images/Pt-fcc-1ML.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab-1x1'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[8, 8, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-17.05903301
</pre>


<div class="figure">
<p><img src="./images/Pt-fcc-1ML.png" alt="Pt-fcc-1ML.png" />
</p>
<p><span class="figure-number">Figure 87:</span> 1 &times; 1 unit cell.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline150" class="outline-5">
<h5 id="orgheadline150"><span class="section-number-5">5.8.2.2</span> fcc site at 1 ML coverage</h5>
<div class="outline-text-5" id="text-5-8-2-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Pt'</span>, size=(1, 1, 3), vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note this function only works when atoms are created by the surface module.</span>
add_adsorbate(atoms, <span style="color: #008000;">'O'</span>, height=1.2, position=<span style="color: #008000;">'fcc'</span>)

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(constraint)

write(<span style="color: #008000;">'images/Pt-o-fcc-1ML.png'</span>, atoms, show_unit_cell=2)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Pt-slab-1x1-O-fcc'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[8, 8, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=25,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-22.13585728
</pre>


<div class="figure">
<p><img src="./images/Pt-o-fcc-1ML.png" alt="Pt-o-fcc-1ML.png" />
</p>
<p><span class="figure-number">Figure 88:</span> 1 ML oxygen in the fcc site.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline152" class="outline-5">
<h5 id="orgheadline152"><span class="section-number-5">5.8.2.3</span> Adsorption energy at 1ML</h5>
<div class="outline-text-5" id="text-5-8-2-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">e_slab_o</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-1x1-O-fcc'</span>).potential_energy

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">clean slab</span>
<span style="color: #BA36A5;">e_slab</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-1x1'</span>).potential_energy

<span style="color: #BA36A5;">e_O2</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-350'</span>).potential_energy

<span style="color: #BA36A5;">hads</span> = e_slab_o - e_slab - 0.5 * e_O2
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Hads (1ML) = {0:1.3f} eV'</span>.<span style="color: #006FE0;">format</span>(hads)
</pre>
</div>

<pre class="example">
Hads (1ML) = -0.099 eV
</pre>

<p>
The adsorption energy is <b>much</b> less favorable at 1ML coverage than at 0.25 ML coverage! We will return what this means in <a href="#orgheadline151">Atomistic thermodynamics effect on adsorption</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline153" class="outline-4">
<h4 id="orgheadline153"><span class="section-number-4">5.8.3</span> Effect of adsorption on the surface energy</h4>
<div class="outline-text-4" id="text-5-8-3">
<p>
There is a small point to make here about what adsorption does to surface energies. Let us define a general surface formation energy scheme like this:
</p>


<div class="figure">
<p><img src="./images/adsorbate-surface-energy.png" alt="adsorbate-surface-energy.png" />
</p>
<p><span class="figure-number">Figure 89:</span> Schematic of forming a surface with adsorbates. First we form two clean surfaces by cleaving the bulk, then allow adsorption to occur on the surfaces.</p>
</div>

<p>
Let us presume the surfaces are symmetric, and that each surface contributes half of the energy change. The overall change in energy:
</p>

<p>
\(\Delta E = E_{slab,ads} - E_{ads} - E_{bulk}\)
</p>

<p>
where the the energies are appropriately normalized for the stoichiometry. Let us rearrange the terms, and add and subtract a constant term \(E_{slab}\).
</p>

<p>
\(\Delta E = E_{slab,ads} - E_{slab} - E_{ads} - E_{bulk} + E_{slab}\)
</p>

<p>
We defined \(\gamma_{clean} = \frac{1}{2A}(E_{slab} - E_{bulk})\), and we defined \(H_{ads} = E_{slab,ads} - E_{slab} - E_{ads}\) for adsorption on a single side of a slab. In this case, there are adsorbates on both sides of the slab, so \(E_{slab,ads} - E_{slab} - E_{ads} = 2 \Delta H_{ads}\). If we normalize by \(2A\), the area for both sides of the slab, we get
</p>

<p>
\(\frac{\Delta E}{2A} = \gamma = \gamma_{clean} + \frac{H_{ads}}{A}\)
</p>

<p>
You can see here that the adsorption energy serves to stabilize, or reduce the surface energy, provided that the adsorption energy is negative.
</p>

<p>
Some final notes about the equations above:
</p>

<ul class="org-ul">
<li>We were not careful about stoichiometry. As written, it is assumed there are the same number of atoms (not including the adsorbates) in the slabs and bulk, and the same number of adsorbate atoms in the slab and \(E_{ads}\). Appropriate normalization factors must be included if that is not true.</li>

<li>It is not necessary to perform a symmetric slab calculation to determine the effect of adsorption on the surface energy! You can examine \(\gamma - \gamma_{clean}\) with knowledge of only the adsorption energies!</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline156" class="outline-3">
<h3 id="orgheadline156"><span class="section-number-3">5.9</span> Adsorbate vibrations</h3>
<div class="outline-text-3" id="text-5-9">
<p>
Adsorbates also have vibrational modes. Unlike a free molecule, the translational and rotational modes of an adsorbate may actually have real frequencies. Sometimes they are called frustrated translations or rotations. For metal surfaces with adsorbates, it is common to only compute vibrational modes of the adsorbate on a frozen metal slab. The rationale is that the metal atoms are so much heavier than the adsorbate that there will be little coupling between the surface and adsorbates. You can limit the number of modes calculated with constraints (<a href="ase.constraints.FixAtoms">ase.constraints.FixAtoms</a> or <a href="ase.constraints.FixScaled">ase.constraints.FixScaled</a>) if you use <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IBRION>IBRION</a>=5. The other IBRION settings (6, 7, 8) do not respect the selective dynamics constraints. Below we consider the vibrational modes of an oxygen atom in an fcc site on Pt(111).
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc'</span>)
calc.clone(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc-vib'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=5,     <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">finite differences with selective dynamics</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2,      <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">central differences (default)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.015,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">default as well</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ediff=1e-8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">f</span>, <span style="color: #BA36A5;">v</span> = calc.get_vibrational_modes(0)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Elapsed time = {0} seconds'</span>.<span style="color: #006FE0;">format</span>(calc.get_elapsed_time())
<span style="color: #BA36A5;">allfreq</span> = calc.get_vibrational_modes()[0]

<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> meV
<span style="color: #BA36A5;">c</span> = 3e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cm/s</span>
<span style="color: #BA36A5;">h</span> = 4.135667516e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV*s</span>

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(f)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational energy = {0} meV'</span>.<span style="color: #006FE0;">format</span>(f/meV)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational freq   = {0} 1/s'</span>.<span style="color: #006FE0;">format</span>(f/h)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational freq   = {0} cm^{{-1}}'</span>.<span style="color: #006FE0;">format</span>(f/(h*c))
<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'All energies = '</span>, allfreq
</pre>
</div>

<p>
There are three modes for the free oxygen atom. One of them is a mode normal to the surface (the one with highest frequency. The other two are called frustrated translations. Note that we did not include the surface Pt atoms in the calculation, and this will have an effect on the result because the O atom could be coupled to the surface modes. It is typical to neglect this coupling because of the large difference in mass between O and Pt.  Next we look at the difference in results when we calculate all the modes.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc'</span>)
calc.clone(<span style="color: #008000;">'Pt-slab-O-fcc-vib-ibrion=6'</span>)
calc.<span style="color: #006FE0;">set</span>(ibrion=6,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">finite differences with symmetry</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">central differences (default)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.015,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">default as well</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ediff=1e-8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1)
calc.update()
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Elapsed time = {0} seconds'</span>.<span style="color: #006FE0;">format</span>(calc.get_elapsed_time())

<span style="color: #BA36A5;">f</span>, <span style="color: #BA36A5;">m</span> = calc.get_vibrational_modes(0)
<span style="color: #BA36A5;">allfreq</span> = calc.get_vibrational_modes()[0]

<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> meV
<span style="color: #BA36A5;">c</span> = 3e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cm/s</span>
<span style="color: #BA36A5;">h</span> = 4.135667516e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV*s</span>

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'For mode 0:'</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(f)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational energy = {0} meV'</span>.<span style="color: #006FE0;">format</span>(f / meV)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational freq   = {0} 1/s'</span>.<span style="color: #006FE0;">format</span>(f / h)
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'vibrational freq   = {0} cm^{{-1}}'</span>.<span style="color: #006FE0;">format</span>(f / (h * c))
<span style="color: #0000FF;">print</span>
<span style="color: #0000FF;">print</span> <span style="color: #008000;">'All energies = '</span>, allfreq
</pre>
</div>

<pre class="example">
Elapsed time = 77121.015 seconds
For mode 0:
vibrational energy = 0.063537929 eV
vibrational energy = 63.537929 meV
vibrational freq   = 1.53634035507e+13 1/s
vibrational freq   = 512.113451691 cm^{-1}

All energies =  [0.06353792899999999, 0.045628623, 0.045628623, 0.023701702, 0.023701702, 0.023223747, 0.022978233, 0.022978233, 0.022190167, 0.021807461, 0.02040119, 0.02040119, 0.019677135000000002, 0.015452848, 0.015302098000000002, 0.015302098000000002, 0.0148412, 0.0148412, 0.014071851000000002, 0.012602063, 0.012602063, 0.012409611999999999, 0.012300973000000002, 0.011735683, 0.011735683, 0.011714521, 0.011482183, 0.011482183, 0.010824891, 0.010414177, 0.010414177, 0.009799697, 0.00932905, 0.00932905, 0.003859079, 0.003859079, (2.9894000000000002e-05+0j), (2.9894000000000002e-05+0j), (0.00012182999999999999+0j)]
</pre>



<p>
Note that now there are 39 modes, which is 3*N where N=13 atoms in the unit cell. Many of the modes are low in frequency, which correspond to slab modes that are essentially phonons. The O frequencies are not that different from the previous calculation (497 vs 512 cm\(^{-1}\). This is why it is common to keep the slab atoms frozen.
</p>

<p>
Calculating these results took 39*2 finite differences. It took about a day to get these results on a single CPU. It pays to use constraints to minimize the number of these calculations.
</p>
</div>


<div id="outline-container-orgheadline155" class="outline-4">
<h4 id="orgheadline155"><span class="section-number-4">5.9.1</span> Vibrations of the bridge site</h4>
<div class="outline-text-4" id="text-5-9-1">
<p>
Here we consider the vibrations of an O atom in a bridge site, which we saw earlier is a metastable saddle point.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">clone calculation so we do not overwrite previous results</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge-xy-constrained'</span>)
calc.clone(<span style="color: #008000;">'surfaces/Pt-slab-O-bridge-vib'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=5,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">finite differences with selective dynamics</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nfree=2,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">central differences (default)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>potim=0.015,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">default as well</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ediff=1e-8,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=1)

<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">del</span> atoms.constraints
<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=[atom.symbol != <span style="color: #008000;">'O'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint([constraint])

<span style="color: #BA36A5;">f</span>, <span style="color: #BA36A5;">v</span> = calc.get_vibrational_modes(2)
<span style="color: #0000FF;">print</span>(calc.get_vibrational_modes()[0])

<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> meV
<span style="color: #BA36A5;">c</span> = 3e10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cm/s</span>
<span style="color: #BA36A5;">h</span> = 4.135667516e-15  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">eV*s</span>

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'vibrational energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(f))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'vibrational energy = {0} meV'</span>.<span style="color: #006FE0;">format</span>(f/meV))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'vibrational freq   = {0} 1/s'</span>.<span style="color: #006FE0;">format</span>(f/h))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'vibrational freq   = {0} cm^(-1)'</span>.<span style="color: #006FE0;">format</span>(f/(h*c)))
</pre>
</div>

<pre class="example">
[0.06691932, 0.047345270999999994, (0.020649715000000003+0j)]
vibrational energy = (0.020649715+0j) eV
vibrational energy = (20.649715+0j) meV
vibrational freq   = (4.99307909065e+12+0j) 1/s
vibrational freq   = (166.435969688+0j) cm^(-1)
</pre>

<p>
Note that we have one imaginary mode. This corresponds to the motion of the O atom falling into one of the neighboring 3-fold sites. It also indicates this position is not a stable minimum, but rather a saddle point. This position is a transition state for hopping between the fcc and hcp sites.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline160" class="outline-3">
<h3 id="orgheadline160"><span class="section-number-3">5.10</span> Surface Diffusion barrier</h3>
<div class="outline-text-3" id="text-5-10">
<p>
See this review <a class='org-ref-reference' href="#ANIE.ANIE200602223">ANIE.ANIE200602223</a> of diffusion on transition metal surfaces.
</p>
</div>

<div id="outline-container-orgheadline157" class="outline-4">
<h4 id="orgheadline157"><span class="section-number-4">5.10.1</span> Standard nudged elastic band method</h4>
<div class="outline-text-4" id="text-5-10-1">
<p>
Here we illustrate a standard NEB method. You need an initial and final state to start with. We will use the results from previous calculations of oxygen atoms in an fcc and hcp site. then we will construct a band of images connecting these two sites. Finally, we let VASP optimize the band and analyze the results to get the barrier.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.neb <span style="color: #0000FF;">import</span> NEB
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-fcc'</span>)
<span style="color: #BA36A5;">initial_atoms</span> = calc.get_atoms()

<span style="color: #BA36A5;">final_atoms</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-slab-O-hcp'</span>).get_atoms()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">here is our estimated transition state. we use vector geometry to</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">define the bridge position, and add 1.451 Ang to z based on our</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">previous bridge calculation. The bridge position is half way between</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms 9 and 10.</span>
<span style="color: #BA36A5;">ts</span> = initial_atoms.copy()
<span style="color: #BA36A5;">ts.positions</span>[-1] = 0.5 * (ts.positions[9] + ts.positions[10]) + [0, 0, 1.451]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">construct the band</span>
<span style="color: #BA36A5;">images</span> = [initial_atoms]
<span style="color: #BA36A5;">images</span> += [initial_atoms.copy()]
<span style="color: #BA36A5;">images</span> += [ts.copy()]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is the TS</span>

<span style="color: #BA36A5;">neb</span> = NEB(images)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Interpolate linearly the positions of these images:</span>
neb.interpolate()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now add the second half</span>
<span style="color: #BA36A5;">images2</span> = [ts.copy()]
<span style="color: #BA36A5;">images2</span> += [ts.copy()]
<span style="color: #BA36A5;">images2</span> += [final_atoms]

<span style="color: #BA36A5;">neb2</span> = NEB(images2)
neb2.interpolate()

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">collect final band. Note we do not repeat the TS in the second half</span>
<span style="color: #BA36A5;">final_images</span> = images + images2[1:]


<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-O-fcc-hcp-neb'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=90,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   spring=-5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=final_images)

<span style="color: #BA36A5;">images</span>, <span style="color: #BA36A5;">energies</span> = calc.get_neb()
<span style="color: #BA36A5;">p</span> = calc.plot_neb(show=<span style="color: #D0372D;">False</span>)
plt.savefig(<span style="color: #008000;">'images/pt-o-fcc-hcp-neb.png'</span>)
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book/surfaces/Pt-O-fcc-hcp-neb submitted: 1400536.gilgamesh.cheme.cmu.edu
[None, None, None, None, None]
</pre>


<div class="figure">
<p><img src="./images/pt-o-fcc-hcp-neb.png" alt="pt-o-fcc-hcp-neb.png" />
</p>
<p><span class="figure-number">Figure 90:</span> Energy pathway for O diffusion from an fcc to hcp site with a spline fit to determine the barrier.</p>
</div>

<p>
We should compare this barrier to what we could estimate from the simple adsorption energies in the fcc and bridge sites. The adsorption energy in the fcc site was -1.04 eV, and in the bridge site was -0.49 eV. The difference between these two is 0.55 eV, which is very close to the calculated barrier from the NEB calculation. In cases where you can determine what the transition state is, e.g. by symmetry, or other means, it is much faster to directly compute the energy of the initial and transition states for barrier determinations. This is not usually possible though.
</p>
</div>
</div>

<div id="outline-container-orgheadline158" class="outline-4">
<h4 id="orgheadline158"><span class="section-number-4">5.10.2</span> Climbing image NEB</h4>
<div class="outline-text-4" id="text-5-10-2">
<p>
One issue with the standard NEB method is there is no image that is exactly at the transition state. That means there is some uncertainty of the true energy of the transition state, and there is no way to verify the transition state by vibrational analysis. The climbing image NEB method <a class='org-ref-reference' href="#henkelman:9901">henkelman:9901</a> solves that problem by making one image climb to the top. You set <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LCLIMB>LCLIMB</a>==True= in <code>Vasp</code> to turn on the climbing image method. Here we use the previous calculation as a starting point and turn on the climbing image method.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">perform a climbing image NEB calculation</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'surfaces/Pt-O-fcc-hcp-neb'</span>)
calc.clone(<span style="color: #008000;">'surfaces/Pt-O-fcc-hcp-cineb'</span>)
calc.<span style="color: #006FE0;">set</span>(ichain=0, lclimb=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">images</span>, <span style="color: #BA36A5;">energies</span> = calc.get_neb()
calc.plot_neb(show=<span style="color: #D0372D;">False</span>)
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.savefig(<span style="color: #008000;">'images/pt-o-cineb.svg'</span>)
plt.show()
</pre>
</div>


<div class="figure">
<p><object type="image/svg+xml" data="./images/pt-o-cineb.svg" >
Sorry, your browser does not support SVG.</object>
</p>
<p><span class="figure-number">Figure 91:</span> Climbing image NEB</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline159" class="outline-4">
<h4 id="orgheadline159"><span class="section-number-4">5.10.3</span> Using vibrations to confirm a transition state</h4>
<div class="outline-text-4" id="text-5-10-3">
<p>
A transition state should have exactly one imaginary degree of freedom which corresponds to the mode that takes reactants to products. See <a href="#orgheadline155">Vibrations of the bridge site</a> for an example.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline164" class="outline-2">
<h2 id="orgheadline164"><a id="ID-b0b88efb-138d-4a22-bbc9-4b763b69b264"></a><span class="section-number-2">6</span> Atomistic thermodynamics</h2>
<div class="outline-text-2" id="text-6">
<p>
<a href="atomistic thermodynamics">atomistic thermodynamics</a>
Let us consider how much the Gibbs free energy of an O<sub>2</sub> molecule changes as a function of temperature, at 1 atm. We use the Shomate polynomials to approximate the temperature dependent entropy and enthalpy, and use the parameters from the <a href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7782447&amp;Units=SI&amp;Mask=1#Thermo-Gas">NIST Webbook</a> for O<sub>2</sub>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *
<span style="color: #BA36A5;">K</span> = 1.0

<span style="color: #0000FF;">print</span> J, mol, K

<span style="color: #0000FF;">print</span> 0.100 * kJ / mol / K

<span style="color: #0000FF;">print</span> 1 * eV / (kJ / mol)
</pre>
</div>

<pre class="example">
6.24150912588e+18 6.022140857e+23 1.0
0.00103642695747
96.4853328825
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *
<span style="color: #BA36A5;">K</span> = 1.  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Kelvin not defined in ase.units!</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Shomate parameters</span>
<span style="color: #BA36A5;">A</span> = 31.32234; <span style="color: #BA36A5;">B</span> = -20.23531; <span style="color: #BA36A5;">C</span> = 57.86644
<span style="color: #BA36A5;">D</span> = -36.50624; <span style="color: #BA36A5;">E</span> = -0.007374; <span style="color: #BA36A5;">F</span> = -8.903471
<span style="color: #BA36A5;">G</span> = 246.7945; <span style="color: #BA36A5;">H</span> = 0.0


<span style="color: #0000FF;">def</span> <span style="color: #006699;">entropy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''entropy returned as eV/K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   T in K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T / 1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">s</span> = (A * np.log(t) + B * t + C * (t**2) / 2.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D * (t**3) / 3. - E / (2. * t**2) + G)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> s * J / mol / K


<span style="color: #0000FF;">def</span> <span style="color: #006699;">enthalpy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">''' H - H(298.15) returned as eV/molecule'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T / 1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">h</span> = (A * t + B * (t**2) / 2. + C * (t**3) / 3.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D * (t**4) / 4. - E / t + F - H)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> h * kJ / mol

<span style="color: #BA36A5;">T</span> = np.linspace(10, 700)

<span style="color: #BA36A5;">G</span> = enthalpy(T) - T * entropy(T)

plt.plot(T, G)
plt.xlabel(<span style="color: #008000;">'Temperature (K)'</span>)
plt.ylabel(r<span style="color: #008000;">'$\Delta G^\circ$ (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/O2-mu.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/O2-mu.png" alt="O2-mu.png" />
</p>
<p><span class="figure-number">Figure 92:</span> Effect of temperature on the Gibbs free energy of an O_2 molecule at standard state (1 atm).</p>
</div>

<p>
This is clearly a big effect! Between 500-600K, the energy has dropped by nearly 1 eV.
</p>

<p>
Pressure also affects the free energy. In the ideal gas limit, the pressure changes the free energy by \(k T \ln P/P_0\) where \(P_0\) is the standard state pressure (1 atm or 1 bar depending on the convention chosen). Let us see how this affects the free energy at different temperatures.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">atm</span> = 101325 * Pascal <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">atm is not defined in units</span>
<span style="color: #BA36A5;">K</span> = 1 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Kelvin</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">examine range over 10^-10 to 10^10 atm</span>
<span style="color: #BA36A5;">P</span> = np.logspace(-10, 10) * atm

plt.semilogx(P / atm, kB * (300 * K) * np.log(P / (1 * atm)), label=<span style="color: #008000;">'300K'</span>)
plt.semilogx(P / atm, kB * (600 * K) * np.log(P / (1 * atm)), label=<span style="color: #008000;">'600K'</span>)
plt.xlabel(<span style="color: #008000;">'Pressure (atm)'</span>)
plt.ylabel(r<span style="color: #008000;">'$\Delta G$ (eV)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/O2-g-p.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/O2-g-p.png" alt="O2-g-p.png" />
</p>
<p><span class="figure-number">Figure 93:</span> Effects of pressure on the ideal gas Gibbs free energy of O\(_2\).</p>
</div>

<p>
Similarly, you can see that simply changing the pressure has a large effect on the Gibbs free energy of an ideal gas through the term: \(kT\ln(P/P_0)\), and that this effect is also temperature dependent. This leads us to the final formula we will use for the chemical potential of oxgyen:
</p>

<p>
\(\mu_{O_2} = E_{O_2}^{DFT} + E_{O_2}^{ZPE} + \Delta \mu (T) + kT \ln(P/P_0)\)
</p>

<p>
We can use \(\mu_{O_2}\) in place of \(E_{O_2}\) everywhere to include the effects of pressure and temperature on <i>the gas phase</i> energy. If T=0K, and P=1 bar, we are at standard state, and this equation reduces to the DFT energy (+ the ZPE).
</p>
</div>

<div id="outline-container-orgheadline162" class="outline-3">
<h3 id="orgheadline162"><span class="section-number-3">6.1</span> Bulk phase stability of oxides</h3>
<div class="outline-text-3" id="text-6-1">
<p>
We will consider the effects of oxygen pressure and temperature on the formation energy of Ag<sub>2</sub>O and Cu<sub>2</sub>O. For now, we neglect the effect of pressure and temperature on the solid phases. Neglecting pressure is pretty reasonable, as the solids are not that compressible, and we do not expect the energy to change for small pressures. For neglecting the temperature, we assume that the temperature dependence of the oxide is similar to the temperature dependence of the metal, and that these dependencies practically cancel each other in the calculations. That is an assumption, and it may not be correct.
</p>

<p>
\(2Cu + 1/2 O_2 \rightarrow Cu_2O\)
</p>

<p>
In atomistic thermodynamics, we define the free energy of formation as:
</p>

<p>
\(G_f = G_{Cu_2O} -2G_{Cu} - 0.5 G_{O_2}\)
</p>

<p>
We will at this point assume that the solids are incompressible so that \(p\Delta V \approx 0\), and that \(S_{Cu_2O} -2S_{Cu} \approx 0\), which leads to \(G_{Cu_2O} -2G_{Cu} \approx E_{Cu_2O} -2E_{Cu}\), which we directly compute from DFT. We express \(G_{O_2} = \mu_{O_2} = E_{O_2}^{DFT} + E_{O_2}^{ZPE} + \Delta \mu (T) + kT \ln(P/P_0)\). In this example we neglect the zero-point energy of the oxygen molecule, and finally arrive at:
</p>

<p>
\(G_f \approx E_{Cu_2O} -2E_{Cu} - 0.5 (E_{O_2}^{DFT} + \Delta \mu (T) + kT \ln(P/P_0))\)
</p>

<p>
Which, after grouping terms is:
</p>

<p>
\(G_f \approx E_{Cu_2O} -2E_{Cu} - 0.5 (E_{O_2}^{DFT}) - 0.5*\Delta \mu_{O_2}(P,T)\)
</p>

<p>
with \(\Delta \mu_{O_2}(P,T) = \Delta \mu (T) + kT \ln(P/P_0)\). We get \(\Delta \mu (T)\) from the Janaf Tables, or the NIST Webbook.
</p>

<ul class="org-ul">
<li>we are explicitly neglecting all entropies of the solid: configurational, vibrational and electronic</li>

<li>we also neglect enthalpic contributions from temperature dependent electronic and vibrational states</li>
</ul>

<p>
You will recognize in this equation the standard formation energy we calculated in <a href="#orgheadline98">Metal oxide oxidation energies </a>plus a correction for the non standard state pressure and temperature (\(\Delta \mu_{O_2}(P,T) = 0\) at standard state).
</p>


<p>
\(G_f \approx H_f - 0.5*\Delta \mu_{O_2}(P, T)\)
</p>


<p>
The <a href="http://materialsproject.org/materials/361/">formation energy</a> of Cu<sub>2</sub>O is -1.9521 eV/formula unit. The <a href="http://materialsproject.org/materials/353/">formation energy</a> for Ag<sub>2</sub>O is -0.99 eV/formula unit. Let us consider what temperature the oxides decompose at a fixed oxygen pressure of 1\(\times 10^{-10}\) atm. We need to find the temperature where:
</p>

<p>
\(H_f = 0.5*\Delta \mu_{O_2}(P, T)\)
</p>

<p>
which will make the formation energy be 0.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fsolve

<span style="color: #BA36A5;">K</span> = 1. <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">not defined in ase.units!</span>
<span style="color: #BA36A5;">atm</span> = 101325 * Pascal

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Shomate parameters valid from 100-700K</span>
<span style="color: #BA36A5;">A</span> = 31.32234; <span style="color: #BA36A5;">B</span> = -20.23531; <span style="color: #BA36A5;">C</span> = 57.86644
<span style="color: #BA36A5;">D</span> = -36.50624; <span style="color: #BA36A5;">E</span> = -0.007374; <span style="color: #BA36A5;">F</span> = -8.903471
<span style="color: #BA36A5;">G</span> = 246.7945; <span style="color: #BA36A5;">H</span> = 0.0


<span style="color: #0000FF;">def</span> <span style="color: #006699;">entropy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''entropy returned as eV/K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   T in K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T/1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">s</span> = (A * np.log(t) + B * t + C * (t**2) / 2.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D * (t**3) / 3. - E / (2. * t**2) + G)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> s * J / mol / K


<span style="color: #0000FF;">def</span> <span style="color: #006699;">enthalpy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">''' H - H(298.15) returned as eV/molecule'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T / 1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">h</span> = (A * t + B * (t**2) / 2. + C * (t**3) / 3.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D * (t**4) / 4. - E / t + F - H)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> h * kJ / mol


<span style="color: #0000FF;">def</span> <span style="color: #006699;">DeltaMu</span>(T, P):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   returns delta chemical potential of oxygen at T and P</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   T in K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   P in atm</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> enthalpy(T) - T * entropy(T) + kB * T * np.log(P / atm)

<span style="color: #BA36A5;">P</span> = 1e-10*atm


<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'Cu2O'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> -1.95 - 0.5*DeltaMu(T, P)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Cu2O decomposition temperature is {0:1.0f} K'</span>.<span style="color: #006FE0;">format</span>(fsolve(func,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  900)[0])

<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'Ag2O'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> -0.99 - 0.5 * DeltaMu(T, P)

<span style="color: #0000FF;">print</span> <span style="color: #008000;">'Ag2O decomposition temperature is {0:1.0f} K'</span>.<span style="color: #006FE0;">format</span>(fsolve(func,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  470)[0])


<span style="color: #BA36A5;">T</span> = np.linspace(100, 1000)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Here we plot delta mu as a function of temperature at different pressures</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you have use \\times to escape the first \ in pyplot</span>
plt.plot(T, DeltaMu(T, 1e10*atm), label=r<span style="color: #008000;">'1$\times 10^{10}$ atm'</span>)
plt.plot(T, DeltaMu(T, 1e5*atm), label=r<span style="color: #008000;">'1$\times 10^5$ atm'</span>)
plt.plot(T, DeltaMu(T, 1*atm), label=<span style="color: #008000;">'1 atm'</span>)
plt.plot(T, DeltaMu(T, 1e-5*atm), label=r<span style="color: #008000;">'1$\times 10^{-5}$ atm'</span>)
plt.plot(T, DeltaMu(T, 1e-10*atm), label=r<span style="color: #008000;">'1$\times 10^{-10}$ atm'</span>)

plt.xlabel(<span style="color: #008000;">'Temperature (K)'</span>)
plt.ylabel(r<span style="color: #008000;">'$\Delta \mu_{O_2}(T,p)$ (eV)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/O2-mu-diff-p.png'</span>)
</pre>
</div>

<pre class="example">
Cu2O decomposition temperature is 917 K
Ag2O decomposition temperature is 478 K
</pre>


<div class="figure">
<p><img src="./images/O2-mu-diff-p.png" alt="O2-mu-diff-p.png" />
</p>
<p><span class="figure-number">Figure 94:</span> &Delta; \(\mu_{O_2}\)(T,p) at different pressures and temperatures. \label{fig:mu-o2}</p>
</div>


<p>
Now, let us make a phase diagram that shows the boundary between silver oxide, and silver metal in P and T space.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fsolve

<span style="color: #BA36A5;">K</span> = 1. <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">not defined in ase.units!</span>
<span style="color: #BA36A5;">atm</span> = 101325*Pascal

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Shomate parameters valid from 100-700K</span>
<span style="color: #BA36A5;">A</span> = 31.32234; <span style="color: #BA36A5;">B</span> = -20.23531; <span style="color: #BA36A5;">C</span> = 57.86644
<span style="color: #BA36A5;">D</span> = -36.50624; <span style="color: #BA36A5;">E</span> = -0.007374; <span style="color: #BA36A5;">F</span> = -8.903471
<span style="color: #BA36A5;">G</span> = 246.7945; <span style="color: #BA36A5;">H</span> = 0.0


<span style="color: #0000FF;">def</span> <span style="color: #006699;">entropy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''entropy returned as eV/K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   T in K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T/1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">s</span> = (A*np.log(t) + B*t + C*(t**2)/2.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D*(t**3)/3. - E/(2.*t**2) + G)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> s*J/mol/K


<span style="color: #0000FF;">def</span> <span style="color: #006699;">enthalpy</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">''' H - H(298.15) returned as eV/molecule'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">t</span> = T/1000.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">h</span> = (A*t + B*(t**2)/2. + C*(t**3)/3.
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ D*(t**4)/4. - E/t + F - H)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> h*kJ/mol


<span style="color: #0000FF;">def</span> <span style="color: #006699;">DeltaMu</span>(T, P):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   T in K</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   P in atm</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> enthalpy(T) - T * entropy(T) + kB * T * np.log(P / atm)

<span style="color: #BA36A5;">P</span> = np.logspace(-11, 1, 10) * atm
<span style="color: #BA36A5;">T</span> = []
<span style="color: #0000FF;">for</span> p <span style="color: #0000FF;">in</span> P:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(T):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> -0.99 - 0.5 * DeltaMu(T, p)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   T.append(fsolve(func, 450)[0])

plt.semilogy(T, P / atm)
plt.xlabel(<span style="color: #008000;">'Temperature (K)'</span>)
plt.ylabel(<span style="color: #008000;">'Pressure (atm)'</span>)
plt.text(800, 1e-7, <span style="color: #008000;">'Ag'</span>)
plt.text(600, 1e-3, <span style="color: #008000;">'Ag$_2$O'</span>)
plt.savefig(<span style="color: #008000;">'images/Ag2O-decomposition.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/Ag2O-decomposition.png" alt="Ag2O-decomposition.png" />
</p>
<p><span class="figure-number">Figure 95:</span> Temperature dependent decomposition pressure for Ag<sub>2</sub>O.</p>
</div>

<p>
This shows that at high temperature and low p<sub>O<sub>2</sub></sub> metallic silver is stable, but if the p<sub>O<sub>2</sub></sub> gets high enough, the oxide becomes thermodynamically favorable. Here is another way to look at it.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">K</span> = 1.  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">not defined in ase.units!</span>
<span style="color: #BA36A5;">atm</span> = 101325*Pascal
<span style="color: #BA36A5;">Hf</span> = -0.99

<span style="color: #BA36A5;">P</span> = 1 * atm

<span style="color: #BA36A5;">Dmu</span> = np.linspace(-4, 0)

<span style="color: #BA36A5;">Hf</span> = -0.99 - 0.5*Dmu

plt.plot(Dmu, Hf, label=<span style="color: #008000;">'Ag$_2$O'</span>)
plt.plot(Dmu, np.zeros(Hf.shape), label=<span style="color: #008000;">'Ag'</span>)
plt.xlabel(r<span style="color: #008000;">'$\Delta \mu_{O_2}$ (eV)'</span>)
plt.ylabel(<span style="color: #008000;">'$H_f$ (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/atomistic-thermo-hf-mu.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/atomistic-thermo-hf-mu.png" alt="atomistic-thermo-hf-mu.png" />
</p>
<p><span class="figure-number">Figure 96:</span> Dependence of the formation energy on the oxygen chemical potential.</p>
</div>

<p>
This graph shows graphically the \(\Delta \mu_{O_2}\) required to make the metal more stable than the oxide. Anything less than about -2 eV will have the metal more stable. That can be achieved by any one of the following combinations (graphically estimated from Figure <a href="#fig:mu-o2">fig:mu-o2</a>):
About 500K at 1\(\times 10^{-10}\) atm, 600K at 1\(\times 10^{-5}\) atm, 900K at 1atm, etc&#x2026;
</p>
</div>
</div>

<div id="outline-container-orgheadline151" class="outline-3">
<h3 id="orgheadline151"><a id="ID-6b509064-8e9d-44a0-ad86-f1302988c875"></a><span class="section-number-3">6.2</span> Effect on adsorption</h3>
<div class="outline-text-3" id="text-6-2">
<p>
We now consider the question: Given a pressure and temperature, what coverage would you expect on a surface? We saw earlier that adsorption energies depend on the site and coverage. We lso know the coverage depends on the pressure and temperature. Above some temperature, desorption occurs, and below some pressure adsorption will not be favorable. We seek to develop a quantitative method to determine those conditions.
</p>

<p>
We redefine the adsorption energy as:
</p>

<p>
\(\Delta G_{ads} \approx E_{slab, ads} - E_{slab} - \mu_{ads}\)
</p>

<p>
where again we neglect all contributions to the free energy of the slabs from vibrational energy and entropy, as well as configurational entropy if that is relevant. That leaves only the pressure and temperature dependence of the adsorbate, which we treat in the ideal gas limit.
</p>

<p>
We expand \(\mu_{ads}\) as \(E_{ads}+\Delta \mu(T,p)\), and thus:
</p>

<p>
\(\Delta G_{ads} \approx E_{slab, ads} - E_{slab} - E_{ads} -\Delta \mu(T,p)\)
</p>

<p>
or
</p>

<p>
\(\Delta G_{ads} \approx \Delta H_{ads} -\Delta \mu(T,p)\)
</p>

<p>
where \(\Delta H_{ads}\) is the adsorption energy we defined earlier. Now we can examine the effect of \(\Delta \mu(T,p)\) on the adsorption energies. We will use the adsorption energies for the oxygen on Pt(111) system we computed earlier:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 7:</span> Adsorption site dependence of adsorption energies of oxygen on Pt(111).</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">system</th>
<th scope="col" class="org-right">\(\Delta H (eV/O)\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">fcc (0.25 ML)</td>
<td class="org-right">-1.04</td>
</tr>

<tr>
<td class="org-left">hcp (0.25 ML)</td>
<td class="org-right">-0.60</td>
</tr>

<tr>
<td class="org-left">bridge (0.25 ML)</td>
<td class="org-right">-0.49</td>
</tr>

<tr>
<td class="org-left">fcc(1ML)</td>
<td class="org-right">-0.10</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">fcc25</span> = -1.04
<span style="color: #BA36A5;">hcp25</span> = -0.60
<span style="color: #BA36A5;">bridge25</span> = -0.49
<span style="color: #BA36A5;">fcc1</span> = -0.10

<span style="color: #BA36A5;">Dmu</span> = np.linspace(-4, 2)

plt.plot(Dmu, np.zeros(Dmu.shape), label=<span style="color: #008000;">'Pt(111)'</span>)
plt.plot(Dmu, 0.25 * (fcc25 - 0.5*Dmu), label=<span style="color: #008000;">'fcc - 0.25 ML'</span>)
plt.plot(Dmu, 0.25 * (hcp25 - 0.5*Dmu), label=<span style="color: #008000;">'hcp - 0.25 ML'</span>)
plt.plot(Dmu, 0.25 * (bridge25 - 0.5*Dmu), label=<span style="color: #008000;">'bridge - 0.25 ML'</span>)
plt.plot(Dmu, 1.0 * (fcc1 - 0.5*Dmu), label=<span style="color: #008000;">'fcc - 1.0 ML'</span>)

plt.xlabel(r<span style="color: #008000;">'$\Delta \mu O_2$ (eV)'</span>)
plt.ylabel(r<span style="color: #008000;">'$\Delta G_{ads}$ (eV/O)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/atomistic-thermo-adsorption.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/atomistic-thermo-adsorption.png" alt="atomistic-thermo-adsorption.png" />
</p>
<p><span class="figure-number">Figure 97:</span> Effect of oxygen chemical potential on the adsorption energy.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline163" class="outline-3">
<h3 id="orgheadline163"><span class="section-number-3">6.3</span> Atomistic therodynamics and multiple reactions</h3>
<div class="outline-text-3" id="text-6-3">
<p>
In <a class='org-ref-reference' href="#Inoglu2009188">Inoglu2009188</a> we considered multiple reactions in an atomistic thermodynamic framework. Let us consider these three reactions of dissociative adsorption of hydrogen and hydrogen disulfide, and consider how to compute the reaction energy for the third reaction.
</p>

<ol class="org-ol">
<li>\(H_2 + 2* \leftrightharpoons 2H*\)</li>

<li>\(H_2S + 2* \leftrightharpoons H* + SH*\)</li>

<li>\(SH* + * \leftrightharpoons S* + H*\)</li>
</ol>

<p>
The reaction energy of interest is \(E_{rxn} = \mu_{S*} + \mu{H*} - \mu{SH*}\) The question is, what are these chemical potentials? We would like them in terms of pressures and temperature, preferrably of molecules that can be approximated as ideal gases. By equilibrium arguments we can say that \(\mu_{H*} = \frac{1}{2} \mu_{H_2}\). It follows that at equilibrium:
</p>

<p>
\(\mu_{H*} + \mu_{SH*} = \mu_{H_2S}\) and \(\mu_{H*} + \mu_{S*} = \mu_{SH*}\).
</p>

<p>
From the first equation we have:
</p>

<p>
\(\mu_{SH*} = \mu_{H_2S} - \frac{1}{2}\mu_{H_2}\)
</p>

<p>
and from the second equation we have:
</p>

<p>
\(\mu_{S*} = \mu_{SH*} - \mu_{H*} = \mu_{H_2S} - \mu_{H_2}\).
</p>

<p>
Thus, the chemical potentials of all these three adsorbed species depend on the chemical potentials of two gas-phase species. The chemical potentials of each of these gases can be defined as:
</p>

<p>
\(\mu_{gas}(T,p) = E_{gas}(0K) + \delta \mu + kT\ln\left (p/p^0\right )\), as we have defined before, so that only simple DFT calculations are needed to estimate them.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline186" class="outline-2">
<h2 id="orgheadline186"><a id="ID-b003ab44-e1f3-4ccb-9ecc-baa8a67c62d5"></a><span class="section-number-2">7</span> Advanced electronic structure methods</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgheadline96" class="outline-3">
<h3 id="orgheadline96"><a id="ID-d4b89c02-f7a3-4233-bf70-1fd35169d01d"></a><span class="section-number-3">7.1</span> DFT+U</h3>
<div class="outline-text-3" id="text-7-1">
<p>
<a href="DFT+U">DFT+U</a>
</p>

<p>
<a href="http://cms.mpi.univie.ac.at/vasp/vasp/On_site_Coulomb_interaction_L_S_DA_U.html">VASP manual on DFT+U</a>
</p>

<p>
It can be difficult to find the lowest energy solutions with DFT+U. Some strategies for improving this are discussed in <a class='org-ref-reference' href="#PhysRevB.82.195128">PhysRevB.82.195128</a>.
</p>
</div>

<div id="outline-container-orgheadline169" class="outline-4">
<h4 id="orgheadline169"><span class="section-number-4">7.1.1</span> Metal oxide oxidation energies with DFT+U</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
We will reconsider here the reaction (see <a href="#orgheadline98">Metal oxide oxidation energies</a>) 2 Cu<sub>2</sub>O + O<sub>2</sub> \(\rightleftharpoons\) 4 CuO. We need to compute the energy of each species, now with DFT+U. In <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a> they use a U parameter of 4 eV for Cu which gave the best agreement with the experimental value. We will also try that.
</p>
</div>

<div id="outline-container-orgheadline165" class="outline-5">
<h5 id="orgheadline165"><span class="section-number-5">7.1.1.1</span> Cu<sub>2</sub>O calculation with U=4.0</h5>
<div class="outline-text-5" id="text-7-1-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">import</span> logging

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu2O'</span>)
calc.clone(<span style="color: #008000;">'bulk/Cu2O-U=4.0'</span>)

calc.<span style="color: #006FE0;">set</span>(ldau=<span style="color: #D0372D;">True</span>,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn DFT+U on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldautype=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">select simplified rotationally invariant option</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldau_luj={<span style="color: #008000;">'Cu'</span>:{<span style="color: #008000;">'L'</span>:2,  <span style="color: #008000;">'U'</span>:4.0, <span style="color: #008000;">'J'</span>:0.0},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'O'</span>:{<span style="color: #008000;">'L'</span>:-1, <span style="color: #008000;">'U'</span>:0.0, <span style="color: #008000;">'J'</span>:0.0}},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldauprint=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=-1,  <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">do not rerelax</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=0)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()

<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">print calc</span>
</pre>
</div>

<pre class="example">
-22.32504781
</pre>


<div class="org-src-container">

<pre class="src src-sh">grep -A 3 <span style="color: #008000;">"LDA+U is selected, type is set to LDAUTYPE"</span> bulk/Cu2O-U=4.0/OUTCAR
</pre>
</div>

<pre class="example">
LDA+U is selected, type is set to LDAUTYPE =  2
  angular momentum for each species LDAUL =     2   -1
  U (eV)           for each species LDAUU =   4.0  0.0
  J (eV)           for each species LDAUJ =   0.0  0.0
</pre>
</div>
</div>



<div id="outline-container-orgheadline166" class="outline-5">
<h5 id="orgheadline166"><span class="section-number-5">7.1.1.2</span> CuO calculation with U=4.0</h5>
<div class="outline-text-5" id="text-7-1-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuO'</span>)
calc.clone(<span style="color: #008000;">'bulk/CuO-U=4.0'</span>)

calc.<span style="color: #006FE0;">set</span>(ldau=<span style="color: #D0372D;">True</span>,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn DFT+U on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldautype=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">select simplified rotationally invariant option</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldau_luj={<span style="color: #008000;">'Cu'</span>:{<span style="color: #008000;">'L'</span>:2,  <span style="color: #008000;">'U'</span>:4.0, <span style="color: #008000;">'J'</span>:0.0},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'O'</span>:{<span style="color: #008000;">'L'</span>:-1, <span style="color: #008000;">'U'</span>:0.0, <span style="color: #008000;">'J'</span>:0.0}},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldauprint=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=-1,  <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">do not rerelax</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=0)

<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
</pre>
</div>

<pre class="example">
-16.91708676
</pre>
</div>
</div>

<div id="outline-container-orgheadline167" class="outline-5">
<h5 id="orgheadline167"><span class="section-number-5">7.1.1.3</span> <span class="todo TODO">TODO</span> Reaction energy calculation with DFT+U</h5>
<div class="outline-text-5" id="text-7-1-1-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu2O-U=4.0'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">cu2o_energy</span> = atoms.get_potential_energy() / (<span style="color: #006FE0;">len</span>(atoms) / 3)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuO-U=4.0'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">cuo_energy</span> = atoms.get_potential_energy() / (<span style="color: #006FE0;">len</span>(atoms) / 2)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure to use the same cutoff energy for the O2 molecule!</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-400'</span>)
<span style="color: #BA36A5;">o2_energy</span> = calc.results[<span style="color: #008000;">'energy'</span>]

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [cu2o_energy, cuo_energy, o2_energy])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">don't forget to normalize your total energy to a formula unit. Cu2O</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">has 3 atoms, so the number of formula units in an atoms is</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">len(atoms)/3.</span>

<span style="color: #BA36A5;">rxn_energy</span> = 4.0 * cuo_energy - o2_energy - 2.0 * cu2o_energy

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Reaction energy  = {0} eV'</span>.<span style="color: #006FE0;">format</span>(rxn_energy))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Corrected energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(rxn_energy - 1.36))
</pre>
</div>

<pre class="example">
Reaction energy  = 7.36775847 eV
Corrected energy = 6.00775847 eV
</pre>

<p>
This is still not in quantitative agreement with the result in <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a>, which at U=4 eV is about -3.14 eV (estimated from a graph). We have not applied the O\(_2\) correction here yet. In that paper, they apply a constant shift of -1.36 eV per O\(_2\). After we apply that correction, we agree within 0.12 eV, which is pretty good considering we have not checked for convergence.
</p>
</div>
</div>

<div id="outline-container-orgheadline168" class="outline-5">
<h5 id="orgheadline168"><span class="section-number-5">7.1.1.4</span> How much does U affect the reaction energy?</h5>
<div class="outline-text-5" id="text-7-1-1-4">
<p>
It is reasonable to consider how sensitive our results are to the U parameter. We do that here.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">for</span> U <span style="color: #0000FF;">in</span> [2.0, 4.0, 6.0]:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">Cu2O ########################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu2O'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.clone(<span style="color: #008000;">'bulk/Cu2O-U={0}'</span>.<span style="color: #006FE0;">format</span>(U))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.<span style="color: #006FE0;">set</span>(ldau=<span style="color: #D0372D;">True</span>,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn DFT+U on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldautype=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">select simplified rotationally invariant option</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldau_luj={<span style="color: #008000;">'Cu'</span>:{<span style="color: #008000;">'L'</span>:2,  <span style="color: #008000;">'U'</span>:U, <span style="color: #008000;">'J'</span>:0.0},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'O'</span>:{<span style="color: #008000;">'L'</span>:-1, <span style="color: #008000;">'U'</span>:0.0, <span style="color: #008000;">'J'</span>:0.0}},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldauprint=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=-1,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">do not rerelax</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=0)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms1</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cu2o_energy</span> = atoms1.get_potential_energy() / (<span style="color: #006FE0;">len</span>(atoms1) / 3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">CuO ########################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuO'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.clone(<span style="color: #008000;">'bulk/CuO-U={0}'</span>.<span style="color: #006FE0;">format</span>(U))


<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calc.<span style="color: #006FE0;">set</span>(ldau=<span style="color: #D0372D;">True</span>,   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">turn DFT+U on</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldautype=2,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">select simplified rotationally invariant option</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldau_luj={<span style="color: #008000;">'Cu'</span>:{<span style="color: #008000;">'L'</span>:2,  <span style="color: #008000;">'U'</span>:U, <span style="color: #008000;">'J'</span>:0.0},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">'O'</span>:{<span style="color: #008000;">'L'</span>:-1, <span style="color: #008000;">'U'</span>:0.0, <span style="color: #008000;">'J'</span>:0.0}},
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ldauprint=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>ibrion=-1,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">do not rerelax</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=0)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms2</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cuo_energy</span> = atoms2.get_potential_energy() / (<span style="color: #006FE0;">len</span>(atoms2) / 2)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">O2 ########################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">make sure to use the same cutoff energy for the O2 molecule!</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O2-sp-triplet-400'</span>)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">o2_energy</span> = atoms.get_potential_energy()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [cu2o_energy, cuo_energy, o2_energy]:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">rxn_energy</span> = (4.0 * cuo_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - o2_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> - 2.0 * cu2o_energy)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span> <span style="color: #008000;">'U = {0}  reaction energy = {1}'</span>.<span style="color: #006FE0;">format</span>(U, rxn_energy - 1.99)
</pre>
</div>

<pre class="example">
U = 2.0  reaction energy = 3.32752349
U = 4.0  reaction energy = 5.37775847
U = 6.0  reaction energy = 5.71849513
</pre>


<pre class="example">
U = 2.0  reaction energy = -3.876906
U = 4.0  reaction energy = -3.653819
U = 6.0  reaction energy = -3.397605
</pre>

<p>
In <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a>, the difference in reaction energy from U=2 eV to U=4 eV was about 0.5 eV (estimated from graph). Here we see a range of 0.48 eV from U=2 eV to U=4 eV. Note that for U=0 eV, we had a (corrected reaction energy of -3.96 eV). Overall, the effect of adding U decreases this reaction energy.
</p>

<p>
This example highlights the challenge of using an approach like DFT+U. On one hand, U has a clear effect of changing the reaction energy. On the other hand, so does the correction factor for the O\(_2\) binding energy. In <a class='org-ref-reference' href="#PhysRevB.73.195107">PhysRevB.73.195107</a> the authors tried to get the O\(_2\) binding energy correction from oxide calculations where U is not important, so that it is decoupled from the non-cancelling errors that U fixes. See <a class='org-ref-reference' href="#PhysRevB.84.045115">PhysRevB.84.045115</a> for additional discussion of how to mix GGA and GGA+U results.
</p>

<p>
In any case, you should be careful to use well converged results to avoid compensating for convergence errors with U.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline171" class="outline-3">
<h3 id="orgheadline171"><span class="section-number-3">7.2</span> Hybrid functionals</h3>
<div class="outline-text-3" id="text-7-2">
</div><div id="outline-container-orgheadline170" class="outline-4">
<h4 id="orgheadline170"><span class="section-number-4">7.2.1</span> FCC Ni DOS</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
This example is adapted from <a href="http://cms.mpi.univie.ac.at/wiki/index.php/FccNi_DOS">http://cms.mpi.univie.ac.at/wiki/index.php/FccNi_DOS</a>
<a href="HSE06">HSE06</a>
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic
<span style="color: #0000FF;">from</span> ase.dft <span style="color: #0000FF;">import</span> DOS

<span style="color: #BA36A5;">atoms</span> = FaceCenteredCubic(directions=[[0, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 0, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [1, 1, 0]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> symbol=<span style="color: #008000;">'Ni'</span>)
atoms[0]<span style="color: #BA36A5;">.magmom</span> = 1

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Ni-PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=-5,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[5, 5, 5],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lorbit=11,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lwave=<span style="color: #D0372D;">True</span>, lcharg=<span style="color: #D0372D;">True</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">store for reuse</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'PBE energy:   '</span>,e)
calc.stop_if(e <span style="color: #0000FF;">is</span> <span style="color: #D0372D;">None</span>)

<span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #BA36A5;">e_pbe</span> = dos.get_energies()
<span style="color: #BA36A5;">d_pbe</span> = dos.get_dos()


calc.clone(<span style="color: #008000;">'bulk/Ni-PBE0'</span>)
calc.<span style="color: #006FE0;">set</span>(xc=<span style="color: #008000;">'pbe0'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">pbe0_e</span> = atoms.get_potential_energy()

<span style="color: #0000FF;">if</span> atoms.get_potential_energy() <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e_pbe0</span> = dos.get_energies()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d_pbe0</span> = dos.get_dos()

<span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">HSE06</span>
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Ni-PBE'</span>)
calc.clone(<span style="color: #008000;">'bulk/Ni-HSE06'</span>)

calc.<span style="color: #006FE0;">set</span>(xc=<span style="color: #008000;">'hse06'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">hse06_e</span> = atoms.get_potential_energy()
<span style="color: #0000FF;">if</span> hse06_e <span style="color: #0000FF;">is</span> <span style="color: #0000FF;">not</span> <span style="color: #D0372D;">None</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dos</span> = DOS(calc, width=0.2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e_hse06</span> = dos.get_energies()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">d_hse06</span> = dos.get_dos()

calc.stop_if(<span style="color: #D0372D;">None</span> <span style="color: #0000FF;">in</span> [e, pbe0_e, hse06_e])

<span style="color: #0000FF;">import</span> pylab <span style="color: #0000FF;">as</span> plt
plt.plot(e_pbe, d_pbe, label=<span style="color: #008000;">'PBE'</span>)
plt.plot(e_pbe0, d_pbe0, label=<span style="color: #008000;">'PBE0'</span>)
plt.plot(e_hse06, d_hse06, label=<span style="color: #008000;">'HSE06'</span>)
plt.xlabel(<span style="color: #008000;">'energy [eV]'</span>)
plt.ylabel(<span style="color: #008000;">'DOS'</span>)
plt.legend()
plt.savefig(<span style="color: #008000;">'images/ni-dos-pbe-pbe0-hse06.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/ni-dos-pbe-pbe0-hse06.png" alt="ni-dos-pbe-pbe0-hse06.png" />
</p>
<p><span class="figure-number">Figure 98:</span> Comparison of DOS from GGA, and two hybrid GGAs (PBE0 and HSE06).</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline180" class="outline-3">
<h3 id="orgheadline180"><span class="section-number-3">7.3</span> van der Waals forces</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Older versions (5.2.11+) implement DFT+D2 <a class='org-ref-reference' href="#JCC-JCC20495">JCC-JCC20495</a> with the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LVDW>LVDW</a> tag.
</p>

<p>
The vdW-DF <a class='org-ref-reference' href="#klimes-2011-van-waals">klimes-2011-van-waals</a> is accessed with <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LUSE_VDW>LUSE_VDW</a>. See <a href="http://cms.mpi.univie.ac.at/vasp/vasp/vdW_DF_functional_Langreth_Lundqvist_et_al.html">http://cms.mpi.univie.ac.at/vasp/vasp/vdW_DF_functional_Langreth_Lundqvist_et_al.html</a> for notes on its usage.
</p>

<p>
In Vasp 5.3+, the <a href=http://cms.mpi.univie.ac.at/wiki/index.php/IVDW>IVDW</a> tag turns van der Waal calculations on.
</p>

<p>
You should review the links below before using these
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">IVDW</th>
<th scope="col" class="org-left">method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">0</td>
<td class="org-left">no correction</td>
</tr>

<tr>
<td class="org-left">1 or 10</td>
<td class="org-left"><a href="http://cms.mpi.univie.ac.at/vasp/vasp/DFT_D2_method.html">DFT-D2</a> method of Grimme (available as of VASP.5.2.11)</td>
</tr>

<tr>
<td class="org-left">11</td>
<td class="org-left">zero damping DFT-D3 method of Grimme (available as of VASP.5.3.4)</td>
</tr>

<tr>
<td class="org-left">12</td>
<td class="org-left"><a href="http://cms.mpi.univie.ac.at/vasp/vasp/DFT_D3_method.html">DFT-D3</a> method with Becke-Jonson damping (available as of VASP.5.3.4)</td>
</tr>

<tr>
<td class="org-left">2 or 20</td>
<td class="org-left"><a href="http://cms.mpi.univie.ac.at/vasp/vasp/Tkatchenko_Scheffler_method.html">Tkatchenko-Scheffler method</a> <a class='org-ref-reference' href="#tkatchenko-2009-accur-molec">tkatchenko-2009-accur-molec</a> (available as of VASP.5.3.3)</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>


<p>
Van der Waal forces can play a considerable role in binding of aromatic molecules to metal surfaces <a href="http://th.fhi-berlin.mpg.de/site/uploads/Publications/PRL_submitted_2012063-582-586-2012.pdf">(ref)</a>. Here we consider the effects of these forces on the adsorption energy of benzene on an Au(111) surface.First, we consider the regular PBE functional.
</p>
</div>


<div id="outline-container-orgheadline175" class="outline-4">
<h4 id="orgheadline175"><span class="section-number-4">7.3.1</span> PBE</h4>
<div class="outline-text-4" id="text-7-3-1">
</div><div id="outline-container-orgheadline172" class="outline-5">
<h5 id="orgheadline172"><span class="section-number-5">7.3.1.1</span> gas-phase benzene</h5>
<div class="outline-text-5" id="text-7-3-1-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">benzene</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
benzene.center(vacuum=5)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'molecules/benzene-pbe'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[1, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=benzene).potential_energy)
</pre>
</div>

<pre class="example">
-76.03718564
</pre>
</div>
</div>

<div id="outline-container-orgheadline173" class="outline-5">
<h5 id="orgheadline173"><span class="section-number-5">7.3.1.2</span> clean slab</h5>
<div class="outline-text-5" id="text-7-3-1-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the clean gold slab</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Au'</span>, size=(3,3,3), vacuum=10)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we constrain the slab</span>
<span style="color: #BA36A5;">c</span> = FixAtoms(mask=[atom.symbol==<span style="color: #008000;">'Au'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(c)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">from ase.visualize import view; view(atoms)</span>

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Au-pbe'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-81.22521492
</pre>
</div>
</div>

<div id="outline-container-orgheadline174" class="outline-5">
<h5 id="orgheadline174"><span class="section-number-5">7.3.1.3</span> benzene on Au(111)</h5>
<div class="outline-text-5" id="text-7-3-1-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Benzene on the slab</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Au'</span>, size=(3,3,3), vacuum=10)
<span style="color: #BA36A5;">benzene</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
benzene.translate(-benzene.get_center_of_mass())

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">I want the benzene centered on the position in the middle of atoms</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">20, 22, 23 and 25</span>
<span style="color: #BA36A5;">p</span> = (atoms.positions[20] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[22] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[23] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[25])/4.0 + [0.0, 0.0, 3.05]

benzene.translate(p)
<span style="color: #BA36A5;">atoms</span> += benzene

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we constrain the slab</span>
<span style="color: #BA36A5;">c</span> = FixAtoms(mask=[atom.symbol==<span style="color: #008000;">'Au'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(c)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">from ase.visualize import view; view(atoms)</span>

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Au-benzene-pbe'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book/surfaces/Au-benzene-pbe submitted: 1400531.gilgamesh.cheme.cmu.edu
None
</pre>

<p>
resubmitted
</p>
<pre class="example">
/home-research/jkitchin/dft-book/surfaces/Au-benzene-pbe submitted: 1399668.gilgamesh.cheme.cmu.edu
None
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">e1</span>, <span style="color: #BA36A5;">e2</span>, <span style="color: #BA36A5;">e3</span> = [Vasp(wd).potential_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">for</span> wd <span style="color: #0000FF;">in</span> [<span style="color: #008000;">'surfaces/Au-benzene-pbe'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">'surfaces/Au-pbe'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">'molecules/benzene-pbe'</span>]]


<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'PBE adsorption energy = {} eV'</span>.<span style="color: #006FE0;">format</span>(e1 - e2 - e3))
</pre>
</div>

<pre class="example">
PBE adsorption energy = 0.071056 eV
</pre>

<p>
This is a very weak energy. It is similar to the result in the reference (0.15 eV), and considerably weaker than the experiment. Next we consider one form of a VDW correction.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline179" class="outline-4">
<h4 id="orgheadline179"><span class="section-number-4">7.3.2</span> DFT-D2</h4>
<div class="outline-text-4" id="text-7-3-2">
<p>
To turn on the van der Waals corrections <a class='org-ref-reference' href="#JCC-JCC20495">JCC-JCC20495</a> we set <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LVDW>LVDW</a> to <code>True</code>.
</p>
</div>
<div id="outline-container-orgheadline176" class="outline-5">
<h5 id="orgheadline176"><span class="section-number-5">7.3.2.1</span> gas-phase benzene</h5>
<div class="outline-text-5" id="text-7-3-2-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">benzene</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
benzene.center(vacuum=5)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'molecules/benzene-pbe-d2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[1, 1, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> lvdw=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=benzene).potential_energy)
</pre>
</div>

<pre class="example">
/home-research/jkitchin/dft-book/molecules/benzene-pbe-d2 submitted: 1398397.gilgamesh.cheme.cmu.edu
/home-research/jkitchin/dft-book/molecules/benzene-pbe-d2 Queued: 1398397.gilgamesh.cheme.cmu.edu
None
</pre>
</div>
</div>

<div id="outline-container-orgheadline177" class="outline-5">
<h5 id="orgheadline177"><span class="section-number-5">7.3.2.2</span> clean slab</h5>
<div class="outline-text-5" id="text-7-3-2-2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the clean gold slab</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Au'</span>, size=(3, 3, 3), vacuum=10)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we constrain the slab</span>
<span style="color: #BA36A5;">c</span> = FixAtoms(mask=[atom.symbol==<span style="color: #008000;">'Au'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(c)

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Au-pbe-d2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> lvdw=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-106.34723065
</pre>
</div>
</div>

<div id="outline-container-orgheadline178" class="outline-5">
<h5 id="orgheadline178"><span class="section-number-5">7.3.2.3</span> benzene on Au(111)</h5>
<div class="outline-text-5" id="text-7-3-2-3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Benzene on the slab</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #BA36A5;">atoms</span> = fcc111(<span style="color: #008000;">'Au'</span>, size=(3,3,3), vacuum=10)
<span style="color: #BA36A5;">benzene</span> = molecule(<span style="color: #008000;">'C6H6'</span>)
benzene.translate(-benzene.get_center_of_mass())

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">I want the benzene centered on the position in the middle of atoms</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">20, 22, 23 and 25</span>
<span style="color: #BA36A5;">p</span> = (atoms.positions[20] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[22] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[23] +
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>atoms.positions[25])/4.0 + [0.0, 0.0, 3.05]

benzene.translate(p)
<span style="color: #BA36A5;">atoms</span> += benzene

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we constrain the slab</span>
<span style="color: #BA36A5;">c</span> = FixAtoms(mask=[atom.symbol==<span style="color: #008000;">'Au'</span> <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms])
atoms.set_constraint(c)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">from ase.visualize import view; view(atoms)</span>

<span style="color: #0000FF;">print</span>(Vasp(<span style="color: #008000;">'surfaces/Au-benzene-pbe-d2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> kpts=[4, 4, 1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ibrion=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> nsw=100,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> lvdw=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms).potential_energy)
</pre>
</div>

<pre class="example">
-184.07495285
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">e1</span>, <span style="color: #BA36A5;">e2</span>, <span style="color: #BA36A5;">e3</span> = [Vasp(wd).potential_energy
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #0000FF;">for</span> wd <span style="color: #0000FF;">in</span> [<span style="color: #008000;">'surfaces/Au-benzene-pbe-d2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">'surfaces/Au-pbe-d2'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">'molecules/benzene-pbe-d2'</span>]]

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Adsorption energy = {0:1.2f} eV'</span>.<span style="color: #006FE0;">format</span>(e1 - e2 - e3))
</pre>
</div>

<pre class="example">
Adsorption energy = -1.54 eV
</pre>

<p>
That is significantly more favorable. This is much higher than this <a href="http://th.fhi-berlin.mpg.de/site/uploads/Publications/PRL_submitted_2012063-582-586-2012.pdf">reference</a> though (0.56 eV), so there could be some issues with convergence or other computational parameters that should be considered.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline181" class="outline-3">
<h3 id="orgheadline181"><span class="section-number-3">7.4</span> Electron localization function</h3>
<div class="outline-text-3" id="text-7-4">
<p>
The electron localization function (ELF) can be used to characterize chemical bonds, e.g. their ionicity/covalency <a class='org-ref-reference' href="#silvi1994">silvi1994</a>. Here we reproduce an example from Ref. <a class='org-ref-reference' href="#silvi1994">silvi1994</a>. We compute and plot the ELF for tetrafluoromethane. The <a href=http://cms.mpi.univie.ac.at/wiki/index.php/LELF>LELF</a> tag turns this on.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute ELF for CF4</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">from</span> enthought.mayavi <span style="color: #0000FF;">import</span> mlab

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CF4'</span>)
atoms.center(vacuum=5)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/cf4-elf'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   prec=<span style="color: #008000;">'high'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   lelf=<span style="color: #D0372D;">True</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">elf</span> = calc.get_elf()
mlab.contour3d(x, y, z, elf, contours=[0.3])
mlab.savefig(<span style="color: #008000;">'../../images/cf4-elf-3.png'</span>)

mlab.figure()
mlab.contour3d(x, y, z, elf, contours=[0.75])
mlab.savefig(<span style="color: #008000;">'../../images/cf4-elf-75.png'</span>)
</pre>
</div>

<pre class="example">
None
</pre>



<div class="figure">
<p><img src="./images/cf4-elf-3.png" alt="cf4-elf-3.png" />
</p>
<p><span class="figure-number">Figure 99:</span> ELF for an isosurface of 0.3 for CF\(_4\). \label{fig:elf1}</p>
</div>


<div class="figure">
<p><img src="./images/cf4-elf-75.png" alt="cf4-elf-75.png" />
</p>
<p><span class="figure-number">Figure 100:</span> ELF for an isosurface of 0.75 for CF\(_4\). \label{fig:elf2}</p>
</div>

<p>
These images (Figure <a href="#fig:elf1">fig:elf1</a> and <a href="#fig:elf2">fig:elf2</a>) are basically consistent with those in Reference <a class='org-ref-reference' href="#silvi1994">silvi1994</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline182" class="outline-3">
<h3 id="orgheadline182"><span class="section-number-3">7.5</span> <span class="todo TODO">TODO</span> Charge partitioning schemes</h3>
</div>
<div id="outline-container-orgheadline183" class="outline-3">
<h3 id="orgheadline183"><span class="section-number-3">7.6</span> <span class="todo TODO">TODO</span> Modeling Core level shifts</h3>
<div class="outline-text-3" id="text-7-6">
<p>
We need to setup four calculations. First, we setup the bulk Cu and bulk alloy calculations and let them relax. We use similar unit cells for each one to maximize cancellation of errors.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      0.000,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Cu'</span>,  [-1.652,     0.000,      2.039])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=  [[0.000, -2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0.000,  2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [-3.303,  0.000,  0.000]])

<span style="color: #BA36A5;">atoms</span> = atoms.repeat((2, 2, 2))
<span style="color: #0000FF;">print</span> atoms[0]

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-cls-0'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=40,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
</pre>
</div>

<pre class="example">
Atom('Cu', [0.0, 0.0, 0.0], index=0)
-59.98232341
</pre>


<p>
Here, we setup the alloy calculation.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,  [0.000,      0.000,      0.000]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  Atom(<span style="color: #008000;">'Pd'</span>,  [-1.652,     0.000,      2.039])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=  [[0.000, -2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0.000,  2.039,  2.039],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [-3.303,  0.000,  0.000]])

<span style="color: #BA36A5;">atoms</span> = atoms.repeat((2, 2, 2))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuPd-cls-0'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[4, 4, 4],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isif=3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=40,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
</pre>
</div>

<pre class="example">
-73.55012322
</pre>

<p>
Next, we have to do the excitation in each structure. For these, we do not relax the structure. We clone the previous results and modify them.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> VAsp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/Cu-cls-0'</span>)
calc.clone(<span style="color: #008000;">'bulk/Cu-cls-1'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>setups=[[0, <span style="color: #008000;">'Cu'</span>]],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Create separate entry in POTCAR for atom index 0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>icorelevel=2,        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Perform core level shift calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>clnt=0,              <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Excite atom index 0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cln=2,               <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">2p3/2 electron for Cu core level shift</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cll=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>clz=1)

calc.update()
</pre>
</div>

<pre class="example">
-345.05440951
</pre>


<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/CuPd-cls-0'</span>)
calc.clone(<span style="color: #008000;">'bulk/CuPd-cls-1'</span>)

calc.<span style="color: #006FE0;">set</span>(ibrion=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>isif=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>nsw=<span style="color: #D0372D;">None</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>setups=[[0, <span style="color: #008000;">'Cu'</span>]],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Create separate entry in POTCAR for atom index 0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>icorelevel=2,        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Perform core level shift calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>clnt=0,              <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Excite atom index 0</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cln=2,               <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">2p3/2 electron for Cu core level shift</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cll=1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>clz=1)
calc.update()
</pre>
</div>

<pre class="example">
-359.87250408
</pre>


<p>
Finally we calculate the CLS:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">alloy_0</span> = Vasp(<span style="color: #008000;">'bulk/CuPd-cls-0'</span>).potential_energy

<span style="color: #BA36A5;">alloy_1</span> = Vasp(<span style="color: #008000;">'bulk/CuPd-cls-1'</span>).potential_energy

<span style="color: #BA36A5;">ref_0</span> = Vasp(<span style="color: #008000;">'bulk/Cu-cls-0'</span>).potential_energy

<span style="color: #BA36A5;">ref_1</span> = Vasp(<span style="color: #008000;">'bulk/Cu-cls-1'</span>).potential_energy

<span style="color: #BA36A5;">CLS</span> = (alloy_1 - alloy_0) - (ref_1 - ref_0)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'CLS = {} eV'</span>.<span style="color: #006FE0;">format</span>(CLS))
</pre>
</div>

<pre class="example">
CLS = -1.2378242 eV
</pre>

<p>
This is a little negative compared to the literature but that could be due to the highly ordered structure we used.
</p>
</div>
</div>

<div id="outline-container-orgheadline184" class="outline-3">
<h3 id="orgheadline184"><span class="section-number-3">7.7</span> The BEEF functional in Vasp</h3>
<div class="outline-text-3" id="text-7-7">
<p>
In Vasp 5.3.5 it is possible to use the BEEF functional <a class='org-ref-reference' href="#wellendorff-2012-densit">wellendorff-2012-densit</a>.
</p>

<p>
In Vasp, we just specify xc='beef-bdw' and Vasp takes care of the rest. This includes setting some addtional variables to setup van der Waals and to get the BEEF ensemble energies. Let us consider the dissociation energy of H<sub>2</sub>.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">H2</span> = molecule(<span style="color: #008000;">'H2'</span>)
H2.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)
H2.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/H2-beef'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'beef-vdw'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=10,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=H2)

<span style="color: #BA36A5;">eH2</span> = H2.get_potential_energy()
<span style="color: #0000FF;">print</span>(eH2)
</pre>
</div>

<pre class="example">
-7.13332059
</pre>

<p>
Next, we get an H atom.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">H</span> = molecule(<span style="color: #008000;">'H'</span>)
H.set_cell([8, 8, 8], scale_atoms=<span style="color: #D0372D;">False</span>)
H.center()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/H-beef'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'beef-vdw'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=H)

<span style="color: #0000FF;">print</span>(calc.potential_energy)
</pre>
</div>

<pre class="example">
-0.22476997
</pre>

<p>
Now, the dissociation energy.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'D = {} eV'</span>.<span style="color: #006FE0;">format</span>(2 * Vasp(<span style="color: #008000;">'molecules/H-beef'</span>).potential_energy -
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>Vasp(<span style="color: #008000;">'molecules/H2-beef'</span>).potential_energy))
</pre>
</div>

<pre class="example">
D = 6.68378065 eV
</pre>


<pre class="example">
-1.15994056 -7.13332059
D = 4.81343947 eV
</pre>

<p>
It doesn't look like we have done much so far. How certain are we of the dissociation energy? Let us consider the ensemble of energies. In the calculation, an ensemble of functionals is used, and each one produces a different energy. We can look at the distribution of these energies to estimate the uncertainty in energy differences. We use the <a href="Vasp.get_beefens">Vasp.get_beefens</a> to get the ensemble. We calculate the uncertainty in our reaction energy by calculating the standard deviation of the appropriately weighted difference of ensembles.
</p>

<p>
Note that this ensemble represents the contribution just from the functionals, and not all the other contributions. So, the differences in the ensembles only represents that part of the uncertainty
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/H-beef'</span>)
<span style="color: #BA36A5;">ensH</span> = calc.get_beefens()

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/H2-beef'</span>)
<span style="color: #BA36A5;">ensH2</span> = calc.get_beefens()

<span style="color: #BA36A5;">ensD</span> = 2 * ensH - ensH2

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'mean = {} eV'</span>.<span style="color: #006FE0;">format</span>(ensD.mean()))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'std = {} eV'</span>.<span style="color: #006FE0;">format</span>(ensD.std()))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.hist(ensD, 20)
plt.xlabel(<span style="color: #008000;">'Deviation'</span>)
plt.ylabel(<span style="color: #008000;">'frequency'</span>)
plt.savefig(<span style="color: #008000;">'images/beef-ens.png'</span>)
</pre>
</div>

<pre class="example">
mean = 0.00661973433552 eV
std = 0.278495927893 eV
</pre>

<p>
You can see the mean is nearly zero, suggesting the deviations are symmetrically distributed. The std error is 0.184 eV, which represents about a 68% confidence interval.
</p>


<div class="figure">
<p><img src="./images/beef-ens.png" alt="beef-ens.png" />
</p>
</div>
</div>
</div>




<div id="outline-container-orgheadline185" class="outline-3">
<h3 id="orgheadline185"><span class="section-number-3">7.8</span> <span class="todo TODO">TODO</span> Solvation</h3>
<div class="outline-text-3" id="text-7-8">
<p>
See <a href="http://vaspsol.mse.ufl.edu/download/">http://vaspsol.mse.ufl.edu/download/</a>, <a class='org-ref-reference' href="#fishman-2013-accur">fishman-2013-accur</a>,<a class='org-ref-reference' href="#mathew-2014-implic">mathew-2014-implic</a>
</p>

<p>
You need a specially patched version of Vasp.
</p>

<p>
First, we run our calculation in vacuum. We need this to get the WAVECAR. The following calculation mimics one of the example calculations in the Vaspsol package. The combination of nsw=0 and ibrion=2 does not make sense, but that is the example. I do not use the npar=4 parameter here.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CO'</span>)
atoms.center(vacuum=5)

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/CO-vacuum'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=600,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   prec=<span style="color: #008000;">'Accurate'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.05,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ibrion=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nsw=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ediff=1e-6,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)
<span style="color: #0000FF;">print</span>(atoms.get_potential_energy())
<span style="color: #0000FF;">print</span>(atoms.get_forces())
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Calculation time: {} seconds'</span>.<span style="color: #006FE0;">format</span>(calc.get_elapsed_time()))
</pre>
</div>

<pre class="example">
-14.81547852
[[ 0.     0.    -0.949]
 [ 0.     0.     0.949]]
Calculation time: 257.546 seconds
</pre>

<p>
The forces are high because nsw was set to 0, so only one iteration was run.
</p>

<p>
Next, we do the solvation calculation. We use the default solvent dielectric constant of water, which is 80.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/CO-vacuum'</span>)
calc.clone(<span style="color: #008000;">'molecules/CO-solvated'</span>)

calc.<span style="color: #006FE0;">set</span>(istart=1,  <span style="color: #8D8D84;">#</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>lsol=<span style="color: #D0372D;">True</span>)
<span style="color: #0000FF;">print</span>(calc.get_atoms().get_potential_energy())
<span style="color: #0000FF;">print</span>(calc.get_atoms().get_forces())
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Calculation time: {} seconds'</span>.<span style="color: #006FE0;">format</span>(calc.get_elapsed_time()))
</pre>
</div>

<pre class="example">
-14.82289079
[[ 0.     0.    -1.007]
 [ 0.     0.     1.007]]
Calculation time: 2937.72 seconds
</pre>

<p>
Note these take quite a bit longer to calculate (e.g. 10 times longer)! The energies here are a little different than the vacuum result. To use this energy in an energy difference, you need to make sure the other energies were run with lsol=True also, and the same parameters.
</p>

<p>
Here is the evidence that we actually ran a calculation with solvation:
</p>

<div class="org-src-container">

<pre class="src src-sh">grep -A 5 Solvation molecules/CO-solvated/OUTCAR
</pre>
</div>

<pre class="example">
   LSOL =      T    Solvation

 Electronic Relaxation 1
   ENCUT  =  600.0 eV  44.10 Ry    6.64 a.u.  19.97 19.97 22.27*2*pi/ulx,y,z
   ENINI  =  600.0     initial cutoff
   ENAUG  =  644.9 eV  augmentation charge cutoff
--
 Solvation parameters
   EB_K    = 80.000000     relative permittivity of the bulk solvent
   SIGMA_K =  0.600000     width of the dielectric cavity
   NC_K    =  0.002500     cutoff charge density
   TAU     =  0.000525     cavity surface tension

--
  Solvation contrib.  Ediel  =        -2.06361062
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82417510 eV

  energy without entropy =      -14.82417510  energy(sigma-&gt;0) =      -14.82417510

--
  Solvation contrib.  Ediel  =        -2.08692034
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82331872 eV

  energy without entropy =      -14.82331872  energy(sigma-&gt;0) =      -14.82331872

--
  Solvation contrib.  Ediel  =        -2.11316669
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82319429 eV

  energy without entropy =      -14.82319429  energy(sigma-&gt;0) =      -14.82319429

--
  Solvation contrib.  Ediel  =        -2.16318931
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82278947 eV

  energy without entropy =      -14.82278947  energy(sigma-&gt;0) =      -14.82278947

--
  Solvation contrib.  Ediel  =        -2.17570687
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82272160 eV

  energy without entropy =      -14.82272160  energy(sigma-&gt;0) =      -14.82272160

--
  Solvation contrib.  Ediel  =        -2.19188585
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82267271 eV

  energy without entropy =      -14.82267271  energy(sigma-&gt;0) =      -14.82267271

--
  Solvation contrib.  Ediel  =        -2.19395757
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82272442 eV

  energy without entropy =      -14.82272442  energy(sigma-&gt;0) =      -14.82272442

--
  Solvation contrib.  Ediel  =        -2.19698448
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288242 eV

  energy without entropy =      -14.82288242  energy(sigma-&gt;0) =      -14.82288242

--
  Solvation contrib.  Ediel  =        -2.19737905
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288470 eV

  energy without entropy =      -14.82288470  energy(sigma-&gt;0) =      -14.82288470

--
  Solvation contrib.  Ediel  =        -2.19908571
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82287091 eV

  energy without entropy =      -14.82287091  energy(sigma-&gt;0) =      -14.82287091

--
  Solvation contrib.  Ediel  =        -2.19782575
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288497 eV

  energy without entropy =      -14.82288497  energy(sigma-&gt;0) =      -14.82288497

--
  Solvation contrib.  Ediel  =        -2.19878993
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288031 eV

  energy without entropy =      -14.82288031  energy(sigma-&gt;0) =      -14.82288031

--
  Solvation contrib.  Ediel  =        -2.19875585
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288727 eV

  energy without entropy =      -14.82288727  energy(sigma-&gt;0) =      -14.82288727

--
  Solvation contrib.  Ediel  =        -2.19894718
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82288935 eV

  energy without entropy =      -14.82288935  energy(sigma-&gt;0) =      -14.82288935

--
  Solvation contrib.  Ediel  =        -2.19902584
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82289064 eV

  energy without entropy =      -14.82289064  energy(sigma-&gt;0) =      -14.82289064

--
  Solvation contrib.  Ediel  =        -2.19905589
  ---------------------------------------------------
  free energy    TOTEN  =       -14.82289079 eV

  energy without entropy =      -14.82289079  energy(sigma-&gt;0) =      -14.82289079
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline187" class="outline-2">
<h2 id="orgheadline187"><span class="section-number-2">8</span> Databases in molecular simulations</h2>
<div class="outline-text-2" id="text-8">
<p>
The continued increase in computing power has enabled us to create massive amounts of computational data. Some of this data is accessible in papers, or at websites, e.g. <a href="https://cmr.fysik.dtu.dk/">https://cmr.fysik.dtu.dk/</a>.
</p>

<p>
Our Vasp module works natively with the ase-database. It is easy to write an entry to a database.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase.db <span style="color: #0000FF;">import</span> connect
<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #0000FF;">print</span> calc.results
<span style="color: #BA36A5;">con</span> = connect(<span style="color: #008000;">'example-1.db'</span>)
con.write(atoms)
</pre>
</div>

<pre class="example">
{'magmom': 0, 'stress': array([ 0.0414556 ,  0.01094971,  0.01094971, -0.        , -0.        , -0.        ]), 'magmoms': array([ 0.,  0.]), 'charges': array([None, None], dtype=object), 'energy': -14.69111507, 'dipole': None, 'forces': array([[ 5.09138064,  0.        ,  0.        ],
       [-5.09138064,  0.        ,  0.        ]])}
</pre>

<div class="org-src-container">

<pre class="src src-sh">ase-db example-1.db
</pre>
</div>

<pre class="example">
id|age|user    |formula|calculator| energy| fmax|pbc| volume|charge|  mass| smax|magmom
 1| 5s|jkitchin|CO     |vasp      |-14.691|5.091|TTT|216.000| 0.000|28.010|0.041| 0.000
Rows: 1
</pre>
</div>
</div>

<div id="outline-container-orgheadline188" class="outline-2">
<h2 id="orgheadline188"><span class="section-number-2">9</span> Acknowledgments</h2>
<div class="outline-text-2" id="text-9">
<p>
I would like to thank Zhongnan Xu for sending me some examples on magnetism. Alan McGaughey and Lars Grabow for sending me some NEB examples. Matt Curnan for examples of phonons.
</p>

<p>
Many thanks to students in my class who have pointed out typos, places of confusion, etc&#x2026; These include Bruno Calfa, Matt Curnan, Charlie Janini, Feng Cao, Gamze Gumuslu, Nicholas Chisholm, Prateek Mehta, Qiyang Duan, Shubhaditya Majumdar, Steven Illes, Wee-Liat Ong, Ye Wang, Yichun Sun, Yubing Lu, and Zhongnan Xu.
</p>
</div>
</div>
<div id="outline-container-orgheadline233" class="outline-2">
<h2 id="orgheadline233"><span class="section-number-2">10</span> Appendices</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-orgheadline215" class="outline-3">
<h3 id="orgheadline215"><span class="section-number-3">10.1</span> Recipes</h3>
<div class="outline-text-3" id="text-10-1">
</div><div id="outline-container-orgheadline189" class="outline-4">
<h4 id="orgheadline189"><span class="section-number-4">10.1.1</span> Modifying Atoms by deleting atoms</h4>
<div class="outline-text-4" id="text-10-1-1">
<p>
Sometimes it is convenient to create an Atoms object by deleting atoms from an existing object. Here is a recipe to delete all the hydrogen atoms in a molecule. The idea is to make a list of indices of which atoms to delete using list comprehension, then use list deletion to delete those indices.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> textwrap
<span style="color: #0000FF;">from</span> ase.structure <span style="color: #0000FF;">import</span> molecule

<span style="color: #BA36A5;">atoms</span> = molecule(<span style="color: #008000;">'CH3CH2OH'</span>)
<span style="color: #0000FF;">print</span>(atoms)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">delete all the hydrogens</span>
<span style="color: #BA36A5;">ind2del</span> = [atom.index <span style="color: #0000FF;">for</span> atom <span style="color: #0000FF;">in</span> atoms <span style="color: #0000FF;">if</span> atom.symbol == <span style="color: #008000;">'H'</span>]
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Indices to delete: '</span>, ind2del)

<span style="color: #0000FF;">del</span> atoms[ind2del]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now print what is left</span>
<span style="color: #0000FF;">print</span>(atoms)
</pre>
</div>

<pre class="example">
Atoms(symbols='C2OH6', positions=..., cell=[1.0, 1.0, 1.0], pbc=[False, False, False])
Indices to delete:  [3, 4, 5, 6, 7, 8]
Atoms(symbols='C2O', positions=..., cell=[1.0, 1.0, 1.0], pbc=[False, False, False])
</pre>
</div>
</div>

<div id="outline-container-orgheadline190" class="outline-4">
<h4 id="orgheadline190"><span class="section-number-4">10.1.2</span> Advanced tagging</h4>
<div class="outline-text-4" id="text-10-1-2">
<p>
We can label atoms with integer tags to help identify them later, e.g. which atoms are adsorbates, or surface atoms, or near an adsorbate, etc&#x2026; We might want to refer to those atoms later for electronic structure, geometry analysis, etc&#x2026;
</p>

<p>
The method uses integer tags that are powers of two, and then uses binary operators to check for matches. &amp; is a bitwise AND. The key to understanding this is to look at the tags in binary form. The tags [1 2 4 8] can be represented by a binary string:
</p>

<pre class="example">
1 = [1 0 0 0]
2 = [0 1 0 0]
4 = [0 0 1 0]
8 = [0 0 0 1]
</pre>

<p>
So, an atom tagged with 1 and 2 would have a tag of [1 1 0 0] or equivalently in decimal numbers, a tag of 3.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #008000;">'''</span>
<span style="color: #008000;">adapted from https://listserv.fysik.dtu.dk/pipermail/campos/2004-September/001155.html</span>
<span style="color: #008000;">'''</span>

<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> *
<span style="color: #0000FF;">from</span> ase.io <span style="color: #0000FF;">import</span> write
<span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> bcc111, add_adsorbate
<span style="color: #0000FF;">from</span> ase.constraints <span style="color: #0000FF;">import</span> FixAtoms

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the bcc111 function automatically tags atoms</span>
<span style="color: #BA36A5;">slab</span> = bcc111(<span style="color: #008000;">'W'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> a=3.92,       <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">W lattice constant</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(2, 2, 6),  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">6-layer slab in 2x2 configuration</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> vacuum=10.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reset tags to be powers of two so we can use binary math</span>
slab.set_tags([2**a.get_tag() <span style="color: #0000FF;">for</span> a <span style="color: #0000FF;">in</span> slab])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we had 6 layers, so we create new tags starting at 7</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Note you must use powers of two for all the tags!</span>
<span style="color: #BA36A5;">LAYER1</span> = 2
<span style="color: #BA36A5;">ADSORBATE</span> = 2**7
<span style="color: #BA36A5;">FREE</span> = 2**8
<span style="color: #BA36A5;">NEARADSORBATE</span> = 2**9

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">let us tag LAYER1 atoms to be FREE too. we can address it by LAYER1 or FREE</span>
<span style="color: #BA36A5;">tags</span> = slab.get_tags()
<span style="color: #0000FF;">for</span> i, tag <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(tags):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> tag == LAYER1:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">tags</span>[i] += FREE
slab.set_tags(tags)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">create a CO molecule</span>
<span style="color: #BA36A5;">co</span>=Atoms([Atom(<span style="color: #008000;">'C'</span>, [0., 0., 0.], tag=ADSORBATE),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we will relax only O</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> Atom(<span style="color: #008000;">'O'</span>, [0., 0., 1.1], tag=ADSORBATE + FREE)])

add_adsorbate(slab, co, height=1.2, position=<span style="color: #008000;">'hollow'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the adsorbate is centered between atoms 20, 21 and 22 (use</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">view(slab)) and over atom12 let us label those atoms, so it is easy to</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">do electronic structure analysis on them later.</span>
<span style="color: #BA36A5;">tags</span> = slab.get_tags()  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">len(tags) changed, so we reget them.</span>
<span style="color: #BA36A5;">tags</span>[12] += NEARADSORBATE
<span style="color: #BA36A5;">tags</span>[20] += NEARADSORBATE
<span style="color: #BA36A5;">tags</span>[21] += NEARADSORBATE
<span style="color: #BA36A5;">tags</span>[22] += NEARADSORBATE
slab.set_tags(tags)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">update the tags</span>
slab.set_tags(tags)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">extract pieces of the slab based on tags</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms in the adsorbate</span>
<span style="color: #BA36A5;">ads</span> = slab[(slab.get_tags() &amp; ADSORBATE) == ADSORBATE]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms in LAYER1</span>
<span style="color: #BA36A5;">layer1</span> = slab[(slab.get_tags() &amp; LAYER1) == LAYER1]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms defined as near the adsorbate</span>
<span style="color: #BA36A5;">nearads</span> = slab[(slab.get_tags() &amp; NEARADSORBATE) == NEARADSORBATE]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms that are free</span>
<span style="color: #BA36A5;">free</span> = slab[(slab.get_tags() &amp; FREE) == FREE]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms that are FREE and part of the ADSORBATE</span>
<span style="color: #BA36A5;">freeads</span> = slab[(slab.get_tags() &amp; FREE+ADSORBATE) == FREE+ADSORBATE]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">atoms that are NOT FREE</span>
<span style="color: #BA36A5;">notfree</span> = slab[(slab.get_tags() &amp; FREE) != FREE]

<span style="color: #BA36A5;">constraint</span> = FixAtoms(mask=(slab.get_tags() &amp; FREE) != FREE)
slab.set_constraint(constraint)
write(<span style="color: #008000;">'images/tagged-bcc111.png'</span>, slab, rotation=<span style="color: #008000;">'-90x'</span>, show_unit_cell=2)
<span style="color: #0000FF;">from</span> ase.visualize <span style="color: #0000FF;">import</span> view; view(slab)
</pre>
</div>


<div class="figure">
<p><img src="./images/tagged-bcc111.png" alt="tagged-bcc111.png" />
</p>
<p><span class="figure-number">Figure 102:</span> The tagged bcc(111) structure created above. Unfortunately, the frozen atoms do not show up in the figure.</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline191" class="outline-4">
<h4 id="orgheadline191"><span class="section-number-4">10.1.3</span> Using units in ase</h4>
<div class="outline-text-4" id="text-10-1-3">
<p>
<a href="ase">ase</a> uses a base set of atomic units.These are eV for energy, \(\AA\) for distance, seconds for time, and amu for mass. Other units are defined in terms of those units, and you can easily convert to alternative units by dividing your quantity in atomic units by the units you want.
</p>

<p>
Not too many units are defined:
['A', 'AUT', 'Ang', 'Angstrom', 'Bohr', 'C', 'Debye', 'GPa', 'Ha', 'Hartree', 'J', 'Pascal', 'Ry', 'Rydberg', 'alpha', 'cm', 'eV', 'erg', 'fs', 'kB', 'kJ', 'kcal', 'kg', 'm', 'meV', 'mol', 'nm', 's', 'second']
</p>

<p>
It is not that hard to define your own derived units though. Note these  are only conversion factors. No units algebra is enforced (i.e. it will be ok to add a m and a kg)!
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.units <span style="color: #0000FF;">import</span> *

<span style="color: #BA36A5;">d</span> = 1 * Angstrom
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">' d = {0} nm'</span>.<span style="color: #006FE0;">format</span>(d / nm))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 eV = {0} Hartrees'</span>.<span style="color: #006FE0;">format</span>(eV / Hartree))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 eV = {0} Rydbergs'</span>.<span style="color: #006FE0;">format</span>(eV / Rydberg))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 eV = {0} kJ/mol'</span>.<span style="color: #006FE0;">format</span>(eV / (kJ / mol)))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 eV = {0} kcal/mol'</span>.<span style="color: #006FE0;">format</span>(eV / (kcal / mol)))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 Hartree = {0} kcal/mol'</span>.<span style="color: #006FE0;">format</span>(1 * Hartree / (kcal / mol)))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'1 Rydberg = {0} eV'</span>.<span style="color: #006FE0;">format</span>(1 * Rydberg / eV))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">derived units</span>
<span style="color: #BA36A5;">minute</span> = 60 * s
<span style="color: #BA36A5;">hour</span> = 60 * minute

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">convert 10 hours to minutes</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'10 hours = {0} minutes'</span>.<span style="color: #006FE0;">format</span>(10 * hour / minute))
</pre>
</div>

<pre class="example">
 d = 0.1 nm
1 eV = 0.036749309468 Hartrees
1 eV = 0.0734986189359 Rydbergs
1 eV = 96.485308989 kJ/mol
1 eV = 23.0605423014 kcal/mol
1 Hartree = 627.509540594 kcal/mol
1 Rydberg = 13.6056978278 eV
10 hours = 600.0 minutes
</pre>
</div>
</div>

<div id="outline-container-orgheadline192" class="outline-4">
<h4 id="orgheadline192"><span class="section-number-4">10.1.4</span> Extracting parts of an array</h4>
<div class="outline-text-4" id="text-10-1-4">
<p>
See <a href="http://www.scipy.org/Cookbook/BuildingArrays">http://www.scipy.org/Cookbook/BuildingArrays</a> for examples of making numpy arrays.
</p>


<p>
When analyzing numerical data you may often want to analyze only a part of the data. For example, suppose you have \(x\) and \(y\) data, (\(x\)=time, \(y\)=signal) and you want to integrate the date between a particular time interval. You can slice a numpy array to extract parts of it. See <a href="http://www.scipy.org/Cookbook/Indexing">http://www.scipy.org/Cookbook/Indexing</a> for several examples of this.
</p>

<p>
In this example we show how to extract the data in an interval. We have \(x\) data in the range of 0 to 6, and \(y\) data that is the \(\cos(x)\). We want to extract the \(x\) and \(y\) data for \(2 < x < 4\), and the corresponding y-data. To do this, we utilize the numpy capability of slicing with a boolean array. We also show some customization of matplotlib.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib <span style="color: #0000FF;">as</span> mpl
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://matplotlib.sourceforge.net/users/customizing.html</span>
<span style="color: #BA36A5;">mpl.rcParams</span>[<span style="color: #008000;">'legend.numpoints'</span>] = 1  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">default is 2</span>
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.linspace(0, 6, 100)
<span style="color: #BA36A5;">y</span> = np.cos(x)

plt.plot(x, y, label=<span style="color: #008000;">'full'</span>)

<span style="color: #BA36A5;">ind</span> = (x &gt; 2) &amp; (x &lt; 4)

<span style="color: #BA36A5;">subx</span> = x[ind]
<span style="color: #BA36A5;">suby</span> = y[ind]

plt.plot(subx, suby, <span style="color: #008000;">'bo'</span>, label=<span style="color: #008000;">'sliced'</span>)
xlabel(<span style="color: #008000;">'x'</span>)
ylabel(<span style="color: #008000;">'cos(x)'</span>)
plt.legend(loc=<span style="color: #008000;">'lower right'</span>)
plt.savefig(<span style="color: #008000;">'images/np-array-slice.png'</span>)
</pre>
</div>

<pre class="example">
None
</pre>

<p>
<img src="./images/np-array-slice.png" alt="np-array-slice.png" />
The expression \(x>2\) returns an array of booleans (True where the element of \(x\) is greater than 2, and False where it is not) equal in size to \(x\). Similarly \(x<4\) returns a boolean array where \(x\) is less than 4. We take the logical <code>and</code> of these two boolean arrays to get another boolean array where both conditions are True (i.e. \(x<2\) and \(x>4\)). This final boolean array is <code>True</code> for the part of the arrays we are interested in, and we can use it to extract the subarrays we want.
</p>
</div>
</div>

<div id="outline-container-orgheadline194" class="outline-4">
<h4 id="orgheadline194"><span class="section-number-4">10.1.5</span> Statistics</h4>
<div class="outline-text-4" id="text-10-1-5">
</div><div id="outline-container-orgheadline193" class="outline-5">
<h5 id="orgheadline193"><span class="section-number-5">10.1.5.1</span> Confidence intervals</h5>
<div class="outline-text-5" id="text-10-1-5-1">
<p>
<a href="scipy">scipy</a> has a statistical package available for getting statistical distributions. This is useful for computing confidence intervals using the student-t tables. Here is an example of computing a 95% confidence interval on an average.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> scipy.stats.distributions <span style="color: #0000FF;">import</span>  t

<span style="color: #BA36A5;">n</span> = 10  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of measurements</span>
<span style="color: #BA36A5;">dof</span> = n - 1  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">degrees of freedom</span>
<span style="color: #BA36A5;">avg_x</span> = 16.1  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">average measurement</span>
<span style="color: #BA36A5;">std_x</span> = 0.01  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">standard deviation of measurements</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Find 95% prediction interval for next measurement</span>

<span style="color: #BA36A5;">alpha</span> = 1.0 - 0.95

<span style="color: #BA36A5;">pred_interval</span> = t.ppf(1 - alpha / 2., dof) * std_x * np.sqrt(1. + 1. / n)

<span style="color: #BA36A5;">s</span> = [<span style="color: #008000;">'We are 95% confident the next measurement'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  <span style="color: #008000;">' will be between {0:1.3f} and {1:1.3f}'</span>]
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>.join(s).<span style="color: #006FE0;">format</span>(avg_x - pred_interval, avg_x + pred_interval))
</pre>
</div>

<pre class="example">
We are 95% confident the next measurement will be between 16.076 and 16.124
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline196" class="outline-4">
<h4 id="orgheadline196"><span class="section-number-4">10.1.6</span> Curve fitting</h4>
<div class="outline-text-4" id="text-10-1-6">
</div><div id="outline-container-orgheadline195" class="outline-5">
<h5 id="orgheadline195"><span class="section-number-5">10.1.6.1</span> Linear fitting</h5>
<div class="outline-text-5" id="text-10-1-6-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">examples of linear curve fitting using least squares</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">xdata</span> = np.array([0., 1., 2., 3., 4., 5., 6.])
<span style="color: #BA36A5;">ydata</span> = np.array([0.1, 0.81, 4.03, 9.1, 15.99, 24.2, 37.2])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">fit a third order polynomial</span>
<span style="color: #0000FF;">from</span> pylab <span style="color: #0000FF;">import</span> polyfit, plot, xlabel, ylabel, show, legend, savefig
<span style="color: #BA36A5;">pars</span> = polyfit(xdata, ydata, 3)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'pars from polyfit: {0}'</span>.<span style="color: #006FE0;">format</span>(pars))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">numpy method returns more data</span>
<span style="color: #BA36A5;">A</span> = np.column_stack([xdata**3,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xdata**2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>xdata,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>np.ones(<span style="color: #006FE0;">len</span>(xdata), np.<span style="color: #006FE0;">float</span>)])

<span style="color: #BA36A5;">pars_np</span>, <span style="color: #BA36A5;">resids</span>, <span style="color: #BA36A5;">rank</span>,<span style="color: #BA36A5;">s</span> = np.linalg.lstsq(A, ydata)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'pars from np.linalg.lstsq: {0}'</span>.<span style="color: #006FE0;">format</span>(pars_np))

<span style="color: #008000;">'''</span>
<span style="color: #008000;">we are trying to solve Ax = b for x in the least squares sense. There</span>
<span style="color: #008000;">are more rows in A than elements in x so, we can left multiply each</span>
<span style="color: #008000;">side by A^T, and then solve for x with an inverse.</span>

<span style="color: #008000;">A^TAx = A^Tb</span>
<span style="color: #008000;">x = (A^TA)^-1 A^T b</span>
<span style="color: #008000;">'''</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">not as pretty but equivalent!</span>
<span style="color: #BA36A5;">pars_man</span> = np.dot(np.linalg.inv(np.dot(A.T, A)), np.dot(A.T, ydata))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'pars from linear algebra: {0}'</span>.<span style="color: #006FE0;">format</span>(pars_man))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">but, it is easy to fit an exponential function to it!</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">y = a*exp(x)+b</span>
<span style="color: #BA36A5;">Aexp</span> = np.column_stack([np.exp(xdata), np.ones(<span style="color: #006FE0;">len</span>(xdata), np.<span style="color: #006FE0;">float</span>)])
<span style="color: #BA36A5;">pars_exp</span> = np.dot(np.linalg.inv(np.dot(Aexp.T, Aexp)), np.dot(Aexp.T, ydata))

plot(xdata, ydata, <span style="color: #008000;">'ro'</span>)
<span style="color: #BA36A5;">fity</span> = np.dot(A, pars)
plot(xdata, fity, <span style="color: #008000;">'k-'</span>, label=<span style="color: #008000;">'poly fit'</span>)
plot(xdata, np.dot(Aexp, pars_exp), <span style="color: #008000;">'b-'</span>, label=<span style="color: #008000;">'exp fit'</span>)
xlabel(<span style="color: #008000;">'x'</span>)
ylabel(<span style="color: #008000;">'y'</span>)
legend()
savefig(<span style="color: #008000;">'images/curve-fit-1.png'</span>)
</pre>
</div>

<pre class="example">
pars from polyfit: [ 0.04861111  0.63440476  0.61365079 -0.08928571]
pars from np.linalg.lstsq: [ 0.04861111  0.63440476  0.61365079 -0.08928571]
pars from linear algebra: [ 0.04861111  0.63440476  0.61365079 -0.08928571]
</pre>


<div class="figure">
<p><img src="./images/curve-fit-1.png" alt="curve-fit-1.png" />
</p>
<p><span class="figure-number">Figure 103:</span> Example of linear least-squares curve fitting.</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline197" class="outline-4">
<h4 id="orgheadline197"><span class="section-number-4">10.1.7</span> Nonlinear curve fitting</h4>
<div class="outline-text-4" id="text-10-1-7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> leastsq
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">vols</span> = np.array([13.71, 14.82, 16.0, 17.23, 18.52])

<span style="color: #BA36A5;">energies</span> = np.array([-56.29, -56.41, -56.46, -56.463, -56.41])


<span style="color: #0000FF;">def</span> <span style="color: #006699;">Murnaghan</span>(parameters, vol):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'From Phys. Rev. B 28, 5480 (1983)'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E0</span> = parameters[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">B0</span> = parameters[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">BP</span> = parameters[2]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V0</span> = parameters[3]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = (E0 + B0*vol / BP*(((V0 / vol)**BP) / (BP - 1) + 1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>- V0 * B0 / (BP - 1.))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> E


<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(pars, y, x):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we will minimize this function</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">err</span> = y - Murnaghan(pars, x)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> err

<span style="color: #BA36A5;">x0</span> = [-56., 0.54, 2., 16.5]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">initial guess of parameters</span>

<span style="color: #BA36A5;">plsq</span> = leastsq(objective, x0, args=(energies, vols))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Fitted parameters = {0}'</span>.<span style="color: #006FE0;">format</span>(plsq[0]))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(vols, energies, <span style="color: #008000;">'ro'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the fitted curve on top</span>
<span style="color: #BA36A5;">x</span> = np.linspace(<span style="color: #006FE0;">min</span>(vols), <span style="color: #006FE0;">max</span>(vols), 50)
<span style="color: #BA36A5;">y</span> = Murnaghan(plsq[0], x)
plt.plot(x, y, <span style="color: #008000;">'k-'</span>)
plt.xlabel(<span style="color: #008000;">'Volume'</span>)
plt.ylabel(<span style="color: #008000;">'energy'</span>)
plt.savefig(<span style="color: #008000;">'images/nonlinear-curve-fitting.png'</span>)
</pre>
</div>

<pre class="example">
Fitted parameters = (array([-56.46839641,   0.57233217,   2.7407944 ,  16.55905648]), 1)
</pre>


<div class="figure">
<p><img src="./images/nonlinear-curve-fitting.png" alt="nonlinear-curve-fitting.png" />
</p>
<p><span class="figure-number">Figure 104:</span> Example of least-squares non-linear curve fitting.</p>
</div>

<p>
See additional examples at \url{http://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html}.
</p>
</div>
</div>

<div id="outline-container-orgheadline198" class="outline-4">
<h4 id="orgheadline198"><span class="section-number-4">10.1.8</span> Nonlinear curve fitting by direct least squares minimization</h4>
<div class="outline-text-4" id="text-10-1-8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">volumes</span> = np.array([13.71, 14.82, 16.0, 17.23, 18.52])

<span style="color: #BA36A5;">energies</span> = np.array([-56.29, -56.41, -56.46, -56.463, -56.41])


<span style="color: #0000FF;">def</span> <span style="color: #006699;">Murnaghan</span>(parameters, vol):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'From PRB 28,5480 (1983'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E0</span> = parameters[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">B0</span> = parameters[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">BP</span> = parameters[2]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V0</span> = parameters[3]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = E0 + B0*vol/BP*(((V0/vol)**BP)/(BP-1)+1) - V0*B0/(BP-1.)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> E


<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(pars, vol):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we will minimize this function</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">err</span> = energies - Murnaghan(pars, vol)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> np.<span style="color: #006FE0;">sum</span>(err**2)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we return the summed squared error directly</span>

<span style="color: #BA36A5;">x0</span> = [-56., 0.54, 2., 16.5]  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">initial guess of parameters</span>

<span style="color: #BA36A5;">plsq</span> = fmin(objective, x0, args=(volumes,))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">note args is a tuple</span>

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'parameters = {0}'</span>.<span style="color: #006FE0;">format</span>(plsq))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(volumes, energies, <span style="color: #008000;">'ro'</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">plot the fitted curve on top</span>
<span style="color: #BA36A5;">x</span> = np.linspace(<span style="color: #006FE0;">min</span>(volumes), <span style="color: #006FE0;">max</span>(volumes), 50)
<span style="color: #BA36A5;">y</span> = Murnaghan(plsq, x)
plt.plot(x, y, <span style="color: #008000;">'k-'</span>)
plt.xlabel(r<span style="color: #008000;">'Volume ($\AA^3$)'</span>)
plt.ylabel(<span style="color: #008000;">'Total energy (eV)'</span>)
plt.savefig(<span style="color: #008000;">'images/nonlinear-fitting-lsq.png'</span>)
</pre>
</div>

<pre class="example">
Optimization terminated successfully.
         Current function value: 0.000020
         Iterations: 137
         Function evaluations: 240
parameters = [-56.46932645   0.59141447   1.9044796   16.59341303]
</pre>


<div class="figure">
<p><img src="./images/nonlinear-fitting-lsq.png" alt="nonlinear-fitting-lsq.png" />
</p>
<p><span class="figure-number">Figure 105:</span> Fitting a nonlinear function.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline199" class="outline-4">
<h4 id="orgheadline199"><span class="section-number-4">10.1.9</span> Nonlinear curve fitting with confidence intervals</h4>
<div class="outline-text-4" id="text-10-1-9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Nonlinear curve fit with confidence interval</span>
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> curve_fit
<span style="color: #0000FF;">from</span> scipy.stats.distributions <span style="color: #0000FF;">import</span>  t

<span style="color: #008000;">'''</span>
<span style="color: #008000;">fit this equation to data</span>
<span style="color: #008000;">y = c1 exp(-x) + c2*x</span>

<span style="color: #008000;">this is actually a linear regression problem, but it is convenient to</span>
<span style="color: #008000;">use the nonlinear fitting routine because it makes it easy to get</span>
<span style="color: #008000;">confidence intervals. The downside is you need an initial guess.</span>

<span style="color: #008000;">from Matlab</span>
<span style="color: #008000;">b =</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   4.9671</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   2.1100</span>


<span style="color: #008000;">bint =</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   4.6267    5.3075</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   1.7671    2.4528</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">x</span> = np.array([ 0.1,  0.2,  0.3,  0.4,  0.5,  0.6,  0.7,  0.8,  0.9,  1. ])
<span style="color: #BA36A5;">y</span> = np.array([ 4.70192769,  4.46826356,  4.57021389,  4.29240134,  3.88155125,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   3.78382253,  3.65454727,  3.86379487,  4.16428541,  4.06079909])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is the function we want to fit to our data</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">func</span>(x,c0, c1):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> c0 * np.exp(-x) + c1*x

<span style="color: #BA36A5;">pars</span>, <span style="color: #BA36A5;">pcov</span> = curve_fit(func, x, y, p0=[4.96, 2.11])

<span style="color: #BA36A5;">alpha</span> = 0.05 <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">95% confidence interval</span>

<span style="color: #BA36A5;">n</span> = <span style="color: #006FE0;">len</span>(y)    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of data points</span>
<span style="color: #BA36A5;">p</span> = <span style="color: #006FE0;">len</span>(pars) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of parameters</span>

<span style="color: #BA36A5;">dof</span> = <span style="color: #006FE0;">max</span>(0, n-p) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of degrees of freedom</span>

<span style="color: #BA36A5;">tval</span> = t.ppf(1.0-alpha/2., dof) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">student-t value for the dof and confidence level</span>

<span style="color: #0000FF;">for</span> i, p,var <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(<span style="color: #006FE0;">range</span>(n), pars, np.diag(pcov)):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">sigma</span> = var**0.5
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'c{0}: {1} [{2}  {3}]'</span>.<span style="color: #006FE0;">format</span>(i, p,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> p - sigma*tval,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> p + sigma*tval))

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
plt.plot(x,y,<span style="color: #008000;">'bo '</span>)
<span style="color: #BA36A5;">xfit</span> = np.linspace(0,1)
<span style="color: #BA36A5;">yfit</span> = func(xfit, pars[0], pars[1])
plt.plot(xfit,yfit,<span style="color: #008000;">'b-'</span>)
plt.legend([<span style="color: #008000;">'data'</span>,<span style="color: #008000;">'fit'</span>],loc=<span style="color: #008000;">'best'</span>)
plt.savefig(<span style="color: #008000;">'images/nonlin-fit-ci.png'</span>)
</pre>
</div>

<pre class="example">
c0: 4.96713966439 [4.62674476321  5.30753456558]
c1: 2.10995112628 [1.76711622067  2.45278603188]
</pre>


<div class="figure">
<p><img src="./images/nonlin-fit-ci.png" alt="nonlin-fit-ci.png" />
</p>
<p><span class="figure-number">Figure 106:</span> Nonlinear fit to data.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline200" class="outline-4">
<h4 id="orgheadline200"><span class="section-number-4">10.1.10</span> Interpolation with splines</h4>
<div class="outline-text-4" id="text-10-1-10">
<p>
When you do not know the functional form of data to fit an equation, you can still fit/interpolate with splines.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">use splines to fit and interpolate data</span>
<span style="color: #0000FF;">from</span> scipy.interpolate <span style="color: #0000FF;">import</span> interp1d
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> fmin
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.array([ 0,      1,      2,      3,      4    ])
<span style="color: #BA36A5;">y</span> = np.array([ 0.,     0.308,  0.55,   0.546,  0.44 ])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">create the interpolating function</span>
<span style="color: #BA36A5;">f</span> = interp1d(x, y, kind=<span style="color: #008000;">'cubic'</span>, bounds_error=<span style="color: #D0372D;">False</span>)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">to find the maximum, we minimize the negative of the function. We</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cannot just multiply f by -1, so we create a new function here.</span>
<span style="color: #BA36A5;">f2</span> = interp1d(x, -y, kind=<span style="color: #008000;">'cubic'</span>)
<span style="color: #BA36A5;">xmax</span> = fmin(f2, 2.5)

<span style="color: #BA36A5;">xfit</span> = np.linspace(0,4)

plt.plot(x,y,<span style="color: #008000;">'bo'</span>)
plt.plot(xfit, f(xfit),<span style="color: #008000;">'r-'</span>)
plt.plot(xmax, f(xmax),<span style="color: #008000;">'g*'</span>)
plt.legend([<span style="color: #008000;">'data'</span>,<span style="color: #008000;">'fit'</span>,<span style="color: #008000;">'max'</span>], loc=<span style="color: #008000;">'best'</span>, numpoints=1)
plt.xlabel(<span style="color: #008000;">'x data'</span>)
plt.ylabel(<span style="color: #008000;">'y data'</span>)
plt.title(<span style="color: #008000;">'Max point = ({0:1.2f}, {1:1.2f})'</span>.<span style="color: #006FE0;">format</span>(<span style="color: #006FE0;">float</span>(xmax),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #006FE0;">float</span>(f(xmax))))
plt.savefig(<span style="color: #008000;">'images/splinefit.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/splinefit.png" alt="splinefit.png" />
</p>
<p><span class="figure-number">Figure 107:</span> Illustration of a spline fit to data and finding the maximum point.</p>
</div>

<p>
There are other good examples at <a href="http://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html">http://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline201" class="outline-4">
<h4 id="orgheadline201"><span class="section-number-4">10.1.11</span> Interpolation in 3D</h4>
<div class="outline-text-4" id="text-10-1-11">
<p>
You might ask, why would I need to interpolate in 3D? Suppose you want to plot the charge density along a line through a unit cell that does not correspond to grid points. What are you to do? Interpolate. In contrast to an abundance of methods for 1D and 2D interpolation, I could not find any standard library methods for 3D interpolation.
</p>

<p>
The principle we will use to develop an interpolation function in 3D is called trilinear interpolation, where we use multiple linear 1D interpolations to compute the value of a point inside a cube. As developed here, this solution only applies to rectangular grids. Later we will generalize the approach. We state the problem as follows:
</p>

<p>
We know a scalar field inside a unit cell on a regularly spaced grid. In VASP these fields may be the charge density or electrostatic potential for example, and they are known on the fft grids. We want to estimate the value of the scalar field at a point not on the grid, say P=(a,b,c).
</p>

<p>
Solution: Find the cube that contains the point, and is defined by points
    P1-P8 as shown in Figure <a href="#fig:trilinearpinterp">fig:trilinearpinterp</a>.
</p>



<div class="figure">
<p><img src="./images/trilinear-interpolation.png" alt="trilinear-interpolation.png" />
</p>
<p><span class="figure-number">Figure 108:</span> Trilinear interpolation scheme. \label{fig:trilinearpinterp}</p>
</div>

<p>
We use 1D interpolation formulas to compute the value of the scalar field at points I1 by interpolating between P1 and P2, and the value of the scalar field at I2 by interpolating between P3 and P4. In these points the only variable changing is x, so it is a simple 1D interpolation. We can then compute the value of the scalar field at I5 by interpolating between I1 and I2. We repeat the process on the top of the cube, to obtain points I3, I4 and I5. Finally, we compute the value of the scalar field at point P by interpolating between points I5 and I6. Note that the point I5 has coordinates (a,b,z1) and I6 is at (a,b,z2), so the final interpolation is again a 1D interpolation along z evaluated at z=c to get the final value of the scalar field at P=(a,b,c).
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-centered'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span>, <span style="color: #BA36A5;">z</span>, <span style="color: #BA36A5;">cd</span> = calc.get_charge_density()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">interp3d</span>(x,y,z,cd,xi,yi,zi):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   interpolate a cubic 3D grid defined by x,y,z,cd at the point</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   (xi,yi,zi)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">def</span> <span style="color: #006699;">get_index</span>(value,vector):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   assumes vector ordered decreasing to increasing. A bisection</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   search would be faster.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> i,val <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(vector):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">if</span> val &gt; value:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> i-1
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> <span style="color: #D0372D;">None</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">xv</span> = x[:,0,0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yv</span> = y[0,:,0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">zv</span> = z[0,0,:]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">a</span>,<span style="color: #BA36A5;">b</span>,<span style="color: #BA36A5;">c</span> = xi, yi, zi

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span> = get_index(a,xv)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = get_index(b,yv)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = get_index(c,zv)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x1</span> = x[i,j,k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">x2</span> = x[i+1,j,k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">y1</span> = y[i,j,k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">y2</span> = y[i,j+1,k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">z1</span> = z[i,j,k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">z2</span> = z[i,j,k+1]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u1</span> = cd[i, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u2</span> = cd[i+1, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u3</span> = cd[i, j+1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u4</span> = cd[i+1, j+1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u5</span> = cd[i, j, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u6</span> = cd[i+1, j, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u7</span> = cd[i, j+1, k+1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u8</span> = cd[i+1, j+1, k+1]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w1</span> = u2 + (u2-u1)/(x2-x1)*(a-x2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w2</span> = u4 + (u4-u3)/(x2-x1)*(a-x2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w3</span> = w2 + (w2-w1)/(y2-y1)*(b-y2)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w4</span> = u5 + (u6-u5)/(x2-x1)*(a-x1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w5</span> = u7 + (u8-u7)/(x2-x1)*(a-x1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w6</span> = w4 + (w5-w4)/(y2-y1)*(b-y1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">w7</span> = w3 + (w6-w3)/(z2-z1)*(c-z1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u</span> = w7

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> u

<span style="color: #BA36A5;">pos</span> = atoms.get_positions()

<span style="color: #BA36A5;">P1</span> = np.array([0.0, 5.0, 5.0])
<span style="color: #BA36A5;">P2</span> = np.array([9.0, 5.0, 5.0])

<span style="color: #BA36A5;">npoints</span> = 60

<span style="color: #BA36A5;">points</span> = [P1 + n*(P2-P1)/npoints <span style="color: #0000FF;">for</span> n <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(npoints)]

<span style="color: #BA36A5;">R</span> = [np.linalg.norm(p-P1) <span style="color: #0000FF;">for</span> p <span style="color: #0000FF;">in</span> points]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">interpolated line</span>
<span style="color: #BA36A5;">icd</span> = [interp3d(x,y,z,cd,p[0],p[1],p[2]) <span style="color: #0000FF;">for</span> p <span style="color: #0000FF;">in</span> points]

<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

plt.plot(R, icd)
<span style="color: #BA36A5;">cR</span> = np.linalg.norm(pos[0] - P1)
<span style="color: #BA36A5;">oR</span> = np.linalg.norm(pos[1] - P1)
plt.plot([cR, cR], [0, 2], <span style="color: #008000;">'r-'</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">markers for where the nuclei are</span>
plt.plot([oR, oR], [0, 8], <span style="color: #008000;">'r-'</span>)
plt.xlabel(<span style="color: #008000;">'|R| ($\AA$)'</span>)
plt.ylabel(<span style="color: #008000;">'Charge density (e/$\AA^3$)'</span>)
plt.savefig(<span style="color: #008000;">'images/CO-charge-density.png'</span>)
plt.show()
</pre>
</div>

<pre class="example">
None
</pre>


<div class="figure">
<p><img src="./images/CO-charge-density.png" alt="CO-charge-density.png" />
</p>
<p><span class="figure-number">Figure 109:</span> An example of interpolated charge density of a CO molecule along the axis of molecule.</p>
</div>

<p>
To generalize this to non-cubic cells, we need to do interpolation along arbitrary vectors. The overall strategy is the same:
</p>

<p>
Find the cell that contains the point (a,b,c).
compute the scaled coordinates (sa,sb,sc) of the point inside the cell.
Do the interpolations along the basis vectors. Given u1 at P1(x1,y1,z1) and u2 at P2(x2,y2,z2) where (P2-P1) is a cell basis vector a, u = u1 + sa*(u2-u1). There are still 7 interpolations to do.
</p>

<p>
Below is an example of this code, using a the python library bisect to find the cell.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #008000;">'''</span>
<span style="color: #008000;">3D vector interpolation in non-cubic unit cells with vector</span>
<span style="color: #008000;">interpolation.</span>

<span style="color: #008000;">This function should work for any shape unit cell.</span>
<span style="color: #008000;">'''</span>
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">import</span> bisect
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> pylab <span style="color: #0000FF;">import</span> plot, xlabel, ylabel, savefig, show

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/co-centered'</span>)
<span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span>,<span style="color: #BA36A5;">z</span>,<span style="color: #BA36A5;">cd</span> = calc.get_charge_density()

<span style="color: #0000FF;">def</span> <span style="color: #006699;">vinterp3d</span>(x, y, z, u, xi, yi, zi):

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">p</span> = np.array([xi, yi, zi])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">1D arrays of cooridinates</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">xv</span> = x[:, 0, 0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">yv</span> = y[0, :, 0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">zv</span> = z[0, 0, :]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we subtract 1 because bisect tells us where to insert the</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">element to maintain an ordered list, so we want the index to the</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">left of that point</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">i</span> = bisect.bisect_right(xv, xi) - 1
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">j</span> = bisect.bisect_right(yv, yi) - 1
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = bisect.bisect_right(zv, zi) - 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">points at edge of cell. We only need P1, P2, P3, and P5</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P1</span> = np.array([x[i, j, k], y[i, j, k], z[i,j,k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P2</span> = np.array([x[i + 1, j, k], y[i + 1, j, k], z[i + 1, j, k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P3</span> = np.array([x[i, j + 1, k], y[i, j + 1, k], z[i, j + 1, k]])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">P5</span> = np.array([x[i, j, k + 1], y[i, j, k + 1], z[i, j, k + 1]])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">values of u at edge of cell</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u1</span> = u[i, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u2</span> = u[i + 1, j, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u3</span> = u[i, j + 1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u4</span> = u[i + 1, j + 1, k]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u5</span> = u[i, j, k + 1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u6</span> = u[i + 1, j, k + 1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u7</span> = u[i, j + 1, k + 1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">u8</span> = u[i + 1, j + 1, k + 1]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">cell basis vectors, not the unit cell, but the voxel cell containing the point</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">cbasis</span> = np.array([P2 - P1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  P3 - P1,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  P5 - P1])

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now get interpolated point in terms of the cell basis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">s</span> = np.dot(np.linalg.inv(cbasis.T), np.array([xi, yi, zi]) - P1)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now s = (sa, sb, sc) which are fractional coordinates in the vector space</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">next we do the interpolations</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui1</span> = u1 + s[0] * (u2 - u1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui2</span> = u3 + s[0] * (u4 - u3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui3</span> = u5 + s[0] * (u6 - u5)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui4</span> = u7 + s[0] * (u8 - u7)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui5</span> = ui1 + s[1] * (ui2 - ui1)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui6</span> = ui3 + s[1] * (ui4 - ui3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ui7</span> = ui5 + s[2] * (ui6 - ui5)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> ui7

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute a line with 60 points in it through these two points</span>
<span style="color: #BA36A5;">P1</span> = np.array([0.0, 5.0, 5.0])
<span style="color: #BA36A5;">P2</span> = np.array([10.0, 5.0, 5.0])

<span style="color: #BA36A5;">npoints</span> = 60

<span style="color: #BA36A5;">points</span> = [P1 + n * (P2 - P1) / npoints <span style="color: #0000FF;">for</span> n <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(npoints)]

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">compute the distance along the line</span>
<span style="color: #BA36A5;">R</span> = [np.linalg.norm(p - P1) <span style="color: #0000FF;">for</span> p <span style="color: #0000FF;">in</span> points]

<span style="color: #BA36A5;">icd</span> = [vinterp3d(x, y, z, cd, p[0], p[1], p[2]) <span style="color: #0000FF;">for</span> p <span style="color: #0000FF;">in</span> points]

plot(R, icd)
<span style="color: #BA36A5;">pos</span> = atoms.get_positions()
<span style="color: #BA36A5;">cR</span> = np.linalg.norm(pos[0] - P1)
<span style="color: #BA36A5;">oR</span> = np.linalg.norm(pos[1] - P1)
plot([cR, cR], [0, 2], <span style="color: #008000;">'r-'</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">markers for where the nuclei are</span>
plot([oR, oR], [0, 8], <span style="color: #008000;">'r-'</span>)
xlabel(<span style="color: #008000;">'|R| ($\AA$)'</span>)
ylabel(<span style="color: #008000;">'Charge density (e/$\AA^3$)'</span>)
savefig(<span style="color: #008000;">'images/interpolated-charge-density.png'</span>)
show()
</pre>
</div>


<div class="figure">
<p><img src="./images/interpolated-charge-density.png" alt="interpolated-charge-density.png" />
</p>
<p><span class="figure-number">Figure 110:</span> Interpolated charge density for a CO molecule.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline204" class="outline-4">
<h4 id="orgheadline204"><span class="section-number-4">10.1.12</span> Reading and writing data</h4>
<div class="outline-text-4" id="text-10-1-12">
</div><div id="outline-container-orgheadline202" class="outline-5">
<h5 id="orgheadline202"><span class="section-number-5">10.1.12.1</span> Built-in io modules</h5>
<div class="outline-text-5" id="text-10-1-12-1">
<p>
<code>pylab</code> has two convenient and powerful functions for saving and
reading data, <a href="pylab.save">pylab.save</a> and <a href="pylab.load">pylab.load</a>.
</p>

<div class="org-src-container">

<pre class="src src-python">pylab.save(<span style="color: #008000;">'pdat.dat'</span>,(x,y))
</pre>
</div>

<p>
and later you can read these arrays back in with:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = pylab.load(<span style="color: #008000;">'pdat.dat'</span>)
</pre>
</div>

<p>
see also <a href="pylab.csv2rec">pylab.csv2rec</a> and <a href="pylab.loadtxt">pylab.loadtxt</a> and
<a href="pylab.savetxt">pylab.savetxt</a>.
</p>

<p>
See <a href="http://www.scipy.org/Cookbook/InputOutput">http://www.scipy.org/Cookbook/InputOutput</a> for examples of numpy io.
</p>
</div>
</div>

<div id="outline-container-orgheadline203" class="outline-5">
<h5 id="orgheadline203"><span class="section-number-5">10.1.12.2</span> From scratch</h5>
<div class="outline-text-5" id="text-10-1-12-2">
<p>
You can save data in many ways from scratch. Basically, just open a
file and write data to it. Likewise, any datafile that has some
structure to it can probably be read by python.
</p>

<p>
Let us consider a datafile with these contents:
</p>

<pre class="example">
	#header
	#ignore these lines
	john, 4
	robert, 5
	terry, 5
</pre>

<p>
A standard approach would be to read in all the lines, skip the first
two lines, split each line (remember each line is a string) at the
',', and append the first field to one variable, and append the second
field to another variable as an integer.  For example:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">v1</span> = []
<span style="color: #BA36A5;">v2</span> = []
<span style="color: #BA36A5;">lines</span> = <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'somefile'</span>,<span style="color: #008000;">'r'</span>).readlines()

<span style="color: #0000FF;">for</span> line <span style="color: #0000FF;">in</span> lines[2:]: <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">skip the first two lines</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">fields</span> = line.split(<span style="color: #008000;">','</span>)
        v1.append(fields[0]) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">names</span>
        v2.append(<span style="color: #006FE0;">int</span>(fields[1])) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">number</span>
</pre>
</div>

<p>
Writing datafiles is easy too.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">v1</span> = [<span style="color: #008000;">'john'</span>, <span style="color: #008000;">'robert'</span>, <span style="color: #008000;">'terry'</span>]
<span style="color: #BA36A5;">v2</span> = [4,5,6]
<span style="color: #BA36A5;">f</span> = <span style="color: #006FE0;">open</span>(<span style="color: #008000;">'somefile'</span>, <span style="color: #008000;">'w'</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">note 'w' = write mode</span>
f.write(<span style="color: #008000;">'#header\n'</span>)
f.write(<span style="color: #008000;">'#ignore these lines\n'</span>)
<span style="color: #0000FF;">for</span> a,b <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">zip</span>(v1,v2):
        f.write(<span style="color: #008000;">'{0}, {1}\n'</span>.<span style="color: #006FE0;">format</span>(a,b))
f.close()
</pre>
</div>

<p>
Some notes:
</p>
<ol class="org-ol">
<li>opening a file in 'w' mode clobbers any existing file, so do that</li>
</ol>
<p>
with care!
</p>
<ol class="org-ol">
<li>when writing to a file you have to add a carriage return to each line.</li>
<li>Manually writing and reading files is pretty tedious. Whenever</li>
</ol>
<p>
possible you should use the built-in methods of <a href="numpy">numpy</a> or <a href="pylab">pylab</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline205" class="outline-4">
<h4 id="orgheadline205"><span class="section-number-4">10.1.13</span> Integration</h4>
<div class="outline-text-4" id="text-10-1-13">
<p>
Numerical integrations is easy with the numpy.trapz() method. Use it like this: <a href="numpy.trapz">numpy.trapz</a>(y,x). Note that y comes first. y and x must be the same length.
</p>

<p>
Integration can be used to calculate average properties of continuous distributions. Suppose for example, we have a density of states, &rho; as a function of energy E. We can integrate the density of states to find the total number of states:
</p>

<p>
\(N_{states} = \int \rho dE\)
</p>

<p>
or, in python:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">Nstates</span> = np.trapz(rho,E)
</pre>
</div>

<p>
where rho is a vector that contains the density of states at each energy in the vector E (vector here means a list of numbers).
</p>

<p>
The average energy of distribution is:
</p>

<p>
\(E_{avg} = \frac{\int \rho E dE}{\int \rho dE}\)
</p>

<p>
or, in python:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">e_avg</span> = np.trapz(rho*E,E)/np.trapz(rho,E)
</pre>
</div>

<p>
These last two examples are the zeroth and first moments of the density of states. The second moment is related to the width squared of the distribution, and the third and fourth moements are related to skewness and kurtosis of the distribution.
</p>

<p>
The nth moment is defined by:
</p>

<p>
\(m_n = \frac{\int \rho*E^n dE}{\int \rho dE}\)
</p>

<p>
To get the second moment of the density of states in python, we use::
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">n</span> = 2
<span style="color: #BA36A5;">mom_2</span> = np.trapz(rho*E**n,E)/np.trapz(rho,E)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline208" class="outline-4">
<h4 id="orgheadline208"><span class="section-number-4">10.1.14</span> Numerical differentiation</h4>
<div class="outline-text-4" id="text-10-1-14">
<p>
numpy has a function called <a href="numpy.diff">numpy.diff</a> that is similar to the one found in Matlab. It calculates the differences between the elements in your list, and returns a list that is one element shorter, which makes it unsuitable for plotting the derivative of a function.
</p>
</div>

<div id="outline-container-orgheadline206" class="outline-5">
<h5 id="orgheadline206"><span class="section-number-5">10.1.14.1</span> Simple loops to define finite difference derivatives</h5>
<div class="outline-text-5" id="text-10-1-14-1">
<p>
Loops in python are pretty slow (relatively speaking) but they are usually trivial to understand. In this script we show some simple ways to construct derivative vectors using loops. It is implied in these formulas that the data points are equally spaced.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">import</span> time

<span style="color: #008000;">'''</span>
<span style="color: #008000;">These are the brainless way to calculate numerical derivatives. They</span>
<span style="color: #008000;">work well for very smooth data. they are surprisingly fast even up to</span>
<span style="color: #008000;">10000 points in the vector.</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">x</span> = np.linspace(0.78, 0.79, 100) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">100 points between 0.78 and 0.79</span>
<span style="color: #BA36A5;">y</span> = np.sin(x)
<span style="color: #BA36A5;">dy_analytical</span> = np.cos(x)
<span style="color: #008000;">'''</span>
<span style="color: #008000;">let us use a forward difference method:</span>
<span style="color: #008000;">that works up until the last point, where there is not</span>
<span style="color: #008000;">a forward difference to use. there, we use a backward difference.</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">tf1</span> = time.time()
<span style="color: #BA36A5;">dyf</span> = [0.0]*<span style="color: #006FE0;">len</span>(x)
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(y)-1):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dyf</span>[i] = (y[i+1] - y[i])/(x[i+1]-x[i])
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">set last element by backwards difference</span>
<span style="color: #BA36A5;">dyf</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">' Forward difference took {0:1.1f} seconds'</span>.<span style="color: #006FE0;">format</span>(time.time() - tf1))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">and now a backwards difference</span>
<span style="color: #BA36A5;">tb1</span> = time.time()
<span style="color: #BA36A5;">dyb</span> = [0.0]*<span style="color: #006FE0;">len</span>(x)
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">set first element by forward difference</span>
<span style="color: #BA36A5;">dyb</span>[0] = (y[0] - y[1])/(x[0] - x[1])
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(1,<span style="color: #006FE0;">len</span>(y)):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dyb</span>[i] = (y[i] - y[i-1])/(x[i]-x[i-1])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">' Backward difference took {0:1.1f} seconds'</span>.<span style="color: #006FE0;">format</span>(time.time() - tb1))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">and now, a centered formula</span>
<span style="color: #BA36A5;">tc1</span> = time.time()
<span style="color: #BA36A5;">dyc</span> = [0.0]*<span style="color: #006FE0;">len</span>(x)
<span style="color: #BA36A5;">dyc</span>[0] = (y[0] - y[1])/(x[0] - x[1])
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(1,<span style="color: #006FE0;">len</span>(y)-1):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dyc</span>[i] = (y[i+1] - y[i-1])/(x[i+1]-x[i-1])
<span style="color: #BA36A5;">dyc</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">' Centered difference took {0:1.1f} seconds'</span>.<span style="color: #006FE0;">format</span>(time.time() - tc1))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the centered formula is the most accurate formula here</span>


plt.plot(x,dy_analytical, label=<span style="color: #008000;">'analytical derivative'</span>)
plt.plot(x,dyf,<span style="color: #008000;">'--'</span>, label=<span style="color: #008000;">'forward'</span>)
plt.plot(x,dyb,<span style="color: #008000;">'--'</span>, label=<span style="color: #008000;">'backward'</span>)
plt.plot(x,dyc,<span style="color: #008000;">'--'</span>, label=<span style="color: #008000;">'centered'</span>)

plt.legend(loc=<span style="color: #008000;">'lower left'</span>)
plt.savefig(<span style="color: #008000;">'images/simple-diffs.png'</span>)
</pre>
</div>

<pre class="example">
Forward difference took 0.0 seconds
Backward difference took 0.0 seconds
Centered difference took 0.0 seconds
</pre>

<p>
Obviously, all of these evaluations are very fast.
</p>


<div class="figure">
<p><img src="./images/simple-diffs.png" alt="simple-diffs.png" />
</p>
<p><span class="figure-number">Figure 111:</span> Comparison of different numerical derivatives.</p>
</div>

<p>
Loops are usually not great for performance. Numpy offers some vectorized methods that allow us to compute derivatives without loops, although this comes at the mental cost of harder to understand syntax:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.linspace(0,2*np.pi,100)
<span style="color: #BA36A5;">y</span> = np.sin(x)
<span style="color: #BA36A5;">dy_analytical</span> = np.cos(x)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we need to specify the size of dy ahead because diff returns</span>
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">an array of n-1 elements</span>
<span style="color: #BA36A5;">dy</span> = np.zeros(y.shape,np.<span style="color: #006FE0;">float</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we know it will be this size</span>
<span style="color: #BA36A5;">dy</span>[0:-1] = np.diff(y)/np.diff(x)
<span style="color: #BA36A5;">dy</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])


<span style="color: #008000;">'''</span>
<span style="color: #008000;">calculate dy by center differencing using array slices</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">dy2</span> = np.zeros(y.shape,np.<span style="color: #006FE0;">float</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we know it will be this size</span>
<span style="color: #BA36A5;">dy2</span>[1:-1] = (y[2:] - y[0:-2])/(x[2:] - x[0:-2])
<span style="color: #BA36A5;">dy2</span>[0] = (y[1]-y[0])/(x[1]-x[0])
<span style="color: #BA36A5;">dy2</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

plt.plot(x,y)
plt.plot(x,dy_analytical,label=<span style="color: #008000;">'analytical derivative'</span>)
plt.plot(x,dy,label=<span style="color: #008000;">'forward diff'</span>)
plt.plot(x,dy2,<span style="color: #008000;">'k--'</span>,lw=2,label=<span style="color: #008000;">'centered diff'</span>)
plt.legend(loc=<span style="color: #008000;">'lower left'</span>)
plt.savefig(<span style="color: #008000;">'images/vectorized-diffs.png'</span>)
</pre>
</div>

<pre class="example">
None
</pre>


<div class="figure">
<p><img src="./images/vectorized-diffs.png" alt="vectorized-diffs.png" />
</p>
<p><span class="figure-number">Figure 112:</span> Comparison of different numerical derivatives.</p>
</div>

<p>
If your data is very noisy, you will have a hard time getting good derivatives; derivatives tend to magnify noise. In these cases, you have to employ smoothing techniques, either implicitly by using a multipoint derivative formula, or explicitly by smoothing the data yourself, or taking the derivative of a function that has been fit to the data in the neighborhood you are interested in.
</p>

<p>
Here is an example of a 4-point centered difference of some noisy data:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">x</span> = np.linspace(0,2*np.pi,100)
<span style="color: #BA36A5;">y</span> = np.sin(x) + 0.1*np.random.random(size=x.shape)
<span style="color: #BA36A5;">dy_analytical</span> = np.cos(x)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">2-point formula</span>
<span style="color: #BA36A5;">dyf</span> = [0.0]*<span style="color: #006FE0;">len</span>(x)
<span style="color: #0000FF;">for</span> i <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">range</span>(<span style="color: #006FE0;">len</span>(y)-1):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">dyf</span>[i] = (y[i+1] - y[i])/(x[i+1]-x[i])
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">set last element by backwards difference</span>
<span style="color: #BA36A5;">dyf</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

<span style="color: #008000;">'''</span>
<span style="color: #008000;">calculate dy by 4-point center differencing using array slices</span>

<span style="color: #008000;">\frac{y[i-2] - 8y[i-1] + 8[i+1] - y[i+2]}{12h}</span>

<span style="color: #008000;">y[0] and y[1] must be defined by lower order methods</span>
<span style="color: #008000;">and y[-1] and y[-2] must be defined by lower order methods</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">dy</span> = np.zeros(y.shape,np.<span style="color: #006FE0;">float</span>) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we know it will be this size</span>
<span style="color: #BA36A5;">h</span> = x[1]-x[0] <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">this assumes the points are evenely spaced!</span>
<span style="color: #BA36A5;">dy</span>[2:-2] = (y[0:-4] - 8*y[1:-3] + 8*y[3:-1] - y[4:])/(12.*h)

<span style="color: #BA36A5;">dy</span>[0] = (y[1]-y[0])/(x[1]-x[0])
<span style="color: #BA36A5;">dy</span>[1] = (y[2]-y[1])/(x[2]-x[1])
<span style="color: #BA36A5;">dy</span>[-2] = (y[-2] - y[-3])/(x[-2] - x[-3])
<span style="color: #BA36A5;">dy</span>[-1] = (y[-1] - y[-2])/(x[-1] - x[-2])

plt.plot(x,y)
plt.plot(x,dy_analytical,label=<span style="color: #008000;">'analytical derivative'</span>)
plt.plot(x,dyf,<span style="color: #008000;">'r-'</span>,label=<span style="color: #008000;">'2pt-forward diff'</span>)
plt.plot(x,dy,<span style="color: #008000;">'k--'</span>,lw=2,label=<span style="color: #008000;">'4pt-centered diff'</span>)
plt.legend(loc=<span style="color: #008000;">'lower left'</span>)
plt.savefig(<span style="color: #008000;">'images/multipt-diff.png'</span>)
</pre>
</div>

<pre class="example">
None
</pre>


<div class="figure">
<p><img src="./images/multipt-diff.png" alt="multipt-diff.png" />
</p>
<p><span class="figure-number">Figure 113:</span> Comparison of 2 point and 4 point numerical derivatives.</p>
</div>

<p>
The derivative is still noisy, but the four-point derivative is a little better than the two-pt formula.
</p>
</div>
</div>

<div id="outline-container-orgheadline207" class="outline-5">
<h5 id="orgheadline207"><span class="section-number-5">10.1.14.2</span> FFT derivatives</h5>
<div class="outline-text-5" id="text-10-1-14-2">
<p>
It is possible to perform derivatives using fast fourier transforms (FFT):
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt

<span style="color: #BA36A5;">N</span> = 101 <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">number of points</span>
<span style="color: #BA36A5;">L</span> = 2*np.pi <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">interval of data</span>

<span style="color: #BA36A5;">x</span> = np.arange(0.0,L,L/<span style="color: #006FE0;">float</span>(N)) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">this does not include the endpoint</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">add some random noise</span>
<span style="color: #BA36A5;">y</span> = np.sin(x) + 0.05*np.random.random(size=x.shape)
<span style="color: #BA36A5;">dy_analytical</span> = np.cos(x)

<span style="color: #008000;">'''</span>
<span style="color: #008000;">http://sci.tech-archive.net/Archive/sci.math/2008-05/msg00401.html</span>

<span style="color: #008000;">you can use fft to calculate derivatives!</span>
<span style="color: #008000;">'''</span>

<span style="color: #0000FF;">if</span> N % 2 == 0:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = np.asarray(<span style="color: #006FE0;">range</span>(0,N/2)+[0] + <span style="color: #006FE0;">range</span>(-N/2+1,0))
<span style="color: #0000FF;">else</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">k</span> = np.asarray(<span style="color: #006FE0;">range</span>(0,(N-1)/2) +[0] + <span style="color: #006FE0;">range</span>(-(N-1)/2,0))

<span style="color: #BA36A5;">k</span> *= 2*np.pi/L

<span style="color: #BA36A5;">fd</span> = np.fft.ifft(1.j*k * np.fft.fft(y))

plt.plot(x,y)
plt.plot(x,dy_analytical,label=<span style="color: #008000;">'analytical der'</span>)
plt.plot(x,fd,label=<span style="color: #008000;">'fft der'</span>)
plt.legend(loc=<span style="color: #008000;">'lower left'</span>)

plt.savefig(<span style="color: #008000;">'images/fft-der.png'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./images/fft-der.png" alt="fft-der.png" />
</p>
<p><span class="figure-number">Figure 114:</span> Comparison of FFT numerical derivatives.</p>
</div>

<p>
This example does not show any major advantage in the quality of the derivative, and it is almost certain I would never remember how to do this off the top of my head.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline209" class="outline-4">
<h4 id="orgheadline209"><span class="section-number-4">10.1.15</span> NetCDF files</h4>
<div class="outline-text-4" id="text-10-1-15">
<p>
<a href="http://www.unidata.ucar.edu/software/netcdf">NetCDF</a> is a binary,
but cross-platform structured data format.        The input file and
output file for Dacapo is the NetCDF format. On creating a NetCDF file
you must define the dimensions and variables before you can store data
in them. You can create and read NetCDF files in python using one of
the following modules:
</p>

<p>
<a href="Scientific.IO.NetCDF">Scientific.IO.NetCDF</a>
(<a href="http://dirac.cnrs-orleans.fr/plone/software/scientificpython/">http://dirac.cnrs-orleans.fr/plone/software/scientificpython/</a>)
</p>

<p>
<a href="netCDF3">netCDF3</a> (<a href="http://netcdf4-python.googlecode.com/svn/trunk/docs/netCDF3-module.html">http://netcdf4-python.googlecode.com/svn/trunk/docs/netCDF3-module.html</a>)
</p>

<p>
<a href="pycdf">pycdf</a> (<a href="http://pysclint.sourceforge.net/pycdf/">http://pysclint.sourceforge.net/pycdf/</a>) this is a very
low level module modelled after the C-api. I am not sure it is completely
bug-free (I have problems with character variables)
</p>
</div>
</div>

<div id="outline-container-orgheadline210" class="outline-4">
<h4 id="orgheadline210"><span class="section-number-4">10.1.16</span> Python modules</h4>
<div class="outline-text-4" id="text-10-1-16">
<p>
The comma separated values (<a href="csv">csv</a>) module in python allows you to
easily create datafiles:
</p>

<p>
csv writing:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">x</span> = np.linspace(0.0,6.0,100)
<span style="color: #BA36A5;">y</span> = np.cos(x)

<span style="color: #0000FF;">import</span> csv
<span style="color: #BA36A5;">writer</span> = csv.writer(<span style="color: #006FE0;">open</span>(<span style="color: #008000;">"some.csv"</span>, <span style="color: #008000;">"w"</span>))
writer.writerows(<span style="color: #006FE0;">zip</span>(x,y))
</pre>
</div>

<p>
It is not so easy to read the data back in though because the module
only returns strings, so you must turn the strings back into floats (or
whatever other format they should be).
</p>

<p>
csv reading:
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> csv
<span style="color: #BA36A5;">reader</span> = csv.reader(<span style="color: #006FE0;">open</span>(<span style="color: #008000;">"some.csv"</span>,<span style="color: #008000;">'r'</span>),delimiter=<span style="color: #008000;">','</span>)

<span style="color: #BA36A5;">x</span>,<span style="color: #BA36A5;">y</span> = [],[]
<span style="color: #0000FF;">for</span> row <span style="color: #0000FF;">in</span> reader:
<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">csv returns strings that must be cast as floats</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">a</span>,<span style="color: #BA36A5;">b</span> = [<span style="color: #006FE0;">float</span>(z) <span style="color: #0000FF;">for</span> z <span style="color: #0000FF;">in</span> row]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   x.append(a)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   y.append(b)
</pre>
</div>

<p>
This is almost as much work as manually reading the data though. The
module is more powerful than I have shown here, so one day checkout
<code>pydoc csv</code>.
</p>

<p>
The <a href="pickle">pickle</a> and <a href="shelve">shelve</a> modules of python also offer some
data storage functionality. Check them out some day too.
</p>
</div>
</div>

<div id="outline-container-orgheadline213" class="outline-4">
<h4 id="orgheadline213"><span class="section-number-4">10.1.17</span> Writing and reading Excel files</h4>
<div class="outline-text-4" id="text-10-1-17">
</div><div id="outline-container-orgheadline211" class="outline-5">
<h5 id="orgheadline211"><span class="section-number-5">10.1.17.1</span> Writing Excel files</h5>
<div class="outline-text-5" id="text-10-1-17-1">
<p>
It is sometimes convenient to do some analysis in Excel. We can create Excel files in python with <a href="xlwt">xlwt</a>. Google this module if you need to do this a lot.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> xlwt

<span style="color: #BA36A5;">wbk</span> = xlwt.Workbook()
<span style="color: #BA36A5;">sheet</span> = wbk.add_sheet(<span style="color: #008000;">'sheet 1'</span>)

<span style="color: #BA36A5;">volumes</span> = np.array([13.72, 14.83, 16.0, 17.23, 18.52])
<span style="color: #BA36A5;">energies</span> = np.array([-56.29, -56.41, -56.46, -56.46, -56.42])

<span style="color: #0000FF;">for</span> i, pair <span style="color: #0000FF;">in</span> <span style="color: #006FE0;">enumerate</span>(<span style="color: #006FE0;">zip</span>(volumes, energies)):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">vol</span> = pair[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">energy</span> = pair[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sheet.write(i,0,vol)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sheet.write(i,1,energy)
wbk.save(<span style="color: #008000;">'images/test-write.xls'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline212" class="outline-5">
<h5 id="orgheadline212"><span class="section-number-5">10.1.17.2</span> Reading Excel files</h5>
<div class="outline-text-5" id="text-10-1-17-2">
<p>
We can also read Excel files (even on Linux!) with <a href="xlrd">xlrd</a>. Let us read in the data we just wrote. We wrote 5 volumes to column 0, and 5 energies to column 1.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> xlrd
<span style="color: #BA36A5;">wbk</span> = xlrd.open_workbook(<span style="color: #008000;">'images/test-write.xls'</span>)
<span style="color: #BA36A5;">sheet1</span> = wbk.sheet_by_name(<span style="color: #008000;">'sheet 1'</span>)
<span style="color: #0000FF;">print</span>(sheet1.col_values(0))
<span style="color: #0000FF;">print</span>(sheet1.col_values(1))
</pre>
</div>

<pre class="example">
[13.72, 14.83, 16.0, 17.23, 18.52]
[-56.29, -56.41, -56.46, -56.46, -56.42]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline214" class="outline-4">
<h4 id="orgheadline214"><span class="section-number-4">10.1.18</span> <span class="todo TODO">TODO</span> making movies</h4>
<div class="outline-text-4" id="text-10-1-18">
<ol class="org-ol">
<li>using animate</li>
<li>using swftools (png2swf, pdf2swf)</li>
</ol>
<p>
#<a href="http://wiki.swftools.org/wiki/Main_Page#SWF_Tools_0.9.2_.28_Current_Stable_Version_.29_Documentation">http://wiki.swftools.org/wiki/Main_Page#SWF_Tools_0.9.2_.28_Current_Stable_Version_.29_Documentation</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline220" class="outline-3">
<h3 id="orgheadline220"><span class="section-number-3">10.2</span> Computational geometry</h3>
<div class="outline-text-3" id="text-10-2">
</div><div id="outline-container-orgheadline216" class="outline-4">
<h4 id="orgheadline216"><span class="section-number-4">10.2.1</span> Changing coordinate systems</h4>
<div class="outline-text-4" id="text-10-2-1">
<p>
Let A, B, C be the unit cell vectors
</p>

\begin{eqnarray}
A = A1 x + A2 y + A3 z \\
B = B1 x + B2 y + B3 z \\
C = C1 x + C2 y + C3 z
\end{eqnarray}

<p>
and we want to find the vector \([s1, s2, s3]\) so that
\(P = s1 A + s2 B + s3 C \)
</p>

<p>
if we expand this, we get:
</p>

\begin{align*}
&s1 A1 x + s1 A2 y + s1 A3 z   \\
&+ s2 B1 x + s2 B2 y + s2 B3 z \\
&+ s3 C1 x + s3 C2 y + s3 C3 z = p1 x + p2 y + p3 z
\end{align*}

<p>
If we now match coefficients on x, y, and z, we can write a set of
linear equations as:
</p>

\begin{equation}
\left [ \begin{array}{ccc}
A1 & B1 & C1 \\
A2 & B2 & C2 \\
A3 & B3 & C3
\end{array}\right]
\left [ \begin{array}{c}
s1 \\
s2 \\
s3 \end{array}\right] =
\left [\begin{array}{c}
p1 \\ p2 \\ p3 \end{array}\right]
\end{equation}

<p>
or, in standard form:
</p>

<p>
\(A^T s = p\)
</p>

<p>
and we need to solve for s as:
</p>

<p>
\(s = (A^T)^{-1} \cdot p\)
</p>

<p>
p must be a column vector, so we will have to transpose the positions
provided by the atoms class, and then transpose the final result to
get the positions back into row-vector form:
</p>

<p>
\(s = ((A^T)^{-1} p^T)^T\)
</p>

<p>
Here we implement that in code:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.surface <span style="color: #0000FF;">import</span> fcc111
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
np.set_printoptions(precision=3,suppress=<span style="color: #D0372D;">True</span>)

<span style="color: #BA36A5;">slab</span> = fcc111(<span style="color: #008000;">'Pd'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> a=3.92,       <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Pd lattice constant</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> size=(2,2,3), <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">3-layer slab in 1x1 configuration</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> vacuum=10.0)

<span style="color: #BA36A5;">pos</span> = slab.get_positions() <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">these positions use x,y,z vectors as a basis</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">we want to see the atoms in terms of the unitcell vectors</span>
<span style="color: #BA36A5;">newbasis</span> = slab.get_cell()

<span style="color: #BA36A5;">s</span> = np.dot(np.linalg.inv(newbasis.T),pos.T).T
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Coordinates in new basis are: \n'</span>,s)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">what we just did is equivalent to the following atoms method</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Scaled coordinates from ase are: \n'</span>,slab.get_scaled_positions())
</pre>
</div>

<pre class="example">
Coordinates in new basis are:
[[ 0.167  0.167  0.408]
 [ 0.667  0.167  0.408]
 [ 0.167  0.667  0.408]
 [ 0.667  0.667  0.408]
 [-0.167  0.333  0.5  ]
 [ 0.333  0.333  0.5  ]
 [-0.167  0.833  0.5  ]
 [ 0.333  0.833  0.5  ]
 [ 0.     0.     0.592]
 [ 0.5    0.     0.592]
 [ 0.     0.5    0.592]
 [ 0.5    0.5    0.592]]
Scaled coordinates from ase are:
[[ 0.167  0.167  0.408]
 [ 0.667  0.167  0.408]
 [ 0.167  0.667  0.408]
 [ 0.667  0.667  0.408]
 [ 0.833  0.333  0.5  ]
 [ 0.333  0.333  0.5  ]
 [ 0.833  0.833  0.5  ]
 [ 0.333  0.833  0.5  ]
 [ 0.     0.     0.592]
 [ 0.5    0.     0.592]
 [ 0.     0.5    0.592]
 [ 0.5    0.5    0.592]]
</pre>


<p>
The method shown above is general to all basis set transformations. We
examine another case next. Sometimes it is nice if all the coordinates
are integers. For this example, we will use the bcc primitive lattice
vectors and express the positions of each atom in terms of them. By
definition each atomic position should be an integer combination of
the primitive lattice vectors (before relaxation, and assuming one
atom is at the origin, and the unit cell is aligned with the primitive
basis!)
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> BodyCenteredCubic
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #BA36A5;">bulk</span> = BodyCenteredCubic(directions=[[1,0,0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0,1,0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0,0,1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>size=(2,2,2),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>latticeconstant=2.87,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>symbol=<span style="color: #008000;">'Fe'</span>)


<span style="color: #BA36A5;">newbasis</span> = 2.87*np.array([[-0.5, 0.5, 0.5],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0.5, -0.5, 0.5],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> [0.5, 0.5, -0.5]])

<span style="color: #BA36A5;">pos</span> = bulk.get_positions()

<span style="color: #BA36A5;">s</span> = np.dot(np.linalg.inv(newbasis.T), pos.T).T
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'atom positions in primitive basis'</span>)
<span style="color: #0000FF;">print</span>(s)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">let us see the unit cell in terms of the primitive basis too</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'unit cell in terms of the primitive basis'</span>)
<span style="color: #0000FF;">print</span>(np.dot(np.linalg.inv(newbasis.T), bulk.get_cell().T).T)
</pre>
</div>

<pre class="example">
atom positions in primitive basis
[[ 0.  0.  0.]
 [ 1.  1.  1.]
 [ 0.  1.  1.]
 [ 1.  2.  2.]
 [ 1.  0.  1.]
 [ 2.  1.  2.]
 [ 1.  1.  2.]
 [ 2.  2.  3.]
 [ 1.  1.  0.]
 [ 2.  2.  1.]
 [ 1.  2.  1.]
 [ 2.  3.  2.]
 [ 2.  1.  1.]
 [ 3.  2.  2.]
 [ 2.  2.  2.]
 [ 3.  3.  3.]]
unit cell in terms of the primitive basis
[[ 0.  2.  2.]
 [ 2.  0.  2.]
 [ 2.  2.  0.]]
</pre>
</div>
</div>

<div id="outline-container-orgheadline217" class="outline-4">
<h4 id="orgheadline217"><span class="section-number-4">10.2.2</span> Simple distances, angles</h4>
<div class="outline-text-4" id="text-10-2-2">
<p>
<code>Scientific.Geometry</code> contains several useful functions for
performing vector algebra including computing lengths and angles.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> Scientific.Geometry <span style="color: #0000FF;">import</span> Vector

<span style="color: #BA36A5;">A</span> = Vector([1, 1, 1])   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Scientfic</span>
<span style="color: #BA36A5;">a</span> = np.array([1, 1, 1])  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">numpy</span>

<span style="color: #BA36A5;">B</span> = Vector([0.0, 1.0, 0.0])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|A| = '</span>, A.length())        <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Scientific Python way</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|a| = '</span>, np.<span style="color: #006FE0;">sum</span>(a**2)**0.5)  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">numpy way</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|a| = '</span>, np.linalg.norm(a))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">numpy way 2</span>

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'ScientificPython angle = '</span>, A.angle(B))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">in radians</span>
<span style="color: #0000FF;">print</span> (<span style="color: #008000;">'numpy angle = {}'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  np.arccos(np.dot(a / np.linalg.norm(a),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   B / np.linalg.norm(B))))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">cross products</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'Scientific A .cross. B = '</span>, A.cross(B))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">you can use Vectors in numpy</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'numpy A .cross. B      = '</span>, np.cross(A,B))
</pre>
</div>

<pre class="example">
('|A| = ', 1.7320508075688772)
('|a| = ', 1.7320508075688772)
('|a| = ', 1.7320508075688772)
('ScientificPython angle = ', 0.9553166181245092)
('numpy angle = {}', 0.95531661812450919)
('Scientific A .cross. B = ', Vector(-1.000000,0.000000,1.000000))
('numpy A .cross. B      = ', array([-1.,  0.,  1.]))
</pre>
</div>
</div>

<div id="outline-container-orgheadline218" class="outline-4">
<h4 id="orgheadline218"><span class="section-number-4">10.2.3</span> Unit cell properties</h4>
<div class="outline-text-4" id="text-10-2-3">
<p>
The volume of a unit cell can be calculated from \(V = (a_1 \times a_2)
\cdot a_3\) where \(a_1\), \(a_2\) and \(a_3\) are the unit cell vectors. It
is more convenient, however, to simply evaluate that equation as the
determinant of the matrix describing the unit cell, where each row of
the matrix is a unit cell vector.
</p>

<p>
\(V = |\det(ucell)|\)
</p>

<p>
Why do we need to take the absolute value? The sign of the determinant
depends on the handedness of the order of the unit cell vectors. If
they are right-handed the determinant will be positive, and if they
are left-handed the determinant will be negative. Switching any two
rows will change the sign of the determinant and the
handedness. <a href="ase">ase</a> implements a convenient function to get the
volume of an <a href="Atoms">Atoms</a> object: <a href="ase.Atoms.get_volume">ase.Atoms.get_volume</a>.
</p>

<p>
Here are three equivalent ways to compute the unit cell volume.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">a1</span> = [2, 0, 0]
<span style="color: #BA36A5;">a2</span> = [1, 1, 0]
<span style="color: #BA36A5;">a3</span> = [0, 0, 10]

<span style="color: #BA36A5;">uc</span> = np.array([a1, a2, a3])

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'V = {0} ang^3 from dot/cross'</span>.<span style="color: #006FE0;">format</span>(np.dot(np.cross(a1,a2),a3)))
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'V = {0} ang^3 from det'</span>.<span style="color: #006FE0;">format</span>(np.linalg.det(uc)))

<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms

<span style="color: #BA36A5;">atoms</span> = Atoms([],cell=uc) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">empty list of atoms</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'V = {0} ang^3 from get_volume'</span>.<span style="color: #006FE0;">format</span>(atoms.get_volume()))
</pre>
</div>

<pre class="example">
V = 20 ang^3 from dot/cross
V = 20.0 ang^3 from det
V = 20.0 ang^3 from get_volume
</pre>
</div>
</div>

<div id="outline-container-orgheadline219" class="outline-4">
<h4 id="orgheadline219"><span class="section-number-4">10.2.4</span> d-spacing</h4>
<div class="outline-text-4" id="text-10-2-4">
<p>
If you like to set up the vacuum in your slab calculations in terms of
equivalent layers of atoms, you need to calculate the d-spacing (which
is the spacing between parallel planes of atoms) for the hkl plane you
are using. The script below shows several ways to accomplish that.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">from</span> ase.lattice.cubic <span style="color: #0000FF;">import</span> FaceCenteredCubic

<span style="color: #BA36A5;">ag</span> = FaceCenteredCubic(directions=[[1, 0, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0, 1, 0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0, 0, 1]],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  size=(1, 1, 1),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  symbol=<span style="color: #008000;">'Ag'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  latticeconstant=4.0)

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">these are the reciprocal lattice vectors</span>
<span style="color: #BA36A5;">b1</span>, <span style="color: #BA36A5;">b2</span>, <span style="color: #BA36A5;">b3</span> = np.linalg.inv(ag.get_cell())

<span style="color: #008000;">'''</span>
<span style="color: #008000;">g(111) = 1*b1 + 1*b2 + 1*b3</span>

<span style="color: #008000;">and |g(111)| = 1/d_111</span>
<span style="color: #008000;">'''</span>
<span style="color: #BA36A5;">h</span>,<span style="color: #BA36A5;">k</span>,<span style="color: #BA36A5;">l</span> = (1, 1, 1)
<span style="color: #BA36A5;">d</span> = 1./np.linalg.norm(h*b1 + k*b2 + l*b3)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'d_111 spacing (method 1) = {0:1.3f} Angstroms'</span>.<span style="color: #006FE0;">format</span>(d))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">method #2</span>
<span style="color: #BA36A5;">hkl</span> = np.array([h, k, l])
<span style="color: #BA36A5;">G</span> = np.array([b1, b2, b3])  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reciprocal unit cell</span>

<span style="color: #008000;">'''</span>
<span style="color: #008000;">Gstar is usually defined as this matrix of dot products:</span>

<span style="color: #008000;">Gstar = np.array([[dot(b1,b1), dot(b1,b2), dot(b1,b3)],</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;"> [dot(b1,b2), dot(b2,b2), dot(b2,b3)],</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   </span><span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;"> [dot(b1,b3), dot(b2,b3), dot(b3,b3)]])</span>

<span style="color: #008000;">but I prefer the notationally more compact:</span>
<span style="color: #008000;">Gstar = G .dot. transpose(G)</span>

<span style="color: #008000;">then, 1/d_hkl^2 = hkl .dot. Gstar .dot. hkl</span>
<span style="color: #008000;">'''</span>

<span style="color: #BA36A5;">Gstar</span> = np.dot(G, G.T)

<span style="color: #BA36A5;">id2</span> = np.dot(hkl, np.dot(Gstar, hkl))

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'d_111 spacing (method 2) ='</span>,np.sqrt(1 / id2))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">http://books.google.com/books?id=nJHSqEseuIUC&amp;lpg=PA118&amp;ots=YA9TBldoVH</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">&amp;dq=reciprocal%20metric%20tensor&amp;pg=PA119#v=onepage</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">&amp;q=reciprocal%20metric%20tensor&amp;f=false</span>

<span style="color: #008000;">'''Finally, many text books on crystallography use long algebraic</span>
<span style="color: #008000;">formulas for computing the d-spacing with sin and cos, vector lengths,</span>
<span style="color: #008000;">and angles. Below we compute these and use them in the general</span>
<span style="color: #008000;">triclinic structure formula which applies to all the structures.</span>
<span style="color: #008000;">'''</span>
<span style="color: #0000FF;">from</span> Scientific.Geometry <span style="color: #0000FF;">import</span> Vector
<span style="color: #0000FF;">import</span> math

<span style="color: #BA36A5;">unitcell</span> = ag.get_cell()
<span style="color: #BA36A5;">A</span> = Vector(unitcell[0])
<span style="color: #BA36A5;">B</span> = Vector(unitcell[1])
<span style="color: #BA36A5;">C</span> = Vector(unitcell[2])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">lengths of the vectors</span>
<span style="color: #BA36A5;">a</span> = A.length()<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">*angstroms2bohr</span>
<span style="color: #BA36A5;">b</span> = B.length()<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">*angstroms2bohr</span>
<span style="color: #BA36A5;">c</span> = C.length()<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">*angstroms2bohr</span>

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">angles between the vectors in radians</span>
<span style="color: #BA36A5;">alpha</span> = B.angle(C)
<span style="color: #BA36A5;">beta</span> = A.angle(C)
<span style="color: #BA36A5;">gamma</span> = A.angle(B)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">''</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'a   b   c   alpha beta gamma'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'{0:1.3f} {1:1.3f} {2:1.3f} {3:1.3f} {4:1.3f} {5:1.3f}\n'</span>.<span style="color: #006FE0;">format</span>(a,b,c,                                                                alpha,beta,gamma))

<span style="color: #BA36A5;">h</span>, <span style="color: #BA36A5;">k</span>, <span style="color: #BA36A5;">l</span> = (1, 1, 1)

<span style="color: #0000FF;">from</span> math <span style="color: #0000FF;">import</span> sin, cos

<span style="color: #BA36A5;">id2</span> = ((h**2 / a**2 * sin(alpha)**2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  + k**2 / b**2 * sin(beta)**2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  + l**2 / c**2 * sin(gamma)**2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  + 2 * k * l / b / c * (cos(beta) * cos(gamma) - cos(alpha))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  + 2 * h * l / a / c * (cos(alpha) * cos(gamma) - cos(beta))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  + 2 * h * k / a / b * (cos(alpha) * cos(beta) - cos(gamma)))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  / (1 - cos(alpha)**2 - cos(beta)**2 - cos(gamma)**2
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>+ 2 * cos(alpha) * cos(beta) * cos(gamma)))

<span style="color: #BA36A5;">d</span> = 1 / math.sqrt(id2)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'d_111 spacing (method 3) = {0}'</span>.<span style="color: #006FE0;">format</span>(d))
</pre>
</div>

<pre class="example">
d_111 spacing (method 1) = 2.309 Angstroms
('d_111 spacing (method 2) =', 2.3094010767585029)

a   b   c   alpha beta gamma
4.000 4.000 4.000 1.571 1.571 1.571

d_111 spacing (method 3) = 2.30940107676
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-3">
<h3 id="orgheadline79"><span class="section-number-3">10.3</span> Equations of State</h3>
<div class="outline-text-3" id="text-10-3">
<p>
The module <a href="ase.utils.eos">ase.utils.eos</a> uses a simple polynomial equation of
state to find bulk unit cell equilibrium volumes and bulk
modulus. There are several other choices you could use that are more
standard in the literature. Here we summarize them and provide
references to the relevant literature. In each of these cases we show equations for the energy as a function of volume, although sometimes the volume is transformed or normalized.
</p>
</div>

<div id="outline-container-orgheadline221" class="outline-4">
<h4 id="orgheadline221"><span class="section-number-4">10.3.1</span> Birch-Murnaghan</h4>
<div class="outline-text-4" id="text-10-3-1">
<p>
This is probably the most common equation of state used most often,
and is a modification of the original Murnaghan EOS described below. A
current description of the equation is in reference
<a class='org-ref-reference' href="#PhysRevB.70.224107">PhysRevB.70.224107</a>. You can also find the equations for the Vinet and
Poirier-Tarantola equations of state in that reference.
</p>

<p>
Birch-Murnaghan EOS:
</p>

<p>
\(E(\eta) = E_0 + \frac{9B_0 V_0}{16}(\eta^2-1)^2(6+B'_0(\eta^2-1)-4\eta^2)\)
</p>

<p>
where \(\eta=(V/V_0)^{1/3}\), \(B_0\) and \(B'_0\) are the bulk
modulus and its pressure derivative at the equilibrium volume
\(V_0\). You may find other derivations of this equation in the
literature too.
</p>

<p>
Two other equations of state in that reference are the Vinet EOS:
</p>

<p>
\(E(\eta) = E_0 + \frac{2 B_0 V_0}{(B'_0-1)^2}(2-(5+3B'_0 (\eta-1) e^{-3(B'_0-1)(\eta-1)/2})\)
</p>

<p>
and the Poirier-Tarantola EOS:
</p>

<p>
\(E(\varrho) = E_0 + \frac{B_0 V_0 \varrho^2}{6}(3 + \varrho (B'_0-2))\)
</p>

<p>
with \(\varrho=-3 \ln(\eta)\).
</p>
</div>
</div>

<div id="outline-container-orgheadline222" class="outline-4">
<h4 id="orgheadline222"><span class="section-number-4">10.3.2</span> Murnaghan</h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
The equation most often used in the Murnaghan  <a class='org-ref-reference' href="#Murnaghan1944">Murnaghan1944</a>
equation of state is described in <a class='org-ref-reference' href="#PhysRevB.28.5480">PhysRevB.28.5480</a>.
</p>


<p>
\(E = E_T+\frac{B_0 V}{B'_0}\left[\frac{(V_0/V)^{B'_0}}{B'_0-1}+1\right]-\frac{V_0 B_0}{B'_0-1}\)
</p>

<p>
where \(V\) is the volume, \(B_0\) and \(B'_0\) are the bulk
modulus and its pressure derivative at the equilibrium volume
\(V_0\). All of these are parameters that are fitted to energy
vs. unit cell volume (\(V\)) data. When fitting data to this equation a
guess of 2-4 for \(B'_0\) is usually a good start.
</p>
</div>
</div>

<div id="outline-container-orgheadline223" class="outline-4">
<h4 id="orgheadline223"><span class="section-number-4">10.3.3</span> Birch</h4>
<div class="outline-text-4" id="text-10-3-3">
<p>
The original Birch equation <a class='org-ref-reference' href="#Birch">Birch</a> is:
</p>


<p>
\(E = E_0 + \frac{9}{8} B_0 V_0 \left(\left(\frac{V_0}{V}\right)^{\frac{2}{3}}-1\right)^2+\frac{9}{16} B_0 V_0 (B'_0-4)\left(\left(\frac{V}{V_0}\right)^{2/3}-1\right)^3\)
</p>
</div>
</div>

<div id="outline-container-orgheadline224" class="outline-4">
<h4 id="orgheadline224"><span class="section-number-4">10.3.4</span> The Anton-Schmidt Equation of state <a class='org-ref-reference' href="#Mayer200323">Mayer200323</a></h4>
<div class="outline-text-4" id="text-10-3-4">
<p>
\(E(V) = E_\infty + \frac{B V_0}{n+1}\left(\frac{V}{V_0}\right)^{n+1} \left( \ln{\frac{V}{V_0}} - \frac{1}{n+1}\right)\)
</p>

<p>
where \(E_\infty\) corresponds to the energy at infinite separation,
although the model they use to derive this equation breaks down at
large separations so this is usually not a good estimate of the
cohesive energy. \(n\) is typically about -2.
</p>
</div>
</div>

<div id="outline-container-orgheadline225" class="outline-4">
<h4 id="orgheadline225"><span class="section-number-4">10.3.5</span> Fitting data to these equations of state</h4>
<div class="outline-text-4" id="text-10-3-5">
<p>
To use these equations of state to find the equilibrium cell volume
and bulk modulus we need a set of calculations that give us the energy
of the unit cell as a function of the cell volume. We then fit that
data to one of the above equations to extract the parameters we want.
All of these equations of state are non-linear in the cell volume,
which means you have to provide some initial guesses for the
parameters.
</p>

<p>
Here we describe a strategy for getting some estimates of the
parameters using a linear least squares fitting of a parabola to the
data to estimate \(E_0\), \(V_0\), \(B\) and
\(B'_0\) which are used as initial guess for a non-linear least
squares fit of the equation of state to the data.
</p>

<p>
The following example illustrates one approach to this problem for the
Murnaghan equation of state:
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #008000;">'''Example of fitting the Birch-Murnaghan EOS to data'''</span>

<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np
<span style="color: #0000FF;">import</span> matplotlib.pyplot <span style="color: #0000FF;">as</span> plt
<span style="color: #0000FF;">from</span> scipy.optimize <span style="color: #0000FF;">import</span> leastsq

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">raw data from 2.2.3-al-analyze-eos.py</span>
<span style="color: #BA36A5;">v</span> = np.array([13.72, 14.83, 16.0, 17.23, 18.52])
<span style="color: #BA36A5;">e</span> = np.array([-56.29, -56.41, -56.46, -56.46, -56.42])

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">make a vector to evaluate fits on with a lot of points so it looks smooth</span>
<span style="color: #BA36A5;">vfit</span> = np.linspace(<span style="color: #006FE0;">min</span>(v),<span style="color: #006FE0;">max</span>(v),100)

<span style="color: #8D8D84;">### </span><span style="color: #8D8D84; font-style: italic;">fit a parabola to the data</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">y = ax^2 + bx + c</span>
<span style="color: #BA36A5;">a</span>,<span style="color: #BA36A5;">b</span>,<span style="color: #BA36A5;">c</span> = np.polyfit(v,e,2) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">this is from pylab</span>

<span style="color: #008000;">'''</span>
<span style="color: #008000;">the parabola does not fit the data very well, but we can use it to get</span>
<span style="color: #008000;">some analytical guesses for other parameters.</span>

<span style="color: #008000;">V0 = minimum energy volume, or where dE/dV=0</span>
<span style="color: #008000;">E = aV^2 + bV + c</span>
<span style="color: #008000;">dE/dV = 2aV + b = 0</span>
<span style="color: #008000;">V0 = -b/2a</span>

<span style="color: #008000;">E0 is the minimum energy, which is:</span>
<span style="color: #008000;">E0 = aV0^2 + bV0 + c</span>

<span style="color: #008000;">B is equal to V0*d^2E/dV^2, which is just 2a*V0</span>

<span style="color: #008000;">and from experience we know Bprime_0 is usually a small number like 4</span>
<span style="color: #008000;">'''</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now here are our initial guesses.</span>
<span style="color: #BA36A5;">v0</span> = -b/(2*a)
<span style="color: #BA36A5;">e0</span> = a*v0**2 + b*v0 + c
<span style="color: #BA36A5;">b0</span> = 2*a*v0
<span style="color: #BA36A5;">bP</span> = 4

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now we have to create the equation of state function</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">Murnaghan</span>(parameters,vol):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   given a vector of parameters and volumes, return a vector of energies.</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   equation From PRB 28,5480 (1983)</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span><span style="color: #008000;">   '''</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E0</span> = parameters[0]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">B0</span> = parameters[1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">BP</span> = parameters[2]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V0</span> = parameters[3]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = E0 + B0*vol/BP*(((V0/vol)**BP)/(BP-1)+1) - V0*B0/(BP-1.)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> E

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">and we define an objective function that will be minimized</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">objective</span>(pars,y,x):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">we will minimize this function</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">err</span> =  y - Murnaghan(pars,x)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> err

<span style="color: #BA36A5;">x0</span> = [e0, b0, bP, v0] <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">initial guesses in the same order used in the Murnaghan function</span>

<span style="color: #BA36A5;">murnpars</span>, <span style="color: #BA36A5;">ier</span> = leastsq(objective, x0, args=(e,v)) <span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">this is from scipy</span>

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">now we make a figure summarizing the results</span>
plt.plot(v,e,<span style="color: #008000;">'ro'</span>)
plt.plot(vfit, a*vfit**2 + b*vfit + c,<span style="color: #008000;">'--'</span>,label=<span style="color: #008000;">'parabolic fit'</span>)
plt.plot(vfit, Murnaghan(murnpars,vfit), label=<span style="color: #008000;">'Murnaghan fit'</span>)
plt.xlabel(<span style="color: #008000;">'Volume ($\AA^3$)'</span>)
plt.ylabel(<span style="color: #008000;">'Energy (eV)'</span>)
plt.legend(loc=<span style="color: #008000;">'best'</span>)

<span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">add some text to the figure in figure coordinates</span>
<span style="color: #BA36A5;">ax</span> = plt.gca()
plt.text(0.4, 0.5, <span style="color: #008000;">'Min volume = {0:1.2f} $\AA^3$'</span>.<span style="color: #006FE0;">format</span>(murnpars[3]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>transform = ax.transAxes)
plt.text(0.4, 0.4, <span style="color: #008000;">'Bulk modulus = {0:1.2f} eV/$\AA^3$ = {1:1.2f} GPa'</span>.<span style="color: #006FE0;">format</span>(murnpars[1],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> murnpars[1]*160.21773),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>transform = ax.transAxes)
plt.savefig(<span style="color: #008000;">'images/a-eos.png'</span>)

np.set_printoptions(precision=3)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'initial guesses  : '</span>, np.array(x0))  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">array for easy printing</span>
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'fitted parameters: '</span>, murnpars)
</pre>
</div>

<pre class="example">
initial guesses  :  [-56.472   0.631   4.     16.79 ]
fitted parameters:  [-56.466   0.49    4.753  16.573]
</pre>


<div class="figure">
<p><img src="./images/a-eos.png" alt="a-eos.png" />
</p>
<p><span class="figure-number">Figure 115:</span> Fitted equation of state for bulk data. The initial fitted parabola is shown to illustrate how it is useful for making initial guesses of the minimum and bulk modulus.</p>
</div>

<p>
You can see the Murnaghan equation of state fits the data better than
the parabola.
</p>

<p>
Here is a comparison of the initial guesses and final parameters. You
can see our guesses from the parabola were actually pretty good, and
are the main reason we converged to a solution. If you try other
guesses you will probably find the <code>scipy.optimize.leastsq</code> function
does not converge.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline231" class="outline-3">
<h3 id="orgheadline231"><span class="section-number-3">10.4</span> Miscellaneous vasp/VASP tips</h3>
<div class="outline-text-3" id="text-10-4">
</div><div id="outline-container-orgheadline226" class="outline-4">
<h4 id="orgheadline226"><span class="section-number-4">10.4.1</span> Using a special setup</h4>
<div class="outline-text-4" id="text-10-4-1">
<p>
VASP provides <a href="http://cms.mpi.univie.ac.at/vasp/vasp/PAW_potentials.html">special setups</a> for some elements. The following guidelines tell you what is in a potential:
</p>

<p>
No extension means the standard potential. The following extensions mean:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 8:</span> Meaning of extensions on POTCAR files for special setups.</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">extension</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">_h</td>
<td class="org-left">means the potential is harder than the standard (i.e. needs a higher cutoff energy)</td>
</tr>

<tr>
<td class="org-left">_s</td>
<td class="org-left">means the potential is softer than the standard (i.e. needs a lower cutoff energy)</td>
</tr>

<tr>
<td class="org-left">_sv</td>
<td class="org-left">\(s\) and \(p\) semi-core states are treated as valence states</td>
</tr>

<tr>
<td class="org-left">_pv</td>
<td class="org-left">\(p\) semi-core states are treated as valence states</td>
</tr>

<tr>
<td class="org-left">_d</td>
<td class="org-left">\(d\) semi-core states are treated as valence states</td>
</tr>
</tbody>
</table>

<p>
Here are some links to information in the VASP manual for the setups.
</p>

<ul class="org-ul">
<li><a href="http://cms.mpi.univie.ac.at/vasp/vasp/st_row_elements.html">1st row elements</a></li>
<li><a href="http://cms.mpi.univie.ac.at/vasp/vasp/Alkali_alkali_earth_elements_simple_metals.html">Alkali and alkali-earth metals</a></li>
<li><a href="http://cms.mpi.univie.ac.at/vasp/vasp/_elements.html">d-elements</a></li>
<li><a href="http://cms.mpi.univie.ac.at/vasp/vasp/_elements_including_first_row.html">p-elements</a></li>
<li><a href="http://cms.mpi.univie.ac.at/vasp/vasp/_elements_I.html">f-elements</a></li>
</ul>
<p>
Here we show how to select the O_sv potential in a calculation.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>,[5, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cell=(6, 6, 6))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O_s'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.001,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   setups=[[<span style="color: #008000;">'O'</span>, <span style="color: #008000;">'_s'</span>]], <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">specifies O_s potential</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=atoms)

<span style="color: #0000FF;">print</span> calc.potential_energy
</pre>
</div>

<pre class="example">
-1.50564364
</pre>


<p>
How do you know you got the right special setup? We can look at the first line of the POTCAR file in the calculation directory to see.
</p>
<div class="org-src-container">

<pre class="src src-sh">head -n 1 molecules/O_sv/POTCAR
</pre>
</div>

<pre class="example">
PAW_PBE O_sv 05Jul2007
</pre>

<p>
This shows we indeed used the O_sv setup.
</p>
</div>
</div>

<div id="outline-container-orgheadline227" class="outline-4">
<h4 id="orgheadline227"><span class="section-number-4">10.4.2</span> <span class="todo TODO">TODO</span> Running vasp in parallel</h4>
<div class="outline-text-4" id="text-10-4-2">
<p>
vasp is smart. If you ask for more than one node, it will automatically try to run in parallel. On our cluster you have to use cores, i.e. (processor per node) not nodes due to a limitation in how vasp is compiled.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> vasp.vasprc <span style="color: #0000FF;">import</span> VASPRC

<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'queue.ppn'</span>]=4
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'O'</span>,[5, 5, 5], magmom=1)],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>cell=(6, 6, 6))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/O_s-4nodes'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> encut=300,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ispin=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> ismear=0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> sigma=0.001,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> setups=[[<span style="color: #008000;">'O'</span>, <span style="color: #008000;">'_s'</span>]],  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">specifies O_s potential</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> atoms=atoms)

<span style="color: #0000FF;">print</span> calc.potential_energy
</pre>
</div>

<p>
How do you know it ran on four nodes?
</p>
<div class="org-src-container">

<pre class="src src-sh">head molecules/O_s-4nodes/OUTCAR
</pre>
</div>

<pre class="example">
 vasp.5.3.5 31Mar14 (build Aug 04 2015 13:07:31) complex

 executed on             LinuxIFC date 2016.05.11  15:58:14
 running on    4 total cores
 distrk:  each k-point on    4 cores,    1 groups
 distr:  one band on NCORES_PER_BAND=   1 cores,    4 groups


--------------------------------------------------------------------------------------------------------
</pre>
</div>
</div>

<div id="outline-container-orgheadline228" class="outline-4">
<h4 id="orgheadline228"><span class="section-number-4">10.4.3</span> Running multiple instances of vasp in parallel</h4>
<div class="outline-text-4" id="text-10-4-3">
<p>
<a href="vasp">vasp</a> was designed to enable asynchronous, parallel running processes through a queuing system. This is ideal for submitting large numbers of independent calculations in one script. The design uses exceptions to exit the script if the results are not available for subsequent analysis. The design expects that you run the script often, and the results are analyzed only when they are finally available.
</p>

<p>
Sometimes it is convenient to run a set of calculations and then wait for them to finish so that a second set of calculations that depend on the first results can be run. In this scenario, it is inconvenient to have to rerun your script again after the first set of calculations is done.  The challenge is how to tell the computer to run a set of calculations in parallel, <b>and</b> wait for the calculations to finish. This can be achieved using the <a href="multiprocessing">multiprocessing</a> module in python.
</p>

<p>
The principle idea is to set up the calculations you want to run, and use <a href="multiprocessing">multiprocessing</a> to handle running them and waiting for you. To do this, you must instruct <a href="vasp">vasp</a> to use a "run mode", and construct a script with a function that runs a calculation, and a section that only runs in the "<span class="underline"><span class="underline">main</span></span>" script.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">import</span> multiprocessing
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.utils.eos <span style="color: #0000FF;">import</span> EquationOfState
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is the function that runs a calculation</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">do_calculation</span>(calc):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">"""function to run a calculation through multiprocessing."""</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v</span> = atoms.get_volume()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> v, e

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this only runs in the main script, not in processes on other cores</span>
<span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span> == <span style="color: #008000;">'__main__'</span>:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">NCORES</span> = 6  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of cores to run processes on</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">setup an atoms object</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">a</span> = 3.6
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,(0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a * np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  [1.0, 0.0, 1.0]]))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v0</span> = atoms.get_volume()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Step 1</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> = 0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calculators</span> = []  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">list of calculators to be run</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">factors</span> = [-0.1, 0.05, 0.0, 0.05, 0.1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">newatoms</span> = atoms.copy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   newatoms.set_volume(v0*(1 + f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">label</span> = <span style="color: #008000;">'bulk/cu-mp/step1-{0}'</span>.<span style="color: #006FE0;">format</span>(COUNTER)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> += 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(label,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isym=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=newatoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calculators.append(calc)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we set up the Pool of processes</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pool</span> = multiprocessing.Pool(processes=NCORES)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get the output from running each calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">out</span> = pool.<span style="color: #006FE0;">map</span>(do_calculation, calculators)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.close()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.join() <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this makes the script wait here until all jobs are done</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now proceed with analysis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> = [x[0] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = [x[1] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">eos</span> = EquationOfState(V, E)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v1</span>, <span style="color: #BA36A5;">e1</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'step1: v1 = {v1}'</span>.<span style="color: #006FE0;">format</span>(**<span style="color: #006FE0;">locals</span>()))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">### </span><span style="color: #8D8D84; font-style: italic;">################################################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">STEP 2, eos around the minimum</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">#################################################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">factors</span> = [-0.06, -0.04, -0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.02, 0.04, 0.06]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calculators</span> = [] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reset list</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">newatoms</span> = atoms.copy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   newatoms.set_volume(v1*(1 + f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">label</span> = <span style="color: #008000;">'bulk/cu-mp/step2-{0}'</span>.<span style="color: #006FE0;">format</span>(COUNTER)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> += 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(label,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isym=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=newatoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calculators.append(calc)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pool</span> = multiprocessing.Pool(processes=NCORES)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">out</span> = pool.<span style="color: #006FE0;">map</span>(do_calculation, calculators)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.close()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.join() <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">wait here for calculations to finish</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">proceed with analysis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> += [x[0] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> += [x[1] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> = np.array(V)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = np.array(E)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f</span> = np.array(V)/v1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">only take points within +- 10% of the minimum</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ind</span> = (f &gt;=0.90) &amp; (f &lt;= 1.1)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">eos</span> = EquationOfState(V[ind], E[ind])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v2</span>, <span style="color: #BA36A5;">e2</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'step2: v2 = {v2}'</span>.<span style="color: #006FE0;">format</span>(**<span style="color: #006FE0;">locals</span>()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   eos.plot(<span style="color: #008000;">'images/cu-mp-eos.png'</span>)
</pre>
</div>

<pre class="example">
step1: v1 = 12.0218897111
step2: v2 = 12.0216094217
</pre>


<div class="figure">
<p><img src="./images/cu-mp-eos.png" alt="cu-mp-eos.png" />
</p>
<p><span class="figure-number">Figure 116:</span> Equation of state for Cu using the multiprocessing module.</p>
</div>

<div class="note">
<p>
The first time you run this you will get all the VASP output. The second time you get the smaller output above.
</p>

<p>
Also, I have not figured out how to integrate this method with the queue system. At the moment, the runvasp.py script which ultimately runs VASP will run VASP in parallel, i.e. one process on multiple nodes/cores instead of a single job that runs multiple processes simultaneously on multiple nodes/cores.
</p>

</div>

<p>
Here is an example of running this through the queue. The main variations are you must set several variables in <code>VASPRC</code> that indicate you want to use <a href="multiprocessing">multiprocessing</a>, and you must save the script and submit manually to the queue with matching parameters. This is not 100% satisfying, but it is the best that I have found for now.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #8D8D84;">#</span><span style="color: #8D8D84; font-style: italic;">!/usr/bin/env python</span>
<span style="color: #0000FF;">import</span> multiprocessing
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp
<span style="color: #0000FF;">from</span> vasp.vasprc <span style="color: #0000FF;">import</span> VASPRC
<span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atom, Atoms
<span style="color: #0000FF;">from</span> ase.utils.eos <span style="color: #0000FF;">import</span> EquationOfState
<span style="color: #0000FF;">import</span> numpy <span style="color: #0000FF;">as</span> np

<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'queue.nodes'</span>] = 1

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Here we will be able to run three MPI jobs on 2 cores at a time.</span>
<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'queue.ppn'</span>] = 6
<span style="color: #BA36A5;">VASPRC</span>[<span style="color: #008000;">'multiprocessing.cores_per_process'</span>] = 2

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">to submit this script, save it as cu-mp.py</span>
<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">qsub -l nodes=1:ppn=6,walltime=10:00:00 cu-mp.py</span>
<span style="color: #0000FF;">import</span> os
<span style="color: #0000FF;">if</span> <span style="color: #008000;">'PBS_O_WORKDIR'</span> <span style="color: #0000FF;">in</span> os.environ:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   os.chdir(os.environ[<span style="color: #008000;">'PBS_O_WORKDIR'</span>])

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is the function that runs a calculation</span>
<span style="color: #0000FF;">def</span> <span style="color: #006699;">do_calculation</span>(calc):
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #008000;">'function to run a calculation through multiprocessing'</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = calc.get_atoms()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">e</span> = atoms.get_potential_energy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v</span> = atoms.get_volume()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">return</span> v, e

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this only runs in the main script, not in processes on other cores</span>
<span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span> == <span style="color: #008000;">'__main__'</span>:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">setup an atoms object</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">a</span> = 3.6
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">atoms</span> = Atoms([Atom(<span style="color: #008000;">'Cu'</span>,(0, 0, 0))],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span> cell=0.5 * a*np.array([[1.0, 1.0, 0.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[0.0, 1.0, 1.0],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>[1.0, 0.0, 1.0]]))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v0</span> = atoms.get_volume()

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Step 1</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> = 0
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calculators</span> = []  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">list of calculators to be run</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">factors</span> = [-0.1, 0.05, 0.0, 0.05, 0.1]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">newatoms</span> = atoms.copy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   newatoms.set_volume(v0*(1 + f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">label</span> = <span style="color: #008000;">'bulk/cu-mp2/step1-{0}'</span>.<span style="color: #006FE0;">format</span>(COUNTER)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> += 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(label,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isym=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   debug=logging.DEBUG,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=newatoms)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calculators.append(calc)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now we set up the Pool of processes</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pool</span> = multiprocessing.Pool(processes=3) <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">ask for 6 cores but run MPI on 2 cores</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">get the output from running each calculation</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">out</span> = pool.<span style="color: #006FE0;">map</span>(do_calculation, calculators)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.close()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.join() <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this makes the script wait here until all jobs are done</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now proceed with analysis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> = [x[0] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = [x[1] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">eos</span> = EquationOfState(V, E)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v1</span>, <span style="color: #BA36A5;">e1</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'step1: v1 = {v1}'</span>.<span style="color: #006FE0;">format</span>(**<span style="color: #006FE0;">locals</span>()))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">### </span><span style="color: #8D8D84; font-style: italic;">################################################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">STEP 2, eos around the minimum</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;">## </span><span style="color: #8D8D84; font-style: italic;">#################################################################</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">factors</span> = [-0.06, -0.04, -0.02,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.0,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  0.02, 0.04, 0.06]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calculators</span> = [] <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">reset list</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> f <span style="color: #0000FF;">in</span> factors:
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">newatoms</span> = atoms.copy()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   newatoms.set_volume(v1*(1 + f))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">label</span> = <span style="color: #008000;">'bulk/cu-mp2/step2-{0}'</span>.<span style="color: #006FE0;">format</span>(COUNTER)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">COUNTER</span> += 1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">calc</span> = Vasp(label,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'PBE'</span>,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   kpts=[6, 6, 6],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   isym=2,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   debug=logging.DEBUG,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=newatoms)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   calculators.append(calc)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">pool</span> = multiprocessing.Pool(processes=3)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">out</span> = pool.<span style="color: #006FE0;">map</span>(do_calculation, calculators)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.close()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   pool.join() <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">wait here for calculations to finish</span>

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">proceed with analysis</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> += [x[0] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> += [x[1] <span style="color: #0000FF;">for</span> x <span style="color: #0000FF;">in</span> out]

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">V</span> = np.array(V)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">E</span> = np.array(E)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">f</span> = np.array(V)/v1

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">only take points within +- 10% of the minimum</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ind</span> = (f &gt;=0.90) &amp; (f &lt;= 1.1)

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">eos</span> = EquationOfState(V[ind], E[ind])
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">v2</span>, <span style="color: #BA36A5;">e2</span>, <span style="color: #BA36A5;">B</span> = eos.fit()
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'step2: v2 = {v2}'</span>.<span style="color: #006FE0;">format</span>(**<span style="color: #006FE0;">locals</span>()))
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   eos.plot(<span style="color: #008000;">'images/cu-mp2-eos.png'</span>,show=<span style="color: #D0372D;">True</span>)
</pre>
</div>

<pre class="example">
step1: v1 = 12.0218897111
step2: v2 = 12.0216189798
</pre>


<div class="figure">
<p><img src="./images/cu-mp2-eos.png" alt="cu-mp2-eos.png" />
</p>
<p><span class="figure-number">Figure 117:</span> Second view of a Cu equation of state computed with multiprocessing.</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline230" class="outline-4">
<h4 id="orgheadline230"><span class="section-number-4">10.4.4</span> Exporting data json, xml, python, sqlite</h4>
<div class="outline-text-4" id="text-10-4-4">
<p>
Vasp has some capability for representing a calculation result in an archival format.
</p>
</div>

<div id="outline-container-orgheadline229" class="outline-5">
<h5 id="orgheadline229"><span class="section-number-5">10.4.4.1</span> json</h5>
<div class="outline-text-5" id="text-10-4-4-1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'bulk/alloy/cu'</span>)
<span style="color: #0000FF;">print</span>(calc.json)
</pre>
</div>

<pre class="example">
{"1": {
 "calculator": "vasp",
 "calculator_parameters": {"kpts": [13, 13, 13], "xc": "pbe", "encut": 350, "isif": 4, "ibrion": 2, "nbands": 13, "nsw": 10},
 "cell": [[1.818, 0.0, 1.818], [1.818, 1.818, 0.0], [0.0, 1.818, 1.818]],
 "charges": [null],
 "ctime": 16.38080562948716,
 "data": {"resort": [0], "ppp_list": [["Cu", "potpaw_PBE/Cu/POTCAR", 1]], "parameters": {"pp": "PBE", "isif": 4, "xc": "pbe", "kpts": [13, 13, 13], "encut": 350, "lcharg": false, "ibrion": 2, "nbands": 13, "ismear": 1, "lwave": false, "sigma": 0.1, "nsw": 10}},
 "energy": -3.73437124,
 "forces": [[0.0, 0.0, 0.0]],
 "key_value_pairs": {"path": "/home-research/jkitchin/dft-book-new-vasp/bulk/alloy/cu"},
 "magmom": 0,
 "magmoms": [0.0],
 "mtime": 16.38080562948716,
 "numbers": [29],
 "pbc": [true, true, true],
 "positions": [[0.0, 0.0, 0.0]],
 "stress": [0.006175314338977028, 0.006175314338977028, 0.006175314338977028, -0.0, -0.0, -0.0],
 "unique_id": "18c58fda5603fa5be9d99b5a7a4de74a",
 "user": "jkitchin"},
"ids": [1],
"nextid": 2}
</pre>
</div>
</div>
</div>



<div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76"><span class="section-number-4">10.4.5</span> Recommended values for ENCUT and valence electrons for different POTCAR files</h4>
<div class="outline-text-4" id="text-10-4-5">
<p>
The <a href=http://cms.mpi.univie.ac.at/wiki/index.php/ENCUT>ENCUT</a> tag and <a href=http://cms.mpi.univie.ac.at/wiki/index.php/PREC>PREC</a> tag affect the accuracy/convergence of your calculations.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> vasp.POTCAR <span style="color: #0000FF;">import</span> get_ENMIN, get_ENMAX, get_ZVAL
<span style="color: #0000FF;">from</span> ase.data <span style="color: #0000FF;">import</span> chemical_symbols
<span style="color: #0000FF;">import</span> glob, os

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'#+ATTR_LaTeX: :environment longtable'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'#+tblname: POTCAR'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'#+caption: Parameters for POTPAW_PBE POTCAR files.'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'| POTCAR | ENMIN | ENMAX | prec=high (eV) | # val. elect. |'</span>)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|-'</span>)

chemical_symbols.sort()
<span style="color: #0000FF;">for</span> symbol <span style="color: #0000FF;">in</span> chemical_symbols:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">potcars</span> = glob.glob(<span style="color: #008000;">'{0}/potpaw_PBE/{1}*/POTCAR'</span>.<span style="color: #006FE0;">format</span>(os.environ[<span style="color: #008000;">'VASP_PP_PATH'</span>],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>symbol))

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">for</span> potcar <span style="color: #0000FF;">in</span> potcars:

<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">POTCAR</span> = os.path.relpath(potcar,
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>os.environ[<span style="color: #008000;">'VASP_PP_PATH'</span>]+<span style="color: #008000;">'/potpaw_PBE'</span>)[:-7]
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ENMIN</span> = get_ENMIN(potcar)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ENMAX</span> = get_ENMAX(potcar)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">HIGH</span>  = 1.3*ENMAX
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #BA36A5;">ZVAL</span>  = get_ZVAL(potcar)
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #0000FF;">print</span>(<span style="color: #008000;">'|{POTCAR:30s}|{ENMIN}|{ENMAX}|{HIGH:1.3f}|{ZVAL}|'</span>.<span style="color: #006FE0;">format</span>(**<span style="color: #006FE0;">locals</span>()))
</pre>
</div>

<table id="orgtable6" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 9:</span> Parameters for POTPAW_PBE POTCAR files.</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">POTCAR</th>
<th scope="col" class="org-right">ENMIN</th>
<th scope="col" class="org-right">ENMAX</th>
<th scope="col" class="org-right">prec=high (eV)</th>
<th scope="col" class="org-right"># val. elect.</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Ac</td>
<td class="org-right">129.263</td>
<td class="org-right">172.351</td>
<td class="org-right">224.056</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ag</td>
<td class="org-right">187.383</td>
<td class="org-right">249.844</td>
<td class="org-right">324.797</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ag_GW</td>
<td class="org-right">187.383</td>
<td class="org-right">249.844</td>
<td class="org-right">324.797</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ag_pv</td>
<td class="org-right">223.399</td>
<td class="org-right">297.865</td>
<td class="org-right">387.225</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Al_GW</td>
<td class="org-right">180.225</td>
<td class="org-right">240.3</td>
<td class="org-right">312.390</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Al_sv_GW</td>
<td class="org-right">308.331</td>
<td class="org-right">411.109</td>
<td class="org-right">534.442</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Al</td>
<td class="org-right">180.225</td>
<td class="org-right">240.3</td>
<td class="org-right">312.390</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Am</td>
<td class="org-right">191.906</td>
<td class="org-right">255.875</td>
<td class="org-right">332.637</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Ar</td>
<td class="org-right">199.806</td>
<td class="org-right">266.408</td>
<td class="org-right">346.330</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ar_GW</td>
<td class="org-right">199.806</td>
<td class="org-right">266.408</td>
<td class="org-right">346.330</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">As_GW</td>
<td class="org-right">156.526</td>
<td class="org-right">208.702</td>
<td class="org-right">271.313</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">As</td>
<td class="org-right">156.526</td>
<td class="org-right">208.702</td>
<td class="org-right">271.313</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">As_d</td>
<td class="org-right">216.488</td>
<td class="org-right">288.651</td>
<td class="org-right">375.246</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">At_d</td>
<td class="org-right">199.688</td>
<td class="org-right">266.251</td>
<td class="org-right">346.126</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">At</td>
<td class="org-right">121.073</td>
<td class="org-right">161.43</td>
<td class="org-right">209.859</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Au_pv_GW</td>
<td class="org-right">186.258</td>
<td class="org-right">248.344</td>
<td class="org-right">322.847</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Au_GW</td>
<td class="org-right">186.258</td>
<td class="org-right">248.344</td>
<td class="org-right">322.847</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Au</td>
<td class="org-right">172.457</td>
<td class="org-right">229.943</td>
<td class="org-right">298.926</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Bi</td>
<td class="org-right">78.777</td>
<td class="org-right">105.037</td>
<td class="org-right">136.548</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Be_GW</td>
<td class="org-right">185.657</td>
<td class="org-right">247.543</td>
<td class="org-right">321.806</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Bi_d_GW</td>
<td class="org-right">182.129</td>
<td class="org-right">242.839</td>
<td class="org-right">315.691</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Be_sv</td>
<td class="org-right">231.576</td>
<td class="org-right">308.768</td>
<td class="org-right">401.398</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Ba_sv_GW</td>
<td class="org-right">178.136</td>
<td class="org-right">237.515</td>
<td class="org-right">308.769</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">B_GW</td>
<td class="org-right">238.96</td>
<td class="org-right">318.614</td>
<td class="org-right">414.198</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">B_s</td>
<td class="org-right">201.934</td>
<td class="org-right">269.245</td>
<td class="org-right">350.019</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Br_GW</td>
<td class="org-right">162.214</td>
<td class="org-right">216.285</td>
<td class="org-right">281.171</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Br</td>
<td class="org-right">162.214</td>
<td class="org-right">216.285</td>
<td class="org-right">281.171</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Bi_GW</td>
<td class="org-right">109.897</td>
<td class="org-right">146.53</td>
<td class="org-right">190.489</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Bi_d</td>
<td class="org-right">182.129</td>
<td class="org-right">242.839</td>
<td class="org-right">315.691</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">B</td>
<td class="org-right">238.96</td>
<td class="org-right">318.614</td>
<td class="org-right">414.198</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Be_sv_GW</td>
<td class="org-right">403.09</td>
<td class="org-right">537.454</td>
<td class="org-right">698.690</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Be</td>
<td class="org-right">185.658</td>
<td class="org-right">247.543</td>
<td class="org-right">321.806</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">B_h</td>
<td class="org-right">500.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Ba_sv</td>
<td class="org-right">140.386</td>
<td class="org-right">187.181</td>
<td class="org-right">243.335</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ba_sv_GW</td>
<td class="org-right">178.136</td>
<td class="org-right">237.515</td>
<td class="org-right">308.769</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ba_sv</td>
<td class="org-right">140.386</td>
<td class="org-right">187.181</td>
<td class="org-right">243.335</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Be_GW</td>
<td class="org-right">185.657</td>
<td class="org-right">247.543</td>
<td class="org-right">321.806</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Be_sv</td>
<td class="org-right">231.576</td>
<td class="org-right">308.768</td>
<td class="org-right">401.398</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Be_sv_GW</td>
<td class="org-right">403.09</td>
<td class="org-right">537.454</td>
<td class="org-right">698.690</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Be</td>
<td class="org-right">185.658</td>
<td class="org-right">247.543</td>
<td class="org-right">321.806</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Bi</td>
<td class="org-right">78.777</td>
<td class="org-right">105.037</td>
<td class="org-right">136.548</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Bi_d_GW</td>
<td class="org-right">182.129</td>
<td class="org-right">242.839</td>
<td class="org-right">315.691</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Bi_GW</td>
<td class="org-right">109.897</td>
<td class="org-right">146.53</td>
<td class="org-right">190.489</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Bi_d</td>
<td class="org-right">182.129</td>
<td class="org-right">242.839</td>
<td class="org-right">315.691</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Br_GW</td>
<td class="org-right">162.214</td>
<td class="org-right">216.285</td>
<td class="org-right">281.171</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Br</td>
<td class="org-right">162.214</td>
<td class="org-right">216.285</td>
<td class="org-right">281.171</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Cm</td>
<td class="org-right">193.465</td>
<td class="org-right">257.953</td>
<td class="org-right">335.339</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Cd_GW</td>
<td class="org-right">190.534</td>
<td class="org-right">254.045</td>
<td class="org-right">330.258</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cu_pv_GW</td>
<td class="org-right">350.498</td>
<td class="org-right">467.331</td>
<td class="org-right">607.530</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Ce_h</td>
<td class="org-right">224.925</td>
<td class="org-right">299.9</td>
<td class="org-right">389.870</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">C_s</td>
<td class="org-right">205.433</td>
<td class="org-right">273.911</td>
<td class="org-right">356.084</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Cd</td>
<td class="org-right">205.752</td>
<td class="org-right">274.336</td>
<td class="org-right">356.637</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cr_sv_GW</td>
<td class="org-right">246.211</td>
<td class="org-right">328.282</td>
<td class="org-right">426.767</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Co_pv</td>
<td class="org-right">203.281</td>
<td class="org-right">271.042</td>
<td class="org-right">352.355</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Cs_sv_GW</td>
<td class="org-right">148.575</td>
<td class="org-right">198.101</td>
<td class="org-right">257.531</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Ca_sv</td>
<td class="org-right">199.967</td>
<td class="org-right">266.622</td>
<td class="org-right">346.609</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Cl_h</td>
<td class="org-right">306.852</td>
<td class="org-right">409.136</td>
<td class="org-right">531.877</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Ca_sv_GW</td>
<td class="org-right">211.072</td>
<td class="org-right">281.43</td>
<td class="org-right">365.859</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Cd_sv_GW</td>
<td class="org-right">488.441</td>
<td class="org-right">651.254</td>
<td class="org-right">846.630</td>
<td class="org-right">20.0</td>
</tr>

<tr>
<td class="org-left">Cu</td>
<td class="org-right">221.585</td>
<td class="org-right">295.446</td>
<td class="org-right">384.080</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Cd_pv_GW</td>
<td class="org-right">297.574</td>
<td class="org-right">396.766</td>
<td class="org-right">515.796</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Cr_sv</td>
<td class="org-right">296.603</td>
<td class="org-right">395.471</td>
<td class="org-right">514.112</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">C_GW_new</td>
<td class="org-right">310.494</td>
<td class="org-right">413.992</td>
<td class="org-right">538.190</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Cr</td>
<td class="org-right">170.31</td>
<td class="org-right">227.08</td>
<td class="org-right">295.204</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Co</td>
<td class="org-right">200.976</td>
<td class="org-right">267.968</td>
<td class="org-right">348.358</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Co_GW</td>
<td class="org-right">242.55</td>
<td class="org-right">323.4</td>
<td class="org-right">420.420</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">C_h</td>
<td class="org-right">500.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Cr_pv</td>
<td class="org-right">199.261</td>
<td class="org-right">265.681</td>
<td class="org-right">345.385</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ce_GW</td>
<td class="org-right">228.468</td>
<td class="org-right">304.625</td>
<td class="org-right">396.012</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cl_GW</td>
<td class="org-right">196.854</td>
<td class="org-right">262.472</td>
<td class="org-right">341.214</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">C</td>
<td class="org-right">300.0</td>
<td class="org-right">400.0</td>
<td class="org-right">520.000</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Cu_pv</td>
<td class="org-right">276.486</td>
<td class="org-right">368.648</td>
<td class="org-right">479.242</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Ce_3</td>
<td class="org-right">132.379</td>
<td class="org-right">176.506</td>
<td class="org-right">229.458</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Cs_sv</td>
<td class="org-right">165.238</td>
<td class="org-right">220.318</td>
<td class="org-right">286.413</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Cl</td>
<td class="org-right">196.854</td>
<td class="org-right">262.472</td>
<td class="org-right">341.214</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Ca_pv</td>
<td class="org-right">89.67</td>
<td class="org-right">119.559</td>
<td class="org-right">155.427</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Co_sv_GW</td>
<td class="org-right">272.827</td>
<td class="org-right">363.77</td>
<td class="org-right">472.901</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Cu_GW</td>
<td class="org-right">312.779</td>
<td class="org-right">417.039</td>
<td class="org-right">542.151</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Co_sv</td>
<td class="org-right">292.771</td>
<td class="org-right">390.362</td>
<td class="org-right">507.471</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">C_GW</td>
<td class="org-right">310.494</td>
<td class="org-right">413.992</td>
<td class="org-right">538.190</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Ce</td>
<td class="org-right">204.781</td>
<td class="org-right">273.042</td>
<td class="org-right">354.955</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ca_sv</td>
<td class="org-right">199.967</td>
<td class="org-right">266.622</td>
<td class="org-right">346.609</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ca_sv_GW</td>
<td class="org-right">211.072</td>
<td class="org-right">281.43</td>
<td class="org-right">365.859</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ca_pv</td>
<td class="org-right">89.67</td>
<td class="org-right">119.559</td>
<td class="org-right">155.427</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Cd_GW</td>
<td class="org-right">190.534</td>
<td class="org-right">254.045</td>
<td class="org-right">330.258</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cd</td>
<td class="org-right">205.752</td>
<td class="org-right">274.336</td>
<td class="org-right">356.637</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cd_sv_GW</td>
<td class="org-right">488.441</td>
<td class="org-right">651.254</td>
<td class="org-right">846.630</td>
<td class="org-right">20.0</td>
</tr>

<tr>
<td class="org-left">Cd_pv_GW</td>
<td class="org-right">297.574</td>
<td class="org-right">396.766</td>
<td class="org-right">515.796</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Ce_h</td>
<td class="org-right">224.925</td>
<td class="org-right">299.9</td>
<td class="org-right">389.870</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ce_GW</td>
<td class="org-right">228.468</td>
<td class="org-right">304.625</td>
<td class="org-right">396.012</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ce_3</td>
<td class="org-right">132.379</td>
<td class="org-right">176.506</td>
<td class="org-right">229.458</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ce</td>
<td class="org-right">204.781</td>
<td class="org-right">273.042</td>
<td class="org-right">354.955</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cl_h</td>
<td class="org-right">306.852</td>
<td class="org-right">409.136</td>
<td class="org-right">531.877</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Cl_GW</td>
<td class="org-right">196.854</td>
<td class="org-right">262.472</td>
<td class="org-right">341.214</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Cl</td>
<td class="org-right">196.854</td>
<td class="org-right">262.472</td>
<td class="org-right">341.214</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Cm</td>
<td class="org-right">193.465</td>
<td class="org-right">257.953</td>
<td class="org-right">335.339</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Co_pv</td>
<td class="org-right">203.281</td>
<td class="org-right">271.042</td>
<td class="org-right">352.355</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Co</td>
<td class="org-right">200.976</td>
<td class="org-right">267.968</td>
<td class="org-right">348.358</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Co_GW</td>
<td class="org-right">242.55</td>
<td class="org-right">323.4</td>
<td class="org-right">420.420</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Co_sv_GW</td>
<td class="org-right">272.827</td>
<td class="org-right">363.77</td>
<td class="org-right">472.901</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Co_sv</td>
<td class="org-right">292.771</td>
<td class="org-right">390.362</td>
<td class="org-right">507.471</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Cr_sv_GW</td>
<td class="org-right">246.211</td>
<td class="org-right">328.282</td>
<td class="org-right">426.767</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Cr_sv</td>
<td class="org-right">296.603</td>
<td class="org-right">395.471</td>
<td class="org-right">514.112</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Cr</td>
<td class="org-right">170.31</td>
<td class="org-right">227.08</td>
<td class="org-right">295.204</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Cr_pv</td>
<td class="org-right">199.261</td>
<td class="org-right">265.681</td>
<td class="org-right">345.385</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Cs_sv_GW</td>
<td class="org-right">148.575</td>
<td class="org-right">198.101</td>
<td class="org-right">257.531</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Cs_sv</td>
<td class="org-right">165.238</td>
<td class="org-right">220.318</td>
<td class="org-right">286.413</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Cu_pv_GW</td>
<td class="org-right">350.498</td>
<td class="org-right">467.331</td>
<td class="org-right">607.530</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Cu</td>
<td class="org-right">221.585</td>
<td class="org-right">295.446</td>
<td class="org-right">384.080</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Cu_pv</td>
<td class="org-right">276.486</td>
<td class="org-right">368.648</td>
<td class="org-right">479.242</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Cu_GW</td>
<td class="org-right">312.779</td>
<td class="org-right">417.039</td>
<td class="org-right">542.151</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Dy</td>
<td class="org-right">191.601</td>
<td class="org-right">255.467</td>
<td class="org-right">332.107</td>
<td class="org-right">20.0</td>
</tr>

<tr>
<td class="org-left">Dy_3</td>
<td class="org-right">116.785</td>
<td class="org-right">155.713</td>
<td class="org-right">202.427</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Er_2</td>
<td class="org-right">89.813</td>
<td class="org-right">119.75</td>
<td class="org-right">155.675</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Er</td>
<td class="org-right">223.587</td>
<td class="org-right">298.116</td>
<td class="org-right">387.551</td>
<td class="org-right">22.0</td>
</tr>

<tr>
<td class="org-left">Er_3</td>
<td class="org-right">116.278</td>
<td class="org-right">155.037</td>
<td class="org-right">201.548</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Eu_3</td>
<td class="org-right">96.793</td>
<td class="org-right">129.057</td>
<td class="org-right">167.774</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Eu</td>
<td class="org-right">187.251</td>
<td class="org-right">249.668</td>
<td class="org-right">324.568</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Eu_2</td>
<td class="org-right">74.496</td>
<td class="org-right">99.328</td>
<td class="org-right">129.126</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">F_s</td>
<td class="org-right">217.378</td>
<td class="org-right">289.837</td>
<td class="org-right">376.788</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Fr_sv</td>
<td class="org-right">160.905</td>
<td class="org-right">214.54</td>
<td class="org-right">278.902</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">F</td>
<td class="org-right">300.0</td>
<td class="org-right">400.0</td>
<td class="org-right">520.000</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Fe_GW</td>
<td class="org-right">240.755</td>
<td class="org-right">321.007</td>
<td class="org-right">417.309</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Fe_sv</td>
<td class="org-right">292.918</td>
<td class="org-right">390.558</td>
<td class="org-right">507.725</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Fe</td>
<td class="org-right">200.911</td>
<td class="org-right">267.882</td>
<td class="org-right">348.247</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">F_GW</td>
<td class="org-right">365.773</td>
<td class="org-right">487.698</td>
<td class="org-right">634.007</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">F_h</td>
<td class="org-right">500.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">F_GW_new</td>
<td class="org-right">365.773</td>
<td class="org-right">487.698</td>
<td class="org-right">634.007</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Fe_pv</td>
<td class="org-right">219.928</td>
<td class="org-right">293.238</td>
<td class="org-right">381.209</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Fe_sv_GW</td>
<td class="org-right">273.539</td>
<td class="org-right">364.719</td>
<td class="org-right">474.135</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Fe_GW</td>
<td class="org-right">240.755</td>
<td class="org-right">321.007</td>
<td class="org-right">417.309</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Fe_sv</td>
<td class="org-right">292.918</td>
<td class="org-right">390.558</td>
<td class="org-right">507.725</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Fe</td>
<td class="org-right">200.911</td>
<td class="org-right">267.882</td>
<td class="org-right">348.247</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Fe_pv</td>
<td class="org-right">219.928</td>
<td class="org-right">293.238</td>
<td class="org-right">381.209</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Fe_sv_GW</td>
<td class="org-right">273.539</td>
<td class="org-right">364.719</td>
<td class="org-right">474.135</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Fr_sv</td>
<td class="org-right">160.905</td>
<td class="org-right">214.54</td>
<td class="org-right">278.902</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Ga_sv_GW</td>
<td class="org-right">377.564</td>
<td class="org-right">503.418</td>
<td class="org-right">654.443</td>
<td class="org-right">21.0</td>
</tr>

<tr>
<td class="org-left">Ga</td>
<td class="org-right">101.009</td>
<td class="org-right">134.678</td>
<td class="org-right">175.081</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Ga_GW</td>
<td class="org-right">101.009</td>
<td class="org-right">134.678</td>
<td class="org-right">175.081</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Ga_pv_GW</td>
<td class="org-right">317.251</td>
<td class="org-right">423.002</td>
<td class="org-right">549.903</td>
<td class="org-right">19.0</td>
</tr>

<tr>
<td class="org-left">Ga_d_GW</td>
<td class="org-right">303.451</td>
<td class="org-right">404.602</td>
<td class="org-right">525.983</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Ga_h</td>
<td class="org-right">303.451</td>
<td class="org-right">404.601</td>
<td class="org-right">525.981</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Ga_d</td>
<td class="org-right">212.018</td>
<td class="org-right">282.691</td>
<td class="org-right">367.498</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Gd</td>
<td class="org-right">192.354</td>
<td class="org-right">256.472</td>
<td class="org-right">333.414</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Gd_3</td>
<td class="org-right">115.749</td>
<td class="org-right">154.332</td>
<td class="org-right">200.632</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Ge_GW</td>
<td class="org-right">130.355</td>
<td class="org-right">173.807</td>
<td class="org-right">225.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Ge</td>
<td class="org-right">130.355</td>
<td class="org-right">173.807</td>
<td class="org-right">225.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Ge_sv_GW</td>
<td class="org-right">340.866</td>
<td class="org-right">454.489</td>
<td class="org-right">590.836</td>
<td class="org-right">22.0</td>
</tr>

<tr>
<td class="org-left">Ge_d</td>
<td class="org-right">232.72</td>
<td class="org-right">310.294</td>
<td class="org-right">403.382</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Ge_h</td>
<td class="org-right">307.818</td>
<td class="org-right">410.425</td>
<td class="org-right">533.553</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Ge_d_GW</td>
<td class="org-right">232.72</td>
<td class="org-right">310.294</td>
<td class="org-right">403.382</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">H</td>
<td class="org-right">200.0</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">H_h_GW</td>
<td class="org-right">350.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">H_AE</td>
<td class="org-right">400.0</td>
<td class="org-right">1000.0</td>
<td class="org-right">1300.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Ho</td>
<td class="org-right">192.876</td>
<td class="org-right">257.168</td>
<td class="org-right">334.318</td>
<td class="org-right">21.0</td>
</tr>

<tr>
<td class="org-left">H1.33</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">1.33</td>
</tr>

<tr>
<td class="org-left">Ho_3</td>
<td class="org-right">115.603</td>
<td class="org-right">154.137</td>
<td class="org-right">200.378</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">He_GW</td>
<td class="org-right">304.335</td>
<td class="org-right">405.78</td>
<td class="org-right">527.514</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">H1.25</td>
<td class="org-right">343.141</td>
<td class="org-right">457.521</td>
<td class="org-right">594.777</td>
<td class="org-right">1.25</td>
</tr>

<tr>
<td class="org-left">Hg</td>
<td class="org-right">174.903</td>
<td class="org-right">233.204</td>
<td class="org-right">303.165</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Hf</td>
<td class="org-right">165.25</td>
<td class="org-right">220.334</td>
<td class="org-right">286.434</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">He</td>
<td class="org-right">359.172</td>
<td class="org-right">478.896</td>
<td class="org-right">622.565</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">H.58</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.58</td>
</tr>

<tr>
<td class="org-left">H.66</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.66</td>
</tr>

<tr>
<td class="org-left">H.42</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.42</td>
</tr>

<tr>
<td class="org-left">Hf_sv_GW</td>
<td class="org-right">212.223</td>
<td class="org-right">282.964</td>
<td class="org-right">367.853</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">H1.5</td>
<td class="org-right">200.0</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">1.5</td>
</tr>

<tr>
<td class="org-left">H_h</td>
<td class="org-right">350.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">H_GW</td>
<td class="org-right">250.0</td>
<td class="org-right">300.0</td>
<td class="org-right">390.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">H_s</td>
<td class="org-right">150.0</td>
<td class="org-right">200.0</td>
<td class="org-right">260.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">H1.66</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">1.66</td>
</tr>

<tr>
<td class="org-left">H.5</td>
<td class="org-right">200.0</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.5</td>
</tr>

<tr>
<td class="org-left">H.25</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.25</td>
</tr>

<tr>
<td class="org-left">Hf_pv</td>
<td class="org-right">165.25</td>
<td class="org-right">220.334</td>
<td class="org-right">286.434</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">H.75</td>
<td class="org-right">200.0</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.75</td>
</tr>

<tr>
<td class="org-left">H.33</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">0.33</td>
</tr>

<tr>
<td class="org-left">H1.75</td>
<td class="org-right">None</td>
<td class="org-right">250.0</td>
<td class="org-right">325.000</td>
<td class="org-right">1.75</td>
</tr>

<tr>
<td class="org-left">Hf_sv</td>
<td class="org-right">178.083</td>
<td class="org-right">237.444</td>
<td class="org-right">308.677</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">He_GW</td>
<td class="org-right">304.335</td>
<td class="org-right">405.78</td>
<td class="org-right">527.514</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">He</td>
<td class="org-right">359.172</td>
<td class="org-right">478.896</td>
<td class="org-right">622.565</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Hf</td>
<td class="org-right">165.25</td>
<td class="org-right">220.334</td>
<td class="org-right">286.434</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Hf_sv_GW</td>
<td class="org-right">212.223</td>
<td class="org-right">282.964</td>
<td class="org-right">367.853</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Hf_pv</td>
<td class="org-right">165.25</td>
<td class="org-right">220.334</td>
<td class="org-right">286.434</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Hf_sv</td>
<td class="org-right">178.083</td>
<td class="org-right">237.444</td>
<td class="org-right">308.677</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Hg</td>
<td class="org-right">174.903</td>
<td class="org-right">233.204</td>
<td class="org-right">303.165</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ho</td>
<td class="org-right">192.876</td>
<td class="org-right">257.168</td>
<td class="org-right">334.318</td>
<td class="org-right">21.0</td>
</tr>

<tr>
<td class="org-left">Ho_3</td>
<td class="org-right">115.603</td>
<td class="org-right">154.137</td>
<td class="org-right">200.378</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">In_d_GW</td>
<td class="org-right">208.968</td>
<td class="org-right">278.624</td>
<td class="org-right">362.211</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">In_d</td>
<td class="org-right">179.409</td>
<td class="org-right">239.211</td>
<td class="org-right">310.974</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">I_GW</td>
<td class="org-right">131.735</td>
<td class="org-right">175.647</td>
<td class="org-right">228.341</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">I</td>
<td class="org-right">131.735</td>
<td class="org-right">175.647</td>
<td class="org-right">228.341</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Ir_sv_GW</td>
<td class="org-right">239.882</td>
<td class="org-right">319.843</td>
<td class="org-right">415.796</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Ir</td>
<td class="org-right">158.148</td>
<td class="org-right">210.864</td>
<td class="org-right">274.123</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">In</td>
<td class="org-right">71.951</td>
<td class="org-right">95.934</td>
<td class="org-right">124.714</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">In_d_GW</td>
<td class="org-right">208.968</td>
<td class="org-right">278.624</td>
<td class="org-right">362.211</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">In_d</td>
<td class="org-right">179.409</td>
<td class="org-right">239.211</td>
<td class="org-right">310.974</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">In</td>
<td class="org-right">71.951</td>
<td class="org-right">95.934</td>
<td class="org-right">124.714</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Ir_sv_GW</td>
<td class="org-right">239.882</td>
<td class="org-right">319.843</td>
<td class="org-right">415.796</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Ir</td>
<td class="org-right">158.148</td>
<td class="org-right">210.864</td>
<td class="org-right">274.123</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Kr</td>
<td class="org-right">138.998</td>
<td class="org-right">185.331</td>
<td class="org-right">240.930</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">K_pv</td>
<td class="org-right">87.548</td>
<td class="org-right">116.731</td>
<td class="org-right">151.750</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">K_sv</td>
<td class="org-right">194.448</td>
<td class="org-right">259.264</td>
<td class="org-right">337.043</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Kr_GW</td>
<td class="org-right">138.998</td>
<td class="org-right">185.331</td>
<td class="org-right">240.930</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">K_sv_GW</td>
<td class="org-right">186.749</td>
<td class="org-right">248.998</td>
<td class="org-right">323.697</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Kr</td>
<td class="org-right">138.998</td>
<td class="org-right">185.331</td>
<td class="org-right">240.930</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Kr_GW</td>
<td class="org-right">138.998</td>
<td class="org-right">185.331</td>
<td class="org-right">240.930</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">La</td>
<td class="org-right">164.469</td>
<td class="org-right">219.292</td>
<td class="org-right">285.080</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">La_s</td>
<td class="org-right">102.397</td>
<td class="org-right">136.53</td>
<td class="org-right">177.489</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Li_sv_GW</td>
<td class="org-right">325.274</td>
<td class="org-right">433.699</td>
<td class="org-right">563.809</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Li_GW</td>
<td class="org-right">84.078</td>
<td class="org-right">112.104</td>
<td class="org-right">145.735</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Li_AE_GW</td>
<td class="org-right">325.274</td>
<td class="org-right">433.699</td>
<td class="org-right">563.809</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Li</td>
<td class="org-right">100.0</td>
<td class="org-right">140.0</td>
<td class="org-right">182.000</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Li_sv</td>
<td class="org-right">374.276</td>
<td class="org-right">499.034</td>
<td class="org-right">648.744</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Lu</td>
<td class="org-right">191.771</td>
<td class="org-right">255.695</td>
<td class="org-right">332.404</td>
<td class="org-right">25.0</td>
</tr>

<tr>
<td class="org-left">Lu_3</td>
<td class="org-right">116.244</td>
<td class="org-right">154.992</td>
<td class="org-right">201.490</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Mg_pv_GW</td>
<td class="org-right">302.947</td>
<td class="org-right">403.929</td>
<td class="org-right">525.108</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Mg_GW</td>
<td class="org-right">94.607</td>
<td class="org-right">126.143</td>
<td class="org-right">163.986</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Mg_pv</td>
<td class="org-right">302.947</td>
<td class="org-right">403.929</td>
<td class="org-right">525.108</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Mg</td>
<td class="org-right">94.607</td>
<td class="org-right">126.143</td>
<td class="org-right">163.986</td>
<td class="org-right">2.0</td>
</tr>

<tr>
<td class="org-left">Mg_sv</td>
<td class="org-right">371.417</td>
<td class="org-right">495.223</td>
<td class="org-right">643.790</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Mg_sv_GW</td>
<td class="org-right">322.42</td>
<td class="org-right">429.893</td>
<td class="org-right">558.861</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Mn_sv_GW</td>
<td class="org-right">268.458</td>
<td class="org-right">357.944</td>
<td class="org-right">465.327</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Mn_pv</td>
<td class="org-right">202.398</td>
<td class="org-right">269.864</td>
<td class="org-right">350.823</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Mn</td>
<td class="org-right">202.398</td>
<td class="org-right">269.864</td>
<td class="org-right">350.823</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Mn_GW</td>
<td class="org-right">208.85</td>
<td class="org-right">278.466</td>
<td class="org-right">362.006</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Mn_sv</td>
<td class="org-right">290.39</td>
<td class="org-right">387.187</td>
<td class="org-right">503.343</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Mo_sv</td>
<td class="org-right">182.007</td>
<td class="org-right">242.676</td>
<td class="org-right">315.479</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Mo_sv_GW</td>
<td class="org-right">233.929</td>
<td class="org-right">311.905</td>
<td class="org-right">405.476</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Mo</td>
<td class="org-right">168.438</td>
<td class="org-right">224.584</td>
<td class="org-right">291.959</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Mo_pv</td>
<td class="org-right">168.438</td>
<td class="org-right">224.584</td>
<td class="org-right">291.959</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Nb_sv</td>
<td class="org-right">219.927</td>
<td class="org-right">293.235</td>
<td class="org-right">381.206</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Nb_pv</td>
<td class="org-right">156.456</td>
<td class="org-right">208.608</td>
<td class="org-right">271.190</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">N_s_GW</td>
<td class="org-right">222.371</td>
<td class="org-right">296.495</td>
<td class="org-right">385.444</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Na_pv</td>
<td class="org-right">194.671</td>
<td class="org-right">259.561</td>
<td class="org-right">337.429</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">N_GW</td>
<td class="org-right">315.677</td>
<td class="org-right">420.902</td>
<td class="org-right">547.173</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Np</td>
<td class="org-right">190.695</td>
<td class="org-right">254.26</td>
<td class="org-right">330.538</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Ni_sv_GW</td>
<td class="org-right">310.107</td>
<td class="org-right">413.475</td>
<td class="org-right">537.518</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Ne</td>
<td class="org-right">257.704</td>
<td class="org-right">343.606</td>
<td class="org-right">446.688</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">N_GW_new</td>
<td class="org-right">315.677</td>
<td class="org-right">420.902</td>
<td class="org-right">547.173</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Na_sv</td>
<td class="org-right">484.23</td>
<td class="org-right">645.64</td>
<td class="org-right">839.332</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Ni</td>
<td class="org-right">202.149</td>
<td class="org-right">269.532</td>
<td class="org-right">350.392</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ne_GW_soft</td>
<td class="org-right">238.695</td>
<td class="org-right">318.26</td>
<td class="org-right">413.738</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">N</td>
<td class="org-right">300.0</td>
<td class="org-right">400.0</td>
<td class="org-right">520.000</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">N_s</td>
<td class="org-right">209.769</td>
<td class="org-right">279.692</td>
<td class="org-right">363.600</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">N_h</td>
<td class="org-right">500.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Nb_sv_GW</td>
<td class="org-right">214.344</td>
<td class="org-right">285.792</td>
<td class="org-right">371.530</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Na</td>
<td class="org-right">76.476</td>
<td class="org-right">101.968</td>
<td class="org-right">132.558</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Nd_3</td>
<td class="org-right">136.964</td>
<td class="org-right">182.619</td>
<td class="org-right">237.405</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ne_GW</td>
<td class="org-right">238.695</td>
<td class="org-right">318.26</td>
<td class="org-right">413.738</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ni_GW</td>
<td class="org-right">267.992</td>
<td class="org-right">357.323</td>
<td class="org-right">464.520</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Nd</td>
<td class="org-right">189.892</td>
<td class="org-right">253.189</td>
<td class="org-right">329.146</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Np_s</td>
<td class="org-right">155.785</td>
<td class="org-right">207.713</td>
<td class="org-right">270.027</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Na_sv_GW</td>
<td class="org-right">195.049</td>
<td class="org-right">260.065</td>
<td class="org-right">338.084</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Ni_pv</td>
<td class="org-right">275.989</td>
<td class="org-right">367.986</td>
<td class="org-right">478.382</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Na_pv</td>
<td class="org-right">194.671</td>
<td class="org-right">259.561</td>
<td class="org-right">337.429</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Na_sv</td>
<td class="org-right">484.23</td>
<td class="org-right">645.64</td>
<td class="org-right">839.332</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Na</td>
<td class="org-right">76.476</td>
<td class="org-right">101.968</td>
<td class="org-right">132.558</td>
<td class="org-right">1.0</td>
</tr>

<tr>
<td class="org-left">Na_sv_GW</td>
<td class="org-right">195.049</td>
<td class="org-right">260.065</td>
<td class="org-right">338.084</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Nb_sv</td>
<td class="org-right">219.927</td>
<td class="org-right">293.235</td>
<td class="org-right">381.206</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Nb_pv</td>
<td class="org-right">156.456</td>
<td class="org-right">208.608</td>
<td class="org-right">271.190</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Nb_sv_GW</td>
<td class="org-right">214.344</td>
<td class="org-right">285.792</td>
<td class="org-right">371.530</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Nd_3</td>
<td class="org-right">136.964</td>
<td class="org-right">182.619</td>
<td class="org-right">237.405</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Nd</td>
<td class="org-right">189.892</td>
<td class="org-right">253.189</td>
<td class="org-right">329.146</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Ne</td>
<td class="org-right">257.704</td>
<td class="org-right">343.606</td>
<td class="org-right">446.688</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ne_GW_soft</td>
<td class="org-right">238.695</td>
<td class="org-right">318.26</td>
<td class="org-right">413.738</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ne_GW</td>
<td class="org-right">238.695</td>
<td class="org-right">318.26</td>
<td class="org-right">413.738</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ni_sv_GW</td>
<td class="org-right">310.107</td>
<td class="org-right">413.475</td>
<td class="org-right">537.518</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Ni</td>
<td class="org-right">202.149</td>
<td class="org-right">269.532</td>
<td class="org-right">350.392</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ni_GW</td>
<td class="org-right">267.992</td>
<td class="org-right">357.323</td>
<td class="org-right">464.520</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ni_pv</td>
<td class="org-right">275.989</td>
<td class="org-right">367.986</td>
<td class="org-right">478.382</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Np</td>
<td class="org-right">190.695</td>
<td class="org-right">254.26</td>
<td class="org-right">330.538</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Np_s</td>
<td class="org-right">155.785</td>
<td class="org-right">207.713</td>
<td class="org-right">270.027</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Os</td>
<td class="org-right">171.017</td>
<td class="org-right">228.022</td>
<td class="org-right">296.429</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">O_s</td>
<td class="org-right">212.14</td>
<td class="org-right">282.853</td>
<td class="org-right">367.709</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">O</td>
<td class="org-right">300.0</td>
<td class="org-right">400.0</td>
<td class="org-right">520.000</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">O_h</td>
<td class="org-right">500.0</td>
<td class="org-right">700.0</td>
<td class="org-right">910.000</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Os_pv</td>
<td class="org-right">171.017</td>
<td class="org-right">228.022</td>
<td class="org-right">296.429</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">O_s_GW</td>
<td class="org-right">250.998</td>
<td class="org-right">334.664</td>
<td class="org-right">435.063</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">O_GW</td>
<td class="org-right">310.976</td>
<td class="org-right">414.635</td>
<td class="org-right">539.025</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Os_sv_GW</td>
<td class="org-right">239.83</td>
<td class="org-right">319.773</td>
<td class="org-right">415.705</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">O_GW_new</td>
<td class="org-right">325.824</td>
<td class="org-right">434.431</td>
<td class="org-right">564.760</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Os</td>
<td class="org-right">171.017</td>
<td class="org-right">228.022</td>
<td class="org-right">296.429</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Os_pv</td>
<td class="org-right">171.017</td>
<td class="org-right">228.022</td>
<td class="org-right">296.429</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Os_sv_GW</td>
<td class="org-right">239.83</td>
<td class="org-right">319.773</td>
<td class="org-right">415.705</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pt_pv_GW</td>
<td class="org-right">186.537</td>
<td class="org-right">248.716</td>
<td class="org-right">323.331</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pm</td>
<td class="org-right">193.97</td>
<td class="org-right">258.627</td>
<td class="org-right">336.215</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">P_h</td>
<td class="org-right">292.651</td>
<td class="org-right">390.202</td>
<td class="org-right">507.263</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Pb_d</td>
<td class="org-right">178.376</td>
<td class="org-right">237.835</td>
<td class="org-right">309.186</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Pa</td>
<td class="org-right">189.145</td>
<td class="org-right">252.193</td>
<td class="org-right">327.851</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Po_d</td>
<td class="org-right">198.424</td>
<td class="org-right">264.565</td>
<td class="org-right">343.935</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pb_d_GW</td>
<td class="org-right">178.357</td>
<td class="org-right">237.809</td>
<td class="org-right">309.152</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">P</td>
<td class="org-right">191.28</td>
<td class="org-right">255.04</td>
<td class="org-right">331.552</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Pt</td>
<td class="org-right">172.712</td>
<td class="org-right">230.283</td>
<td class="org-right">299.368</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pd_GW</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Po</td>
<td class="org-right">119.78</td>
<td class="org-right">159.707</td>
<td class="org-right">207.619</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Pd_pv</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pu</td>
<td class="org-right">190.765</td>
<td class="org-right">254.353</td>
<td class="org-right">330.659</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pt_GW</td>
<td class="org-right">186.537</td>
<td class="org-right">248.716</td>
<td class="org-right">323.331</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pb</td>
<td class="org-right">73.48</td>
<td class="org-right">97.973</td>
<td class="org-right">127.365</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Pm_3</td>
<td class="org-right">132.719</td>
<td class="org-right">176.959</td>
<td class="org-right">230.047</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Pr</td>
<td class="org-right">204.706</td>
<td class="org-right">272.941</td>
<td class="org-right">354.823</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Pr_3</td>
<td class="org-right">136.289</td>
<td class="org-right">181.719</td>
<td class="org-right">236.235</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Pt_sv_GW</td>
<td class="org-right">242.752</td>
<td class="org-right">323.669</td>
<td class="org-right">420.770</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">P_GW</td>
<td class="org-right">191.28</td>
<td class="org-right">255.04</td>
<td class="org-right">331.552</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Pa_s</td>
<td class="org-right">145.1</td>
<td class="org-right">193.466</td>
<td class="org-right">251.506</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Pd</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pt_pv</td>
<td class="org-right">220.955</td>
<td class="org-right">294.607</td>
<td class="org-right">382.989</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pu_s</td>
<td class="org-right">155.873</td>
<td class="org-right">207.83</td>
<td class="org-right">270.179</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pa</td>
<td class="org-right">189.145</td>
<td class="org-right">252.193</td>
<td class="org-right">327.851</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Pa_s</td>
<td class="org-right">145.1</td>
<td class="org-right">193.466</td>
<td class="org-right">251.506</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Pb_d</td>
<td class="org-right">178.376</td>
<td class="org-right">237.835</td>
<td class="org-right">309.186</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Pb_d_GW</td>
<td class="org-right">178.357</td>
<td class="org-right">237.809</td>
<td class="org-right">309.152</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Pb</td>
<td class="org-right">73.48</td>
<td class="org-right">97.973</td>
<td class="org-right">127.365</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Pd_GW</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pd_pv</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pd</td>
<td class="org-right">188.194</td>
<td class="org-right">250.925</td>
<td class="org-right">326.203</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pm</td>
<td class="org-right">193.97</td>
<td class="org-right">258.627</td>
<td class="org-right">336.215</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Pm_3</td>
<td class="org-right">132.719</td>
<td class="org-right">176.959</td>
<td class="org-right">230.047</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Po_d</td>
<td class="org-right">198.424</td>
<td class="org-right">264.565</td>
<td class="org-right">343.935</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Po</td>
<td class="org-right">119.78</td>
<td class="org-right">159.707</td>
<td class="org-right">207.619</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Pr</td>
<td class="org-right">204.706</td>
<td class="org-right">272.941</td>
<td class="org-right">354.823</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Pr_3</td>
<td class="org-right">136.289</td>
<td class="org-right">181.719</td>
<td class="org-right">236.235</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Pt_pv_GW</td>
<td class="org-right">186.537</td>
<td class="org-right">248.716</td>
<td class="org-right">323.331</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pt</td>
<td class="org-right">172.712</td>
<td class="org-right">230.283</td>
<td class="org-right">299.368</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pt_GW</td>
<td class="org-right">186.537</td>
<td class="org-right">248.716</td>
<td class="org-right">323.331</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Pt_sv_GW</td>
<td class="org-right">242.752</td>
<td class="org-right">323.669</td>
<td class="org-right">420.770</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Pt_pv</td>
<td class="org-right">220.955</td>
<td class="org-right">294.607</td>
<td class="org-right">382.989</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pu</td>
<td class="org-right">190.765</td>
<td class="org-right">254.353</td>
<td class="org-right">330.659</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Pu_s</td>
<td class="org-right">155.873</td>
<td class="org-right">207.83</td>
<td class="org-right">270.179</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Ra_sv</td>
<td class="org-right">178.025</td>
<td class="org-right">237.367</td>
<td class="org-right">308.577</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Rb_sv</td>
<td class="org-right">165.084</td>
<td class="org-right">220.112</td>
<td class="org-right">286.146</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Rb_sv_GW</td>
<td class="org-right">165.898</td>
<td class="org-right">221.197</td>
<td class="org-right">287.556</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Rb_pv</td>
<td class="org-right">91.412</td>
<td class="org-right">121.882</td>
<td class="org-right">158.447</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Re</td>
<td class="org-right">169.662</td>
<td class="org-right">226.216</td>
<td class="org-right">294.081</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Re_pv</td>
<td class="org-right">169.662</td>
<td class="org-right">226.216</td>
<td class="org-right">294.081</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Re_sv_GW</td>
<td class="org-right">237.759</td>
<td class="org-right">317.012</td>
<td class="org-right">412.116</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Rh_sv_GW</td>
<td class="org-right">240.068</td>
<td class="org-right">320.091</td>
<td class="org-right">416.118</td>
<td class="org-right">17.0</td>
</tr>

<tr>
<td class="org-left">Rh_pv_GW</td>
<td class="org-right">185.556</td>
<td class="org-right">247.408</td>
<td class="org-right">321.630</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Rh_pv</td>
<td class="org-right">185.556</td>
<td class="org-right">247.408</td>
<td class="org-right">321.630</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Rh</td>
<td class="org-right">171.747</td>
<td class="org-right">228.996</td>
<td class="org-right">297.695</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Rh_GW</td>
<td class="org-right">185.556</td>
<td class="org-right">247.408</td>
<td class="org-right">321.630</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Rn</td>
<td class="org-right">114.091</td>
<td class="org-right">152.121</td>
<td class="org-right">197.757</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ru</td>
<td class="org-right">159.953</td>
<td class="org-right">213.271</td>
<td class="org-right">277.252</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Ru_pv_GW</td>
<td class="org-right">180.037</td>
<td class="org-right">240.049</td>
<td class="org-right">312.064</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Ru_sv_GW</td>
<td class="org-right">240.9</td>
<td class="org-right">321.2</td>
<td class="org-right">417.560</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Ru_pv</td>
<td class="org-right">180.037</td>
<td class="org-right">240.049</td>
<td class="org-right">312.064</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Ru_sv</td>
<td class="org-right">239.141</td>
<td class="org-right">318.855</td>
<td class="org-right">414.512</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Sn_d_GW</td>
<td class="org-right">195.049</td>
<td class="org-right">260.066</td>
<td class="org-right">338.086</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">S_h</td>
<td class="org-right">301.827</td>
<td class="org-right">402.436</td>
<td class="org-right">523.167</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Sn</td>
<td class="org-right">77.427</td>
<td class="org-right">103.236</td>
<td class="org-right">134.207</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Sr_sv_GW</td>
<td class="org-right">168.613</td>
<td class="org-right">224.817</td>
<td class="org-right">292.262</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Sc_sv_GW</td>
<td class="org-right">213.799</td>
<td class="org-right">285.066</td>
<td class="org-right">370.586</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Se_GW</td>
<td class="org-right">158.666</td>
<td class="org-right">211.555</td>
<td class="org-right">275.022</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Sm_3</td>
<td class="org-right">132.815</td>
<td class="org-right">177.087</td>
<td class="org-right">230.213</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">S_GW</td>
<td class="org-right">194.016</td>
<td class="org-right">258.689</td>
<td class="org-right">336.296</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Si_sv_GW</td>
<td class="org-right">410.683</td>
<td class="org-right">547.578</td>
<td class="org-right">711.851</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Sc_sv</td>
<td class="org-right">166.995</td>
<td class="org-right">222.66</td>
<td class="org-right">289.458</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Se</td>
<td class="org-right">158.666</td>
<td class="org-right">211.555</td>
<td class="org-right">275.022</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">S</td>
<td class="org-right">194.016</td>
<td class="org-right">258.689</td>
<td class="org-right">336.296</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Sb_d_GW</td>
<td class="org-right">197.325</td>
<td class="org-right">263.1</td>
<td class="org-right">342.030</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Sn_d</td>
<td class="org-right">180.812</td>
<td class="org-right">241.083</td>
<td class="org-right">313.408</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Sc</td>
<td class="org-right">116.072</td>
<td class="org-right">154.763</td>
<td class="org-right">201.192</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Sr_sv</td>
<td class="org-right">172.014</td>
<td class="org-right">229.353</td>
<td class="org-right">298.159</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Sb</td>
<td class="org-right">129.052</td>
<td class="org-right">172.069</td>
<td class="org-right">223.690</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Si</td>
<td class="org-right">184.009</td>
<td class="org-right">245.345</td>
<td class="org-right">318.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Sb_GW</td>
<td class="org-right">129.052</td>
<td class="org-right">172.069</td>
<td class="org-right">223.690</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Sm</td>
<td class="org-right">193.136</td>
<td class="org-right">257.515</td>
<td class="org-right">334.769</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Si_GW</td>
<td class="org-right">184.009</td>
<td class="org-right">245.345</td>
<td class="org-right">318.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Sb_d_GW</td>
<td class="org-right">197.325</td>
<td class="org-right">263.1</td>
<td class="org-right">342.030</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Sb</td>
<td class="org-right">129.052</td>
<td class="org-right">172.069</td>
<td class="org-right">223.690</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Sb_GW</td>
<td class="org-right">129.052</td>
<td class="org-right">172.069</td>
<td class="org-right">223.690</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Sc_sv_GW</td>
<td class="org-right">213.799</td>
<td class="org-right">285.066</td>
<td class="org-right">370.586</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Sc_sv</td>
<td class="org-right">166.995</td>
<td class="org-right">222.66</td>
<td class="org-right">289.458</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Sc</td>
<td class="org-right">116.072</td>
<td class="org-right">154.763</td>
<td class="org-right">201.192</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Se_GW</td>
<td class="org-right">158.666</td>
<td class="org-right">211.555</td>
<td class="org-right">275.022</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Se</td>
<td class="org-right">158.666</td>
<td class="org-right">211.555</td>
<td class="org-right">275.022</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Si_sv_GW</td>
<td class="org-right">410.683</td>
<td class="org-right">547.578</td>
<td class="org-right">711.851</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Si</td>
<td class="org-right">184.009</td>
<td class="org-right">245.345</td>
<td class="org-right">318.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Si_GW</td>
<td class="org-right">184.009</td>
<td class="org-right">245.345</td>
<td class="org-right">318.949</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Sm_3</td>
<td class="org-right">132.815</td>
<td class="org-right">177.087</td>
<td class="org-right">230.213</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Sm</td>
<td class="org-right">193.136</td>
<td class="org-right">257.515</td>
<td class="org-right">334.769</td>
<td class="org-right">16.0</td>
</tr>

<tr>
<td class="org-left">Sn_d_GW</td>
<td class="org-right">195.049</td>
<td class="org-right">260.066</td>
<td class="org-right">338.086</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Sn</td>
<td class="org-right">77.427</td>
<td class="org-right">103.236</td>
<td class="org-right">134.207</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Sn_d</td>
<td class="org-right">180.812</td>
<td class="org-right">241.083</td>
<td class="org-right">313.408</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">Sr_sv_GW</td>
<td class="org-right">168.613</td>
<td class="org-right">224.817</td>
<td class="org-right">292.262</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Sr_sv</td>
<td class="org-right">172.014</td>
<td class="org-right">229.353</td>
<td class="org-right">298.159</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ta_pv</td>
<td class="org-right">167.75</td>
<td class="org-right">223.667</td>
<td class="org-right">290.767</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Ta</td>
<td class="org-right">167.75</td>
<td class="org-right">223.667</td>
<td class="org-right">290.767</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">Ta_sv_GW</td>
<td class="org-right">214.506</td>
<td class="org-right">286.008</td>
<td class="org-right">371.810</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Tb_3</td>
<td class="org-right">116.709</td>
<td class="org-right">155.613</td>
<td class="org-right">202.297</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">Tb</td>
<td class="org-right">198.618</td>
<td class="org-right">264.824</td>
<td class="org-right">344.271</td>
<td class="org-right">19.0</td>
</tr>

<tr>
<td class="org-left">Tc_pv</td>
<td class="org-right">197.642</td>
<td class="org-right">263.523</td>
<td class="org-right">342.580</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Tc_sv</td>
<td class="org-right">239.028</td>
<td class="org-right">318.703</td>
<td class="org-right">414.314</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Tc_sv_GW</td>
<td class="org-right">238.582</td>
<td class="org-right">318.11</td>
<td class="org-right">413.543</td>
<td class="org-right">15.0</td>
</tr>

<tr>
<td class="org-left">Tc</td>
<td class="org-right">171.521</td>
<td class="org-right">228.694</td>
<td class="org-right">297.302</td>
<td class="org-right">7.0</td>
</tr>

<tr>
<td class="org-left">Te</td>
<td class="org-right">131.236</td>
<td class="org-right">174.982</td>
<td class="org-right">227.477</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Te_GW</td>
<td class="org-right">131.236</td>
<td class="org-right">174.982</td>
<td class="org-right">227.477</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">Th_s</td>
<td class="org-right">127.022</td>
<td class="org-right">169.363</td>
<td class="org-right">220.172</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Th</td>
<td class="org-right">185.48</td>
<td class="org-right">247.306</td>
<td class="org-right">321.498</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ti</td>
<td class="org-right">133.747</td>
<td class="org-right">178.33</td>
<td class="org-right">231.829</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">Ti_pv</td>
<td class="org-right">166.751</td>
<td class="org-right">222.335</td>
<td class="org-right">289.036</td>
<td class="org-right">10.0</td>
</tr>

<tr>
<td class="org-left">Ti_sv_GW</td>
<td class="org-right">214.498</td>
<td class="org-right">285.998</td>
<td class="org-right">371.797</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Ti_sv</td>
<td class="org-right">205.957</td>
<td class="org-right">274.61</td>
<td class="org-right">356.993</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Tl_d</td>
<td class="org-right">177.789</td>
<td class="org-right">237.053</td>
<td class="org-right">308.169</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">Tl</td>
<td class="org-right">67.605</td>
<td class="org-right">90.14</td>
<td class="org-right">117.182</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">Tm</td>
<td class="org-right">193.065</td>
<td class="org-right">257.42</td>
<td class="org-right">334.646</td>
<td class="org-right">23.0</td>
</tr>

<tr>
<td class="org-left">Tm_3</td>
<td class="org-right">111.916</td>
<td class="org-right">149.221</td>
<td class="org-right">193.987</td>
<td class="org-right">9.0</td>
</tr>

<tr>
<td class="org-left">U_s</td>
<td class="org-right">156.922</td>
<td class="org-right">209.23</td>
<td class="org-right">271.999</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">U</td>
<td class="org-right">189.376</td>
<td class="org-right">252.502</td>
<td class="org-right">328.253</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">V_sv</td>
<td class="org-right">197.755</td>
<td class="org-right">263.673</td>
<td class="org-right">342.775</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">V</td>
<td class="org-right">144.408</td>
<td class="org-right">192.543</td>
<td class="org-right">250.306</td>
<td class="org-right">5.0</td>
</tr>

<tr>
<td class="org-left">V_sv_GW</td>
<td class="org-right">242.302</td>
<td class="org-right">323.07</td>
<td class="org-right">419.991</td>
<td class="org-right">13.0</td>
</tr>

<tr>
<td class="org-left">V_pv</td>
<td class="org-right">197.755</td>
<td class="org-right">263.673</td>
<td class="org-right">342.775</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">W</td>
<td class="org-right">167.293</td>
<td class="org-right">223.057</td>
<td class="org-right">289.974</td>
<td class="org-right">6.0</td>
</tr>

<tr>
<td class="org-left">W_sv_GW</td>
<td class="org-right">237.849</td>
<td class="org-right">317.132</td>
<td class="org-right">412.272</td>
<td class="org-right">14.0</td>
</tr>

<tr>
<td class="org-left">W_pv</td>
<td class="org-right">167.293</td>
<td class="org-right">223.057</td>
<td class="org-right">289.974</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Xe</td>
<td class="org-right">114.839</td>
<td class="org-right">153.118</td>
<td class="org-right">199.053</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Xe_GW</td>
<td class="org-right">134.66</td>
<td class="org-right">179.547</td>
<td class="org-right">233.411</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Xe</td>
<td class="org-right">114.839</td>
<td class="org-right">153.118</td>
<td class="org-right">199.053</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Xe_GW</td>
<td class="org-right">134.66</td>
<td class="org-right">179.547</td>
<td class="org-right">233.411</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Y_sv</td>
<td class="org-right">151.97</td>
<td class="org-right">202.626</td>
<td class="org-right">263.414</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Y_sv_GW</td>
<td class="org-right">171.957</td>
<td class="org-right">229.276</td>
<td class="org-right">298.059</td>
<td class="org-right">11.0</td>
</tr>

<tr>
<td class="org-left">Yb</td>
<td class="org-right">189.771</td>
<td class="org-right">253.028</td>
<td class="org-right">328.936</td>
<td class="org-right">24.0</td>
</tr>

<tr>
<td class="org-left">Yb_2</td>
<td class="org-right">84.433</td>
<td class="org-right">112.578</td>
<td class="org-right">146.351</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Yb</td>
<td class="org-right">189.771</td>
<td class="org-right">253.028</td>
<td class="org-right">328.936</td>
<td class="org-right">24.0</td>
</tr>

<tr>
<td class="org-left">Yb_2</td>
<td class="org-right">84.433</td>
<td class="org-right">112.578</td>
<td class="org-right">146.351</td>
<td class="org-right">8.0</td>
</tr>

<tr>
<td class="org-left">Zn_GW</td>
<td class="org-right">246.143</td>
<td class="org-right">328.191</td>
<td class="org-right">426.648</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Zn_pv_GW</td>
<td class="org-right">270.184</td>
<td class="org-right">360.246</td>
<td class="org-right">468.320</td>
<td class="org-right">18.0</td>
</tr>

<tr>
<td class="org-left">Zn_sv_GW</td>
<td class="org-right">372.453</td>
<td class="org-right">496.604</td>
<td class="org-right">645.585</td>
<td class="org-right">20.0</td>
</tr>

<tr>
<td class="org-left">Zn</td>
<td class="org-right">207.542</td>
<td class="org-right">276.723</td>
<td class="org-right">359.740</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Zr_sv_GW</td>
<td class="org-right">211.823</td>
<td class="org-right">282.431</td>
<td class="org-right">367.160</td>
<td class="org-right">12.0</td>
</tr>

<tr>
<td class="org-left">Zr_sv</td>
<td class="org-right">172.424</td>
<td class="org-right">229.898</td>
<td class="org-right">298.867</td>
<td class="org-right">12.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgheadline232" class="outline-3">
<h3 id="orgheadline232"><span class="section-number-3">10.5</span> Hy</h3>
<div class="outline-text-3" id="text-10-5">
<p>
Here is our prototypical python script.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #0000FF;">from</span> ase <span style="color: #0000FF;">import</span> Atoms, Atom
<span style="color: #0000FF;">from</span> vasp <span style="color: #0000FF;">import</span> Vasp

<span style="color: #BA36A5;">co</span> = Atoms([Atom(<span style="color: #008000;">'C'</span>, [0, 0, 0]),
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   Atom(<span style="color: #008000;">'O'</span>, [1.2, 0, 0])],
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>  cell=(6., 6., 6.))

<span style="color: #BA36A5;">calc</span> = Vasp(<span style="color: #008000;">'molecules/simple-co'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">output dir</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   xc=<span style="color: #008000;">'pbe'</span>,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">the exchange-correlation functional</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   nbands=6,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">number of bands</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   encut=350,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">planewave cutoff</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   ismear=1,    <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">Methfessel-Paxton smearing</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   sigma=0.01,  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">very small smearing factor for a molecule</span>
<span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   <span style="color: #9B9B9B; background-color: #EDEDED;"> </span>   atoms=co)

<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'energy = {0} eV'</span>.<span style="color: #006FE0;">format</span>(co.get_potential_energy()))
<span style="color: #0000FF;">print</span>(co.get_forces())
</pre>
</div>

<pre class="example">
energy = -14.69111507 eV
[[ 5.09138064  0.          0.        ]
 [-5.09138064  0.          0.        ]]
</pre>

<p>
We can also use hy-lang for these scripts. Hy is a Lisp that works with Python. You need this in your Emacs setup (mile-hy is part of jmax).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">auto-complete</span>)
(<span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">mile-hy</span>)
</pre>
</div>

<pre class="example">
mile-hy
</pre>

<p>
And here is the same script in hy.
</p>

<div class="org-src-container">

<pre class="src src-hy">(import [ase [Atom Atoms]])
(import [vasp [Vasp]])

(<span style="color: #006FE0;">setv</span> co (Atoms [(Atom <span style="color: #008000;">"C"</span> [0.0 0.0 0.0])
                 (Atom <span style="color: #008000;">"O"</span> [1.2 0.0 0.0])]
                <span style="color: #D0372D;">:cell</span> [6.0 6.0 6.0]))

(<span style="color: #006FE0;">setv</span> calc (Vasp <span style="color: #008000;">"molecules/simple-co-hy"</span>
                 <span style="color: #D0372D;">:xc</span> <span style="color: #008000;">"pbe"</span>
                 <span style="color: #D0372D;">:nbands</span> 6
                 <span style="color: #D0372D;">:encut</span> 350
                 <span style="color: #D0372D;">:ismear</span> 1
                 <span style="color: #D0372D;">:sigma</span> 0.01
                 <span style="color: #D0372D;">:atoms</span> co))

(<span style="color: #006FE0;">print</span> (.format <span style="color: #008000;">"energy = {0} eV"</span>
                (.get_potential_energy co)))

(<span style="color: #006FE0;">print</span> (. calc potential_energy))
<span style="color: #8D8D84;">; </span><span style="color: #8D8D84; font-style: italic;">(print (.potential_energy calc)) ;; not ok</span>
(<span style="color: #006FE0;">print</span> (.get_forces co))
</pre>
</div>

<pre class="example">
energy = -14.69111507 eV
-14.69111507
[[ 5.09138064  0.          0.        ]
 [-5.09138064  0.          0.        ]]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline236" class="outline-2">
<h2 id="orgheadline236"><span class="section-number-2">11</span> Python</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-orgheadline234" class="outline-3">
<h3 id="orgheadline234"><span class="section-number-3">11.1</span> pip as a user</h3>
<div class="outline-text-3" id="text-11-1">
<p>
pip is pretty easy to install as a user.
</p>

<div class="org-src-container">

<pre class="src src-sh">pip install --user some-package
</pre>
</div>

<p>
For me this installs here:
</p>

<p>
~/.local/lib/python2.7/site-packages
</p>

<p>
That may or may not be on your Python path.
</p>
</div>
</div>

<div id="outline-container-orgheadline235" class="outline-3">
<h3 id="orgheadline235"><span class="section-number-3">11.2</span> Integer division math gotchas</h3>
<div class="outline-text-3" id="text-11-2">
<p>
It pays to be careful when dividing by integers because you can get unexpected results if you do not know the integer division rules. In python 2.6, if you divide two integers, you get an integer! This is usually not a problem if there is no emainder in the division, e.g. 6/3=2. But, if there is a remainder, and that remainder is important, you will lose it. Here is an example of calculating the mole fraction of a species from integer numbers of atoms in the unit cell. If you are not careful, you get the wrong answer! You can convert (also called casting) a number to a float using the float command.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">nPd</span> = 4
<span style="color: #BA36A5;">nCu</span> = 5
<span style="color: #BA36A5;">x_Cu</span> = nCu/(nPd + nCu)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'x_cu = {0} (integer division)'</span>.<span style="color: #006FE0;">format</span>(x_Cu))

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now cast as floats</span>
<span style="color: #BA36A5;">x_Cu</span> = <span style="color: #006FE0;">float</span>(nCu)/<span style="color: #006FE0;">float</span>(nPd + nCu)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'x_cu = {0} (float division)'</span>.<span style="color: #006FE0;">format</span>(x_Cu))
</pre>
</div>

<pre class="example">
x_cu = 0 (integer division)
x_cu = 0.555555555556 (float division)
</pre>

<p>
Note that if one of the numbers is a float, python will automatically cast the integer as a float, and return a float.
</p>
<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">nPd</span> = 4
<span style="color: #BA36A5;">nCu</span> = 5

<span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">now cast as floats</span>
<span style="color: #BA36A5;">x_Cu</span> = <span style="color: #006FE0;">float</span>(nCu)/(nPd + nCu)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'x_cu = {0}'</span>.<span style="color: #006FE0;">format</span>(x_Cu))
</pre>
</div>

<pre class="example">
x_cu = 0.555555555556
</pre>

<p>
Finally, you can tell python a number is a float by adding a decimal to it. You do not need to put a 0 after the decimal, but you can.
</p>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #BA36A5;">nPd</span> = 4.  <span style="color: #8D8D84;"># </span><span style="color: #8D8D84; font-style: italic;">this is a float</span>
<span style="color: #BA36A5;">nCu</span> = 5

<span style="color: #BA36A5;">x_Cu</span> = nCu / (nPd + nCu)
<span style="color: #0000FF;">print</span>(<span style="color: #008000;">'x_cu = {0}'</span>.<span style="color: #006FE0;">format</span>(x_Cu))
</pre>
</div>

<pre class="example">
x_cu = 0.555555555556
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline237" class="outline-2">
<h2 id="orgheadline237"><span class="section-number-2">12</span> References</h2>
<div class="outline-text-2" id="text-12">
<p>

<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="sholl-2009-densit-funct-theor">[sholl-2009-densit-funct-theor] David Sholl & Janice Steckel, Density Functional Theory: A Practical Introduction, Wiley (2009).</a></li>
<li><a id="parr-yang">[parr-yang] Parr & Yang, Density-Functional Theory of Atoms and Molecules, Oxford Science Publications (1989).</a></li>
<li><a id="koch2001">[koch2001] Koch & Holthausen, A Chemist's Guide to Density Functional Theory, Wiley-VCH (2001).</a></li>
<li><a id="kittel">[kittel] Charles Kittel, Introduction to Solid State Physics, Wiley (2005).</a></li>
<li><a id="ashcroft-mermin">[ashcroft-mermin] Ashcroft & David Mermin, Solid State Physics, Saunders College Publishing (1976).</a></li>
<li><a id="hoffmann1987">[hoffmann1987] Hoffmann, How Chemistry and Physics Meet in the Solid State, <i>Angewandte Chemie International Edition in English</i>, <b>26(9)</b>, 846-878 (1987). <a href="http://dx.doi.org/10.1002/anie.198708461">link</a>. <a href="http://dx.doi.org/10.1002/anie.198708461">doi</a>.</a></li>
<li><a id="RevModPhys.60.601">[RevModPhys.60.601] Hoffmann, A chemical and theoretical way to look at bonding on  surfaces, <i>Rev. Mod. Phys.</i>, <b>60</b>, 601-628 (1988). <a href="http://link.aps.org/doi/10.1103/RevModPhys.60.601">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.60.601">doi</a>.</a></li>
<li><a id="hammer2000:adv-cat">[hammer2000:adv-cat] @incollectionhammer2000:adv-cat,
  title =        "Theoretical surface science and
                  catalysiscalculations and concepts",
  editor =       "Bruce C. Gates, Helmut Knozinger",
  booktitle =    "Impact of Surface Science on Catalysis",
  publisher =    "Academic Press",
  year =         2000,
  volume =       45,
  pages =        "71 - 129",
  series =       "Advances in Catalysis",
  issn =         "0360-0564",
  doi =          "10.1016/S0360-0564(02)45013-4",
  url =
                  "http://www.sciencedirect.com/science/article/pii/S0360056402450134",
  author =       "B. Hammer and J.K. Nrskov"
</a></li>
<li><a id="greeley2002:elect">[greeley2002:elect] Greeley, Nrskov, Mavrikakis & Manos, ELECTRONIC STRUCTURE AND CATALYSIS ON METAL  SURFACES, <i>Annual Review of Physical Chemistry</i>, <b>53(1)</b>, 319-348 (2002). <a href="http://www.annualreviews.org/doi/abs/10.1146/annurev.physchem.53.100301.131630">link</a>. <a href="http://dx.doi.org/10.1146/annurev.physchem.53.100301.131630">doi</a>.</a></li>
<li><a id="freeman1995:densit">[freeman1995:densit] Freeman & Wimmer, Density Functional Theory as a Major Tool in  Computational Materials Science, <i>Annual Review of Materials Science</i>, <b>25(1)</b>, 7-36 (1995). <a href="http://dx.doi.org/10.1146/annurev.ms.25.080195.000255">doi</a>.</a></li>
<li><a id="payne1992:iterat">[payne1992:iterat] Payne, Teter, Allan, , Arias & Joannopoulos, Iterative minimization techniques for \textitab  initio total-energy calculations: molecular  dynamics and conjugate gradients, <i>Rev. Mod. Phys.</i>, <b>64</b>, 1045-1097 (1992). <a href="http://link.aps.org/doi/10.1103/RevModPhys.64.1045">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.64.1045">doi</a>.</a></li>
<li><a id="Kresse199615">[Kresse199615] Kresse & Furthm\"uller, Efficiency of ab-initio total energy calculations  for metals and semiconductors using a plane-wave  basis set, <i>"Computational Materials Science"</i>, <b>6(1)</b>, 15 - 50 (1996). <a href="http://www.sciencedirect.com/science/article/pii/0927025696000080">link</a>. <a href="http://dx.doi.org/10.1016/0927-0256(96)00008-0">doi</a>.</a></li>
<li><a id="bligaard2000:exchan-correl-funct">[bligaard2000:exchan-correl-funct] @MastersThesisbligaard2000:exchan-correl-funct,
  author =       T. Bligaard,
  title =        Exchange and Correlation Functionals - a study
                  toward improving the precision of electron density
                  functional calculations of atomistic systems,
  school =       Technical University of Denmark,
  year =         2000,
  note =
                  \urlhttp://www.fysik.dtu.dk/\~bligaard/masterthesis/masterdirectory/project/project.pdf
</a></li>
<li><a id="bligaard2003:under-mater-proper-basis-densit">[bligaard2003:under-mater-proper-basis-densit] @PhdThesisbligaard2003:under-mater-proper-basis-densit,
  author =       T. Bligaard,
  title =        Understanding Materials Properties on the Basis of
                  Density Functional Theory Calculations,
  school =       Technical University of Denmark,
  year =         2003,
  note =
                  \urlhttp://www.fysik.dtu.dk/\~bligaard/phdthesis/phdproject.pdf
</a></li>
<li><a id="seitsonen2000:phd">[seitsonen2000:phd] @PhdThesisseitsonen2000:phd,
  author =       A. P. Seitsonen,
  title =        Theoretical Investigations into adsorption and
                  co-adsorption on transition-metal surfaces as models
                  to heterogeneous catalysis,
  school =       Technical University of Berlin, School of
                  Mathematics and Natural Sciences,
  year =         2000,
  note =
                  http://edocs.tu-berlin.de/diss/2000/seitsonen\_ari.pdf
</a></li>
<li><a id="hirschl2002:binar-trans-metal-alloy-their-surfac">[hirschl2002:binar-trans-metal-alloy-their-surfac] @PhdThesishirschl2002:binar-trans-metal-alloy-their-surfac,
  author =       R. Hirschl,
  title =        Binary Transition Metal Alloys and Their Surfaces,
  school =       Institut f\"ur Materialphysik, University of
                  Vienna,
  year =         2002,
  note =         \urlhttp://www.hirschl.at/download/diss\_part1.pdf
                  and
                  \urlhttp://www.hirschl.at/download/diss\_part2.pdf
</a></li>
<li><a id="pauling1963">[pauling1963] Pauling & Wilson, Introduction to Quantum Mechanics with Applications  to Chemistry, Dover Publications, Inc. (1963).</a></li>
<li><a id="RevModPhys.71.1253">[RevModPhys.71.1253] Kohn, Nobel Lecture: Electronic structure of matter-wave  functions and density functionals, <i>Rev. Mod. Phys.</i>, <b>71</b>, 1253-1266 (1999). <a href="http://link.aps.org/doi/10.1103/RevModPhys.71.1253">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.71.1253">doi</a>.</a></li>
<li><a id="dirac1929:quant-mechan-many-elect-system">[dirac1929:quant-mechan-many-elect-system] Dirac, Quantum Mechanics of Many-Electron Systems, <i>Proceedings of the Royal Society of London. Series
                  A, Containing Papers of a Mathematical and Physical
                  Character</i>, <b>123(792)</b>, pp. 714-733 (1929). <a href="http://www.jstor.org/stable/95222">link</a>.</a></li>
<li><a id="PhysRev.136.B864">[PhysRev.136.B864] Hohenberg & Kohn, Inhomogeneous Electron Gas, <i>Phys. Rev.</i>, <b>136</b>, B864-B871 (1964). <a href="http://link.aps.org/doi/10.1103/PhysRev.136.B864">link</a>. <a href="http://dx.doi.org/10.1103/PhysRev.136.B864">doi</a>.</a></li>
<li><a id="PhysRev.140.A1133">[PhysRev.140.A1133] Kohn & Sham, Self-Consistent Equations Including Exchange and  Correlation Effects, <i>Phys. Rev.</i>, <b>140</b>, A1133-A1138 (1965). <a href="http://link.aps.org/doi/10.1103/PhysRev.140.A1133">link</a>. <a href="http://dx.doi.org/10.1103/PhysRev.140.A1133">doi</a>.</a></li>
<li><a id="RevModPhys.71.1267">[RevModPhys.71.1267] Pople, Nobel Lecture: Quantum chemical models, <i>Rev. Mod. Phys.</i>, <b>71</b>, 1267-1274 (1999). <a href="http://link.aps.org/doi/10.1103/RevModPhys.71.1267">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.71.1267">doi</a>.</a></li>
<li><a id="fuchs1998:pseud">[fuchs1998:pseud] Fuchs, Bockstedte, Pehlke, & Scheffler, Pseudopotential study of binding properties of  solids within generalized gradient approximations:  The role of core-valence exchange correlation, <i>Phys. Rev. B</i>, <b>57</b>, 2134-2145 (1998). <a href="http://link.aps.org/doi/10.1103/PhysRevB.57.2134">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.57.2134">doi</a>.</a></li>
<li><a id="perdew1982:elect-kohn-sham">[perdew1982:elect-kohn-sham] Perdew, Parr, Levy, & Balduz, Density-Functional Theory for Fractional Particle  Number: Derivative Discontinuities of the Energy, <i>Phys. Rev. Lett.</i>, <b>49</b>, 1691-1694 (1982). <a href="http://link.aps.org/doi/10.1103/PhysRevLett.49.1691">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevLett.49.1691">doi</a>.</a></li>
<li><a id="hammer1999:improv-pbe">[hammer1999:improv-pbe] Hammer, Hansen & N\orskov, Improved adsorption energetics within  density-functional theory using revised  Perdew-Burke-Ernzerhof functionals, <i>Phys. Rev. B</i>, <b>59</b>, 7413-7421 (1999). <a href="http://link.aps.org/doi/10.1103/PhysRevB.59.7413">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.59.7413">doi</a>.</a></li>
<li><a id="makov1995:period-bound-condit">[makov1995:period-bound-condit] Makov & Payne, Periodic boundary conditions in \textitab initio  calculations, <i>Phys. Rev. B</i>, <b>51</b>, 4014-4022 (1995). <a href="http://link.aps.org/doi/10.1103/PhysRevB.51.4014">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.51.4014">doi</a>.</a></li>
<li><a id="PhysRevB.8.5747">[PhysRevB.8.5747] Chadi & Cohen, Special Points in the Brillouin Zone, <i>Phys. Rev. B</i>, <b>8</b>, 5747-5753 (1973). <a href="http://link.aps.org/doi/10.1103/PhysRevB.8.5747">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.8.5747">doi</a>.</a></li>
<li><a id="PhysRevB.13.5188">[PhysRevB.13.5188] Monkhorst & Pack, Special points for Brillouin-zone integrations, <i>Phys. Rev. B</i>, <b>13</b>, 5188-5192 (1976). <a href="http://link.aps.org/doi/10.1103/PhysRevB.13.5188">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.13.5188">doi</a>.</a></li>
<li><a id="PhysRevB.43.1993">[PhysRevB.43.1993] Troullier & Martins, Efficient pseudopotentials for plane-wave  calculations, <i>Phys. Rev. B</i>, <b>43</b>, 1993-2006 (1991). <a href="http://link.aps.org/doi/10.1103/PhysRevB.43.1993">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.43.1993">doi</a>.</a></li>
<li><a id="PhysRevB.41.7892">[PhysRevB.41.7892] Vanderbilt, Soft self-consistent pseudopotentials in a  generalized eigenvalue formalism, <i>Phys. Rev. B</i>, <b>41</b>, 7892-7895 (1990). <a href="http://link.aps.org/doi/10.1103/PhysRevB.41.7892">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.41.7892">doi</a>.</a></li>
<li><a id="PhysRevB.56.15629">[PhysRevB.56.15629] Moroni, Kresse, Hafner, & Furthm\"uller, Ultrasoft pseudopotentials applied to magnetic Fe,  Co, and Ni: From atoms to solids, <i>Phys. Rev. B</i>, <b>56</b>, 15629-15646 (1997). <a href="http://link.aps.org/doi/10.1103/PhysRevB.56.15629">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.56.15629">doi</a>.</a></li>
<li><a id="PhysRevB.50.17953">[PhysRevB.50.17953] Bl\"ochl, Projector augmented-wave method, <i>Phys. Rev. B</i>, <b>50</b>, 17953-17979 (1994). <a href="http://link.aps.org/doi/10.1103/PhysRevB.50.17953">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.50.17953">doi</a>.</a></li>
<li><a id="PhysRevB.59.1758">[PhysRevB.59.1758] Kresse & Joubert, From ultrasoft pseudopotentials to the projector  augmented-wave method, <i>Phys. Rev. B</i>, <b>59</b>, 1758-1775 (1999). <a href="http://link.aps.org/doi/10.1103/PhysRevB.59.1758">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.59.1758">doi</a>.</a></li>
<li><a id="gillan1989:calcul">[gillan1989:calcul] M J Gillan, Calculation of the vacancy formation energy in  aluminium, <i>Journal of Physics: Condensed Matter</i>, <b>1(4)</b>, 689 (1989). <a href="http://stacks.iop.org/0953-8984/1/i=4/a=005">link</a>.</a></li>
<li><a id="PhysRev.137.A1441">[PhysRev.137.A1441] Mermin, Thermal Properties of the Inhomogeneous Electron  Gas, <i>Phys. Rev.</i>, <b>137</b>, A1441-A1443 (1965). <a href="http://link.aps.org/doi/10.1103/PhysRev.137.A1441">link</a>. <a href="http://dx.doi.org/10.1103/PhysRev.137.A1441">doi</a>.</a></li>
<li><a id="PhysRevB.54.11169">[PhysRevB.54.11169] Kresse & Furthm\"uller, Efficient iterative schemes for \textitab initio  total-energy calculations using a plane-wave basis  set, <i>Phys. Rev. B</i>, <b>54</b>, 11169-11186 (1996). <a href="http://link.aps.org/doi/10.1103/PhysRevB.54.11169">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.54.11169">doi</a>.</a></li>
<li><a id="PhysRevB.49.14251">[PhysRevB.49.14251] Kresse & Hafner, \textitAb initio molecular-dynamics simulation of  the liquid-metal/amorphous-semiconductor transition  in germanium, <i>Phys. Rev. B</i>, <b>49</b>, 14251-14269 (1994). <a href="http://link.aps.org/doi/10.1103/PhysRevB.49.14251">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.49.14251">doi</a>.</a></li>
<li><a id="PhysRevB.47.558">[PhysRevB.47.558] Kresse & Hafner, \textitAb initio molecular dynamics for liquid  metals, <i>Phys. Rev. B</i>, <b>47</b>, 558-561 (1993). <a href="http://link.aps.org/doi/10.1103/PhysRevB.47.558">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.47.558">doi</a>.</a></li>
<li><a id="paier:234102">[paier:234102] Joachim Paier, Robin Hirschl, Martijn Marsman, & Georg Kresse, The Perdew-Burke-Ernzerhof  exchange-correlation functional applied to the  G2-1 test set using a plane-wave basis set, <i>The Journal of Chemical Physics</i>, <b>122(23)</b>, 234102 (2005). <a href="http://link.aip.org/link/?JCP/122/234102/1">link</a>. <a href="http://dx.doi.org/10.1063/1.1926272">doi</a>.</a></li>
<li><a id="curtiss:1063">[curtiss:1063] Larry Curtiss, Krishnan Raghavachari, Paul, Redfern & John Pople, Assessment of Gaussian-2 and density functional  theories for the computation of enthalpies of  formation, <i>The Journal of Chemical Physics</i>, <b>106(3)</b>, 1063-1079 (1997). <a href="http://link.aip.org/link/?JCP/106/1063/1">link</a>. <a href="http://dx.doi.org/10.1063/1.473182">doi</a>.</a></li>
<li><a id="Henkelman2006354">[Henkelman2006354] "Graeme Henkelman, Andri Arnaldsson, Hannes & Jnsson", A fast and robust algorithm for Bader decomposition  of charge density, <i>"Computational Materials Science"</i>, <b>36(3)</b>, 354 - 360 (2006). <a href="http://www.sciencedirect.com/science/article/pii/S0927025605001849">link</a>. <a href="http://dx.doi.org/10.1016/j.commatsci.2005.04.010">doi</a>.</a></li>
<li><a id="doi.10.1021/ct100125x">[doi.10.1021/ct100125x] Manz & Sholl, Chemically Meaningful Atomic Charges That Reproduce  the Electrostatic Potential in Periodic and  Nonperiodic Materials, <i>Journal of Chemical Theory and Computation</i>, <b>6(8)</b>, 2455-2468 (2010). <a href="http://pubs.acs.org/doi/abs/10.1021/ct100125x">link</a>. <a href="http://dx.doi.org/10.1021/ct100125x">doi</a>.</a></li>
<li><a id="wilson1955">[wilson1955] Bright Wilson, Decius, Paul & Cross, Molecular Vibrations: The Theory of Infrared and  Raman Vibrational Spectra, Dover Publications (1955).</a></li>
<li><a id="giannozzi:8537">[giannozzi:8537] Paolo Giannozzi & Stefano Baroni, Vibrational and dielectric properties of C$_60$ from  density-functional perturbation theory, <i>The Journal of Chemical Physics</i>, <b>100(11)</b>, 8537-8539 (1994). <a href="http://link.aip.org/link/?JCP/100/8537/1">link</a>. <a href="http://dx.doi.org/10.1063/1.466753">doi</a>.</a></li>
<li><a id="0953-8984-22-26-265006">[0953-8984-22-26-265006] David Karhnek, Tom Buko & Jrgen Hafner, A density-functional study of the adsorption of  methane-thiol on the (111) surfaces of the  Ni-group metals: II. Vibrational spectroscopy, <i>Journal of Physics: Condensed Matter</i>, <b>22(26)</b>, 265006 (2010). <a href="http://stacks.iop.org/0953-8984/22/i=26/a=265006">link</a>.</a></li>
<li><a id="springerlink-10.1007/s00214-007-0328-0">[springerlink-10.1007/s00214-007-0328-0] Fernndez-Ramos, Ellingson, , Meana-Paeda, Marques, Truhlar & Donald, Symmetry numbers and chemical reaction rates, <i>Theoretical Chemistry Accounts: Theory, Computation,
                  and Modeling (Theoretica Chimica Acta)</i>, <b>118</b>, 813-826 (2007). <a href="http://dx.doi.org/10.1007/s00214-007-0328-0">link</a>.</a></li>
<li><a id="sheppard:134106">[sheppard:134106] Daniel Sheppard, Rye Terrell, Graeme & Henkelman, Optimization methods for finding minimum energy  paths, <i>The Journal of Chemical Physics</i>, <b>128(13)</b>, 134106 (2008). <a href="http://link.aip.org/link/?JCP/128/134106/1">link</a>. <a href="http://dx.doi.org/10.1063/1.2841941">doi</a>.</a></li>
<li><a id="olsen:9776">[olsen:9776] Olsen, Kroes, Henkelman, , Arnaldsson & Jonsson, Comparison of methods for finding saddle points  without knowledge of the final states, <i>The Journal of Chemical Physics</i>, <b>121(20)</b>, 9776-9792 (2004). <a href="http://link.aip.org/link/?JCP/121/9776/1">link</a>. <a href="http://dx.doi.org/10.1063/1.1809574">doi</a>.</a></li>
<li><a id="mattsson-084714">[mattsson-084714] Ann Mattsson, Rickard Armiento, Joachim, Paier, Georg Kresse, John Wills, Thomas & Mattsson, The AM05 density functional applied to solids, <i>The Journal of Chemical Physics</i>, <b>128(8)</b>, 084714 (2008). <a href="http://link.aip.org/link/?JCP/128/084714/1">link</a>. <a href="http://dx.doi.org/10.1063/1.2835596">doi</a>.</a></li>
<li><a id="PhysRevB.65.104104">[PhysRevB.65.104104] Le Page & Saxe, Symmetry-general least-squares extraction of elastic  data for strained materials from \textitab initio  calculations of stress, <i>Phys. Rev. B</i>, <b>65</b>, 104104 (2002). <a href="http://link.aps.org/doi/10.1103/PhysRevB.65.104104">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.65.104104">doi</a>.</a></li>
<li><a id="Shang20101040">[Shang20101040] "Shun-Li Shang, Yi Wang, DongEung Kim, & Zi-Kui Liu", First-principles thermodynamics from phonon and  Debye model: Application to Ni and Ni3Al, <i>"Computational Materials Science"</i>, <b>47(4)</b>, 1040 - 1048 (2010). <a href="http://www.sciencedirect.com/science/article/pii/S0927025609004558">link</a>. <a href="http://dx.doi.org/10.1016/j.commatsci.2009.12.006">doi</a>.</a></li>
<li><a id="vandeWalle2002539">[vandeWalle2002539] "van de Walle, Asta & Ceder", The alloy theoretic automated toolkit: A user guide, <i>"Calphad"</i>, <b>26(4)</b>, 539 - 553 (2002). <a href="http://www.sciencedirect.com/science/article/pii/S0364591602800062">link</a>. <a href="http://dx.doi.org/10.1016/S0364-5916(02)80006-2">doi</a>.</a></li>
<li><a id="vandeWalle2009266">[vandeWalle2009266] "Axel van de Walle", Multicomponent multisublattice alloys,  nonconfigurational entropy and other additions to  the Alloy Theoretic Automated Toolkit, <i>"Calphad"</i>, <b>33(2)</b>, 266 - 278 (2009). <a href="http://www.sciencedirect.com/science/article/pii/S0364591608001314">link</a>. <a href="http://dx.doi.org/10.1016/j.calphad.2008.12.005">doi</a>.</a></li>
<li><a id="PhysRevB.73.195107">[PhysRevB.73.195107] Wang, Maxisch & Ceder, Oxidation energies of transition metal oxides within  the $\mathrmGGA+\mathrmU$ framework, <i>Phys. Rev. B</i>, <b>73</b>, 195107 (2006). <a href="http://link.aps.org/doi/10.1103/PhysRevB.73.195107">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.73.195107">doi</a>.</a></li>
<li><a id="kleinman1997:signif-kohn-sham">[kleinman1997:signif-kohn-sham] Kleinman, Significance of the highest occupied Kohn-Sham  eigenvalue, <i>Phys. Rev. B</i>, <b>56</b>, 12042-12045 (1997). <a href="http://link.aps.org/doi/10.1103/PhysRevB.56.12042">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.56.12042">doi</a>.</a></li>
<li><a id="perdew1997">[perdew1997] Perdew & Levy, Comment on "Significance of the highest occupied  Kohn-Sham eigenvalue", <i>Phys. Rev. B</i>, <b>56</b>, 16021-16028 (1997). <a href="http://link.aps.org/doi/10.1103/PhysRevB.56.16021">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.56.16021">doi</a>.</a></li>
<li><a id="kleinman1997:reply-commen-kohn-sham">[kleinman1997:reply-commen-kohn-sham] Kleinman, Reply to "Comment on 'Significance of the  highest occupied Kohn-Sham eigenvalue' ", <i>Phys. Rev. B</i>, <b>56</b>, 16029-16030 (1997). <a href="http://link.aps.org/doi/10.1103/PhysRevB.56.16029">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.56.16029">doi</a>.</a></li>
<li><a id="stowasser1999:what-kohn-sham">[stowasser1999:what-kohn-sham] Stowasser & Hoffmann, What Do the Kohn-Sham Orbitals and  Eigenvalues Mean?, <i>Journal of the American Chemical Society</i>, <b>121(14)</b>, 3414-3420 (1999). <a href="http://pubs.acs.org/doi/abs/10.1021/ja9826892">link</a>. <a href="http://dx.doi.org/10.1021/ja9826892">doi</a>.</a></li>
<li><a id="gritsenko2002">[gritsenko2002] Gritsenko & Baerends, The analog of Koopmans' theorem in spin-density  functional theory, <i>The Journal of Chemical Physics</i>, <b>117(20)</b>, 9154-9159 (2002). <a href="http://link.aip.org/link/?JCP/117/9154/1">link</a>. <a href="http://dx.doi.org/10.1063/1.1516800">doi</a>.</a></li>
<li><a id="jones1989">[jones1989] Jones & Gunnarsson, The density functional formalism, its applications  and prospects, <i>Rev. Mod. Phys.</i>, <b>61</b>, 689-746 (1989). <a href="http://link.aps.org/doi/10.1103/RevModPhys.61.689">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.61.689">doi</a>.</a></li>
<li><a id="perdew1981:self">[perdew1981:self] Perdew & Zunger, Self-interaction correction to density-functional  approximations for many-electron systems, <i>Phys. Rev. B</i>, <b>23</b>, 5048-5079 (1981). <a href="http://link.aps.org/doi/10.1103/PhysRevB.23.5048">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.23.5048">doi</a>.</a></li>
<li><a id="sanchez-portal1995:projec">[sanchez-portal1995:projec] "Daniel Sanchez-Portal, Emilio Artacho, Jose M & Soler", Projection of plane-wave calculations into atomic  orbitals, <i>"Solid State Communications"</i>, <b>95(10)</b>, 685 - 690 (1995). <a href="http://www.sciencedirect.com/science/article/pii/003810989500341X">link</a>. <a href="http://dx.doi.org/10.1016/0038-1098(95)00341-X">doi</a>.</a></li>
<li><a id="segall1996:popul">[segall1996:popul] Segall, Shah, Pickard, & Payne, Population analysis of plane-wave electronic  structure calculations of bulk materials, <i>Phys. Rev. B</i>, <b>54</b>, 16317-16320 (1996). <a href="http://link.aps.org/doi/10.1103/PhysRevB.54.16317">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.54.16317">doi</a>.</a></li>
<li><a id="segall1996:popul-mp">[segall1996:popul-mp] Segall, Pickard, Shah, & Payne, Population analysis in plane wave electronic  structure calculations, <i>Mol. Phys.</i>, <b>89(2)</b>, 571-577 (1996).</a></li>
<li><a id="ruban1997:surfac">[ruban1997:surfac] "A Ruban, B Hammer, P Stoltze, L Skriver, & K Nrskov", Surface electronic structure and reactivity of  transition and noble metals, <i>"Journal of Molecular Catalysis A: Chemical"</i>, <b>115(3)</b>, 421 - 429 (1997). <a href="http://www.sciencedirect.com/science/article/pii/S1381116996003482">link</a>. <a href="http://dx.doi.org/10.1016/S1381-1169(96)00348-2">doi</a>.</a></li>
<li><a id="cottrell1988">[cottrell1988] Cottrell, Introduction to the Modern Theory of Metals, The Institute of Metals (1988).</a></li>
<li><a id="ducastelle1991">[ducastelle1991] Ducastelle, Order and Phase Stability in Alloys, Elsevier Science Publishers (1991).</a></li>
<li><a id="pettifor1992:elect-theor-alloy-desig">[pettifor1992:elect-theor-alloy-desig] Pettifor & Cottrell, Electon Theory in Alloy Design, The Institute of Materials (1992).</a></li>
<li><a id="RevModPhys.73.515">[RevModPhys.73.515] Baroni, de Gironcoli, Dal, Corso & Giannozzi, Phonons and related crystal properties from  density-functional perturbation theory, <i>Rev. Mod. Phys.</i>, <b>73</b>, 515-562 (2001). <a href="http://link.aps.org/doi/10.1103/RevModPhys.73.515">link</a>. <a href="http://dx.doi.org/10.1103/RevModPhys.73.515">doi</a>.</a></li>
<li><a id="Caspersen10052005">[Caspersen10052005] Caspersen & Carter, Finding transition states for crystalline  solid/solid phase transformations, <i>Proceedings of the National Academy of Sciences of
                  the United States of America</i>, <b>102(19)</b>, 6738-6743 (2005). <a href="http://www.pnas.org/content/102/19/6738.abstract">link</a>. <a href="http://dx.doi.org/10.1073/pnas.0408127102">doi</a>.</a></li>
<li><a id="sheppard:074103">[sheppard:074103] Daniel Sheppard, Penghao Xiao, William, Chemelewski, Duane Johnson, Graeme & Henkelman, A generalized solid-state nudged elastic band  method, <i>The Journal of Chemical Physics</i>, <b>136(7)</b>, 074103 (2012). <a href="http://link.aip.org/link/?JCP/136/074103/1">link</a>. <a href="http://dx.doi.org/10.1063/1.3684549">doi</a>.</a></li>
<li><a id="PhysRevB.56.10518">[PhysRevB.56.10518] Ritz, Schmid, Varga, Borg, & R\onning, Pt(100) quasihexagonal reconstruction: A comparison  between scanning tunneling microscopy data and  effective medium theory simulation calculations, <i>Phys. Rev. B</i>, <b>56</b>, 10518-10525 (1997). <a href="http://link.aps.org/doi/10.1103/PhysRevB.56.10518">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.56.10518">doi</a>.</a></li>
<li><a id="PhysRevB.82.161418">[PhysRevB.82.161418] Havu, Blum, Havu, , Rinke & Scheffler, Large-scale surface reconstruction energetics of  Pt(100) and Au(100) by all-electron density  functional theory, <i>Phys. Rev. B</i>, <b>82</b>, 161418 (2010). <a href="http://link.aps.org/doi/10.1103/PhysRevB.82.161418">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.82.161418">doi</a>.</a></li>
<li><a id="PhysRevB.83.075415">[PhysRevB.83.075415] Chen, Schmidt, Schneider, & Wolverton, First-principles cluster expansion study of  missing-row reconstructions of fcc (110) surfaces, <i>Phys. Rev. B</i>, <b>83</b>, 075415 (2011). <a href="http://link.aps.org/doi/10.1103/PhysRevB.83.075415">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.83.075415">doi</a>.</a></li>
<li><a id="PhysRevLett.59.2307">[PhysRevLett.59.2307] Frenken, Krans, van der Veen, , Holub-Krappe & Horn, Missing-row surface reconstruction of Ag(110)  induced by potassium adsorption, <i>Phys. Rev. Lett.</i>, <b>59</b>, 2307-2310 (1987). <a href="http://link.aps.org/doi/10.1103/PhysRevLett.59.2307">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevLett.59.2307">doi</a>.</a></li>
<li><a id="PhysRevB.49.16798">[PhysRevB.49.16798] Boettger, Nonconvergence of surface energies obtained from  thin-film calculations, <i>Phys. Rev. B</i>, <b>49</b>, 16798-16800 (1994). <a href="http://link.aps.org/doi/10.1103/PhysRevB.49.16798">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.49.16798">doi</a>.</a></li>
<li><a id="0953-8984-10-4-017">[0953-8984-10-4-017] Boettger, John Smith, Uwe Birkenheuer, , Notker Rsch, Trickey, John Sabin, & Peter Apell, Extracting convergent surface formation energies  from slab calculations, <i>Journal of Physics: Condensed Matter</i>, <b>10(4)</b>, 893 (1998). <a href="http://stacks.iop.org/0953-8984/10/i=4/a=017">link</a>.</a></li>
<li><a id="Fiolhais2003209">[Fiolhais2003209] "Carlos Fiolhais, Almeida & Henriques", Extraction of aluminium surface energies from slab  calculations: perturbative and non-perturbative  approaches, <i>"Progress in Surface Science"</i>, <b>74(18)</b>, 209 - 217 (2003). <a href="http://www.sciencedirect.com/science/article/pii/S0079681603000777">link</a>. <a href="http://dx.doi.org/10.1016/j.progsurf.2003.08.017">doi</a>.</a></li>
<li><a id="PhysRevB.75.115131">[PhysRevB.75.115131] Tran, Laskowski, Blaha, & Schwarz, Performance on molecules, surfaces, and solids of  the Wu-Cohen GGA exchange-correlation energy  functional, <i>Phys. Rev. B</i>, <b>75</b>, 115131 (2007). <a href="http://link.aps.org/doi/10.1103/PhysRevB.75.115131">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.75.115131">doi</a>.</a></li>
<li><a id="doi.10.1021/jp200950a">[doi.10.1021/jp200950a] Han, Li & Sholl, Density Functional Theory Study of H and CO  Adsorption on Alkali-Promoted Mo$_2$C Surfaces, <i>The Journal of Physical Chemistry C</i>, <b>115(14)</b>, 6870-6876 (2011). <a href="http://pubs.acs.org/doi/abs/10.1021/jp200950a">link</a>. <a href="http://dx.doi.org/10.1021/jp200950a">doi</a>.</a></li>
<li><a id="Inoglu2009188">[Inoglu2009188] "Nilay nolu & John Kitchin", Atomistic thermodynamics study of the adsorption and  the effects of watergas shift reactants on Cu  catalysts under reaction conditions, <i>"Journal of Catalysis"</i>, <b>261(2)</b>, 188 - 194 (2009). <a href="http://www.sciencedirect.com/science/article/pii/S0021951708004314">link</a>. <a href="http://dx.doi.org/10.1016/j.jcat.2008.11.020">doi</a>.</a></li>
<li><a id="Vitos1998186">[Vitos1998186] "Vitos, Ruban, Skriver, & Kollr", The surface energy of metals, <i>"Surface Science"</i>, <b>411(12)</b>, 186 - 202 (1998). <a href="http://www.sciencedirect.com/science/article/pii/S003960289800363X">link</a>. <a href="http://dx.doi.org/10.1016/S0039-6028(98)00363-X">doi</a>.</a></li>
<li><a id="PhysRevB.46.16067">[PhysRevB.46.16067] Neugebauer & Scheffler, Adsorbate-substrate and adsorbate-adsorbate  interactions of Na and K adlayers on Al(111), <i>Phys. Rev. B</i>, <b>46</b>, 16067-16080 (1992). <a href="http://link.aps.org/doi/10.1103/PhysRevB.46.16067">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.46.16067">doi</a>.</a></li>
<li><a id="PhysRevB.59.12301">[PhysRevB.59.12301] Bengtsson, Dipole correction for surface supercell  calculations, <i>Phys. Rev. B</i>, <b>59</b>, 12301-12304 (1999). <a href="http://link.aps.org/doi/10.1103/PhysRevB.59.12301">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.59.12301">doi</a>.</a></li>
<li><a id="morikawa2001:c2h2-si">[morikawa2001:c2h2-si] Morikawa, Adsorption geometries and vibrational modes of  C$_2$H$_2$ on the Si(001) surface, <i>Phys. Rev. B</i>, <b>63</b>, 033405 (2001). <a href="http://link.aps.org/doi/10.1103/PhysRevB.63.033405">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.63.033405">doi</a>.</a></li>
<li><a id="PhysRevB.82.045414">[PhysRevB.82.045414] \ifmmode \dotI\else I\fino\ifmmode, \breveg\else \ug\filu, Kitchin & , Simple model explaining and predicting  coverage-dependent atomic adsorption energies on  transition metal surfaces, <i>Phys. Rev. B</i>, <b>82</b>, 045414 (2010). <a href="http://link.aps.org/doi/10.1103/PhysRevB.82.045414">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.82.045414">doi</a>.</a></li>
<li><a id="miller:104709">[miller:104709] Spencer Miller, Nilay Inoglu, John & Kitchin, Configurational correlations in the coverage  dependent adsorption energies of oxygen atoms on  late transition metal fcc(111) surfaces, <i>The Journal of Chemical Physics</i>, <b>134(10)</b>, 104709 (2011). <a href="http://link.aip.org/link/?JCP/134/104709/1">link</a>. <a href="http://dx.doi.org/10.1063/1.3561287">doi</a>.</a></li>
<li><a id="Miller2009794">[Miller2009794] "Spencer Miller & John Kitchin", Relating the coverage dependence of oxygen  adsorption on Au and Pt fcc(111) surfaces  through adsorbate-induced surface electronic  structure effects, <i>"Surface Science"</i>, <b>603(5)</b>, 794 - 801 (2009). <a href="http://www.sciencedirect.com/science/article/pii/S0039602809001186">link</a>. <a href="http://dx.doi.org/10.1016/j.susc.2009.01.021">doi</a>.</a></li>
<li><a id="PhysRevB.79.205412">[PhysRevB.79.205412] Kitchin, Correlations in coverage-dependent atomic adsorption  energies on Pd(111), <i>Phys. Rev. B</i>, <b>79</b>, 205412 (2009). <a href="http://link.aps.org/doi/10.1103/PhysRevB.79.205412">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.79.205412">doi</a>.</a></li>
<li><a id="PhysRevB.77.075437">[PhysRevB.77.075437] Kitchin, Reuter, Scheffler & Matthias, Alloy surface segregation in reactive environments:  First-principles atomistic thermodynamics study of  Ag$_3$Pd$(111)$ in oxygen atmospheres, <i>Phys. Rev. B</i>, <b>77</b>, 075437 (2008). <a href="http://link.aps.org/doi/10.1103/PhysRevB.77.075437">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.77.075437">doi</a>.</a></li>
<li><a id="ANIE.ANIE200602223">[ANIE.ANIE200602223] Nilekar, Greeley, & Mavrikakis, A Simple Rule of Thumb for Diffusion on  Transition-Metal Surfaces, <i>Angewandte Chemie International Edition</i>, <b>45(42)</b>, 7046-7049 (2006). <a href="http://dx.doi.org/10.1002/anie.200602223">link</a>. <a href="http://dx.doi.org/10.1002/anie.200602223">doi</a>.</a></li>
<li><a id="henkelman:9901">[henkelman:9901] Graeme Henkelman, Blas Uberuaga, Hannes & Jonsson, A climbing image nudged elastic band method for  finding saddle points and minimum energy paths, <i>The Journal of Chemical Physics</i>, <b>113(22)</b>, 9901-9904 (2000). <a href="http://link.aip.org/link/?JCP/113/9901/1">link</a>. <a href="http://dx.doi.org/10.1063/1.1329672">doi</a>.</a></li>
<li><a id="doi-10.1021/jp810518x">[doi-10.1021/jp810518x] Deshlahra, Wolf & Schneider, A Periodic Density Functional Theory Analysis of CO  Chemisorption on Pt(111) in the Presence of Uniform  Electric Fields, <i>The Journal of Physical Chemistry A</i>, <b>113(16)</b>, 4125-4133 (2009). <a href="http://pubs.acs.org/doi/abs/10.1021/jp810518x">link</a>. <a href="http://dx.doi.org/10.1021/jp810518x">doi</a>.</a></li>
<li><a id="PhysRevB.82.195128">[PhysRevB.82.195128] Meredig, Thompson, Hansen, , Wolverton & van de Walle, Method for locating low-energy solutions within  $\textDFT+U$, <i>Phys. Rev. B</i>, <b>82</b>, 195128 (2010). <a href="http://link.aps.org/doi/10.1103/PhysRevB.82.195128">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.82.195128">doi</a>.</a></li>
<li><a id="PhysRevB.84.045115">[PhysRevB.84.045115] Jain, Hautier, Ong, Ping, Moore, Fischer, , Persson & Ceder, Formation enthalpies by mixing GGA and GGA $+$  $U$ calculations, <i>Phys. Rev. B</i>, <b>84</b>, 045115 (2011). <a href="http://link.aps.org/doi/10.1103/PhysRevB.84.045115">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.84.045115">doi</a>.</a></li>
<li><a id="JCC-JCC20495">[JCC-JCC20495] Grimme, Semiempirical GGA-type density functional  constructed with a long-range dispersion correction, <i>Journal of Computational Chemistry</i>, <b>27(15)</b>, 1787-1799 (2006). <a href="http://dx.doi.org/10.1002/jcc.20495">link</a>. <a href="http://dx.doi.org/10.1002/jcc.20495">doi</a>.</a></li>
<li><a id="klimes-2011-van-waals">[klimes-2011-van-waals] Ji\'i Klime\vs, David Bowler & Angelos Michaelides, Van Der Waals Density Functionals Applied To Solids, <i>Physical Review B</i>, <b>83(19)</b>, nil (2011). <a href="http://dx.doi.org/10.1103/PhysRevB.83.195131">link</a>. <a href="http://dx.doi.org/10.1103/physrevb.83.195131">doi</a>.</a></li>
<li><a id="tkatchenko-2009-accur-molec">[tkatchenko-2009-accur-molec] Alexandre Tkatchenko & Matthias Scheffler, Accurate Molecular Van Der Waals Interactions From  Ground-State Electron Density and Free-Atom Reference Data, <i>Phys. Rev. Lett.</i>, <b>102(7)</b>, nil (2009). <a href="http://dx.doi.org/10.1103/physrevlett.102.073005">link</a>. <a href="http://dx.doi.org/10.1103/physrevlett.102.073005">doi</a>.</a></li>
<li><a id="silvi1994">[silvi1994] Silvi & Savin, Classification of chemical bonds based on  topological analysis of electron localization  functions, <i>Nature</i>, <b>371</b>, 683-686 (1994). <a href="http://dx.doi.org/10.1038/371683a0">link</a>.</a></li>
<li><a id="doi.10.1021/jp202489s">[doi.10.1021/jp202489s] Deringer, Tchougreeff, & Dronskowski, Crystal Orbital Hamilton Population (COHP) Analysis  As Projected from Plane-Wave Basis Sets, <i>The Journal of Physical Chemistry A</i>, <b>115(21)</b>, 5461-5466 (2011). <a href="http://pubs.acs.org/doi/abs/10.1021/jp202489s">link</a>. <a href="http://dx.doi.org/10.1021/jp202489s">doi</a>.</a></li>
<li><a id="wellendorff-2012-densit">[wellendorff-2012-densit] Jess Wellendorff, Keld Lundgaard, Andreas, M\ogelh\oj, Vivien Petzold, David, Landis, Jens N\orskov, Thomas Bligaard, & Karsten Jacobsen, Density Functionals for Surface Science:  Exchange-Correlation Model Development With Bayesian  Error Estimation, <i>Physical Review B</i>, <b>85(23)</b>, nil (2012). <a href="http://dx.doi.org/10.1103/physrevb.85.235149">link</a>. <a href="http://dx.doi.org/10.1103/physrevb.85.235149">doi</a>.</a></li>
<li><a id="fishman-2013-accur">[fishman-2013-accur] Matthew Fishman, Houlong Zhuang, Kiran Mathew, , William Dirschka & Richard Hennig, Accuracy of Exchange-Correlation Functionals and Effect of  Solvation on the Surface Energy of Copper, <i>Physical Review B</i>, <b>87(24)</b>, nil (2013). <a href="http://dx.doi.org/10.1103/PhysRevB.87.245402">link</a>. <a href="http://dx.doi.org/10.1103/physrevb.87.245402">doi</a>.</a></li>
<li><a id="mathew-2014-implic">[mathew-2014-implic] Kiran Mathew, Ravishankar Sundararaman, Kendra, Letchworth-Weaver, Arias & Richard Hennig, Implicit Solvation Model for Density-Functional Study of  Nanocrystal Surfaces and Reaction Pathways, <i>J. Chem. Phys.</i>, <b>140(8)</b>, 084106 (2014). <a href="http://dx.doi.org/10.1063/1.4865107">link</a>. <a href="http://dx.doi.org/10.1063/1.4865107">doi</a>.</a></li>
<li><a id="PhysRevB.70.224107">[PhysRevB.70.224107] Hebbache & Zemzemi, \textitAb initio study of high-pressure behavior  of a low compressibility metal and a hard  material:\quadOsmium and diamond, <i>Phys. Rev. B</i>, <b>70</b>, 224107 (2004). <a href="http://link.aps.org/doi/10.1103/PhysRevB.70.224107">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.70.224107">doi</a>.</a></li>
<li><a id="Murnaghan1944">[Murnaghan1944] Murnaghan, The Compressibility of Media under Extreme  Pressures, <i>Proceedings of the National Academy of Sciences of
                  the United States of America</i>, <b>30(9)</b>, pp. 244-247 (1944). <a href="http://www.jstor.org/stable/87468">link</a>.</a></li>
<li><a id="PhysRevB.28.5480">[PhysRevB.28.5480] Fu & Ho, First-principles calculation of the equilibrium  ground-state properties of transition metals:  Applications to Nb and Mo, <i>Phys. Rev. B</i>, <b>28</b>, 5480-5486 (1983). <a href="http://link.aps.org/doi/10.1103/PhysRevB.28.5480">link</a>. <a href="http://dx.doi.org/10.1103/PhysRevB.28.5480">doi</a>.</a></li>
<li><a id="Birch">[Birch] @InBookBirch,
  author =       Michael J. Mehl and Barry M. Klein and Dimitri
                  A. Papaconstantopoulos,
  editor =       J. H. Westbrook and R. L. Fleischer,
  title =        Intermetallic Compounds: Principles and Principles,
                  Volume I: Principles,
  chapter =      First principles calculations of elastic properties
                  of metals,
  publisher =    John Wiley and Sons,
  year =         1995,
  volume =       I,
  pages =        195-210,
  url =
                  http://cst-www.nrl.navy.mil/users/mehl/papers/cij453.pdf
</a></li>
<li><a id="Mayer200323">[Mayer200323] "Mayer, Anton, Bott, Methfessel, , Sticht, Harris & Schmidt", Ab-initio calculation of the elastic constants and  thermal expansion coefficients of Laves phases, <i>"Intermetallics"</i>, <b>11(1)</b>, 23 - 32 (2003). <a href="http://www.sciencedirect.com/science/article/pii/S0966979502001279">link</a>. <a href="http://dx.doi.org/10.1016/S0966-9795(02)00127-9">doi</a>.</a></li>
</ul>
</p>
</div>
</div>

<div id="outline-container-orgheadline238" class="outline-2">
<h2 id="orgheadline238"><span class="section-number-2">13</span> GNU Free Documentation License</h2>
<div class="outline-text-2" id="text-13">
<pre class="example">
                GNU Free Documentation License
                 Version 1.3, 3 November 2008


 Copyright (C) 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
     &lt;http://fsf.org/&gt;
 Everyone is permitted to copy and distribute verbatim copies
 of this license document, but changing it is not allowed.

0. PREAMBLE

The purpose of this License is to make a manual, textbook, or other
functional and useful document "free" in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.

This License is a kind of "copyleft", which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.

We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.


1. APPLICABILITY AND DEFINITIONS

This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The "Document", below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as "you".  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.

A "Modified Version" of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.

A "Secondary Section" is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document's overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.

The "Invariant Sections" are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.

The "Cover Texts" are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.

A "Transparent" copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not "Transparent" is called "Opaque".

Examples of suitable formats for Transparent copies include plain
ASCII without markup, Texinfo input format, LaTeX input format, SGML
or XML using a publicly available DTD, and standard-conforming simple
HTML, PostScript or PDF designed for human modification.  Examples of
transparent image formats include PNG, XCF and JPG.  Opaque formats
include proprietary formats that can be read and edited only by
proprietary word processors, SGML or XML for which the DTD and/or
processing tools are not generally available, and the
machine-generated HTML, PostScript or PDF produced by some word
processors for output purposes only.

The "Title Page" means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, "Title Page" means
the text near the most prominent appearance of the work's title,
preceding the beginning of the body of the text.

The "publisher" means any person or entity that distributes copies of
the Document to the public.

A section "Entitled XYZ" means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as "Acknowledgements",
"Dedications", "Endorsements", or "History".)  To "Preserve the Title"
of such a section when you modify the Document means that it remains a
section "Entitled XYZ" according to this definition.

The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.

2. VERBATIM COPYING

You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no
other conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.

You may also lend copies, under the same conditions stated above, and
you may publicly display copies.


3. COPYING IN QUANTITY

If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document's license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.

If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.

If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.

It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to
give them a chance to provide you with an updated version of the
Document.


4. MODIFICATIONS

You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:

A. Use in the Title Page (and on the covers, if any) a title distinct
   from that of the Document, and from those of previous versions
   (which should, if there were any, be listed in the History section
   of the Document).  You may use the same title as a previous version
   if the original publisher of that version gives permission.
B. List on the Title Page, as authors, one or more persons or entities
   responsible for authorship of the modifications in the Modified
   Version, together with at least five of the principal authors of the
   Document (all of its principal authors, if it has fewer than five),
   unless they release you from this requirement.
C. State on the Title page the name of the publisher of the
   Modified Version, as the publisher.
D. Preserve all the copyright notices of the Document.
E. Add an appropriate copyright notice for your modifications
   adjacent to the other copyright notices.
F. Include, immediately after the copyright notices, a license notice
   giving the public permission to use the Modified Version under the
   terms of this License, in the form shown in the Addendum below.
G. Preserve in that license notice the full lists of Invariant Sections
   and required Cover Texts given in the Document's license notice.
H. Include an unaltered copy of this License.
I. Preserve the section Entitled "History", Preserve its Title, and add
   to it an item stating at least the title, year, new authors, and
   publisher of the Modified Version as given on the Title Page.  If
   there is no section Entitled "History" in the Document, create one
   stating the title, year, authors, and publisher of the Document as
   given on its Title Page, then add an item describing the Modified
   Version as stated in the previous sentence.
J. Preserve the network location, if any, given in the Document for
   public access to a Transparent copy of the Document, and likewise
   the network locations given in the Document for previous versions
   it was based on.  These may be placed in the "History" section.
   You may omit a network location for a work that was published at
   least four years before the Document itself, or if the original
   publisher of the version it refers to gives permission.
K. For any section Entitled "Acknowledgements" or "Dedications",
   Preserve the Title of the section, and preserve in the section all
   the substance and tone of each of the contributor acknowledgements
   and/or dedications given therein.
L. Preserve all the Invariant Sections of the Document,
   unaltered in their text and in their titles.  Section numbers
   or the equivalent are not considered part of the section titles.
M. Delete any section Entitled "Endorsements".  Such a section
   may not be included in the Modified Version.
N. Do not retitle any existing section to be Entitled "Endorsements"
   or to conflict in title with any Invariant Section.
O. Preserve any Warranty Disclaimers.

If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version's license notice.
These titles must be distinct from any other section titles.

You may add a section Entitled "Endorsements", provided it contains
nothing but endorsements of your Modified Version by various
parties--for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.

You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.

The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.


5. COMBINING DOCUMENTS

You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.

The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.

In the combination, you must combine any sections Entitled "History"
in the various original documents, forming one section Entitled
"History"; likewise combine any sections Entitled "Acknowledgements",
and any sections Entitled "Dedications".  You must delete all sections
Entitled "Endorsements".


6. COLLECTIONS OF DOCUMENTS

You may make a collection consisting of the Document and other
documents released under this License, and replace the individual
copies of this License in the various documents with a single copy
that is included in the collection, provided that you follow the rules
of this License for verbatim copying of each of the documents in all
other respects.

You may extract a single document from such a collection, and
distribute it individually under this License, provided you insert a
copy of this License into the extracted document, and follow this
License in all other respects regarding verbatim copying of that
document.


7. AGGREGATION WITH INDEPENDENT WORKS

A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an "aggregate" if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation's users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.

If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document's Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.


8. TRANSLATION

Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.

If a section in the Document is Entitled "Acknowledgements",
"Dedications", or "History", the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.


9. TERMINATION

You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.

However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.

Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.

Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.


10. FUTURE REVISIONS OF THIS LICENSE

The Free Software Foundation may publish new, revised versions of the
GNU Free Documentation License from time to time.  Such new versions
will be similar in spirit to the present version, but may differ in
detail to address new problems or concerns.  See
http://www.gnu.org/copyleft/.

Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy's public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.

11. RELICENSING

"Massive Multiauthor Collaboration Site" (or "MMC Site") means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
"Massive Multiauthor Collaboration" (or "MMC") contained in the site
means any set of copyrightable works thus published on the MMC site.

"CC-BY-SA" means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.

"Incorporate" means to publish or republish a Document, in whole or in
part, as part of another Document.

An MMC is "eligible for relicensing" if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole or
in part into the MMC, (1) had no cover texts or invariant sections, and
(2) were thus incorporated prior to November 1, 2008.

The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.
</pre>
</div>
</div>

<div id="outline-container-orgheadline239" class="outline-2">
<h2 id="orgheadline239"><span class="section-number-2">14</span> Index</h2>
<div class="outline-text-2" id="text-14">
<p>
<a href="pind">Print index</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2012-07-11 Wed</p>
<p class="author">Author: John Kitchin</p>
<p class="date">Created: 2016-06-03 Fri 12:55</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
